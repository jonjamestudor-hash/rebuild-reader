!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(e){return!(!e||"undefined"==typeof e.length)}function t(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],c(e,this)}function r(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(r){return void f(n.promise,r)}i(n.promise,o)}else(1===e._state?i:f)(n.promise,e._value)})):e._deferreds.push(n)}function i(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof o)return e._state=3,e._value=n,void u(e);if("function"==typeof t)return void c(function(e,n){return function(){e.apply(n,arguments)}}(t,n),e)}e._state=1,e._value=n,u(e)}catch(r){f(e,r)}}function f(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;t>n;n++)r(e,e._deferreds[n]);e._deferreds=null}function c(e,n){var t=!1;try{e(function(e){t||(t=!0,i(n,e))},function(e){t||(t=!0,f(n,e))})}catch(o){if(t)return;t=!0,f(n,o)}}var a=setTimeout;o.prototype["catch"]=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return r(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,n,o)),o},o.prototype["finally"]=e,o.all=function(e){return new o(function(t,o){function r(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var u=n.then;if("function"==typeof u)return void u.call(n,function(n){r(e,n)},o)}i[e]=n,0==--f&&t(i)}catch(c){o(c)}}if(!n(e))return o(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var f=i.length,u=0;i.length>u;u++)r(u,i[u])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(t,r){if(!n(e))return r(new TypeError("Promise.race accepts an array"));for(var i=0,f=e.length;f>i;i++)o.resolve(e[i]).then(t,r)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){a(e,0)},o._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype["finally"]||(l.Promise.prototype["finally"]=e):l.Promise=o});

!function(){"use strict";function o(){var o=window,t=document;if(!("scrollBehavior"in t.documentElement.style&&!0!==o.__forceSmoothScrollPolyfill__)){var l,e=o.HTMLElement||o.Element,r=468,i={scroll:o.scroll||o.scrollTo,scrollBy:o.scrollBy,elementScroll:e.prototype.scroll||n,scrollIntoView:e.prototype.scrollIntoView},s=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now,c=(l=o.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(l)?1:0);o.scroll=o.scrollTo=function(){void 0!==arguments[0]&&(!0!==f(arguments[0])?h.call(o,t.body,void 0!==arguments[0].left?~~arguments[0].left:o.scrollX||o.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:o.scrollY||o.pageYOffset):i.scroll.call(o,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:o.scrollX||o.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:o.scrollY||o.pageYOffset))},o.scrollBy=function(){void 0!==arguments[0]&&(f(arguments[0])?i.scrollBy.call(o,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):h.call(o,t.body,~~arguments[0].left+(o.scrollX||o.pageXOffset),~~arguments[0].top+(o.scrollY||o.pageYOffset)))},e.prototype.scroll=e.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==f(arguments[0])){var o=arguments[0].left,t=arguments[0].top;h.call(this,this,void 0===o?this.scrollLeft:~~o,void 0===t?this.scrollTop:~~t)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},e.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==f(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},e.prototype.scrollIntoView=function(){if(!0!==f(arguments[0])){var l=function(o){for(;o!==t.body&&!1===(e=p(l=o,"Y")&&a(l,"Y"),r=p(l,"X")&&a(l,"X"),e||r);)o=o.parentNode||o.host;var l,e,r;return o}(this),e=l.getBoundingClientRect(),r=this.getBoundingClientRect();l!==t.body?(h.call(this,l,l.scrollLeft+r.left-e.left,l.scrollTop+r.top-e.top),"fixed"!==o.getComputedStyle(l).position&&o.scrollBy({left:e.left,top:e.top,behavior:"smooth"})):o.scrollBy({left:r.left,top:r.top,behavior:"smooth"})}else i.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function n(o,t){this.scrollLeft=o,this.scrollTop=t}function f(o){if(null===o||"object"!=typeof o||void 0===o.behavior||"auto"===o.behavior||"instant"===o.behavior)return!0;if("object"==typeof o&&"smooth"===o.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+o.behavior+" is not a valid value for enumeration ScrollBehavior.")}function p(o,t){return"Y"===t?o.clientHeight+c<o.scrollHeight:"X"===t?o.clientWidth+c<o.scrollWidth:void 0}function a(t,l){var e=o.getComputedStyle(t,null)["overflow"+l];return"auto"===e||"scroll"===e}function d(t){var l,e,i,c,n=(s()-t.startTime)/r;c=n=n>1?1:n,l=.5*(1-Math.cos(Math.PI*c)),e=t.startX+(t.x-t.startX)*l,i=t.startY+(t.y-t.startY)*l,t.method.call(t.scrollable,e,i),e===t.x&&i===t.y||o.requestAnimationFrame(d.bind(o,t))}function h(l,e,r){var c,f,p,a,h=s();l===t.body?(c=o,f=o.scrollX||o.pageXOffset,p=o.scrollY||o.pageYOffset,a=i.scroll):(c=l,f=l.scrollLeft,p=l.scrollTop,a=n),d({scrollable:c,method:a,startTime:h,startX:f,startY:p,x:e,y:r})}}"object"==typeof exports&&"undefined"!=typeof module?module.exports={polyfill:o}:o()}();
/**
 * Minified by jsDelivr using Terser v5.13.1.
 * Original file: /npm/intersection-observer@0.12.2/intersection-observer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(){"use strict";if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var t=function(t){for(var e=window.document,o=i(e);o;)o=i(e=o.ownerDocument);return e}(),e=[],o=null,n=null;s.prototype.THROTTLE_TIMEOUT=100,s.prototype.POLL_INTERVAL=null,s.prototype.USE_MUTATION_OBSERVER=!0,s._setupCrossOriginUpdater=function(){return o||(o=function(t,o){n=t&&o?l(t,o):{top:0,bottom:0,left:0,right:0,width:0,height:0},e.forEach((function(t){t._checkForIntersections()}))}),o},s._resetCrossOriginUpdater=function(){o=null,n=null},s.prototype.observe=function(t){if(!this._observationTargets.some((function(e){return e.element==t}))){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(t.ownerDocument),this._checkForIntersections()}},s.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter((function(e){return e.element!=t})),this._unmonitorIntersections(t.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},s.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},s.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},s.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter((function(t,e,o){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==o[e-1]}))},s.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map((function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}}));return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},s.prototype._monitorIntersections=function(e){var o=e.defaultView;if(o&&-1==this._monitoringDocuments.indexOf(e)){var n=this._checkForIntersections,r=null,s=null;this.POLL_INTERVAL?r=o.setInterval(n,this.POLL_INTERVAL):(h(o,"resize",n,!0),h(e,"scroll",n,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in o&&(s=new o.MutationObserver(n)).observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(e),this._monitoringUnsubscribes.push((function(){var t=e.defaultView;t&&(r&&t.clearInterval(r),c(t,"resize",n,!0)),c(e,"scroll",n,!0),s&&s.disconnect()}));var u=this.root&&(this.root.ownerDocument||this.root)||t;if(e!=u){var a=i(e);a&&this._monitorIntersections(a.ownerDocument)}}},s.prototype._unmonitorIntersections=function(e){var o=this._monitoringDocuments.indexOf(e);if(-1!=o){var n=this.root&&(this.root.ownerDocument||this.root)||t,r=this._observationTargets.some((function(t){var o=t.element.ownerDocument;if(o==e)return!0;for(;o&&o!=n;){var r=i(o);if((o=r&&r.ownerDocument)==e)return!0}return!1}));if(!r){var s=this._monitoringUnsubscribes[o];if(this._monitoringDocuments.splice(o,1),this._monitoringUnsubscribes.splice(o,1),s(),e!=n){var h=i(e);h&&this._unmonitorIntersections(h.ownerDocument)}}}},s.prototype._unmonitorAllIntersections=function(){var t=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var e=0;e<t.length;e++)t[e]()},s.prototype._checkForIntersections=function(){if(this.root||!o||n){var t=this._rootIsInDom(),e=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach((function(n){var i=n.element,s=u(i),h=this._rootContainsTarget(i),c=n.entry,a=t&&h&&this._computeTargetAndRootIntersection(i,s,e),l=null;this._rootContainsTarget(i)?o&&!this.root||(l=e):l={top:0,bottom:0,left:0,right:0,width:0,height:0};var f=n.entry=new r({time:window.performance&&performance.now&&performance.now(),target:i,boundingClientRect:s,rootBounds:l,intersectionRect:a});c?t&&h?this._hasCrossedThreshold(c,f)&&this._queuedEntries.push(f):c&&c.isIntersecting&&this._queuedEntries.push(f):this._queuedEntries.push(f)}),this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},s.prototype._computeTargetAndRootIntersection=function(e,i,r){if("none"!=window.getComputedStyle(e).display){for(var s,h,c,a,f,d,g,m,v=i,_=p(e),b=!1;!b&&_;){var w=null,y=1==_.nodeType?window.getComputedStyle(_):{};if("none"==y.display)return null;if(_==this.root||9==_.nodeType)if(b=!0,_==this.root||_==t)o&&!this.root?!n||0==n.width&&0==n.height?(_=null,w=null,v=null):w=n:w=r;else{var I=p(_),E=I&&u(I),T=I&&this._computeTargetAndRootIntersection(I,E,r);E&&T?(_=I,w=l(E,T)):(_=null,v=null)}else{var R=_.ownerDocument;_!=R.body&&_!=R.documentElement&&"visible"!=y.overflow&&(w=u(_))}if(w&&(s=w,h=v,c=void 0,a=void 0,f=void 0,d=void 0,g=void 0,m=void 0,c=Math.max(s.top,h.top),a=Math.min(s.bottom,h.bottom),f=Math.max(s.left,h.left),d=Math.min(s.right,h.right),m=a-c,v=(g=d-f)>=0&&m>=0&&{top:c,bottom:a,left:f,right:d,width:g,height:m}||null),!v)break;_=_&&p(_)}return v}},s.prototype._getRootRect=function(){var e;if(this.root&&!d(this.root))e=u(this.root);else{var o=d(this.root)?this.root:t,n=o.documentElement,i=o.body;e={top:0,left:0,right:n.clientWidth||i.clientWidth,width:n.clientWidth||i.clientWidth,bottom:n.clientHeight||i.clientHeight,height:n.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(e)},s.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map((function(e,o){return"px"==e.unit?e.value:e.value*(o%2?t.width:t.height)/100})),o={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return o.width=o.right-o.left,o.height=o.bottom-o.top,o},s.prototype._hasCrossedThreshold=function(t,e){var o=t&&t.isIntersecting?t.intersectionRatio||0:-1,n=e.isIntersecting?e.intersectionRatio||0:-1;if(o!==n)for(var i=0;i<this.thresholds.length;i++){var r=this.thresholds[i];if(r==o||r==n||r<o!=r<n)return!0}},s.prototype._rootIsInDom=function(){return!this.root||f(t,this.root)},s.prototype._rootContainsTarget=function(e){var o=this.root&&(this.root.ownerDocument||this.root)||t;return f(o,e)&&(!this.root||o==e.ownerDocument)},s.prototype._registerInstance=function(){e.indexOf(this)<0&&e.push(this)},s.prototype._unregisterInstance=function(){var t=e.indexOf(this);-1!=t&&e.splice(t,1)},window.IntersectionObserver=s,window.IntersectionObserverEntry=r}function i(t){try{return t.defaultView&&t.defaultView.frameElement||null}catch(t){return null}}function r(t){this.time=t.time,this.target=t.target,this.rootBounds=a(t.rootBounds),this.boundingClientRect=a(t.boundingClientRect),this.intersectionRect=a(t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0}),this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,o=e.width*e.height,n=this.intersectionRect,i=n.width*n.height;this.intersectionRatio=o?Number((i/o).toFixed(4)):this.isIntersecting?1:0}function s(t,e){var o,n,i,r=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(r.root&&1!=r.root.nodeType&&9!=r.root.nodeType)throw new Error("root must be a Document or Element");this._checkForIntersections=(o=this._checkForIntersections.bind(this),n=this.THROTTLE_TIMEOUT,i=null,function(){i||(i=setTimeout((function(){o(),i=null}),n))}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(r.rootMargin),this.thresholds=this._initThresholds(r.threshold),this.root=r.root||null,this.rootMargin=this._rootMarginValues.map((function(t){return t.value+t.unit})).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function h(t,e,o,n){"function"==typeof t.addEventListener?t.addEventListener(e,o,n||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,o)}function c(t,e,o,n){"function"==typeof t.removeEventListener?t.removeEventListener(e,o,n||!1):"function"==typeof t.detachEvent&&t.detachEvent("on"+e,o)}function u(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function a(t){return!t||"x"in t?t:{top:t.top,y:t.top,bottom:t.bottom,left:t.left,x:t.left,right:t.right,width:t.width,height:t.height}}function l(t,e){var o=e.top-t.top,n=e.left-t.left;return{top:o,left:n,height:e.height,width:e.width,bottom:o+e.height,right:n+e.width}}function f(t,e){for(var o=e;o;){if(o==t)return!0;o=p(o)}return!1}function p(e){var o=e.parentNode;return 9==e.nodeType&&e!=t?i(e):(o&&o.assignedSlot&&(o=o.assignedSlot.parentNode),o&&11==o.nodeType&&o.host?o.host:o)}function d(t){return t&&9===t.nodeType}}();
//# sourceMappingURL=/sm/53a8f430304314e601f512c451d4d00d99f3fa0d435de24bec9a6bfb1a7db02d.map
/*!
 * Vue.js v2.6.11
 * (c) 2014-2019 Evan You
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Vue=t()}(this,function(){"use strict";var e=Object.freeze({});function t(e){return null==e}function n(e){return null!=e}function r(e){return!0===e}function i(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}function o(e){return null!==e&&"object"==typeof e}var a=Object.prototype.toString;function s(e){return"[object Object]"===a.call(e)}function c(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function u(e){return n(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function l(e){return null==e?"":Array.isArray(e)||s(e)&&e.toString===a?JSON.stringify(e,null,2):String(e)}function f(e){var t=parseFloat(e);return isNaN(t)?e:t}function p(e,t){for(var n=Object.create(null),r=e.split(","),i=0;i<r.length;i++)n[r[i]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}var d=p("slot,component",!0),v=p("key,ref,slot,slot-scope,is");function h(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}var m=Object.prototype.hasOwnProperty;function y(e,t){return m.call(e,t)}function g(e){var t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}var _=/-(\w)/g,b=g(function(e){return e.replace(_,function(e,t){return t?t.toUpperCase():""})}),$=g(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}),w=/\B([A-Z])/g,C=g(function(e){return e.replace(w,"-$1").toLowerCase()});var x=Function.prototype.bind?function(e,t){return e.bind(t)}:function(e,t){function n(n){var r=arguments.length;return r?r>1?e.apply(t,arguments):e.call(t,n):e.call(t)}return n._length=e.length,n};function k(e,t){t=t||0;for(var n=e.length-t,r=new Array(n);n--;)r[n]=e[n+t];return r}function A(e,t){for(var n in t)e[n]=t[n];return e}function O(e){for(var t={},n=0;n<e.length;n++)e[n]&&A(t,e[n]);return t}function S(e,t,n){}var T=function(e,t,n){return!1},E=function(e){return e};function N(e,t){if(e===t)return!0;var n=o(e),r=o(t);if(!n||!r)return!n&&!r&&String(e)===String(t);try{var i=Array.isArray(e),a=Array.isArray(t);if(i&&a)return e.length===t.length&&e.every(function(e,n){return N(e,t[n])});if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(i||a)return!1;var s=Object.keys(e),c=Object.keys(t);return s.length===c.length&&s.every(function(n){return N(e[n],t[n])})}catch(e){return!1}}function j(e,t){for(var n=0;n<e.length;n++)if(N(e[n],t))return n;return-1}function D(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var L="data-server-rendered",M=["component","directive","filter"],I=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],F={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:T,isReservedAttr:T,isUnknownElement:T,getTagNamespace:S,parsePlatformTagName:E,mustUseProp:T,async:!0,_lifecycleHooks:I},P=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function R(e,t,n,r){Object.defineProperty(e,t,{value:n,enumerable:!!r,writable:!0,configurable:!0})}var H=new RegExp("[^"+P.source+".$_\\d]");var B,U="__proto__"in{},z="undefined"!=typeof window,V="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,K=V&&WXEnvironment.platform.toLowerCase(),J=z&&window.navigator.userAgent.toLowerCase(),q=J&&/msie|trident/.test(J),W=J&&J.indexOf("msie 9.0")>0,Z=J&&J.indexOf("edge/")>0,G=(J&&J.indexOf("android"),J&&/iphone|ipad|ipod|ios/.test(J)||"ios"===K),X=(J&&/chrome\/\d+/.test(J),J&&/phantomjs/.test(J),J&&J.match(/firefox\/(\d+)/)),Y={}.watch,Q=!1;if(z)try{var ee={};Object.defineProperty(ee,"passive",{get:function(){Q=!0}}),window.addEventListener("test-passive",null,ee)}catch(e){}var te=function(){return void 0===B&&(B=!z&&!V&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),B},ne=z&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function re(e){return"function"==typeof e&&/native code/.test(e.toString())}var ie,oe="undefined"!=typeof Symbol&&re(Symbol)&&"undefined"!=typeof Reflect&&re(Reflect.ownKeys);ie="undefined"!=typeof Set&&re(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var ae=S,se=0,ce=function(){this.id=se++,this.subs=[]};ce.prototype.addSub=function(e){this.subs.push(e)},ce.prototype.removeSub=function(e){h(this.subs,e)},ce.prototype.depend=function(){ce.target&&ce.target.addDep(this)},ce.prototype.notify=function(){for(var e=this.subs.slice(),t=0,n=e.length;t<n;t++)e[t].update()},ce.target=null;var ue=[];function le(e){ue.push(e),ce.target=e}function fe(){ue.pop(),ce.target=ue[ue.length-1]}var pe=function(e,t,n,r,i,o,a,s){this.tag=e,this.data=t,this.children=n,this.text=r,this.elm=i,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=a,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},de={child:{configurable:!0}};de.child.get=function(){return this.componentInstance},Object.defineProperties(pe.prototype,de);var ve=function(e){void 0===e&&(e="");var t=new pe;return t.text=e,t.isComment=!0,t};function he(e){return new pe(void 0,void 0,void 0,String(e))}function me(e){var t=new pe(e.tag,e.data,e.children&&e.children.slice(),e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.asyncMeta=e.asyncMeta,t.isCloned=!0,t}var ye=Array.prototype,ge=Object.create(ye);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(e){var t=ye[e];R(ge,e,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var i,o=t.apply(this,n),a=this.__ob__;switch(e){case"push":case"unshift":i=n;break;case"splice":i=n.slice(2)}return i&&a.observeArray(i),a.dep.notify(),o})});var _e=Object.getOwnPropertyNames(ge),be=!0;function $e(e){be=e}var we=function(e){var t;this.value=e,this.dep=new ce,this.vmCount=0,R(e,"__ob__",this),Array.isArray(e)?(U?(t=ge,e.__proto__=t):function(e,t,n){for(var r=0,i=n.length;r<i;r++){var o=n[r];R(e,o,t[o])}}(e,ge,_e),this.observeArray(e)):this.walk(e)};function Ce(e,t){var n;if(o(e)&&!(e instanceof pe))return y(e,"__ob__")&&e.__ob__ instanceof we?n=e.__ob__:be&&!te()&&(Array.isArray(e)||s(e))&&Object.isExtensible(e)&&!e._isVue&&(n=new we(e)),t&&n&&n.vmCount++,n}function xe(e,t,n,r,i){var o=new ce,a=Object.getOwnPropertyDescriptor(e,t);if(!a||!1!==a.configurable){var s=a&&a.get,c=a&&a.set;s&&!c||2!==arguments.length||(n=e[t]);var u=!i&&Ce(n);Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=s?s.call(e):n;return ce.target&&(o.depend(),u&&(u.dep.depend(),Array.isArray(t)&&function e(t){for(var n=void 0,r=0,i=t.length;r<i;r++)(n=t[r])&&n.__ob__&&n.__ob__.dep.depend(),Array.isArray(n)&&e(n)}(t))),t},set:function(t){var r=s?s.call(e):n;t===r||t!=t&&r!=r||s&&!c||(c?c.call(e,t):n=t,u=!i&&Ce(t),o.notify())}})}}function ke(e,t,n){if(Array.isArray(e)&&c(t))return e.length=Math.max(e.length,t),e.splice(t,1,n),n;if(t in e&&!(t in Object.prototype))return e[t]=n,n;var r=e.__ob__;return e._isVue||r&&r.vmCount?n:r?(xe(r.value,t,n),r.dep.notify(),n):(e[t]=n,n)}function Ae(e,t){if(Array.isArray(e)&&c(t))e.splice(t,1);else{var n=e.__ob__;e._isVue||n&&n.vmCount||y(e,t)&&(delete e[t],n&&n.dep.notify())}}we.prototype.walk=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)xe(e,t[n])},we.prototype.observeArray=function(e){for(var t=0,n=e.length;t<n;t++)Ce(e[t])};var Oe=F.optionMergeStrategies;function Se(e,t){if(!t)return e;for(var n,r,i,o=oe?Reflect.ownKeys(t):Object.keys(t),a=0;a<o.length;a++)"__ob__"!==(n=o[a])&&(r=e[n],i=t[n],y(e,n)?r!==i&&s(r)&&s(i)&&Se(r,i):ke(e,n,i));return e}function Te(e,t,n){return n?function(){var r="function"==typeof t?t.call(n,n):t,i="function"==typeof e?e.call(n,n):e;return r?Se(r,i):i}:t?e?function(){return Se("function"==typeof t?t.call(this,this):t,"function"==typeof e?e.call(this,this):e)}:t:e}function Ee(e,t){var n=t?e?e.concat(t):Array.isArray(t)?t:[t]:e;return n?function(e){for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}(n):n}function Ne(e,t,n,r){var i=Object.create(e||null);return t?A(i,t):i}Oe.data=function(e,t,n){return n?Te(e,t,n):t&&"function"!=typeof t?e:Te(e,t)},I.forEach(function(e){Oe[e]=Ee}),M.forEach(function(e){Oe[e+"s"]=Ne}),Oe.watch=function(e,t,n,r){if(e===Y&&(e=void 0),t===Y&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var i={};for(var o in A(i,e),t){var a=i[o],s=t[o];a&&!Array.isArray(a)&&(a=[a]),i[o]=a?a.concat(s):Array.isArray(s)?s:[s]}return i},Oe.props=Oe.methods=Oe.inject=Oe.computed=function(e,t,n,r){if(!e)return t;var i=Object.create(null);return A(i,e),t&&A(i,t),i},Oe.provide=Te;var je=function(e,t){return void 0===t?e:t};function De(e,t,n){if("function"==typeof t&&(t=t.options),function(e,t){var n=e.props;if(n){var r,i,o={};if(Array.isArray(n))for(r=n.length;r--;)"string"==typeof(i=n[r])&&(o[b(i)]={type:null});else if(s(n))for(var a in n)i=n[a],o[b(a)]=s(i)?i:{type:i};e.props=o}}(t),function(e,t){var n=e.inject;if(n){var r=e.inject={};if(Array.isArray(n))for(var i=0;i<n.length;i++)r[n[i]]={from:n[i]};else if(s(n))for(var o in n){var a=n[o];r[o]=s(a)?A({from:o},a):{from:a}}}}(t),function(e){var t=e.directives;if(t)for(var n in t){var r=t[n];"function"==typeof r&&(t[n]={bind:r,update:r})}}(t),!t._base&&(t.extends&&(e=De(e,t.extends,n)),t.mixins))for(var r=0,i=t.mixins.length;r<i;r++)e=De(e,t.mixins[r],n);var o,a={};for(o in e)c(o);for(o in t)y(e,o)||c(o);function c(r){var i=Oe[r]||je;a[r]=i(e[r],t[r],n,r)}return a}function Le(e,t,n,r){if("string"==typeof n){var i=e[t];if(y(i,n))return i[n];var o=b(n);if(y(i,o))return i[o];var a=$(o);return y(i,a)?i[a]:i[n]||i[o]||i[a]}}function Me(e,t,n,r){var i=t[e],o=!y(n,e),a=n[e],s=Pe(Boolean,i.type);if(s>-1)if(o&&!y(i,"default"))a=!1;else if(""===a||a===C(e)){var c=Pe(String,i.type);(c<0||s<c)&&(a=!0)}if(void 0===a){a=function(e,t,n){if(!y(t,"default"))return;var r=t.default;if(e&&e.$options.propsData&&void 0===e.$options.propsData[n]&&void 0!==e._props[n])return e._props[n];return"function"==typeof r&&"Function"!==Ie(t.type)?r.call(e):r}(r,i,e);var u=be;$e(!0),Ce(a),$e(u)}return a}function Ie(e){var t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:""}function Fe(e,t){return Ie(e)===Ie(t)}function Pe(e,t){if(!Array.isArray(t))return Fe(t,e)?0:-1;for(var n=0,r=t.length;n<r;n++)if(Fe(t[n],e))return n;return-1}function Re(e,t,n){le();try{if(t)for(var r=t;r=r.$parent;){var i=r.$options.errorCaptured;if(i)for(var o=0;o<i.length;o++)try{if(!1===i[o].call(r,e,t,n))return}catch(e){Be(e,r,"errorCaptured hook")}}Be(e,t,n)}finally{fe()}}function He(e,t,n,r,i){var o;try{(o=n?e.apply(t,n):e.call(t))&&!o._isVue&&u(o)&&!o._handled&&(o.catch(function(e){return Re(e,r,i+" (Promise/async)")}),o._handled=!0)}catch(e){Re(e,r,i)}return o}function Be(e,t,n){if(F.errorHandler)try{return F.errorHandler.call(null,e,t,n)}catch(t){t!==e&&Ue(t,null,"config.errorHandler")}Ue(e,t,n)}function Ue(e,t,n){if(!z&&!V||"undefined"==typeof console)throw e;console.error(e)}var ze,Ve=!1,Ke=[],Je=!1;function qe(){Je=!1;var e=Ke.slice(0);Ke.length=0;for(var t=0;t<e.length;t++)e[t]()}if("undefined"!=typeof Promise&&re(Promise)){var We=Promise.resolve();ze=function(){We.then(qe),G&&setTimeout(S)},Ve=!0}else if(q||"undefined"==typeof MutationObserver||!re(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())ze="undefined"!=typeof setImmediate&&re(setImmediate)?function(){setImmediate(qe)}:function(){setTimeout(qe,0)};else{var Ze=1,Ge=new MutationObserver(qe),Xe=document.createTextNode(String(Ze));Ge.observe(Xe,{characterData:!0}),ze=function(){Ze=(Ze+1)%2,Xe.data=String(Ze)},Ve=!0}function Ye(e,t){var n;if(Ke.push(function(){if(e)try{e.call(t)}catch(e){Re(e,t,"nextTick")}else n&&n(t)}),Je||(Je=!0,ze()),!e&&"undefined"!=typeof Promise)return new Promise(function(e){n=e})}var Qe=new ie;function et(e){!function e(t,n){var r,i;var a=Array.isArray(t);if(!a&&!o(t)||Object.isFrozen(t)||t instanceof pe)return;if(t.__ob__){var s=t.__ob__.dep.id;if(n.has(s))return;n.add(s)}if(a)for(r=t.length;r--;)e(t[r],n);else for(i=Object.keys(t),r=i.length;r--;)e(t[i[r]],n)}(e,Qe),Qe.clear()}var tt=g(function(e){var t="&"===e.charAt(0),n="~"===(e=t?e.slice(1):e).charAt(0),r="!"===(e=n?e.slice(1):e).charAt(0);return{name:e=r?e.slice(1):e,once:n,capture:r,passive:t}});function nt(e,t){function n(){var e=arguments,r=n.fns;if(!Array.isArray(r))return He(r,null,arguments,t,"v-on handler");for(var i=r.slice(),o=0;o<i.length;o++)He(i[o],null,e,t,"v-on handler")}return n.fns=e,n}function rt(e,n,i,o,a,s){var c,u,l,f;for(c in e)u=e[c],l=n[c],f=tt(c),t(u)||(t(l)?(t(u.fns)&&(u=e[c]=nt(u,s)),r(f.once)&&(u=e[c]=a(f.name,u,f.capture)),i(f.name,u,f.capture,f.passive,f.params)):u!==l&&(l.fns=u,e[c]=l));for(c in n)t(e[c])&&o((f=tt(c)).name,n[c],f.capture)}function it(e,i,o){var a;e instanceof pe&&(e=e.data.hook||(e.data.hook={}));var s=e[i];function c(){o.apply(this,arguments),h(a.fns,c)}t(s)?a=nt([c]):n(s.fns)&&r(s.merged)?(a=s).fns.push(c):a=nt([s,c]),a.merged=!0,e[i]=a}function ot(e,t,r,i,o){if(n(t)){if(y(t,r))return e[r]=t[r],o||delete t[r],!0;if(y(t,i))return e[r]=t[i],o||delete t[i],!0}return!1}function at(e){return i(e)?[he(e)]:Array.isArray(e)?function e(o,a){var s=[];var c,u,l,f;for(c=0;c<o.length;c++)t(u=o[c])||"boolean"==typeof u||(l=s.length-1,f=s[l],Array.isArray(u)?u.length>0&&(st((u=e(u,(a||"")+"_"+c))[0])&&st(f)&&(s[l]=he(f.text+u[0].text),u.shift()),s.push.apply(s,u)):i(u)?st(f)?s[l]=he(f.text+u):""!==u&&s.push(he(u)):st(u)&&st(f)?s[l]=he(f.text+u.text):(r(o._isVList)&&n(u.tag)&&t(u.key)&&n(a)&&(u.key="__vlist"+a+"_"+c+"__"),s.push(u)));return s}(e):void 0}function st(e){return n(e)&&n(e.text)&&!1===e.isComment}function ct(e,t){if(e){for(var n=Object.create(null),r=oe?Reflect.ownKeys(e):Object.keys(e),i=0;i<r.length;i++){var o=r[i];if("__ob__"!==o){for(var a=e[o].from,s=t;s;){if(s._provided&&y(s._provided,a)){n[o]=s._provided[a];break}s=s.$parent}if(!s&&"default"in e[o]){var c=e[o].default;n[o]="function"==typeof c?c.call(t):c}}}return n}}function ut(e,t){if(!e||!e.length)return{};for(var n={},r=0,i=e.length;r<i;r++){var o=e[r],a=o.data;if(a&&a.attrs&&a.attrs.slot&&delete a.attrs.slot,o.context!==t&&o.fnContext!==t||!a||null==a.slot)(n.default||(n.default=[])).push(o);else{var s=a.slot,c=n[s]||(n[s]=[]);"template"===o.tag?c.push.apply(c,o.children||[]):c.push(o)}}for(var u in n)n[u].every(lt)&&delete n[u];return n}function lt(e){return e.isComment&&!e.asyncFactory||" "===e.text}function ft(t,n,r){var i,o=Object.keys(n).length>0,a=t?!!t.$stable:!o,s=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(a&&r&&r!==e&&s===r.$key&&!o&&!r.$hasNormal)return r;for(var c in i={},t)t[c]&&"$"!==c[0]&&(i[c]=pt(n,c,t[c]))}else i={};for(var u in n)u in i||(i[u]=dt(n,u));return t&&Object.isExtensible(t)&&(t._normalized=i),R(i,"$stable",a),R(i,"$key",s),R(i,"$hasNormal",o),i}function pt(e,t,n){var r=function(){var e=arguments.length?n.apply(null,arguments):n({});return(e=e&&"object"==typeof e&&!Array.isArray(e)?[e]:at(e))&&(0===e.length||1===e.length&&e[0].isComment)?void 0:e};return n.proxy&&Object.defineProperty(e,t,{get:r,enumerable:!0,configurable:!0}),r}function dt(e,t){return function(){return e[t]}}function vt(e,t){var r,i,a,s,c;if(Array.isArray(e)||"string"==typeof e)for(r=new Array(e.length),i=0,a=e.length;i<a;i++)r[i]=t(e[i],i);else if("number"==typeof e)for(r=new Array(e),i=0;i<e;i++)r[i]=t(i+1,i);else if(o(e))if(oe&&e[Symbol.iterator]){r=[];for(var u=e[Symbol.iterator](),l=u.next();!l.done;)r.push(t(l.value,r.length)),l=u.next()}else for(s=Object.keys(e),r=new Array(s.length),i=0,a=s.length;i<a;i++)c=s[i],r[i]=t(e[c],c,i);return n(r)||(r=[]),r._isVList=!0,r}function ht(e,t,n,r){var i,o=this.$scopedSlots[e];o?(n=n||{},r&&(n=A(A({},r),n)),i=o(n)||t):i=this.$slots[e]||t;var a=n&&n.slot;return a?this.$createElement("template",{slot:a},i):i}function mt(e){return Le(this.$options,"filters",e)||E}function yt(e,t){return Array.isArray(e)?-1===e.indexOf(t):e!==t}function gt(e,t,n,r,i){var o=F.keyCodes[t]||n;return i&&r&&!F.keyCodes[t]?yt(i,r):o?yt(o,e):r?C(r)!==t:void 0}function _t(e,t,n,r,i){if(n)if(o(n)){var a;Array.isArray(n)&&(n=O(n));var s=function(o){if("class"===o||"style"===o||v(o))a=e;else{var s=e.attrs&&e.attrs.type;a=r||F.mustUseProp(t,s,o)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}var c=b(o),u=C(o);c in a||u in a||(a[o]=n[o],i&&((e.on||(e.on={}))["update:"+o]=function(e){n[o]=e}))};for(var c in n)s(c)}else;return e}function bt(e,t){var n=this._staticTrees||(this._staticTrees=[]),r=n[e];return r&&!t?r:(wt(r=n[e]=this.$options.staticRenderFns[e].call(this._renderProxy,null,this),"__static__"+e,!1),r)}function $t(e,t,n){return wt(e,"__once__"+t+(n?"_"+n:""),!0),e}function wt(e,t,n){if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]&&"string"!=typeof e[r]&&Ct(e[r],t+"_"+r,n);else Ct(e,t,n)}function Ct(e,t,n){e.isStatic=!0,e.key=t,e.isOnce=n}function xt(e,t){if(t)if(s(t)){var n=e.on=e.on?A({},e.on):{};for(var r in t){var i=n[r],o=t[r];n[r]=i?[].concat(i,o):o}}else;return e}function kt(e,t,n,r){t=t||{$stable:!n};for(var i=0;i<e.length;i++){var o=e[i];Array.isArray(o)?kt(o,t,n):o&&(o.proxy&&(o.fn.proxy=!0),t[o.key]=o.fn)}return r&&(t.$key=r),t}function At(e,t){for(var n=0;n<t.length;n+=2){var r=t[n];"string"==typeof r&&r&&(e[t[n]]=t[n+1])}return e}function Ot(e,t){return"string"==typeof e?t+e:e}function St(e){e._o=$t,e._n=f,e._s=l,e._l=vt,e._t=ht,e._q=N,e._i=j,e._m=bt,e._f=mt,e._k=gt,e._b=_t,e._v=he,e._e=ve,e._u=kt,e._g=xt,e._d=At,e._p=Ot}function Tt(t,n,i,o,a){var s,c=this,u=a.options;y(o,"_uid")?(s=Object.create(o))._original=o:(s=o,o=o._original);var l=r(u._compiled),f=!l;this.data=t,this.props=n,this.children=i,this.parent=o,this.listeners=t.on||e,this.injections=ct(u.inject,o),this.slots=function(){return c.$slots||ft(t.scopedSlots,c.$slots=ut(i,o)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ft(t.scopedSlots,this.slots())}}),l&&(this.$options=u,this.$slots=this.slots(),this.$scopedSlots=ft(t.scopedSlots,this.$slots)),u._scopeId?this._c=function(e,t,n,r){var i=Pt(s,e,t,n,r,f);return i&&!Array.isArray(i)&&(i.fnScopeId=u._scopeId,i.fnContext=o),i}:this._c=function(e,t,n,r){return Pt(s,e,t,n,r,f)}}function Et(e,t,n,r,i){var o=me(e);return o.fnContext=n,o.fnOptions=r,t.slot&&((o.data||(o.data={})).slot=t.slot),o}function Nt(e,t){for(var n in t)e[b(n)]=t[n]}St(Tt.prototype);var jt={init:function(e,t){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var r=e;jt.prepatch(r,r)}else{(e.componentInstance=function(e,t){var r={_isComponent:!0,_parentVnode:e,parent:t},i=e.data.inlineTemplate;n(i)&&(r.render=i.render,r.staticRenderFns=i.staticRenderFns);return new e.componentOptions.Ctor(r)}(e,Wt)).$mount(t?e.elm:void 0,t)}},prepatch:function(t,n){var r=n.componentOptions;!function(t,n,r,i,o){var a=i.data.scopedSlots,s=t.$scopedSlots,c=!!(a&&!a.$stable||s!==e&&!s.$stable||a&&t.$scopedSlots.$key!==a.$key),u=!!(o||t.$options._renderChildren||c);t.$options._parentVnode=i,t.$vnode=i,t._vnode&&(t._vnode.parent=i);if(t.$options._renderChildren=o,t.$attrs=i.data.attrs||e,t.$listeners=r||e,n&&t.$options.props){$e(!1);for(var l=t._props,f=t.$options._propKeys||[],p=0;p<f.length;p++){var d=f[p],v=t.$options.props;l[d]=Me(d,v,n,t)}$e(!0),t.$options.propsData=n}r=r||e;var h=t.$options._parentListeners;t.$options._parentListeners=r,qt(t,r,h),u&&(t.$slots=ut(o,i.context),t.$forceUpdate())}(n.componentInstance=t.componentInstance,r.propsData,r.listeners,n,r.children)},insert:function(e){var t,n=e.context,r=e.componentInstance;r._isMounted||(r._isMounted=!0,Yt(r,"mounted")),e.data.keepAlive&&(n._isMounted?((t=r)._inactive=!1,en.push(t)):Xt(r,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?function e(t,n){if(n&&(t._directInactive=!0,Gt(t)))return;if(!t._inactive){t._inactive=!0;for(var r=0;r<t.$children.length;r++)e(t.$children[r]);Yt(t,"deactivated")}}(t,!0):t.$destroy())}},Dt=Object.keys(jt);function Lt(i,a,s,c,l){if(!t(i)){var f=s.$options._base;if(o(i)&&(i=f.extend(i)),"function"==typeof i){var p;if(t(i.cid)&&void 0===(i=function(e,i){if(r(e.error)&&n(e.errorComp))return e.errorComp;if(n(e.resolved))return e.resolved;var a=Ht;a&&n(e.owners)&&-1===e.owners.indexOf(a)&&e.owners.push(a);if(r(e.loading)&&n(e.loadingComp))return e.loadingComp;if(a&&!n(e.owners)){var s=e.owners=[a],c=!0,l=null,f=null;a.$on("hook:destroyed",function(){return h(s,a)});var p=function(e){for(var t=0,n=s.length;t<n;t++)s[t].$forceUpdate();e&&(s.length=0,null!==l&&(clearTimeout(l),l=null),null!==f&&(clearTimeout(f),f=null))},d=D(function(t){e.resolved=Bt(t,i),c?s.length=0:p(!0)}),v=D(function(t){n(e.errorComp)&&(e.error=!0,p(!0))}),m=e(d,v);return o(m)&&(u(m)?t(e.resolved)&&m.then(d,v):u(m.component)&&(m.component.then(d,v),n(m.error)&&(e.errorComp=Bt(m.error,i)),n(m.loading)&&(e.loadingComp=Bt(m.loading,i),0===m.delay?e.loading=!0:l=setTimeout(function(){l=null,t(e.resolved)&&t(e.error)&&(e.loading=!0,p(!1))},m.delay||200)),n(m.timeout)&&(f=setTimeout(function(){f=null,t(e.resolved)&&v(null)},m.timeout)))),c=!1,e.loading?e.loadingComp:e.resolved}}(p=i,f)))return function(e,t,n,r,i){var o=ve();return o.asyncFactory=e,o.asyncMeta={data:t,context:n,children:r,tag:i},o}(p,a,s,c,l);a=a||{},$n(i),n(a.model)&&function(e,t){var r=e.model&&e.model.prop||"value",i=e.model&&e.model.event||"input";(t.attrs||(t.attrs={}))[r]=t.model.value;var o=t.on||(t.on={}),a=o[i],s=t.model.callback;n(a)?(Array.isArray(a)?-1===a.indexOf(s):a!==s)&&(o[i]=[s].concat(a)):o[i]=s}(i.options,a);var d=function(e,r,i){var o=r.options.props;if(!t(o)){var a={},s=e.attrs,c=e.props;if(n(s)||n(c))for(var u in o){var l=C(u);ot(a,c,u,l,!0)||ot(a,s,u,l,!1)}return a}}(a,i);if(r(i.options.functional))return function(t,r,i,o,a){var s=t.options,c={},u=s.props;if(n(u))for(var l in u)c[l]=Me(l,u,r||e);else n(i.attrs)&&Nt(c,i.attrs),n(i.props)&&Nt(c,i.props);var f=new Tt(i,c,a,o,t),p=s.render.call(null,f._c,f);if(p instanceof pe)return Et(p,i,f.parent,s);if(Array.isArray(p)){for(var d=at(p)||[],v=new Array(d.length),h=0;h<d.length;h++)v[h]=Et(d[h],i,f.parent,s);return v}}(i,d,a,s,c);var v=a.on;if(a.on=a.nativeOn,r(i.options.abstract)){var m=a.slot;a={},m&&(a.slot=m)}!function(e){for(var t=e.hook||(e.hook={}),n=0;n<Dt.length;n++){var r=Dt[n],i=t[r],o=jt[r];i===o||i&&i._merged||(t[r]=i?Mt(o,i):o)}}(a);var y=i.options.name||l;return new pe("vue-component-"+i.cid+(y?"-"+y:""),a,void 0,void 0,void 0,s,{Ctor:i,propsData:d,listeners:v,tag:l,children:c},p)}}}function Mt(e,t){var n=function(n,r){e(n,r),t(n,r)};return n._merged=!0,n}var It=1,Ft=2;function Pt(e,a,s,c,u,l){return(Array.isArray(s)||i(s))&&(u=c,c=s,s=void 0),r(l)&&(u=Ft),function(e,i,a,s,c){if(n(a)&&n(a.__ob__))return ve();n(a)&&n(a.is)&&(i=a.is);if(!i)return ve();Array.isArray(s)&&"function"==typeof s[0]&&((a=a||{}).scopedSlots={default:s[0]},s.length=0);c===Ft?s=at(s):c===It&&(s=function(e){for(var t=0;t<e.length;t++)if(Array.isArray(e[t]))return Array.prototype.concat.apply([],e);return e}(s));var u,l;if("string"==typeof i){var f;l=e.$vnode&&e.$vnode.ns||F.getTagNamespace(i),u=F.isReservedTag(i)?new pe(F.parsePlatformTagName(i),a,s,void 0,void 0,e):a&&a.pre||!n(f=Le(e.$options,"components",i))?new pe(i,a,s,void 0,void 0,e):Lt(f,a,e,s,i)}else u=Lt(i,a,e,s);return Array.isArray(u)?u:n(u)?(n(l)&&function e(i,o,a){i.ns=o;"foreignObject"===i.tag&&(o=void 0,a=!0);if(n(i.children))for(var s=0,c=i.children.length;s<c;s++){var u=i.children[s];n(u.tag)&&(t(u.ns)||r(a)&&"svg"!==u.tag)&&e(u,o,a)}}(u,l),n(a)&&function(e){o(e.style)&&et(e.style);o(e.class)&&et(e.class)}(a),u):ve()}(e,a,s,c,u)}var Rt,Ht=null;function Bt(e,t){return(e.__esModule||oe&&"Module"===e[Symbol.toStringTag])&&(e=e.default),o(e)?t.extend(e):e}function Ut(e){return e.isComment&&e.asyncFactory}function zt(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t];if(n(r)&&(n(r.componentOptions)||Ut(r)))return r}}function Vt(e,t){Rt.$on(e,t)}function Kt(e,t){Rt.$off(e,t)}function Jt(e,t){var n=Rt;return function r(){null!==t.apply(null,arguments)&&n.$off(e,r)}}function qt(e,t,n){Rt=e,rt(t,n||{},Vt,Kt,Jt,e),Rt=void 0}var Wt=null;function Zt(e){var t=Wt;return Wt=e,function(){Wt=t}}function Gt(e){for(;e&&(e=e.$parent);)if(e._inactive)return!0;return!1}function Xt(e,t){if(t){if(e._directInactive=!1,Gt(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var n=0;n<e.$children.length;n++)Xt(e.$children[n]);Yt(e,"activated")}}function Yt(e,t){le();var n=e.$options[t],r=t+" hook";if(n)for(var i=0,o=n.length;i<o;i++)He(n[i],e,null,e,r);e._hasHookEvent&&e.$emit("hook:"+t),fe()}var Qt=[],en=[],tn={},nn=!1,rn=!1,on=0;var an=0,sn=Date.now;if(z&&!q){var cn=window.performance;cn&&"function"==typeof cn.now&&sn()>document.createEvent("Event").timeStamp&&(sn=function(){return cn.now()})}function un(){var e,t;for(an=sn(),rn=!0,Qt.sort(function(e,t){return e.id-t.id}),on=0;on<Qt.length;on++)(e=Qt[on]).before&&e.before(),t=e.id,tn[t]=null,e.run();var n=en.slice(),r=Qt.slice();on=Qt.length=en.length=0,tn={},nn=rn=!1,function(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,Xt(e[t],!0)}(n),function(e){var t=e.length;for(;t--;){var n=e[t],r=n.vm;r._watcher===n&&r._isMounted&&!r._isDestroyed&&Yt(r,"updated")}}(r),ne&&F.devtools&&ne.emit("flush")}var ln=0,fn=function(e,t,n,r,i){this.vm=e,i&&(e._watcher=this),e._watchers.push(this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++ln,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ie,this.newDepIds=new ie,this.expression="","function"==typeof t?this.getter=t:(this.getter=function(e){if(!H.test(e)){var t=e.split(".");return function(e){for(var n=0;n<t.length;n++){if(!e)return;e=e[t[n]]}return e}}}(t),this.getter||(this.getter=S)),this.value=this.lazy?void 0:this.get()};fn.prototype.get=function(){var e;le(this);var t=this.vm;try{e=this.getter.call(t,t)}catch(e){if(!this.user)throw e;Re(e,t,'getter for watcher "'+this.expression+'"')}finally{this.deep&&et(e),fe(),this.cleanupDeps()}return e},fn.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},fn.prototype.cleanupDeps=function(){for(var e=this.deps.length;e--;){var t=this.deps[e];this.newDepIds.has(t.id)||t.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},fn.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(e){var t=e.id;if(null==tn[t]){if(tn[t]=!0,rn){for(var n=Qt.length-1;n>on&&Qt[n].id>e.id;)n--;Qt.splice(n+1,0,e)}else Qt.push(e);nn||(nn=!0,Ye(un))}}(this)},fn.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||o(e)||this.deep){var t=this.value;if(this.value=e,this.user)try{this.cb.call(this.vm,e,t)}catch(e){Re(e,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,e,t)}}},fn.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},fn.prototype.depend=function(){for(var e=this.deps.length;e--;)this.deps[e].depend()},fn.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||h(this.vm._watchers,this);for(var e=this.deps.length;e--;)this.deps[e].removeSub(this);this.active=!1}};var pn={enumerable:!0,configurable:!0,get:S,set:S};function dn(e,t,n){pn.get=function(){return this[t][n]},pn.set=function(e){this[t][n]=e},Object.defineProperty(e,n,pn)}function vn(e){e._watchers=[];var t=e.$options;t.props&&function(e,t){var n=e.$options.propsData||{},r=e._props={},i=e.$options._propKeys=[];e.$parent&&$e(!1);var o=function(o){i.push(o);var a=Me(o,t,n,e);xe(r,o,a),o in e||dn(e,"_props",o)};for(var a in t)o(a);$e(!0)}(e,t.props),t.methods&&function(e,t){e.$options.props;for(var n in t)e[n]="function"!=typeof t[n]?S:x(t[n],e)}(e,t.methods),t.data?function(e){var t=e.$options.data;s(t=e._data="function"==typeof t?function(e,t){le();try{return e.call(t,t)}catch(e){return Re(e,t,"data()"),{}}finally{fe()}}(t,e):t||{})||(t={});var n=Object.keys(t),r=e.$options.props,i=(e.$options.methods,n.length);for(;i--;){var o=n[i];r&&y(r,o)||(a=void 0,36!==(a=(o+"").charCodeAt(0))&&95!==a&&dn(e,"_data",o))}var a;Ce(t,!0)}(e):Ce(e._data={},!0),t.computed&&function(e,t){var n=e._computedWatchers=Object.create(null),r=te();for(var i in t){var o=t[i],a="function"==typeof o?o:o.get;r||(n[i]=new fn(e,a||S,S,hn)),i in e||mn(e,i,o)}}(e,t.computed),t.watch&&t.watch!==Y&&function(e,t){for(var n in t){var r=t[n];if(Array.isArray(r))for(var i=0;i<r.length;i++)_n(e,n,r[i]);else _n(e,n,r)}}(e,t.watch)}var hn={lazy:!0};function mn(e,t,n){var r=!te();"function"==typeof n?(pn.get=r?yn(t):gn(n),pn.set=S):(pn.get=n.get?r&&!1!==n.cache?yn(t):gn(n.get):S,pn.set=n.set||S),Object.defineProperty(e,t,pn)}function yn(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),ce.target&&t.depend(),t.value}}function gn(e){return function(){return e.call(this,this)}}function _n(e,t,n,r){return s(n)&&(r=n,n=n.handler),"string"==typeof n&&(n=e[n]),e.$watch(t,n,r)}var bn=0;function $n(e){var t=e.options;if(e.super){var n=$n(e.super);if(n!==e.superOptions){e.superOptions=n;var r=function(e){var t,n=e.options,r=e.sealedOptions;for(var i in n)n[i]!==r[i]&&(t||(t={}),t[i]=n[i]);return t}(e);r&&A(e.extendOptions,r),(t=e.options=De(n,e.extendOptions)).name&&(t.components[t.name]=e)}}return t}function wn(e){this._init(e)}function Cn(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var n=this,r=n.cid,i=e._Ctor||(e._Ctor={});if(i[r])return i[r];var o=e.name||n.options.name,a=function(e){this._init(e)};return(a.prototype=Object.create(n.prototype)).constructor=a,a.cid=t++,a.options=De(n.options,e),a.super=n,a.options.props&&function(e){var t=e.options.props;for(var n in t)dn(e.prototype,"_props",n)}(a),a.options.computed&&function(e){var t=e.options.computed;for(var n in t)mn(e.prototype,n,t[n])}(a),a.extend=n.extend,a.mixin=n.mixin,a.use=n.use,M.forEach(function(e){a[e]=n[e]}),o&&(a.options.components[o]=a),a.superOptions=n.options,a.extendOptions=e,a.sealedOptions=A({},a.options),i[r]=a,a}}function xn(e){return e&&(e.Ctor.options.name||e.tag)}function kn(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"==typeof e?e.split(",").indexOf(t)>-1:(n=e,"[object RegExp]"===a.call(n)&&e.test(t));var n}function An(e,t){var n=e.cache,r=e.keys,i=e._vnode;for(var o in n){var a=n[o];if(a){var s=xn(a.componentOptions);s&&!t(s)&&On(n,o,r,i)}}}function On(e,t,n,r){var i=e[t];!i||r&&i.tag===r.tag||i.componentInstance.$destroy(),e[t]=null,h(n,t)}!function(t){t.prototype._init=function(t){var n=this;n._uid=bn++,n._isVue=!0,t&&t._isComponent?function(e,t){var n=e.$options=Object.create(e.constructor.options),r=t._parentVnode;n.parent=t.parent,n._parentVnode=r;var i=r.componentOptions;n.propsData=i.propsData,n._parentListeners=i.listeners,n._renderChildren=i.children,n._componentTag=i.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}(n,t):n.$options=De($n(n.constructor),t||{},n),n._renderProxy=n,n._self=n,function(e){var t=e.$options,n=t.parent;if(n&&!t.abstract){for(;n.$options.abstract&&n.$parent;)n=n.$parent;n.$children.push(e)}e.$parent=n,e.$root=n?n.$root:e,e.$children=[],e.$refs={},e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}(n),function(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&qt(e,t)}(n),function(t){t._vnode=null,t._staticTrees=null;var n=t.$options,r=t.$vnode=n._parentVnode,i=r&&r.context;t.$slots=ut(n._renderChildren,i),t.$scopedSlots=e,t._c=function(e,n,r,i){return Pt(t,e,n,r,i,!1)},t.$createElement=function(e,n,r,i){return Pt(t,e,n,r,i,!0)};var o=r&&r.data;xe(t,"$attrs",o&&o.attrs||e,null,!0),xe(t,"$listeners",n._parentListeners||e,null,!0)}(n),Yt(n,"beforeCreate"),function(e){var t=ct(e.$options.inject,e);t&&($e(!1),Object.keys(t).forEach(function(n){xe(e,n,t[n])}),$e(!0))}(n),vn(n),function(e){var t=e.$options.provide;t&&(e._provided="function"==typeof t?t.call(e):t)}(n),Yt(n,"created"),n.$options.el&&n.$mount(n.$options.el)}}(wn),function(e){var t={get:function(){return this._data}},n={get:function(){return this._props}};Object.defineProperty(e.prototype,"$data",t),Object.defineProperty(e.prototype,"$props",n),e.prototype.$set=ke,e.prototype.$delete=Ae,e.prototype.$watch=function(e,t,n){if(s(t))return _n(this,e,t,n);(n=n||{}).user=!0;var r=new fn(this,e,t,n);if(n.immediate)try{t.call(this,r.value)}catch(e){Re(e,this,'callback for immediate watcher "'+r.expression+'"')}return function(){r.teardown()}}}(wn),function(e){var t=/^hook:/;e.prototype.$on=function(e,n){var r=this;if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)r.$on(e[i],n);else(r._events[e]||(r._events[e]=[])).push(n),t.test(e)&&(r._hasHookEvent=!0);return r},e.prototype.$once=function(e,t){var n=this;function r(){n.$off(e,r),t.apply(n,arguments)}return r.fn=t,n.$on(e,r),n},e.prototype.$off=function(e,t){var n=this;if(!arguments.length)return n._events=Object.create(null),n;if(Array.isArray(e)){for(var r=0,i=e.length;r<i;r++)n.$off(e[r],t);return n}var o,a=n._events[e];if(!a)return n;if(!t)return n._events[e]=null,n;for(var s=a.length;s--;)if((o=a[s])===t||o.fn===t){a.splice(s,1);break}return n},e.prototype.$emit=function(e){var t=this._events[e];if(t){t=t.length>1?k(t):t;for(var n=k(arguments,1),r='event handler for "'+e+'"',i=0,o=t.length;i<o;i++)He(t[i],this,n,this,r)}return this}}(wn),function(e){e.prototype._update=function(e,t){var n=this,r=n.$el,i=n._vnode,o=Zt(n);n._vnode=e,n.$el=i?n.__patch__(i,e):n.__patch__(n.$el,e,t,!1),o(),r&&(r.__vue__=null),n.$el&&(n.$el.__vue__=n),n.$vnode&&n.$parent&&n.$vnode===n.$parent._vnode&&(n.$parent.$el=n.$el)},e.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){Yt(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||h(t.$children,e),e._watcher&&e._watcher.teardown();for(var n=e._watchers.length;n--;)e._watchers[n].teardown();e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),Yt(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}(wn),function(e){St(e.prototype),e.prototype.$nextTick=function(e){return Ye(e,this)},e.prototype._render=function(){var e,t=this,n=t.$options,r=n.render,i=n._parentVnode;i&&(t.$scopedSlots=ft(i.data.scopedSlots,t.$slots,t.$scopedSlots)),t.$vnode=i;try{Ht=t,e=r.call(t._renderProxy,t.$createElement)}catch(n){Re(n,t,"render"),e=t._vnode}finally{Ht=null}return Array.isArray(e)&&1===e.length&&(e=e[0]),e instanceof pe||(e=ve()),e.parent=i,e}}(wn);var Sn=[String,RegExp,Array],Tn={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Sn,exclude:Sn,max:[String,Number]},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var e in this.cache)On(this.cache,e,this.keys)},mounted:function(){var e=this;this.$watch("include",function(t){An(e,function(e){return kn(t,e)})}),this.$watch("exclude",function(t){An(e,function(e){return!kn(t,e)})})},render:function(){var e=this.$slots.default,t=zt(e),n=t&&t.componentOptions;if(n){var r=xn(n),i=this.include,o=this.exclude;if(i&&(!r||!kn(i,r))||o&&r&&kn(o,r))return t;var a=this.cache,s=this.keys,c=null==t.key?n.Ctor.cid+(n.tag?"::"+n.tag:""):t.key;a[c]?(t.componentInstance=a[c].componentInstance,h(s,c),s.push(c)):(a[c]=t,s.push(c),this.max&&s.length>parseInt(this.max)&&On(a,s[0],s,this._vnode)),t.data.keepAlive=!0}return t||e&&e[0]}}};!function(e){var t={get:function(){return F}};Object.defineProperty(e,"config",t),e.util={warn:ae,extend:A,mergeOptions:De,defineReactive:xe},e.set=ke,e.delete=Ae,e.nextTick=Ye,e.observable=function(e){return Ce(e),e},e.options=Object.create(null),M.forEach(function(t){e.options[t+"s"]=Object.create(null)}),e.options._base=e,A(e.options.components,Tn),function(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var n=k(arguments,1);return n.unshift(this),"function"==typeof e.install?e.install.apply(e,n):"function"==typeof e&&e.apply(null,n),t.push(e),this}}(e),function(e){e.mixin=function(e){return this.options=De(this.options,e),this}}(e),Cn(e),function(e){M.forEach(function(t){e[t]=function(e,n){return n?("component"===t&&s(n)&&(n.name=n.name||e,n=this.options._base.extend(n)),"directive"===t&&"function"==typeof n&&(n={bind:n,update:n}),this.options[t+"s"][e]=n,n):this.options[t+"s"][e]}})}(e)}(wn),Object.defineProperty(wn.prototype,"$isServer",{get:te}),Object.defineProperty(wn.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(wn,"FunctionalRenderContext",{value:Tt}),wn.version="2.6.11";var En=p("style,class"),Nn=p("input,textarea,option,select,progress"),jn=function(e,t,n){return"value"===n&&Nn(e)&&"button"!==t||"selected"===n&&"option"===e||"checked"===n&&"input"===e||"muted"===n&&"video"===e},Dn=p("contenteditable,draggable,spellcheck"),Ln=p("events,caret,typing,plaintext-only"),Mn=function(e,t){return Hn(t)||"false"===t?"false":"contenteditable"===e&&Ln(t)?t:"true"},In=p("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"),Fn="http://www.w3.org/1999/xlink",Pn=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},Rn=function(e){return Pn(e)?e.slice(6,e.length):""},Hn=function(e){return null==e||!1===e};function Bn(e){for(var t=e.data,r=e,i=e;n(i.componentInstance);)(i=i.componentInstance._vnode)&&i.data&&(t=Un(i.data,t));for(;n(r=r.parent);)r&&r.data&&(t=Un(t,r.data));return function(e,t){if(n(e)||n(t))return zn(e,Vn(t));return""}(t.staticClass,t.class)}function Un(e,t){return{staticClass:zn(e.staticClass,t.staticClass),class:n(e.class)?[e.class,t.class]:t.class}}function zn(e,t){return e?t?e+" "+t:e:t||""}function Vn(e){return Array.isArray(e)?function(e){for(var t,r="",i=0,o=e.length;i<o;i++)n(t=Vn(e[i]))&&""!==t&&(r&&(r+=" "),r+=t);return r}(e):o(e)?function(e){var t="";for(var n in e)e[n]&&(t&&(t+=" "),t+=n);return t}(e):"string"==typeof e?e:""}var Kn={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Jn=p("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),qn=p("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Wn=function(e){return Jn(e)||qn(e)};function Zn(e){return qn(e)?"svg":"math"===e?"math":void 0}var Gn=Object.create(null);var Xn=p("text,number,password,search,email,tel,url");function Yn(e){if("string"==typeof e){var t=document.querySelector(e);return t||document.createElement("div")}return e}var Qn=Object.freeze({createElement:function(e,t){var n=document.createElement(e);return"select"!==e?n:(t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n)},createElementNS:function(e,t){return document.createElementNS(Kn[e],t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},setStyleScope:function(e,t){e.setAttribute(t,"")}}),er={create:function(e,t){tr(t)},update:function(e,t){e.data.ref!==t.data.ref&&(tr(e,!0),tr(t))},destroy:function(e){tr(e,!0)}};function tr(e,t){var r=e.data.ref;if(n(r)){var i=e.context,o=e.componentInstance||e.elm,a=i.$refs;t?Array.isArray(a[r])?h(a[r],o):a[r]===o&&(a[r]=void 0):e.data.refInFor?Array.isArray(a[r])?a[r].indexOf(o)<0&&a[r].push(o):a[r]=[o]:a[r]=o}}var nr=new pe("",{},[]),rr=["create","activate","update","remove","destroy"];function ir(e,i){return e.key===i.key&&(e.tag===i.tag&&e.isComment===i.isComment&&n(e.data)===n(i.data)&&function(e,t){if("input"!==e.tag)return!0;var r,i=n(r=e.data)&&n(r=r.attrs)&&r.type,o=n(r=t.data)&&n(r=r.attrs)&&r.type;return i===o||Xn(i)&&Xn(o)}(e,i)||r(e.isAsyncPlaceholder)&&e.asyncFactory===i.asyncFactory&&t(i.asyncFactory.error))}function or(e,t,r){var i,o,a={};for(i=t;i<=r;++i)n(o=e[i].key)&&(a[o]=i);return a}var ar={create:sr,update:sr,destroy:function(e){sr(e,nr)}};function sr(e,t){(e.data.directives||t.data.directives)&&function(e,t){var n,r,i,o=e===nr,a=t===nr,s=ur(e.data.directives,e.context),c=ur(t.data.directives,t.context),u=[],l=[];for(n in c)r=s[n],i=c[n],r?(i.oldValue=r.value,i.oldArg=r.arg,fr(i,"update",t,e),i.def&&i.def.componentUpdated&&l.push(i)):(fr(i,"bind",t,e),i.def&&i.def.inserted&&u.push(i));if(u.length){var f=function(){for(var n=0;n<u.length;n++)fr(u[n],"inserted",t,e)};o?it(t,"insert",f):f()}l.length&&it(t,"postpatch",function(){for(var n=0;n<l.length;n++)fr(l[n],"componentUpdated",t,e)});if(!o)for(n in s)c[n]||fr(s[n],"unbind",e,e,a)}(e,t)}var cr=Object.create(null);function ur(e,t){var n,r,i=Object.create(null);if(!e)return i;for(n=0;n<e.length;n++)(r=e[n]).modifiers||(r.modifiers=cr),i[lr(r)]=r,r.def=Le(t.$options,"directives",r.name);return i}function lr(e){return e.rawName||e.name+"."+Object.keys(e.modifiers||{}).join(".")}function fr(e,t,n,r,i){var o=e.def&&e.def[t];if(o)try{o(n.elm,e,n,r,i)}catch(r){Re(r,n.context,"directive "+e.name+" "+t+" hook")}}var pr=[er,ar];function dr(e,r){var i=r.componentOptions;if(!(n(i)&&!1===i.Ctor.options.inheritAttrs||t(e.data.attrs)&&t(r.data.attrs))){var o,a,s=r.elm,c=e.data.attrs||{},u=r.data.attrs||{};for(o in n(u.__ob__)&&(u=r.data.attrs=A({},u)),u)a=u[o],c[o]!==a&&vr(s,o,a);for(o in(q||Z)&&u.value!==c.value&&vr(s,"value",u.value),c)t(u[o])&&(Pn(o)?s.removeAttributeNS(Fn,Rn(o)):Dn(o)||s.removeAttribute(o))}}function vr(e,t,n){e.tagName.indexOf("-")>-1?hr(e,t,n):In(t)?Hn(n)?e.removeAttribute(t):(n="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,n)):Dn(t)?e.setAttribute(t,Mn(t,n)):Pn(t)?Hn(n)?e.removeAttributeNS(Fn,Rn(t)):e.setAttributeNS(Fn,t,n):hr(e,t,n)}function hr(e,t,n){if(Hn(n))e.removeAttribute(t);else{if(q&&!W&&"TEXTAREA"===e.tagName&&"placeholder"===t&&""!==n&&!e.__ieph){var r=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",r)};e.addEventListener("input",r),e.__ieph=!0}e.setAttribute(t,n)}}var mr={create:dr,update:dr};function yr(e,r){var i=r.elm,o=r.data,a=e.data;if(!(t(o.staticClass)&&t(o.class)&&(t(a)||t(a.staticClass)&&t(a.class)))){var s=Bn(r),c=i._transitionClasses;n(c)&&(s=zn(s,Vn(c))),s!==i._prevClass&&(i.setAttribute("class",s),i._prevClass=s)}}var gr,_r,br,$r,wr,Cr,xr={create:yr,update:yr},kr=/[\w).+\-_$\]]/;function Ar(e){var t,n,r,i,o,a=!1,s=!1,c=!1,u=!1,l=0,f=0,p=0,d=0;for(r=0;r<e.length;r++)if(n=t,t=e.charCodeAt(r),a)39===t&&92!==n&&(a=!1);else if(s)34===t&&92!==n&&(s=!1);else if(c)96===t&&92!==n&&(c=!1);else if(u)47===t&&92!==n&&(u=!1);else if(124!==t||124===e.charCodeAt(r+1)||124===e.charCodeAt(r-1)||l||f||p){switch(t){case 34:s=!0;break;case 39:a=!0;break;case 96:c=!0;break;case 40:p++;break;case 41:p--;break;case 91:f++;break;case 93:f--;break;case 123:l++;break;case 125:l--}if(47===t){for(var v=r-1,h=void 0;v>=0&&" "===(h=e.charAt(v));v--);h&&kr.test(h)||(u=!0)}}else void 0===i?(d=r+1,i=e.slice(0,r).trim()):m();function m(){(o||(o=[])).push(e.slice(d,r).trim()),d=r+1}if(void 0===i?i=e.slice(0,r).trim():0!==d&&m(),o)for(r=0;r<o.length;r++)i=Or(i,o[r]);return i}function Or(e,t){var n=t.indexOf("(");if(n<0)return'_f("'+t+'")('+e+")";var r=t.slice(0,n),i=t.slice(n+1);return'_f("'+r+'")('+e+(")"!==i?","+i:i)}function Sr(e,t){console.error("[Vue compiler]: "+e)}function Tr(e,t){return e?e.map(function(e){return e[t]}).filter(function(e){return e}):[]}function Er(e,t,n,r,i){(e.props||(e.props=[])).push(Rr({name:t,value:n,dynamic:i},r)),e.plain=!1}function Nr(e,t,n,r,i){(i?e.dynamicAttrs||(e.dynamicAttrs=[]):e.attrs||(e.attrs=[])).push(Rr({name:t,value:n,dynamic:i},r)),e.plain=!1}function jr(e,t,n,r){e.attrsMap[t]=n,e.attrsList.push(Rr({name:t,value:n},r))}function Dr(e,t,n,r,i,o,a,s){(e.directives||(e.directives=[])).push(Rr({name:t,rawName:n,value:r,arg:i,isDynamicArg:o,modifiers:a},s)),e.plain=!1}function Lr(e,t,n){return n?"_p("+t+',"'+e+'")':e+t}function Mr(t,n,r,i,o,a,s,c){var u;(i=i||e).right?c?n="("+n+")==='click'?'contextmenu':("+n+")":"click"===n&&(n="contextmenu",delete i.right):i.middle&&(c?n="("+n+")==='click'?'mouseup':("+n+")":"click"===n&&(n="mouseup")),i.capture&&(delete i.capture,n=Lr("!",n,c)),i.once&&(delete i.once,n=Lr("~",n,c)),i.passive&&(delete i.passive,n=Lr("&",n,c)),i.native?(delete i.native,u=t.nativeEvents||(t.nativeEvents={})):u=t.events||(t.events={});var l=Rr({value:r.trim(),dynamic:c},s);i!==e&&(l.modifiers=i);var f=u[n];Array.isArray(f)?o?f.unshift(l):f.push(l):u[n]=f?o?[l,f]:[f,l]:l,t.plain=!1}function Ir(e,t,n){var r=Fr(e,":"+t)||Fr(e,"v-bind:"+t);if(null!=r)return Ar(r);if(!1!==n){var i=Fr(e,t);if(null!=i)return JSON.stringify(i)}}function Fr(e,t,n){var r;if(null!=(r=e.attrsMap[t]))for(var i=e.attrsList,o=0,a=i.length;o<a;o++)if(i[o].name===t){i.splice(o,1);break}return n&&delete e.attrsMap[t],r}function Pr(e,t){for(var n=e.attrsList,r=0,i=n.length;r<i;r++){var o=n[r];if(t.test(o.name))return n.splice(r,1),o}}function Rr(e,t){return t&&(null!=t.start&&(e.start=t.start),null!=t.end&&(e.end=t.end)),e}function Hr(e,t,n){var r=n||{},i=r.number,o="$$v";r.trim&&(o="(typeof $$v === 'string'? $$v.trim(): $$v)"),i&&(o="_n("+o+")");var a=Br(t,o);e.model={value:"("+t+")",expression:JSON.stringify(t),callback:"function ($$v) {"+a+"}"}}function Br(e,t){var n=function(e){if(e=e.trim(),gr=e.length,e.indexOf("[")<0||e.lastIndexOf("]")<gr-1)return($r=e.lastIndexOf("."))>-1?{exp:e.slice(0,$r),key:'"'+e.slice($r+1)+'"'}:{exp:e,key:null};_r=e,$r=wr=Cr=0;for(;!zr();)Vr(br=Ur())?Jr(br):91===br&&Kr(br);return{exp:e.slice(0,wr),key:e.slice(wr+1,Cr)}}(e);return null===n.key?e+"="+t:"$set("+n.exp+", "+n.key+", "+t+")"}function Ur(){return _r.charCodeAt(++$r)}function zr(){return $r>=gr}function Vr(e){return 34===e||39===e}function Kr(e){var t=1;for(wr=$r;!zr();)if(Vr(e=Ur()))Jr(e);else if(91===e&&t++,93===e&&t--,0===t){Cr=$r;break}}function Jr(e){for(var t=e;!zr()&&(e=Ur())!==t;);}var qr,Wr="__r",Zr="__c";function Gr(e,t,n){var r=qr;return function i(){null!==t.apply(null,arguments)&&Qr(e,i,n,r)}}var Xr=Ve&&!(X&&Number(X[1])<=53);function Yr(e,t,n,r){if(Xr){var i=an,o=t;t=o._wrapper=function(e){if(e.target===e.currentTarget||e.timeStamp>=i||e.timeStamp<=0||e.target.ownerDocument!==document)return o.apply(this,arguments)}}qr.addEventListener(e,t,Q?{capture:n,passive:r}:n)}function Qr(e,t,n,r){(r||qr).removeEventListener(e,t._wrapper||t,n)}function ei(e,r){if(!t(e.data.on)||!t(r.data.on)){var i=r.data.on||{},o=e.data.on||{};qr=r.elm,function(e){if(n(e[Wr])){var t=q?"change":"input";e[t]=[].concat(e[Wr],e[t]||[]),delete e[Wr]}n(e[Zr])&&(e.change=[].concat(e[Zr],e.change||[]),delete e[Zr])}(i),rt(i,o,Yr,Qr,Gr,r.context),qr=void 0}}var ti,ni={create:ei,update:ei};function ri(e,r){if(!t(e.data.domProps)||!t(r.data.domProps)){var i,o,a=r.elm,s=e.data.domProps||{},c=r.data.domProps||{};for(i in n(c.__ob__)&&(c=r.data.domProps=A({},c)),s)i in c||(a[i]="");for(i in c){if(o=c[i],"textContent"===i||"innerHTML"===i){if(r.children&&(r.children.length=0),o===s[i])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===i&&"PROGRESS"!==a.tagName){a._value=o;var u=t(o)?"":String(o);ii(a,u)&&(a.value=u)}else if("innerHTML"===i&&qn(a.tagName)&&t(a.innerHTML)){(ti=ti||document.createElement("div")).innerHTML="<svg>"+o+"</svg>";for(var l=ti.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}else if(o!==s[i])try{a[i]=o}catch(e){}}}}function ii(e,t){return!e.composing&&("OPTION"===e.tagName||function(e,t){var n=!0;try{n=document.activeElement!==e}catch(e){}return n&&e.value!==t}(e,t)||function(e,t){var r=e.value,i=e._vModifiers;if(n(i)){if(i.number)return f(r)!==f(t);if(i.trim)return r.trim()!==t.trim()}return r!==t}(e,t))}var oi={create:ri,update:ri},ai=g(function(e){var t={},n=/:(.+)/;return e.split(/;(?![^(]*\))/g).forEach(function(e){if(e){var r=e.split(n);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t});function si(e){var t=ci(e.style);return e.staticStyle?A(e.staticStyle,t):t}function ci(e){return Array.isArray(e)?O(e):"string"==typeof e?ai(e):e}var ui,li=/^--/,fi=/\s*!important$/,pi=function(e,t,n){if(li.test(t))e.style.setProperty(t,n);else if(fi.test(n))e.style.setProperty(C(t),n.replace(fi,""),"important");else{var r=vi(t);if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++)e.style[r]=n[i];else e.style[r]=n}},di=["Webkit","Moz","ms"],vi=g(function(e){if(ui=ui||document.createElement("div").style,"filter"!==(e=b(e))&&e in ui)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<di.length;n++){var r=di[n]+t;if(r in ui)return r}});function hi(e,r){var i=r.data,o=e.data;if(!(t(i.staticStyle)&&t(i.style)&&t(o.staticStyle)&&t(o.style))){var a,s,c=r.elm,u=o.staticStyle,l=o.normalizedStyle||o.style||{},f=u||l,p=ci(r.data.style)||{};r.data.normalizedStyle=n(p.__ob__)?A({},p):p;var d=function(e,t){var n,r={};if(t)for(var i=e;i.componentInstance;)(i=i.componentInstance._vnode)&&i.data&&(n=si(i.data))&&A(r,n);(n=si(e.data))&&A(r,n);for(var o=e;o=o.parent;)o.data&&(n=si(o.data))&&A(r,n);return r}(r,!0);for(s in f)t(d[s])&&pi(c,s,"");for(s in d)(a=d[s])!==f[s]&&pi(c,s,null==a?"":a)}}var mi={create:hi,update:hi},yi=/\s+/;function gi(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(yi).forEach(function(t){return e.classList.add(t)}):e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function _i(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(yi).forEach(function(t){return e.classList.remove(t)}):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{for(var n=" "+(e.getAttribute("class")||"")+" ",r=" "+t+" ";n.indexOf(r)>=0;)n=n.replace(r," ");(n=n.trim())?e.setAttribute("class",n):e.removeAttribute("class")}}function bi(e){if(e){if("object"==typeof e){var t={};return!1!==e.css&&A(t,$i(e.name||"v")),A(t,e),t}return"string"==typeof e?$i(e):void 0}}var $i=g(function(e){return{enterClass:e+"-enter",enterToClass:e+"-enter-to",enterActiveClass:e+"-enter-active",leaveClass:e+"-leave",leaveToClass:e+"-leave-to",leaveActiveClass:e+"-leave-active"}}),wi=z&&!W,Ci="transition",xi="animation",ki="transition",Ai="transitionend",Oi="animation",Si="animationend";wi&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(ki="WebkitTransition",Ai="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Oi="WebkitAnimation",Si="webkitAnimationEnd"));var Ti=z?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function Ei(e){Ti(function(){Ti(e)})}function Ni(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),gi(e,t))}function ji(e,t){e._transitionClasses&&h(e._transitionClasses,t),_i(e,t)}function Di(e,t,n){var r=Mi(e,t),i=r.type,o=r.timeout,a=r.propCount;if(!i)return n();var s=i===Ci?Ai:Si,c=0,u=function(){e.removeEventListener(s,l),n()},l=function(t){t.target===e&&++c>=a&&u()};setTimeout(function(){c<a&&u()},o+1),e.addEventListener(s,l)}var Li=/\b(transform|all)(,|$)/;function Mi(e,t){var n,r=window.getComputedStyle(e),i=(r[ki+"Delay"]||"").split(", "),o=(r[ki+"Duration"]||"").split(", "),a=Ii(i,o),s=(r[Oi+"Delay"]||"").split(", "),c=(r[Oi+"Duration"]||"").split(", "),u=Ii(s,c),l=0,f=0;return t===Ci?a>0&&(n=Ci,l=a,f=o.length):t===xi?u>0&&(n=xi,l=u,f=c.length):f=(n=(l=Math.max(a,u))>0?a>u?Ci:xi:null)?n===Ci?o.length:c.length:0,{type:n,timeout:l,propCount:f,hasTransform:n===Ci&&Li.test(r[ki+"Property"])}}function Ii(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max.apply(null,t.map(function(t,n){return Fi(t)+Fi(e[n])}))}function Fi(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function Pi(e,r){var i=e.elm;n(i._leaveCb)&&(i._leaveCb.cancelled=!0,i._leaveCb());var a=bi(e.data.transition);if(!t(a)&&!n(i._enterCb)&&1===i.nodeType){for(var s=a.css,c=a.type,u=a.enterClass,l=a.enterToClass,p=a.enterActiveClass,d=a.appearClass,v=a.appearToClass,h=a.appearActiveClass,m=a.beforeEnter,y=a.enter,g=a.afterEnter,_=a.enterCancelled,b=a.beforeAppear,$=a.appear,w=a.afterAppear,C=a.appearCancelled,x=a.duration,k=Wt,A=Wt.$vnode;A&&A.parent;)k=A.context,A=A.parent;var O=!k._isMounted||!e.isRootInsert;if(!O||$||""===$){var S=O&&d?d:u,T=O&&h?h:p,E=O&&v?v:l,N=O&&b||m,j=O&&"function"==typeof $?$:y,L=O&&w||g,M=O&&C||_,I=f(o(x)?x.enter:x),F=!1!==s&&!W,P=Bi(j),R=i._enterCb=D(function(){F&&(ji(i,E),ji(i,T)),R.cancelled?(F&&ji(i,S),M&&M(i)):L&&L(i),i._enterCb=null});e.data.show||it(e,"insert",function(){var t=i.parentNode,n=t&&t._pending&&t._pending[e.key];n&&n.tag===e.tag&&n.elm._leaveCb&&n.elm._leaveCb(),j&&j(i,R)}),N&&N(i),F&&(Ni(i,S),Ni(i,T),Ei(function(){ji(i,S),R.cancelled||(Ni(i,E),P||(Hi(I)?setTimeout(R,I):Di(i,c,R)))})),e.data.show&&(r&&r(),j&&j(i,R)),F||P||R()}}}function Ri(e,r){var i=e.elm;n(i._enterCb)&&(i._enterCb.cancelled=!0,i._enterCb());var a=bi(e.data.transition);if(t(a)||1!==i.nodeType)return r();if(!n(i._leaveCb)){var s=a.css,c=a.type,u=a.leaveClass,l=a.leaveToClass,p=a.leaveActiveClass,d=a.beforeLeave,v=a.leave,h=a.afterLeave,m=a.leaveCancelled,y=a.delayLeave,g=a.duration,_=!1!==s&&!W,b=Bi(v),$=f(o(g)?g.leave:g),w=i._leaveCb=D(function(){i.parentNode&&i.parentNode._pending&&(i.parentNode._pending[e.key]=null),_&&(ji(i,l),ji(i,p)),w.cancelled?(_&&ji(i,u),m&&m(i)):(r(),h&&h(i)),i._leaveCb=null});y?y(C):C()}function C(){w.cancelled||(!e.data.show&&i.parentNode&&((i.parentNode._pending||(i.parentNode._pending={}))[e.key]=e),d&&d(i),_&&(Ni(i,u),Ni(i,p),Ei(function(){ji(i,u),w.cancelled||(Ni(i,l),b||(Hi($)?setTimeout(w,$):Di(i,c,w)))})),v&&v(i,w),_||b||w())}}function Hi(e){return"number"==typeof e&&!isNaN(e)}function Bi(e){if(t(e))return!1;var r=e.fns;return n(r)?Bi(Array.isArray(r)?r[0]:r):(e._length||e.length)>1}function Ui(e,t){!0!==t.data.show&&Pi(t)}var zi=function(e){var o,a,s={},c=e.modules,u=e.nodeOps;for(o=0;o<rr.length;++o)for(s[rr[o]]=[],a=0;a<c.length;++a)n(c[a][rr[o]])&&s[rr[o]].push(c[a][rr[o]]);function l(e){var t=u.parentNode(e);n(t)&&u.removeChild(t,e)}function f(e,t,i,o,a,c,l){if(n(e.elm)&&n(c)&&(e=c[l]=me(e)),e.isRootInsert=!a,!function(e,t,i,o){var a=e.data;if(n(a)){var c=n(e.componentInstance)&&a.keepAlive;if(n(a=a.hook)&&n(a=a.init)&&a(e,!1),n(e.componentInstance))return d(e,t),v(i,e.elm,o),r(c)&&function(e,t,r,i){for(var o,a=e;a.componentInstance;)if(a=a.componentInstance._vnode,n(o=a.data)&&n(o=o.transition)){for(o=0;o<s.activate.length;++o)s.activate[o](nr,a);t.push(a);break}v(r,e.elm,i)}(e,t,i,o),!0}}(e,t,i,o)){var f=e.data,p=e.children,m=e.tag;n(m)?(e.elm=e.ns?u.createElementNS(e.ns,m):u.createElement(m,e),g(e),h(e,p,t),n(f)&&y(e,t),v(i,e.elm,o)):r(e.isComment)?(e.elm=u.createComment(e.text),v(i,e.elm,o)):(e.elm=u.createTextNode(e.text),v(i,e.elm,o))}}function d(e,t){n(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,m(e)?(y(e,t),g(e)):(tr(e),t.push(e))}function v(e,t,r){n(e)&&(n(r)?u.parentNode(r)===e&&u.insertBefore(e,t,r):u.appendChild(e,t))}function h(e,t,n){if(Array.isArray(t))for(var r=0;r<t.length;++r)f(t[r],n,e.elm,null,!0,t,r);else i(e.text)&&u.appendChild(e.elm,u.createTextNode(String(e.text)))}function m(e){for(;e.componentInstance;)e=e.componentInstance._vnode;return n(e.tag)}function y(e,t){for(var r=0;r<s.create.length;++r)s.create[r](nr,e);n(o=e.data.hook)&&(n(o.create)&&o.create(nr,e),n(o.insert)&&t.push(e))}function g(e){var t;if(n(t=e.fnScopeId))u.setStyleScope(e.elm,t);else for(var r=e;r;)n(t=r.context)&&n(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t),r=r.parent;n(t=Wt)&&t!==e.context&&t!==e.fnContext&&n(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t)}function _(e,t,n,r,i,o){for(;r<=i;++r)f(n[r],o,e,t,!1,n,r)}function b(e){var t,r,i=e.data;if(n(i))for(n(t=i.hook)&&n(t=t.destroy)&&t(e),t=0;t<s.destroy.length;++t)s.destroy[t](e);if(n(t=e.children))for(r=0;r<e.children.length;++r)b(e.children[r])}function $(e,t,r){for(;t<=r;++t){var i=e[t];n(i)&&(n(i.tag)?(w(i),b(i)):l(i.elm))}}function w(e,t){if(n(t)||n(e.data)){var r,i=s.remove.length+1;for(n(t)?t.listeners+=i:t=function(e,t){function n(){0==--n.listeners&&l(e)}return n.listeners=t,n}(e.elm,i),n(r=e.componentInstance)&&n(r=r._vnode)&&n(r.data)&&w(r,t),r=0;r<s.remove.length;++r)s.remove[r](e,t);n(r=e.data.hook)&&n(r=r.remove)?r(e,t):t()}else l(e.elm)}function C(e,t,r,i){for(var o=r;o<i;o++){var a=t[o];if(n(a)&&ir(e,a))return o}}function x(e,i,o,a,c,l){if(e!==i){n(i.elm)&&n(a)&&(i=a[c]=me(i));var p=i.elm=e.elm;if(r(e.isAsyncPlaceholder))n(i.asyncFactory.resolved)?O(e.elm,i,o):i.isAsyncPlaceholder=!0;else if(r(i.isStatic)&&r(e.isStatic)&&i.key===e.key&&(r(i.isCloned)||r(i.isOnce)))i.componentInstance=e.componentInstance;else{var d,v=i.data;n(v)&&n(d=v.hook)&&n(d=d.prepatch)&&d(e,i);var h=e.children,y=i.children;if(n(v)&&m(i)){for(d=0;d<s.update.length;++d)s.update[d](e,i);n(d=v.hook)&&n(d=d.update)&&d(e,i)}t(i.text)?n(h)&&n(y)?h!==y&&function(e,r,i,o,a){for(var s,c,l,p=0,d=0,v=r.length-1,h=r[0],m=r[v],y=i.length-1,g=i[0],b=i[y],w=!a;p<=v&&d<=y;)t(h)?h=r[++p]:t(m)?m=r[--v]:ir(h,g)?(x(h,g,o,i,d),h=r[++p],g=i[++d]):ir(m,b)?(x(m,b,o,i,y),m=r[--v],b=i[--y]):ir(h,b)?(x(h,b,o,i,y),w&&u.insertBefore(e,h.elm,u.nextSibling(m.elm)),h=r[++p],b=i[--y]):ir(m,g)?(x(m,g,o,i,d),w&&u.insertBefore(e,m.elm,h.elm),m=r[--v],g=i[++d]):(t(s)&&(s=or(r,p,v)),t(c=n(g.key)?s[g.key]:C(g,r,p,v))?f(g,o,e,h.elm,!1,i,d):ir(l=r[c],g)?(x(l,g,o,i,d),r[c]=void 0,w&&u.insertBefore(e,l.elm,h.elm)):f(g,o,e,h.elm,!1,i,d),g=i[++d]);p>v?_(e,t(i[y+1])?null:i[y+1].elm,i,d,y,o):d>y&&$(r,p,v)}(p,h,y,o,l):n(y)?(n(e.text)&&u.setTextContent(p,""),_(p,null,y,0,y.length-1,o)):n(h)?$(h,0,h.length-1):n(e.text)&&u.setTextContent(p,""):e.text!==i.text&&u.setTextContent(p,i.text),n(v)&&n(d=v.hook)&&n(d=d.postpatch)&&d(e,i)}}}function k(e,t,i){if(r(i)&&n(e.parent))e.parent.data.pendingInsert=t;else for(var o=0;o<t.length;++o)t[o].data.hook.insert(t[o])}var A=p("attrs,class,staticClass,staticStyle,key");function O(e,t,i,o){var a,s=t.tag,c=t.data,u=t.children;if(o=o||c&&c.pre,t.elm=e,r(t.isComment)&&n(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(n(c)&&(n(a=c.hook)&&n(a=a.init)&&a(t,!0),n(a=t.componentInstance)))return d(t,i),!0;if(n(s)){if(n(u))if(e.hasChildNodes())if(n(a=c)&&n(a=a.domProps)&&n(a=a.innerHTML)){if(a!==e.innerHTML)return!1}else{for(var l=!0,f=e.firstChild,p=0;p<u.length;p++){if(!f||!O(f,u[p],i,o)){l=!1;break}f=f.nextSibling}if(!l||f)return!1}else h(t,u,i);if(n(c)){var v=!1;for(var m in c)if(!A(m)){v=!0,y(t,i);break}!v&&c.class&&et(c.class)}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,i,o,a){if(!t(i)){var c,l=!1,p=[];if(t(e))l=!0,f(i,p);else{var d=n(e.nodeType);if(!d&&ir(e,i))x(e,i,p,null,null,a);else{if(d){if(1===e.nodeType&&e.hasAttribute(L)&&(e.removeAttribute(L),o=!0),r(o)&&O(e,i,p))return k(i,p,!0),e;c=e,e=new pe(u.tagName(c).toLowerCase(),{},[],void 0,c)}var v=e.elm,h=u.parentNode(v);if(f(i,p,v._leaveCb?null:h,u.nextSibling(v)),n(i.parent))for(var y=i.parent,g=m(i);y;){for(var _=0;_<s.destroy.length;++_)s.destroy[_](y);if(y.elm=i.elm,g){for(var w=0;w<s.create.length;++w)s.create[w](nr,y);var C=y.data.hook.insert;if(C.merged)for(var A=1;A<C.fns.length;A++)C.fns[A]()}else tr(y);y=y.parent}n(h)?$([e],0,0):n(e.tag)&&b(e)}}return k(i,p,l),i.elm}n(e)&&b(e)}}({nodeOps:Qn,modules:[mr,xr,ni,oi,mi,z?{create:Ui,activate:Ui,remove:function(e,t){!0!==e.data.show?Ri(e,t):t()}}:{}].concat(pr)});W&&document.addEventListener("selectionchange",function(){var e=document.activeElement;e&&e.vmodel&&Xi(e,"input")});var Vi={inserted:function(e,t,n,r){"select"===n.tag?(r.elm&&!r.elm._vOptions?it(n,"postpatch",function(){Vi.componentUpdated(e,t,n)}):Ki(e,t,n.context),e._vOptions=[].map.call(e.options,Wi)):("textarea"===n.tag||Xn(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",Zi),e.addEventListener("compositionend",Gi),e.addEventListener("change",Gi),W&&(e.vmodel=!0)))},componentUpdated:function(e,t,n){if("select"===n.tag){Ki(e,t,n.context);var r=e._vOptions,i=e._vOptions=[].map.call(e.options,Wi);if(i.some(function(e,t){return!N(e,r[t])}))(e.multiple?t.value.some(function(e){return qi(e,i)}):t.value!==t.oldValue&&qi(t.value,i))&&Xi(e,"change")}}};function Ki(e,t,n){Ji(e,t,n),(q||Z)&&setTimeout(function(){Ji(e,t,n)},0)}function Ji(e,t,n){var r=t.value,i=e.multiple;if(!i||Array.isArray(r)){for(var o,a,s=0,c=e.options.length;s<c;s++)if(a=e.options[s],i)o=j(r,Wi(a))>-1,a.selected!==o&&(a.selected=o);else if(N(Wi(a),r))return void(e.selectedIndex!==s&&(e.selectedIndex=s));i||(e.selectedIndex=-1)}}function qi(e,t){return t.every(function(t){return!N(t,e)})}function Wi(e){return"_value"in e?e._value:e.value}function Zi(e){e.target.composing=!0}function Gi(e){e.target.composing&&(e.target.composing=!1,Xi(e.target,"input"))}function Xi(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}function Yi(e){return!e.componentInstance||e.data&&e.data.transition?e:Yi(e.componentInstance._vnode)}var Qi={model:Vi,show:{bind:function(e,t,n){var r=t.value,i=(n=Yi(n)).data&&n.data.transition,o=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;r&&i?(n.data.show=!0,Pi(n,function(){e.style.display=o})):e.style.display=r?o:"none"},update:function(e,t,n){var r=t.value;!r!=!t.oldValue&&((n=Yi(n)).data&&n.data.transition?(n.data.show=!0,r?Pi(n,function(){e.style.display=e.__vOriginalDisplay}):Ri(n,function(){e.style.display="none"})):e.style.display=r?e.__vOriginalDisplay:"none")},unbind:function(e,t,n,r,i){i||(e.style.display=e.__vOriginalDisplay)}}},eo={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function to(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?to(zt(t.children)):e}function no(e){var t={},n=e.$options;for(var r in n.propsData)t[r]=e[r];var i=n._parentListeners;for(var o in i)t[b(o)]=i[o];return t}function ro(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}var io=function(e){return e.tag||Ut(e)},oo=function(e){return"show"===e.name},ao={name:"transition",props:eo,abstract:!0,render:function(e){var t=this,n=this.$slots.default;if(n&&(n=n.filter(io)).length){var r=this.mode,o=n[0];if(function(e){for(;e=e.parent;)if(e.data.transition)return!0}(this.$vnode))return o;var a=to(o);if(!a)return o;if(this._leaving)return ro(e,o);var s="__transition-"+this._uid+"-";a.key=null==a.key?a.isComment?s+"comment":s+a.tag:i(a.key)?0===String(a.key).indexOf(s)?a.key:s+a.key:a.key;var c=(a.data||(a.data={})).transition=no(this),u=this._vnode,l=to(u);if(a.data.directives&&a.data.directives.some(oo)&&(a.data.show=!0),l&&l.data&&!function(e,t){return t.key===e.key&&t.tag===e.tag}(a,l)&&!Ut(l)&&(!l.componentInstance||!l.componentInstance._vnode.isComment)){var f=l.data.transition=A({},c);if("out-in"===r)return this._leaving=!0,it(f,"afterLeave",function(){t._leaving=!1,t.$forceUpdate()}),ro(e,o);if("in-out"===r){if(Ut(a))return u;var p,d=function(){p()};it(c,"afterEnter",d),it(c,"enterCancelled",d),it(f,"delayLeave",function(e){p=e})}}return o}}},so=A({tag:String,moveClass:String},eo);function co(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function uo(e){e.data.newPos=e.elm.getBoundingClientRect()}function lo(e){var t=e.data.pos,n=e.data.newPos,r=t.left-n.left,i=t.top-n.top;if(r||i){e.data.moved=!0;var o=e.elm.style;o.transform=o.WebkitTransform="translate("+r+"px,"+i+"px)",o.transitionDuration="0s"}}delete so.mode;var fo={Transition:ao,TransitionGroup:{props:so,beforeMount:function(){var e=this,t=this._update;this._update=function(n,r){var i=Zt(e);e.__patch__(e._vnode,e.kept,!1,!0),e._vnode=e.kept,i(),t.call(e,n,r)}},render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),r=this.prevChildren=this.children,i=this.$slots.default||[],o=this.children=[],a=no(this),s=0;s<i.length;s++){var c=i[s];c.tag&&null!=c.key&&0!==String(c.key).indexOf("__vlist")&&(o.push(c),n[c.key]=c,(c.data||(c.data={})).transition=a)}if(r){for(var u=[],l=[],f=0;f<r.length;f++){var p=r[f];p.data.transition=a,p.data.pos=p.elm.getBoundingClientRect(),n[p.key]?u.push(p):l.push(p)}this.kept=e(t,null,u),this.removed=l}return e(t,null,o)},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(co),e.forEach(uo),e.forEach(lo),this._reflow=document.body.offsetHeight,e.forEach(function(e){if(e.data.moved){var n=e.elm,r=n.style;Ni(n,t),r.transform=r.WebkitTransform=r.transitionDuration="",n.addEventListener(Ai,n._moveCb=function e(r){r&&r.target!==n||r&&!/transform$/.test(r.propertyName)||(n.removeEventListener(Ai,e),n._moveCb=null,ji(n,t))})}}))},methods:{hasMove:function(e,t){if(!wi)return!1;if(this._hasMove)return this._hasMove;var n=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach(function(e){_i(n,e)}),gi(n,t),n.style.display="none",this.$el.appendChild(n);var r=Mi(n);return this.$el.removeChild(n),this._hasMove=r.hasTransform}}}};wn.config.mustUseProp=jn,wn.config.isReservedTag=Wn,wn.config.isReservedAttr=En,wn.config.getTagNamespace=Zn,wn.config.isUnknownElement=function(e){if(!z)return!0;if(Wn(e))return!1;if(e=e.toLowerCase(),null!=Gn[e])return Gn[e];var t=document.createElement(e);return e.indexOf("-")>-1?Gn[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:Gn[e]=/HTMLUnknownElement/.test(t.toString())},A(wn.options.directives,Qi),A(wn.options.components,fo),wn.prototype.__patch__=z?zi:S,wn.prototype.$mount=function(e,t){return function(e,t,n){var r;return e.$el=t,e.$options.render||(e.$options.render=ve),Yt(e,"beforeMount"),r=function(){e._update(e._render(),n)},new fn(e,r,S,{before:function(){e._isMounted&&!e._isDestroyed&&Yt(e,"beforeUpdate")}},!0),n=!1,null==e.$vnode&&(e._isMounted=!0,Yt(e,"mounted")),e}(this,e=e&&z?Yn(e):void 0,t)},z&&setTimeout(function(){F.devtools&&ne&&ne.emit("init",wn)},0);var po=/\{\{((?:.|\r?\n)+?)\}\}/g,vo=/[-.*+?^${}()|[\]\/\\]/g,ho=g(function(e){var t=e[0].replace(vo,"\\$&"),n=e[1].replace(vo,"\\$&");return new RegExp(t+"((?:.|\\n)+?)"+n,"g")});var mo={staticKeys:["staticClass"],transformNode:function(e,t){t.warn;var n=Fr(e,"class");n&&(e.staticClass=JSON.stringify(n));var r=Ir(e,"class",!1);r&&(e.classBinding=r)},genData:function(e){var t="";return e.staticClass&&(t+="staticClass:"+e.staticClass+","),e.classBinding&&(t+="class:"+e.classBinding+","),t}};var yo,go={staticKeys:["staticStyle"],transformNode:function(e,t){t.warn;var n=Fr(e,"style");n&&(e.staticStyle=JSON.stringify(ai(n)));var r=Ir(e,"style",!1);r&&(e.styleBinding=r)},genData:function(e){var t="";return e.staticStyle&&(t+="staticStyle:"+e.staticStyle+","),e.styleBinding&&(t+="style:("+e.styleBinding+"),"),t}},_o=function(e){return(yo=yo||document.createElement("div")).innerHTML=e,yo.textContent},bo=p("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),$o=p("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source"),wo=p("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"),Co=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,xo=/^\s*((?:v-[\w-]+:|@|:|#)\[[^=]+\][^\s"'<>\/=]*)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,ko="[a-zA-Z_][\\-\\.0-9_a-zA-Z"+P.source+"]*",Ao="((?:"+ko+"\\:)?"+ko+")",Oo=new RegExp("^<"+Ao),So=/^\s*(\/?)>/,To=new RegExp("^<\\/"+Ao+"[^>]*>"),Eo=/^<!DOCTYPE [^>]+>/i,No=/^<!\--/,jo=/^<!\[/,Do=p("script,style,textarea",!0),Lo={},Mo={"&lt;":"<","&gt;":">","&quot;":'"',"&amp;":"&","&#10;":"\n","&#9;":"\t","&#39;":"'"},Io=/&(?:lt|gt|quot|amp|#39);/g,Fo=/&(?:lt|gt|quot|amp|#39|#10|#9);/g,Po=p("pre,textarea",!0),Ro=function(e,t){return e&&Po(e)&&"\n"===t[0]};function Ho(e,t){var n=t?Fo:Io;return e.replace(n,function(e){return Mo[e]})}var Bo,Uo,zo,Vo,Ko,Jo,qo,Wo,Zo=/^@|^v-on:/,Go=/^v-|^@|^:|^#/,Xo=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,Yo=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Qo=/^\(|\)$/g,ea=/^\[.*\]$/,ta=/:(.*)$/,na=/^:|^\.|^v-bind:/,ra=/\.[^.\]]+(?=[^\]]*$)/g,ia=/^v-slot(:|$)|^#/,oa=/[\r\n]/,aa=/\s+/g,sa=g(_o),ca="_empty_";function ua(e,t,n){return{type:1,tag:e,attrsList:t,attrsMap:ma(t),rawAttrsMap:{},parent:n,children:[]}}function la(e,t){Bo=t.warn||Sr,Jo=t.isPreTag||T,qo=t.mustUseProp||T,Wo=t.getTagNamespace||T;t.isReservedTag;zo=Tr(t.modules,"transformNode"),Vo=Tr(t.modules,"preTransformNode"),Ko=Tr(t.modules,"postTransformNode"),Uo=t.delimiters;var n,r,i=[],o=!1!==t.preserveWhitespace,a=t.whitespace,s=!1,c=!1;function u(e){if(l(e),s||e.processed||(e=fa(e,t)),i.length||e===n||n.if&&(e.elseif||e.else)&&da(n,{exp:e.elseif,block:e}),r&&!e.forbidden)if(e.elseif||e.else)a=e,(u=function(e){var t=e.length;for(;t--;){if(1===e[t].type)return e[t];e.pop()}}(r.children))&&u.if&&da(u,{exp:a.elseif,block:a});else{if(e.slotScope){var o=e.slotTarget||'"default"';(r.scopedSlots||(r.scopedSlots={}))[o]=e}r.children.push(e),e.parent=r}var a,u;e.children=e.children.filter(function(e){return!e.slotScope}),l(e),e.pre&&(s=!1),Jo(e.tag)&&(c=!1);for(var f=0;f<Ko.length;f++)Ko[f](e,t)}function l(e){if(!c)for(var t;(t=e.children[e.children.length-1])&&3===t.type&&" "===t.text;)e.children.pop()}return function(e,t){for(var n,r,i=[],o=t.expectHTML,a=t.isUnaryTag||T,s=t.canBeLeftOpenTag||T,c=0;e;){if(n=e,r&&Do(r)){var u=0,l=r.toLowerCase(),f=Lo[l]||(Lo[l]=new RegExp("([\\s\\S]*?)(</"+l+"[^>]*>)","i")),p=e.replace(f,function(e,n,r){return u=r.length,Do(l)||"noscript"===l||(n=n.replace(/<!\--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1")),Ro(l,n)&&(n=n.slice(1)),t.chars&&t.chars(n),""});c+=e.length-p.length,e=p,A(l,c-u,c)}else{var d=e.indexOf("<");if(0===d){if(No.test(e)){var v=e.indexOf("--\x3e");if(v>=0){t.shouldKeepComment&&t.comment(e.substring(4,v),c,c+v+3),C(v+3);continue}}if(jo.test(e)){var h=e.indexOf("]>");if(h>=0){C(h+2);continue}}var m=e.match(Eo);if(m){C(m[0].length);continue}var y=e.match(To);if(y){var g=c;C(y[0].length),A(y[1],g,c);continue}var _=x();if(_){k(_),Ro(_.tagName,e)&&C(1);continue}}var b=void 0,$=void 0,w=void 0;if(d>=0){for($=e.slice(d);!(To.test($)||Oo.test($)||No.test($)||jo.test($)||(w=$.indexOf("<",1))<0);)d+=w,$=e.slice(d);b=e.substring(0,d)}d<0&&(b=e),b&&C(b.length),t.chars&&b&&t.chars(b,c-b.length,c)}if(e===n){t.chars&&t.chars(e);break}}function C(t){c+=t,e=e.substring(t)}function x(){var t=e.match(Oo);if(t){var n,r,i={tagName:t[1],attrs:[],start:c};for(C(t[0].length);!(n=e.match(So))&&(r=e.match(xo)||e.match(Co));)r.start=c,C(r[0].length),r.end=c,i.attrs.push(r);if(n)return i.unarySlash=n[1],C(n[0].length),i.end=c,i}}function k(e){var n=e.tagName,c=e.unarySlash;o&&("p"===r&&wo(n)&&A(r),s(n)&&r===n&&A(n));for(var u=a(n)||!!c,l=e.attrs.length,f=new Array(l),p=0;p<l;p++){var d=e.attrs[p],v=d[3]||d[4]||d[5]||"",h="a"===n&&"href"===d[1]?t.shouldDecodeNewlinesForHref:t.shouldDecodeNewlines;f[p]={name:d[1],value:Ho(v,h)}}u||(i.push({tag:n,lowerCasedTag:n.toLowerCase(),attrs:f,start:e.start,end:e.end}),r=n),t.start&&t.start(n,f,u,e.start,e.end)}function A(e,n,o){var a,s;if(null==n&&(n=c),null==o&&(o=c),e)for(s=e.toLowerCase(),a=i.length-1;a>=0&&i[a].lowerCasedTag!==s;a--);else a=0;if(a>=0){for(var u=i.length-1;u>=a;u--)t.end&&t.end(i[u].tag,n,o);i.length=a,r=a&&i[a-1].tag}else"br"===s?t.start&&t.start(e,[],!0,n,o):"p"===s&&(t.start&&t.start(e,[],!1,n,o),t.end&&t.end(e,n,o))}A()}(e,{warn:Bo,expectHTML:t.expectHTML,isUnaryTag:t.isUnaryTag,canBeLeftOpenTag:t.canBeLeftOpenTag,shouldDecodeNewlines:t.shouldDecodeNewlines,shouldDecodeNewlinesForHref:t.shouldDecodeNewlinesForHref,shouldKeepComment:t.comments,outputSourceRange:t.outputSourceRange,start:function(e,o,a,l,f){var p=r&&r.ns||Wo(e);q&&"svg"===p&&(o=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];ya.test(r.name)||(r.name=r.name.replace(ga,""),t.push(r))}return t}(o));var d,v=ua(e,o,r);p&&(v.ns=p),"style"!==(d=v).tag&&("script"!==d.tag||d.attrsMap.type&&"text/javascript"!==d.attrsMap.type)||te()||(v.forbidden=!0);for(var h=0;h<Vo.length;h++)v=Vo[h](v,t)||v;s||(!function(e){null!=Fr(e,"v-pre")&&(e.pre=!0)}(v),v.pre&&(s=!0)),Jo(v.tag)&&(c=!0),s?function(e){var t=e.attrsList,n=t.length;if(n)for(var r=e.attrs=new Array(n),i=0;i<n;i++)r[i]={name:t[i].name,value:JSON.stringify(t[i].value)},null!=t[i].start&&(r[i].start=t[i].start,r[i].end=t[i].end);else e.pre||(e.plain=!0)}(v):v.processed||(pa(v),function(e){var t=Fr(e,"v-if");if(t)e.if=t,da(e,{exp:t,block:e});else{null!=Fr(e,"v-else")&&(e.else=!0);var n=Fr(e,"v-else-if");n&&(e.elseif=n)}}(v),function(e){null!=Fr(e,"v-once")&&(e.once=!0)}(v)),n||(n=v),a?u(v):(r=v,i.push(v))},end:function(e,t,n){var o=i[i.length-1];i.length-=1,r=i[i.length-1],u(o)},chars:function(e,t,n){if(r&&(!q||"textarea"!==r.tag||r.attrsMap.placeholder!==e)){var i,u,l,f=r.children;if(e=c||e.trim()?"script"===(i=r).tag||"style"===i.tag?e:sa(e):f.length?a?"condense"===a&&oa.test(e)?"":" ":o?" ":"":"")c||"condense"!==a||(e=e.replace(aa," ")),!s&&" "!==e&&(u=function(e,t){var n=t?ho(t):po;if(n.test(e)){for(var r,i,o,a=[],s=[],c=n.lastIndex=0;r=n.exec(e);){(i=r.index)>c&&(s.push(o=e.slice(c,i)),a.push(JSON.stringify(o)));var u=Ar(r[1].trim());a.push("_s("+u+")"),s.push({"@binding":u}),c=i+r[0].length}return c<e.length&&(s.push(o=e.slice(c)),a.push(JSON.stringify(o))),{expression:a.join("+"),tokens:s}}}(e,Uo))?l={type:2,expression:u.expression,tokens:u.tokens,text:e}:" "===e&&f.length&&" "===f[f.length-1].text||(l={type:3,text:e}),l&&f.push(l)}},comment:function(e,t,n){if(r){var i={type:3,text:e,isComment:!0};r.children.push(i)}}}),n}function fa(e,t){var n,r;(r=Ir(n=e,"key"))&&(n.key=r),e.plain=!e.key&&!e.scopedSlots&&!e.attrsList.length,function(e){var t=Ir(e,"ref");t&&(e.ref=t,e.refInFor=function(e){var t=e;for(;t;){if(void 0!==t.for)return!0;t=t.parent}return!1}(e))}(e),function(e){var t;"template"===e.tag?(t=Fr(e,"scope"),e.slotScope=t||Fr(e,"slot-scope")):(t=Fr(e,"slot-scope"))&&(e.slotScope=t);var n=Ir(e,"slot");n&&(e.slotTarget='""'===n?'"default"':n,e.slotTargetDynamic=!(!e.attrsMap[":slot"]&&!e.attrsMap["v-bind:slot"]),"template"===e.tag||e.slotScope||Nr(e,"slot",n,function(e,t){return e.rawAttrsMap[":"+t]||e.rawAttrsMap["v-bind:"+t]||e.rawAttrsMap[t]}(e,"slot")));if("template"===e.tag){var r=Pr(e,ia);if(r){var i=va(r),o=i.name,a=i.dynamic;e.slotTarget=o,e.slotTargetDynamic=a,e.slotScope=r.value||ca}}else{var s=Pr(e,ia);if(s){var c=e.scopedSlots||(e.scopedSlots={}),u=va(s),l=u.name,f=u.dynamic,p=c[l]=ua("template",[],e);p.slotTarget=l,p.slotTargetDynamic=f,p.children=e.children.filter(function(e){if(!e.slotScope)return e.parent=p,!0}),p.slotScope=s.value||ca,e.children=[],e.plain=!1}}}(e),function(e){"slot"===e.tag&&(e.slotName=Ir(e,"name"))}(e),function(e){var t;(t=Ir(e,"is"))&&(e.component=t);null!=Fr(e,"inline-template")&&(e.inlineTemplate=!0)}(e);for(var i=0;i<zo.length;i++)e=zo[i](e,t)||e;return function(e){var t,n,r,i,o,a,s,c,u=e.attrsList;for(t=0,n=u.length;t<n;t++)if(r=i=u[t].name,o=u[t].value,Go.test(r))if(e.hasBindings=!0,(a=ha(r.replace(Go,"")))&&(r=r.replace(ra,"")),na.test(r))r=r.replace(na,""),o=Ar(o),(c=ea.test(r))&&(r=r.slice(1,-1)),a&&(a.prop&&!c&&"innerHtml"===(r=b(r))&&(r="innerHTML"),a.camel&&!c&&(r=b(r)),a.sync&&(s=Br(o,"$event"),c?Mr(e,'"update:"+('+r+")",s,null,!1,0,u[t],!0):(Mr(e,"update:"+b(r),s,null,!1,0,u[t]),C(r)!==b(r)&&Mr(e,"update:"+C(r),s,null,!1,0,u[t])))),a&&a.prop||!e.component&&qo(e.tag,e.attrsMap.type,r)?Er(e,r,o,u[t],c):Nr(e,r,o,u[t],c);else if(Zo.test(r))r=r.replace(Zo,""),(c=ea.test(r))&&(r=r.slice(1,-1)),Mr(e,r,o,a,!1,0,u[t],c);else{var l=(r=r.replace(Go,"")).match(ta),f=l&&l[1];c=!1,f&&(r=r.slice(0,-(f.length+1)),ea.test(f)&&(f=f.slice(1,-1),c=!0)),Dr(e,r,i,o,f,c,a,u[t])}else Nr(e,r,JSON.stringify(o),u[t]),!e.component&&"muted"===r&&qo(e.tag,e.attrsMap.type,r)&&Er(e,r,"true",u[t])}(e),e}function pa(e){var t;if(t=Fr(e,"v-for")){var n=function(e){var t=e.match(Xo);if(!t)return;var n={};n.for=t[2].trim();var r=t[1].trim().replace(Qo,""),i=r.match(Yo);i?(n.alias=r.replace(Yo,"").trim(),n.iterator1=i[1].trim(),i[2]&&(n.iterator2=i[2].trim())):n.alias=r;return n}(t);n&&A(e,n)}}function da(e,t){e.ifConditions||(e.ifConditions=[]),e.ifConditions.push(t)}function va(e){var t=e.name.replace(ia,"");return t||"#"!==e.name[0]&&(t="default"),ea.test(t)?{name:t.slice(1,-1),dynamic:!0}:{name:'"'+t+'"',dynamic:!1}}function ha(e){var t=e.match(ra);if(t){var n={};return t.forEach(function(e){n[e.slice(1)]=!0}),n}}function ma(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n].name]=e[n].value;return t}var ya=/^xmlns:NS\d+/,ga=/^NS\d+:/;function _a(e){return ua(e.tag,e.attrsList.slice(),e.parent)}var ba=[mo,go,{preTransformNode:function(e,t){if("input"===e.tag){var n,r=e.attrsMap;if(!r["v-model"])return;if((r[":type"]||r["v-bind:type"])&&(n=Ir(e,"type")),r.type||n||!r["v-bind"]||(n="("+r["v-bind"]+").type"),n){var i=Fr(e,"v-if",!0),o=i?"&&("+i+")":"",a=null!=Fr(e,"v-else",!0),s=Fr(e,"v-else-if",!0),c=_a(e);pa(c),jr(c,"type","checkbox"),fa(c,t),c.processed=!0,c.if="("+n+")==='checkbox'"+o,da(c,{exp:c.if,block:c});var u=_a(e);Fr(u,"v-for",!0),jr(u,"type","radio"),fa(u,t),da(c,{exp:"("+n+")==='radio'"+o,block:u});var l=_a(e);return Fr(l,"v-for",!0),jr(l,":type",n),fa(l,t),da(c,{exp:i,block:l}),a?c.else=!0:s&&(c.elseif=s),c}}}}];var $a,wa,Ca={expectHTML:!0,modules:ba,directives:{model:function(e,t,n){var r=t.value,i=t.modifiers,o=e.tag,a=e.attrsMap.type;if(e.component)return Hr(e,r,i),!1;if("select"===o)!function(e,t,n){var r='var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = "_value" in o ? o._value : o.value;return '+(n&&n.number?"_n(val)":"val")+"});";r=r+" "+Br(t,"$event.target.multiple ? $$selectedVal : $$selectedVal[0]"),Mr(e,"change",r,null,!0)}(e,r,i);else if("input"===o&&"checkbox"===a)!function(e,t,n){var r=n&&n.number,i=Ir(e,"value")||"null",o=Ir(e,"true-value")||"true",a=Ir(e,"false-value")||"false";Er(e,"checked","Array.isArray("+t+")?_i("+t+","+i+")>-1"+("true"===o?":("+t+")":":_q("+t+","+o+")")),Mr(e,"change","var $$a="+t+",$$el=$event.target,$$c=$$el.checked?("+o+"):("+a+");if(Array.isArray($$a)){var $$v="+(r?"_n("+i+")":i)+",$$i=_i($$a,$$v);if($$el.checked){$$i<0&&("+Br(t,"$$a.concat([$$v])")+")}else{$$i>-1&&("+Br(t,"$$a.slice(0,$$i).concat($$a.slice($$i+1))")+")}}else{"+Br(t,"$$c")+"}",null,!0)}(e,r,i);else if("input"===o&&"radio"===a)!function(e,t,n){var r=n&&n.number,i=Ir(e,"value")||"null";Er(e,"checked","_q("+t+","+(i=r?"_n("+i+")":i)+")"),Mr(e,"change",Br(t,i),null,!0)}(e,r,i);else if("input"===o||"textarea"===o)!function(e,t,n){var r=e.attrsMap.type,i=n||{},o=i.lazy,a=i.number,s=i.trim,c=!o&&"range"!==r,u=o?"change":"range"===r?Wr:"input",l="$event.target.value";s&&(l="$event.target.value.trim()"),a&&(l="_n("+l+")");var f=Br(t,l);c&&(f="if($event.target.composing)return;"+f),Er(e,"value","("+t+")"),Mr(e,u,f,null,!0),(s||a)&&Mr(e,"blur","$forceUpdate()")}(e,r,i);else if(!F.isReservedTag(o))return Hr(e,r,i),!1;return!0},text:function(e,t){t.value&&Er(e,"textContent","_s("+t.value+")",t)},html:function(e,t){t.value&&Er(e,"innerHTML","_s("+t.value+")",t)}},isPreTag:function(e){return"pre"===e},isUnaryTag:bo,mustUseProp:jn,canBeLeftOpenTag:$o,isReservedTag:Wn,getTagNamespace:Zn,staticKeys:function(e){return e.reduce(function(e,t){return e.concat(t.staticKeys||[])},[]).join(",")}(ba)},xa=g(function(e){return p("type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap"+(e?","+e:""))});function ka(e,t){e&&($a=xa(t.staticKeys||""),wa=t.isReservedTag||T,function e(t){t.static=function(e){if(2===e.type)return!1;if(3===e.type)return!0;return!(!e.pre&&(e.hasBindings||e.if||e.for||d(e.tag)||!wa(e.tag)||function(e){for(;e.parent;){if("template"!==(e=e.parent).tag)return!1;if(e.for)return!0}return!1}(e)||!Object.keys(e).every($a)))}(t);if(1===t.type){if(!wa(t.tag)&&"slot"!==t.tag&&null==t.attrsMap["inline-template"])return;for(var n=0,r=t.children.length;n<r;n++){var i=t.children[n];e(i),i.static||(t.static=!1)}if(t.ifConditions)for(var o=1,a=t.ifConditions.length;o<a;o++){var s=t.ifConditions[o].block;e(s),s.static||(t.static=!1)}}}(e),function e(t,n){if(1===t.type){if((t.static||t.once)&&(t.staticInFor=n),t.static&&t.children.length&&(1!==t.children.length||3!==t.children[0].type))return void(t.staticRoot=!0);if(t.staticRoot=!1,t.children)for(var r=0,i=t.children.length;r<i;r++)e(t.children[r],n||!!t.for);if(t.ifConditions)for(var o=1,a=t.ifConditions.length;o<a;o++)e(t.ifConditions[o].block,n)}}(e,!1))}var Aa=/^([\w$_]+|\([^)]*?\))\s*=>|^function(?:\s+[\w$]+)?\s*\(/,Oa=/\([^)]*?\);*$/,Sa=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Ta={esc:27,tab:9,enter:13,space:32,up:38,left:37,right:39,down:40,delete:[8,46]},Ea={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]},Na=function(e){return"if("+e+")return null;"},ja={stop:"$event.stopPropagation();",prevent:"$event.preventDefault();",self:Na("$event.target !== $event.currentTarget"),ctrl:Na("!$event.ctrlKey"),shift:Na("!$event.shiftKey"),alt:Na("!$event.altKey"),meta:Na("!$event.metaKey"),left:Na("'button' in $event && $event.button !== 0"),middle:Na("'button' in $event && $event.button !== 1"),right:Na("'button' in $event && $event.button !== 2")};function Da(e,t){var n=t?"nativeOn:":"on:",r="",i="";for(var o in e){var a=La(e[o]);e[o]&&e[o].dynamic?i+=o+","+a+",":r+='"'+o+'":'+a+","}return r="{"+r.slice(0,-1)+"}",i?n+"_d("+r+",["+i.slice(0,-1)+"])":n+r}function La(e){if(!e)return"function(){}";if(Array.isArray(e))return"["+e.map(function(e){return La(e)}).join(",")+"]";var t=Sa.test(e.value),n=Aa.test(e.value),r=Sa.test(e.value.replace(Oa,""));if(e.modifiers){var i="",o="",a=[];for(var s in e.modifiers)if(ja[s])o+=ja[s],Ta[s]&&a.push(s);else if("exact"===s){var c=e.modifiers;o+=Na(["ctrl","shift","alt","meta"].filter(function(e){return!c[e]}).map(function(e){return"$event."+e+"Key"}).join("||"))}else a.push(s);return a.length&&(i+=function(e){return"if(!$event.type.indexOf('key')&&"+e.map(Ma).join("&&")+")return null;"}(a)),o&&(i+=o),"function($event){"+i+(t?"return "+e.value+"($event)":n?"return ("+e.value+")($event)":r?"return "+e.value:e.value)+"}"}return t||n?e.value:"function($event){"+(r?"return "+e.value:e.value)+"}"}function Ma(e){var t=parseInt(e,10);if(t)return"$event.keyCode!=="+t;var n=Ta[e],r=Ea[e];return"_k($event.keyCode,"+JSON.stringify(e)+","+JSON.stringify(n)+",$event.key,"+JSON.stringify(r)+")"}var Ia={on:function(e,t){e.wrapListeners=function(e){return"_g("+e+","+t.value+")"}},bind:function(e,t){e.wrapData=function(n){return"_b("+n+",'"+e.tag+"',"+t.value+","+(t.modifiers&&t.modifiers.prop?"true":"false")+(t.modifiers&&t.modifiers.sync?",true":"")+")"}},cloak:S},Fa=function(e){this.options=e,this.warn=e.warn||Sr,this.transforms=Tr(e.modules,"transformCode"),this.dataGenFns=Tr(e.modules,"genData"),this.directives=A(A({},Ia),e.directives);var t=e.isReservedTag||T;this.maybeComponent=function(e){return!!e.component||!t(e.tag)},this.onceId=0,this.staticRenderFns=[],this.pre=!1};function Pa(e,t){var n=new Fa(t);return{render:"with(this){return "+(e?Ra(e,n):'_c("div")')+"}",staticRenderFns:n.staticRenderFns}}function Ra(e,t){if(e.parent&&(e.pre=e.pre||e.parent.pre),e.staticRoot&&!e.staticProcessed)return Ha(e,t);if(e.once&&!e.onceProcessed)return Ba(e,t);if(e.for&&!e.forProcessed)return za(e,t);if(e.if&&!e.ifProcessed)return Ua(e,t);if("template"!==e.tag||e.slotTarget||t.pre){if("slot"===e.tag)return function(e,t){var n=e.slotName||'"default"',r=qa(e,t),i="_t("+n+(r?","+r:""),o=e.attrs||e.dynamicAttrs?Ga((e.attrs||[]).concat(e.dynamicAttrs||[]).map(function(e){return{name:b(e.name),value:e.value,dynamic:e.dynamic}})):null,a=e.attrsMap["v-bind"];!o&&!a||r||(i+=",null");o&&(i+=","+o);a&&(i+=(o?"":",null")+","+a);return i+")"}(e,t);var n;if(e.component)n=function(e,t,n){var r=t.inlineTemplate?null:qa(t,n,!0);return"_c("+e+","+Va(t,n)+(r?","+r:"")+")"}(e.component,e,t);else{var r;(!e.plain||e.pre&&t.maybeComponent(e))&&(r=Va(e,t));var i=e.inlineTemplate?null:qa(e,t,!0);n="_c('"+e.tag+"'"+(r?","+r:"")+(i?","+i:"")+")"}for(var o=0;o<t.transforms.length;o++)n=t.transforms[o](e,n);return n}return qa(e,t)||"void 0"}function Ha(e,t){e.staticProcessed=!0;var n=t.pre;return e.pre&&(t.pre=e.pre),t.staticRenderFns.push("with(this){return "+Ra(e,t)+"}"),t.pre=n,"_m("+(t.staticRenderFns.length-1)+(e.staticInFor?",true":"")+")"}function Ba(e,t){if(e.onceProcessed=!0,e.if&&!e.ifProcessed)return Ua(e,t);if(e.staticInFor){for(var n="",r=e.parent;r;){if(r.for){n=r.key;break}r=r.parent}return n?"_o("+Ra(e,t)+","+t.onceId+++","+n+")":Ra(e,t)}return Ha(e,t)}function Ua(e,t,n,r){return e.ifProcessed=!0,function e(t,n,r,i){if(!t.length)return i||"_e()";var o=t.shift();return o.exp?"("+o.exp+")?"+a(o.block)+":"+e(t,n,r,i):""+a(o.block);function a(e){return r?r(e,n):e.once?Ba(e,n):Ra(e,n)}}(e.ifConditions.slice(),t,n,r)}function za(e,t,n,r){var i=e.for,o=e.alias,a=e.iterator1?","+e.iterator1:"",s=e.iterator2?","+e.iterator2:"";return e.forProcessed=!0,(r||"_l")+"(("+i+"),function("+o+a+s+"){return "+(n||Ra)(e,t)+"})"}function Va(e,t){var n="{",r=function(e,t){var n=e.directives;if(!n)return;var r,i,o,a,s="directives:[",c=!1;for(r=0,i=n.length;r<i;r++){o=n[r],a=!0;var u=t.directives[o.name];u&&(a=!!u(e,o,t.warn)),a&&(c=!0,s+='{name:"'+o.name+'",rawName:"'+o.rawName+'"'+(o.value?",value:("+o.value+"),expression:"+JSON.stringify(o.value):"")+(o.arg?",arg:"+(o.isDynamicArg?o.arg:'"'+o.arg+'"'):"")+(o.modifiers?",modifiers:"+JSON.stringify(o.modifiers):"")+"},")}if(c)return s.slice(0,-1)+"]"}(e,t);r&&(n+=r+","),e.key&&(n+="key:"+e.key+","),e.ref&&(n+="ref:"+e.ref+","),e.refInFor&&(n+="refInFor:true,"),e.pre&&(n+="pre:true,"),e.component&&(n+='tag:"'+e.tag+'",');for(var i=0;i<t.dataGenFns.length;i++)n+=t.dataGenFns[i](e);if(e.attrs&&(n+="attrs:"+Ga(e.attrs)+","),e.props&&(n+="domProps:"+Ga(e.props)+","),e.events&&(n+=Da(e.events,!1)+","),e.nativeEvents&&(n+=Da(e.nativeEvents,!0)+","),e.slotTarget&&!e.slotScope&&(n+="slot:"+e.slotTarget+","),e.scopedSlots&&(n+=function(e,t,n){var r=e.for||Object.keys(t).some(function(e){var n=t[e];return n.slotTargetDynamic||n.if||n.for||Ka(n)}),i=!!e.if;if(!r)for(var o=e.parent;o;){if(o.slotScope&&o.slotScope!==ca||o.for){r=!0;break}o.if&&(i=!0),o=o.parent}var a=Object.keys(t).map(function(e){return Ja(t[e],n)}).join(",");return"scopedSlots:_u(["+a+"]"+(r?",null,true":"")+(!r&&i?",null,false,"+function(e){var t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(a):"")+")"}(e,e.scopedSlots,t)+","),e.model&&(n+="model:{value:"+e.model.value+",callback:"+e.model.callback+",expression:"+e.model.expression+"},"),e.inlineTemplate){var o=function(e,t){var n=e.children[0];if(n&&1===n.type){var r=Pa(n,t.options);return"inlineTemplate:{render:function(){"+r.render+"},staticRenderFns:["+r.staticRenderFns.map(function(e){return"function(){"+e+"}"}).join(",")+"]}"}}(e,t);o&&(n+=o+",")}return n=n.replace(/,$/,"")+"}",e.dynamicAttrs&&(n="_b("+n+',"'+e.tag+'",'+Ga(e.dynamicAttrs)+")"),e.wrapData&&(n=e.wrapData(n)),e.wrapListeners&&(n=e.wrapListeners(n)),n}function Ka(e){return 1===e.type&&("slot"===e.tag||e.children.some(Ka))}function Ja(e,t){var n=e.attrsMap["slot-scope"];if(e.if&&!e.ifProcessed&&!n)return Ua(e,t,Ja,"null");if(e.for&&!e.forProcessed)return za(e,t,Ja);var r=e.slotScope===ca?"":String(e.slotScope),i="function("+r+"){return "+("template"===e.tag?e.if&&n?"("+e.if+")?"+(qa(e,t)||"undefined")+":undefined":qa(e,t)||"undefined":Ra(e,t))+"}",o=r?"":",proxy:true";return"{key:"+(e.slotTarget||'"default"')+",fn:"+i+o+"}"}function qa(e,t,n,r,i){var o=e.children;if(o.length){var a=o[0];if(1===o.length&&a.for&&"template"!==a.tag&&"slot"!==a.tag){var s=n?t.maybeComponent(a)?",1":",0":"";return""+(r||Ra)(a,t)+s}var c=n?function(e,t){for(var n=0,r=0;r<e.length;r++){var i=e[r];if(1===i.type){if(Wa(i)||i.ifConditions&&i.ifConditions.some(function(e){return Wa(e.block)})){n=2;break}(t(i)||i.ifConditions&&i.ifConditions.some(function(e){return t(e.block)}))&&(n=1)}}return n}(o,t.maybeComponent):0,u=i||Za;return"["+o.map(function(e){return u(e,t)}).join(",")+"]"+(c?","+c:"")}}function Wa(e){return void 0!==e.for||"template"===e.tag||"slot"===e.tag}function Za(e,t){return 1===e.type?Ra(e,t):3===e.type&&e.isComment?(r=e,"_e("+JSON.stringify(r.text)+")"):"_v("+(2===(n=e).type?n.expression:Xa(JSON.stringify(n.text)))+")";var n,r}function Ga(e){for(var t="",n="",r=0;r<e.length;r++){var i=e[r],o=Xa(i.value);i.dynamic?n+=i.name+","+o+",":t+='"'+i.name+'":'+o+","}return t="{"+t.slice(0,-1)+"}",n?"_d("+t+",["+n.slice(0,-1)+"])":t}function Xa(e){return e.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}new RegExp("\\b"+"do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments".split(",").join("\\b|\\b")+"\\b");function Ya(e,t){try{return new Function(e)}catch(n){return t.push({err:n,code:e}),S}}function Qa(e){var t=Object.create(null);return function(n,r,i){(r=A({},r)).warn;delete r.warn;var o=r.delimiters?String(r.delimiters)+n:n;if(t[o])return t[o];var a=e(n,r),s={},c=[];return s.render=Ya(a.render,c),s.staticRenderFns=a.staticRenderFns.map(function(e){return Ya(e,c)}),t[o]=s}}var es,ts,ns=(es=function(e,t){var n=la(e.trim(),t);!1!==t.optimize&&ka(n,t);var r=Pa(n,t);return{ast:n,render:r.render,staticRenderFns:r.staticRenderFns}},function(e){function t(t,n){var r=Object.create(e),i=[],o=[];if(n)for(var a in n.modules&&(r.modules=(e.modules||[]).concat(n.modules)),n.directives&&(r.directives=A(Object.create(e.directives||null),n.directives)),n)"modules"!==a&&"directives"!==a&&(r[a]=n[a]);r.warn=function(e,t,n){(n?o:i).push(e)};var s=es(t.trim(),r);return s.errors=i,s.tips=o,s}return{compile:t,compileToFunctions:Qa(t)}})(Ca),rs=(ns.compile,ns.compileToFunctions);function is(e){return(ts=ts||document.createElement("div")).innerHTML=e?'<a href="\n"/>':'<div a="\n"/>',ts.innerHTML.indexOf("&#10;")>0}var os=!!z&&is(!1),as=!!z&&is(!0),ss=g(function(e){var t=Yn(e);return t&&t.innerHTML}),cs=wn.prototype.$mount;return wn.prototype.$mount=function(e,t){if((e=e&&Yn(e))===document.body||e===document.documentElement)return this;var n=this.$options;if(!n.render){var r=n.template;if(r)if("string"==typeof r)"#"===r.charAt(0)&&(r=ss(r));else{if(!r.nodeType)return this;r=r.innerHTML}else e&&(r=function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}(e));if(r){var i=rs(r,{outputSourceRange:!1,shouldDecodeNewlines:os,shouldDecodeNewlinesForHref:as,delimiters:n.delimiters,comments:n.comments},this),o=i.render,a=i.staticRenderFns;n.render=o,n.staticRenderFns=a}}return cs.call(this,e,t)},wn.compile=rs,wn});
/*!
  * vue-router v3.5.3
  * (c) 2021 Evan You
  * @license MIT
  */
/*!
  * vue-router v3.5.3
  * (c) 2021 Evan You
  * @license MIT
  */
var t,e;t=this,e=function(){"use strict";function t(t,e){for(var r in e)t[r]=e[r];return t}var e=/[!'()*]/g,r=function(t){return"%"+t.charCodeAt(0).toString(16)},n=/%2C/g,o=function(t){return encodeURIComponent(t).replace(e,r).replace(n,",")};function i(t){try{return decodeURIComponent(t)}catch(t){}return t}var a=function(t){return null==t||"object"==typeof t?t:String(t)};function s(t){var e={};return(t=t.trim().replace(/^(\?|#|&)/,""))?(t.split("&").forEach((function(t){var r=t.replace(/\+/g," ").split("="),n=i(r.shift()),o=r.length>0?i(r.join("=")):null;void 0===e[n]?e[n]=o:Array.isArray(e[n])?e[n].push(o):e[n]=[e[n],o]})),e):e}function u(t){var e=t?Object.keys(t).map((function(e){var r=t[e];if(void 0===r)return"";if(null===r)return o(e);if(Array.isArray(r)){var n=[];return r.forEach((function(t){void 0!==t&&(null===t?n.push(o(e)):n.push(o(e)+"="+o(t)))})),n.join("&")}return o(e)+"="+o(r)})).filter((function(t){return t.length>0})).join("&"):null;return e?"?"+e:""}var c=/\/?$/;function p(t,e,r,n){var o=n&&n.options.stringifyQuery,i=e.query||{};try{i=f(i)}catch(t){}var a={name:e.name||t&&t.name,meta:t&&t.meta||{},path:e.path||"/",hash:e.hash||"",query:i,params:e.params||{},fullPath:d(e,o),matched:t?l(t):[]};return r&&(a.redirectedFrom=d(r,o)),Object.freeze(a)}function f(t){if(Array.isArray(t))return t.map(f);if(t&&"object"==typeof t){var e={};for(var r in t)e[r]=f(t[r]);return e}return t}var h=p(null,{path:"/"});function l(t){for(var e=[];t;)e.unshift(t),t=t.parent;return e}function d(t,e){var r=t.path,n=t.query;void 0===n&&(n={});var o=t.hash;return void 0===o&&(o=""),(r||"/")+(e||u)(n)+o}function v(t,e,r){return e===h?t===e:!!e&&(t.path&&e.path?t.path.replace(c,"")===e.path.replace(c,"")&&(r||t.hash===e.hash&&y(t.query,e.query)):!(!t.name||!e.name)&&t.name===e.name&&(r||t.hash===e.hash&&y(t.query,e.query)&&y(t.params,e.params)))}function y(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!t||!e)return t===e;var r=Object.keys(t).sort(),n=Object.keys(e).sort();return r.length===n.length&&r.every((function(r,o){var i=t[r];if(n[o]!==r)return!1;var a=e[r];return null==i||null==a?i===a:"object"==typeof i&&"object"==typeof a?y(i,a):String(i)===String(a)}))}function m(t){for(var e=0;e<t.matched.length;e++){var r=t.matched[e];for(var n in r.instances){var o=r.instances[n],i=r.enteredCbs[n];if(o&&i){delete r.enteredCbs[n];for(var a=0;a<i.length;a++)o._isBeingDestroyed||i[a](o)}}}}var g={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(e,r){var n=r.props,o=r.children,i=r.parent,a=r.data;a.routerView=!0;for(var s=i.$createElement,u=n.name,c=i.$route,p=i._routerViewCache||(i._routerViewCache={}),f=0,h=!1;i&&i._routerRoot!==i;){var l=i.$vnode?i.$vnode.data:{};l.routerView&&f++,l.keepAlive&&i._directInactive&&i._inactive&&(h=!0),i=i.$parent}if(a.routerViewDepth=f,h){var d=p[u],v=d&&d.component;return v?(d.configProps&&w(v,a,d.route,d.configProps),s(v,a,o)):s()}var y=c.matched[f],g=y&&y.components[u];if(!y||!g)return p[u]=null,s();p[u]={component:g},a.registerRouteInstance=function(t,e){var r=y.instances[u];(e&&r!==t||!e&&r===t)&&(y.instances[u]=e)},(a.hook||(a.hook={})).prepatch=function(t,e){y.instances[u]=e.componentInstance},a.hook.init=function(t){t.data.keepAlive&&t.componentInstance&&t.componentInstance!==y.instances[u]&&(y.instances[u]=t.componentInstance),m(c)};var b=y.props&&y.props[u];return b&&(t(p[u],{route:c,configProps:b}),w(g,a,c,b)),s(g,a,o)}};function w(e,r,n,o){var i=r.props=function(t,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(t);case"boolean":return e?t.params:void 0}}(n,o);if(i){i=r.props=t({},i);var a=r.attrs=r.attrs||{};for(var s in i)e.props&&s in e.props||(a[s]=i[s],delete i[s])}}function b(t,e,r){var n=t.charAt(0);if("/"===n)return t;if("?"===n||"#"===n)return e+t;var o=e.split("/");r&&o[o.length-1]||o.pop();for(var i=t.replace(/^\//,"").split("/"),a=0;a<i.length;a++){var s=i[a];".."===s?o.pop():"."!==s&&o.push(s)}return""!==o[0]&&o.unshift(""),o.join("/")}function x(t){return t.replace(/\/+/g,"/")}var R=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},k=B,E=j,C=function(t,e){return S(j(t,e),e)},A=S,O=U,_=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function j(t,e){for(var r,n=[],o=0,i=0,a="",s=e&&e.delimiter||"/";null!=(r=_.exec(t));){var u=r[0],c=r[1],p=r.index;if(a+=t.slice(i,p),i=p+u.length,c)a+=c[1];else{var f=t[i],h=r[2],l=r[3],d=r[4],v=r[5],y=r[6],m=r[7];a&&(n.push(a),a="");var g=null!=h&&null!=f&&f!==h,w="+"===y||"*"===y,b="?"===y||"*"===y,x=r[2]||s,R=d||v;n.push({name:l||o++,prefix:h||"",delimiter:x,optional:b,repeat:w,partial:g,asterisk:!!m,pattern:R?L(R):m?".*":"[^"+P(x)+"]+?"})}}return i<t.length&&(a+=t.substr(i)),a&&n.push(a),n}function T(t){return encodeURI(t).replace(/[\/?#]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}))}function S(t,e){for(var r=new Array(t.length),n=0;n<t.length;n++)"object"==typeof t[n]&&(r[n]=new RegExp("^(?:"+t[n].pattern+")$",q(e)));return function(e,n){for(var o="",i=e||{},a=(n||{}).pretty?T:encodeURIComponent,s=0;s<t.length;s++){var u=t[s];if("string"!=typeof u){var c,p=i[u.name];if(null==p){if(u.optional){u.partial&&(o+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be defined')}if(R(p)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var f=0;f<p.length;f++){if(c=a(p[f]),!r[s].test(c))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(c)+"`");o+=(0===f?u.prefix:u.delimiter)+c}}else{if(c=u.asterisk?encodeURI(p).replace(/[?#]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})):a(p),!r[s].test(c))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+c+'"');o+=u.prefix+c}}else o+=u}return o}}function P(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function L(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function $(t,e){return t.keys=e,t}function q(t){return t&&t.sensitive?"":"i"}function U(t,e,r){R(e)||(r=e||r,e=[]);for(var n=(r=r||{}).strict,o=!1!==r.end,i="",a=0;a<t.length;a++){var s=t[a];if("string"==typeof s)i+=P(s);else{var u=P(s.prefix),c="(?:"+s.pattern+")";e.push(s),s.repeat&&(c+="(?:"+u+c+")*"),i+=c=s.optional?s.partial?u+"("+c+")?":"(?:"+u+"("+c+"))?":u+"("+c+")"}}var p=P(r.delimiter||"/"),f=i.slice(-p.length)===p;return n||(i=(f?i.slice(0,-p.length):i)+"(?:"+p+"(?=$))?"),i+=o?"$":n&&f?"":"(?="+p+"|$)",$(new RegExp("^"+i,q(r)),e)}function B(t,e,r){return R(e)||(r=e||r,e=[]),r=r||{},t instanceof RegExp?function(t,e){var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return $(t,e)}(t,e):R(t)?function(t,e,r){for(var n=[],o=0;o<t.length;o++)n.push(B(t[o],e,r).source);return $(new RegExp("(?:"+n.join("|")+")",q(r)),e)}(t,e,r):function(t,e,r){return U(j(t,r),e,r)}(t,e,r)}k.parse=E,k.compile=C,k.tokensToFunction=A,k.tokensToRegExp=O;var I=Object.create(null);function M(t,e,r){e=e||{};try{var n=I[t]||(I[t]=k.compile(t));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),n(e,{pretty:!0})}catch(t){return""}finally{delete e[0]}}function V(e,r,n,o){var i="string"==typeof e?{path:e}:e;if(i._normalized)return i;if(i.name){var u=(i=t({},e)).params;return u&&"object"==typeof u&&(i.params=t({},u)),i}if(!i.path&&i.params&&r){(i=t({},i))._normalized=!0;var c=t(t({},r.params),i.params);if(r.name)i.name=r.name,i.params=c;else if(r.matched.length){var p=r.matched[r.matched.length-1].path;i.path=M(p,c,r.path)}return i}var f=function(t){var e="",r="",n=t.indexOf("#");n>=0&&(e=t.slice(n),t=t.slice(0,n));var o=t.indexOf("?");return o>=0&&(r=t.slice(o+1),t=t.slice(0,o)),{path:t,query:r,hash:e}}(i.path||""),h=r&&r.path||"/",l=f.path?b(f.path,h,n||i.append):h,d=function(t,e,r){void 0===e&&(e={});var n,o=r||s;try{n=o(t||"")}catch(t){n={}}for(var i in e){var u=e[i];n[i]=Array.isArray(u)?u.map(a):a(u)}return n}(f.query,i.query,o&&o.options.parseQuery),v=i.hash||f.hash;return v&&"#"!==v.charAt(0)&&(v="#"+v),{_normalized:!0,path:l,query:d,hash:v}}var H,N=function(){},F={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(e){var r=this,n=this.$router,o=this.$route,i=n.resolve(this.to,o,this.append),a=i.location,s=i.route,u=i.href,f={},h=n.options.linkActiveClass,l=n.options.linkExactActiveClass,d=null==h?"router-link-active":h,y=null==l?"router-link-exact-active":l,m=null==this.activeClass?d:this.activeClass,g=null==this.exactActiveClass?y:this.exactActiveClass,w=s.redirectedFrom?p(null,V(s.redirectedFrom),null,n):s;f[g]=v(o,w,this.exactPath),f[m]=this.exact||this.exactPath?f[g]:function(t,e){return 0===t.path.replace(c,"/").indexOf(e.path.replace(c,"/"))&&(!e.hash||t.hash===e.hash)&&function(t,e){for(var r in e)if(!(r in t))return!1;return!0}(t.query,e.query)}(o,w);var b=f[g]?this.ariaCurrentValue:null,x=function(t){z(t)&&(r.replace?n.replace(a,N):n.push(a,N))},R={click:z};Array.isArray(this.event)?this.event.forEach((function(t){R[t]=x})):R[this.event]=x;var k={class:f},E=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:u,route:s,navigate:x,isActive:f[m],isExactActive:f[g]});if(E){if(1===E.length)return E[0];if(E.length>1||!E.length)return 0===E.length?e():e("span",{},E)}if("a"===this.tag)k.on=R,k.attrs={href:u,"aria-current":b};else{var C=function t(e){var r;if(e)for(var n=0;n<e.length;n++){if("a"===(r=e[n]).tag)return r;if(r.children&&(r=t(r.children)))return r}}(this.$slots.default);if(C){C.isStatic=!1;var A=C.data=t({},C.data);for(var O in A.on=A.on||{},A.on){var _=A.on[O];O in R&&(A.on[O]=Array.isArray(_)?_:[_])}for(var j in R)j in A.on?A.on[j].push(R[j]):A.on[j]=x;var T=C.data.attrs=t({},C.data.attrs);T.href=u,T["aria-current"]=b}else k.on=R}return e(this.tag,k,this.$slots.default)}};function z(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||t.defaultPrevented||void 0!==t.button&&0!==t.button)){if(t.currentTarget&&t.currentTarget.getAttribute){var e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}var D="undefined"!=typeof window;function K(t,e,r,n,o){var i=e||[],a=r||Object.create(null),s=n||Object.create(null);t.forEach((function(t){!function t(e,r,n,o,i,a){var s=o.path,u=o.name,c=o.pathToRegexpOptions||{},p=function(t,e,r){return r||(t=t.replace(/\/$/,"")),"/"===t[0]||null==e?t:x(e.path+"/"+t)}(s,i,c.strict);"boolean"==typeof o.caseSensitive&&(c.sensitive=o.caseSensitive);var f={path:p,regex:J(p,c),components:o.components||{default:o.component},alias:o.alias?"string"==typeof o.alias?[o.alias]:o.alias:[],instances:{},enteredCbs:{},name:u,parent:i,matchAs:a,redirect:o.redirect,beforeEnter:o.beforeEnter,meta:o.meta||{},props:null==o.props?{}:o.components?o.props:{default:o.props}};if(o.children&&o.children.forEach((function(o){var i=a?x(a+"/"+o.path):void 0;t(e,r,n,o,f,i)})),r[f.path]||(e.push(f.path),r[f.path]=f),void 0!==o.alias)for(var h=Array.isArray(o.alias)?o.alias:[o.alias],l=0;l<h.length;++l){var d={path:h[l],children:o.children};t(e,r,n,d,i,f.path||"/")}u&&(n[u]||(n[u]=f))}(i,a,s,t,o)}));for(var u=0,c=i.length;u<c;u++)"*"===i[u]&&(i.push(i.splice(u,1)[0]),c--,u--);return{pathList:i,pathMap:a,nameMap:s}}function J(t,e){return k(t,[],e)}function Q(t,e){var r=K(t),n=r.pathList,o=r.pathMap,i=r.nameMap;function a(t,r,a){var s=V(t,r,!1,e),c=s.name;if(c){var p=i[c];if(!p)return u(null,s);var f=p.regex.keys.filter((function(t){return!t.optional})).map((function(t){return t.name}));if("object"!=typeof s.params&&(s.params={}),r&&"object"==typeof r.params)for(var h in r.params)!(h in s.params)&&f.indexOf(h)>-1&&(s.params[h]=r.params[h]);return s.path=M(p.path,s.params),u(p,s,a)}if(s.path){s.params={};for(var l=0;l<n.length;l++){var d=n[l],v=o[d];if(X(v.regex,s.path,s.params))return u(v,s,a)}}return u(null,s)}function s(t,r){var n=t.redirect,o="function"==typeof n?n(p(t,r,null,e)):n;if("string"==typeof o&&(o={path:o}),!o||"object"!=typeof o)return u(null,r);var s=o,c=s.name,f=s.path,h=r.query,l=r.hash,d=r.params;return h=s.hasOwnProperty("query")?s.query:h,l=s.hasOwnProperty("hash")?s.hash:l,d=s.hasOwnProperty("params")?s.params:d,c?(i[c],a({_normalized:!0,name:c,query:h,hash:l,params:d},void 0,r)):f?a({_normalized:!0,path:M(function(t,e){return b(t,e.parent?e.parent.path:"/",!0)}(f,t),d),query:h,hash:l},void 0,r):u(null,r)}function u(t,r,n){return t&&t.redirect?s(t,n||r):t&&t.matchAs?function(t,e,r){var n=a({_normalized:!0,path:M(r,e.params)});if(n){var o=n.matched,i=o[o.length-1];return e.params=n.params,u(i,e)}return u(null,e)}(0,r,t.matchAs):p(t,r,n,e)}return{match:a,addRoute:function(t,e){var r="object"!=typeof t?i[t]:void 0;K([e||t],n,o,i,r),r&&r.alias.length&&K(r.alias.map((function(t){return{path:t,children:[e]}})),n,o,i,r)},getRoutes:function(){return n.map((function(t){return o[t]}))},addRoutes:function(t){K(t,n,o,i)}}}function X(t,e,r){var n=e.match(t);if(!n)return!1;if(!r)return!0;for(var o=1,a=n.length;o<a;++o){var s=t.keys[o-1];s&&(r[s.name||"pathMatch"]="string"==typeof n[o]?i(n[o]):n[o])}return!0}var Y=D&&window.performance&&window.performance.now?window.performance:Date;function W(){return Y.now().toFixed(3)}var G=W();function Z(){return G}function tt(t){return G=t}var et=Object.create(null);function rt(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var e=window.location.protocol+"//"+window.location.host,r=window.location.href.replace(e,""),n=t({},window.history.state);return n.key=Z(),window.history.replaceState(n,"",r),window.addEventListener("popstate",it),function(){window.removeEventListener("popstate",it)}}function nt(t,e,r,n){if(t.app){var o=t.options.scrollBehavior;o&&t.app.$nextTick((function(){var i=function(){var t=Z();if(t)return et[t]}(),a=o.call(t,e,r,n?i:null);a&&("function"==typeof a.then?a.then((function(t){pt(t,i)})).catch((function(t){})):pt(a,i))}))}}function ot(){var t=Z();t&&(et[t]={x:window.pageXOffset,y:window.pageYOffset})}function it(t){ot(),t.state&&t.state.key&&tt(t.state.key)}function at(t){return ut(t.x)||ut(t.y)}function st(t){return{x:ut(t.x)?t.x:window.pageXOffset,y:ut(t.y)?t.y:window.pageYOffset}}function ut(t){return"number"==typeof t}var ct=/^#\d/;function pt(t,e){var r,n="object"==typeof t;if(n&&"string"==typeof t.selector){var o=ct.test(t.selector)?document.getElementById(t.selector.slice(1)):document.querySelector(t.selector);if(o){var i=t.offset&&"object"==typeof t.offset?t.offset:{};e=function(t,e){var r=document.documentElement.getBoundingClientRect(),n=t.getBoundingClientRect();return{x:n.left-r.left-e.x,y:n.top-r.top-e.y}}(o,i={x:ut((r=i).x)?r.x:0,y:ut(r.y)?r.y:0})}else at(t)&&(e=st(t))}else n&&at(t)&&(e=st(t));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:t.behavior}):window.scrollTo(e.x,e.y))}var ft,ht=D&&(-1===(ft=window.navigator.userAgent).indexOf("Android 2.")&&-1===ft.indexOf("Android 4.0")||-1===ft.indexOf("Mobile Safari")||-1!==ft.indexOf("Chrome")||-1!==ft.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState;function lt(e,r){ot();var n=window.history;try{if(r){var o=t({},n.state);o.key=Z(),n.replaceState(o,"",e)}else n.pushState({key:tt(W())},"",e)}catch(t){window.location[r?"replace":"assign"](e)}}function dt(t){lt(t,!0)}function vt(t,e,r){var n=function(o){o>=t.length?r():t[o]?e(t[o],(function(){n(o+1)})):n(o+1)};n(0)}var yt={redirected:2,aborted:4,cancelled:8,duplicated:16};function mt(t,e){return wt(t,e,yt.redirected,'Redirected when going from "'+t.fullPath+'" to "'+function(t){if("string"==typeof t)return t;if("path"in t)return t.path;var e={};return bt.forEach((function(r){r in t&&(e[r]=t[r])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function gt(t,e){return wt(t,e,yt.cancelled,'Navigation cancelled from "'+t.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function wt(t,e,r,n){var o=new Error(n);return o._isRouter=!0,o.from=t,o.to=e,o.type=r,o}var bt=["params","query","hash"];function xt(t){return Object.prototype.toString.call(t).indexOf("Error")>-1}function Rt(t,e){return xt(t)&&t._isRouter&&(null==e||t.type===e)}function kt(t){return function(e,r,n){var o=!1,i=0,a=null;Et(t,(function(t,e,r,s){if("function"==typeof t&&void 0===t.cid){o=!0,i++;var u,c=Ot((function(e){var o;((o=e).__esModule||At&&"Module"===o[Symbol.toStringTag])&&(e=e.default),t.resolved="function"==typeof e?e:H.extend(e),r.components[s]=e,--i<=0&&n()})),p=Ot((function(t){var e="Failed to resolve async component "+s+": "+t;a||(a=xt(t)?t:new Error(e),n(a))}));try{u=t(c,p)}catch(t){p(t)}if(u)if("function"==typeof u.then)u.then(c,p);else{var f=u.component;f&&"function"==typeof f.then&&f.then(c,p)}}})),o||n()}}function Et(t,e){return Ct(t.map((function(t){return Object.keys(t.components).map((function(r){return e(t.components[r],t.instances[r],t,r)}))})))}function Ct(t){return Array.prototype.concat.apply([],t)}var At="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Ot(t){var e=!1;return function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];if(!e)return e=!0,t.apply(this,r)}}var _t=function(t,e){this.router=t,this.base=function(t){if(!t)if(D){var e=document.querySelector("base");t=(t=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else t="/";return"/"!==t.charAt(0)&&(t="/"+t),t.replace(/\/$/,"")}(e),this.current=h,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function jt(t,e,r,n){var o=Et(t,(function(t,n,o,i){var a=function(t,e){return"function"!=typeof t&&(t=H.extend(t)),t.options[e]}(t,e);if(a)return Array.isArray(a)?a.map((function(t){return r(t,n,o,i)})):r(a,n,o,i)}));return Ct(n?o.reverse():o)}function Tt(t,e){if(e)return function(){return t.apply(e,arguments)}}_t.prototype.listen=function(t){this.cb=t},_t.prototype.onReady=function(t,e){this.ready?t():(this.readyCbs.push(t),e&&this.readyErrorCbs.push(e))},_t.prototype.onError=function(t){this.errorCbs.push(t)},_t.prototype.transitionTo=function(t,e,r){var n,o=this;try{n=this.router.match(t,this.current)}catch(t){throw this.errorCbs.forEach((function(e){e(t)})),t}var i=this.current;this.confirmTransition(n,(function(){o.updateRoute(n),e&&e(n),o.ensureURL(),o.router.afterHooks.forEach((function(t){t&&t(n,i)})),o.ready||(o.ready=!0,o.readyCbs.forEach((function(t){t(n)})))}),(function(t){r&&r(t),t&&!o.ready&&(Rt(t,yt.redirected)&&i===h||(o.ready=!0,o.readyErrorCbs.forEach((function(e){e(t)}))))}))},_t.prototype.confirmTransition=function(t,e,r){var n=this,o=this.current;this.pending=t;var i,a,s=function(t){!Rt(t)&&xt(t)&&(n.errorCbs.length?n.errorCbs.forEach((function(e){e(t)})):console.error(t)),r&&r(t)},u=t.matched.length-1,c=o.matched.length-1;if(v(t,o)&&u===c&&t.matched[u]===o.matched[c])return this.ensureURL(),t.hash&&nt(this.router,o,t,!1),s(((a=wt(i=o,t,yt.duplicated,'Avoided redundant navigation to current location: "'+i.fullPath+'".')).name="NavigationDuplicated",a));var p=function(t,e){var r,n=Math.max(t.length,e.length);for(r=0;r<n&&t[r]===e[r];r++);return{updated:e.slice(0,r),activated:e.slice(r),deactivated:t.slice(r)}}(this.current.matched,t.matched),f=p.updated,h=p.deactivated,l=p.activated,d=[].concat(function(t){return jt(t,"beforeRouteLeave",Tt,!0)}(h),this.router.beforeHooks,function(t){return jt(t,"beforeRouteUpdate",Tt)}(f),l.map((function(t){return t.beforeEnter})),kt(l)),y=function(e,r){if(n.pending!==t)return s(gt(o,t));try{e(t,o,(function(e){!1===e?(n.ensureURL(!0),s(function(t,e){return wt(t,e,yt.aborted,'Navigation aborted from "'+t.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(o,t))):xt(e)?(n.ensureURL(!0),s(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(s(mt(o,t)),"object"==typeof e&&e.replace?n.replace(e):n.push(e)):r(e)}))}catch(t){s(t)}};vt(d,y,(function(){vt(function(t){return jt(t,"beforeRouteEnter",(function(t,e,r,n){return function(t,e,r){return function(n,o,i){return t(n,o,(function(t){"function"==typeof t&&(e.enteredCbs[r]||(e.enteredCbs[r]=[]),e.enteredCbs[r].push(t)),i(t)}))}}(t,r,n)}))}(l).concat(n.router.resolveHooks),y,(function(){if(n.pending!==t)return s(gt(o,t));n.pending=null,e(t),n.router.app&&n.router.app.$nextTick((function(){m(t)}))}))}))},_t.prototype.updateRoute=function(t){this.current=t,this.cb&&this.cb(t)},_t.prototype.setupListeners=function(){},_t.prototype.teardown=function(){this.listeners.forEach((function(t){t()})),this.listeners=[],this.current=h,this.pending=null};var St=function(t){function e(e,r){t.call(this,e,r),this._startLocation=Pt(this.base)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var t=this;if(!(this.listeners.length>0)){var e=this.router,r=e.options.scrollBehavior,n=ht&&r;n&&this.listeners.push(rt());var o=function(){var r=t.current,o=Pt(t.base);t.current===h&&o===t._startLocation||t.transitionTo(o,(function(t){n&&nt(e,t,r,!0)}))};window.addEventListener("popstate",o),this.listeners.push((function(){window.removeEventListener("popstate",o)}))}},e.prototype.go=function(t){window.history.go(t)},e.prototype.push=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){lt(x(n.base+t.fullPath)),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.replace=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){dt(x(n.base+t.fullPath)),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.ensureURL=function(t){if(Pt(this.base)!==this.current.fullPath){var e=x(this.base+this.current.fullPath);t?lt(e):dt(e)}},e.prototype.getCurrentLocation=function(){return Pt(this.base)},e}(_t);function Pt(t){var e=window.location.pathname,r=e.toLowerCase(),n=t.toLowerCase();return!t||r!==n&&0!==r.indexOf(x(n+"/"))||(e=e.slice(t.length)),(e||"/")+window.location.search+window.location.hash}var Lt=function(t){function e(e,r,n){t.call(this,e,r),n&&function(t){var e=Pt(t);if(!/^\/#/.test(e))return window.location.replace(x(t+"/#"+e)),!0}(this.base)||$t()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var t=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,r=ht&&e;r&&this.listeners.push(rt());var n=function(){var e=t.current;$t()&&t.transitionTo(qt(),(function(n){r&&nt(t.router,n,e,!0),ht||It(n.fullPath)}))},o=ht?"popstate":"hashchange";window.addEventListener(o,n),this.listeners.push((function(){window.removeEventListener(o,n)}))}},e.prototype.push=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){Bt(t.fullPath),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.replace=function(t,e,r){var n=this,o=this.current;this.transitionTo(t,(function(t){It(t.fullPath),nt(n.router,t,o,!1),e&&e(t)}),r)},e.prototype.go=function(t){window.history.go(t)},e.prototype.ensureURL=function(t){var e=this.current.fullPath;qt()!==e&&(t?Bt(e):It(e))},e.prototype.getCurrentLocation=function(){return qt()},e}(_t);function $t(){var t=qt();return"/"===t.charAt(0)||(It("/"+t),!1)}function qt(){var t=window.location.href,e=t.indexOf("#");return e<0?"":t=t.slice(e+1)}function Ut(t){var e=window.location.href,r=e.indexOf("#");return(r>=0?e.slice(0,r):e)+"#"+t}function Bt(t){ht?lt(Ut(t)):window.location.hash=t}function It(t){ht?dt(Ut(t)):window.location.replace(Ut(t))}var Mt=function(t){function e(e,r){t.call(this,e,r),this.stack=[],this.index=-1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.push=function(t,e,r){var n=this;this.transitionTo(t,(function(t){n.stack=n.stack.slice(0,n.index+1).concat(t),n.index++,e&&e(t)}),r)},e.prototype.replace=function(t,e,r){var n=this;this.transitionTo(t,(function(t){n.stack=n.stack.slice(0,n.index).concat(t),e&&e(t)}),r)},e.prototype.go=function(t){var e=this,r=this.index+t;if(!(r<0||r>=this.stack.length)){var n=this.stack[r];this.confirmTransition(n,(function(){var t=e.current;e.index=r,e.updateRoute(n),e.router.afterHooks.forEach((function(e){e&&e(n,t)}))}),(function(t){Rt(t,yt.duplicated)&&(e.index=r)}))}},e.prototype.getCurrentLocation=function(){var t=this.stack[this.stack.length-1];return t?t.fullPath:"/"},e.prototype.ensureURL=function(){},e}(_t),Vt=function(t){void 0===t&&(t={}),this.app=null,this.apps=[],this.options=t,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Q(t.routes||[],this);var e=t.mode||"hash";switch(this.fallback="history"===e&&!ht&&!1!==t.fallback,this.fallback&&(e="hash"),D||(e="abstract"),this.mode=e,e){case"history":this.history=new St(this,t.base);break;case"hash":this.history=new Lt(this,t.base,this.fallback);break;case"abstract":this.history=new Mt(this,t.base)}},Ht={currentRoute:{configurable:!0}};function Nt(t,e){return t.push(e),function(){var r=t.indexOf(e);r>-1&&t.splice(r,1)}}return Vt.prototype.match=function(t,e,r){return this.matcher.match(t,e,r)},Ht.currentRoute.get=function(){return this.history&&this.history.current},Vt.prototype.init=function(t){var e=this;if(this.apps.push(t),t.$once("hook:destroyed",(function(){var r=e.apps.indexOf(t);r>-1&&e.apps.splice(r,1),e.app===t&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=t;var r=this.history;if(r instanceof St||r instanceof Lt){var n=function(t){r.setupListeners(),function(t){var n=r.current,o=e.options.scrollBehavior;ht&&o&&"fullPath"in t&&nt(e,t,n,!1)}(t)};r.transitionTo(r.getCurrentLocation(),n,n)}r.listen((function(t){e.apps.forEach((function(e){e._route=t}))}))}},Vt.prototype.beforeEach=function(t){return Nt(this.beforeHooks,t)},Vt.prototype.beforeResolve=function(t){return Nt(this.resolveHooks,t)},Vt.prototype.afterEach=function(t){return Nt(this.afterHooks,t)},Vt.prototype.onReady=function(t,e){this.history.onReady(t,e)},Vt.prototype.onError=function(t){this.history.onError(t)},Vt.prototype.push=function(t,e,r){var n=this;if(!e&&!r&&"undefined"!=typeof Promise)return new Promise((function(e,r){n.history.push(t,e,r)}));this.history.push(t,e,r)},Vt.prototype.replace=function(t,e,r){var n=this;if(!e&&!r&&"undefined"!=typeof Promise)return new Promise((function(e,r){n.history.replace(t,e,r)}));this.history.replace(t,e,r)},Vt.prototype.go=function(t){this.history.go(t)},Vt.prototype.back=function(){this.go(-1)},Vt.prototype.forward=function(){this.go(1)},Vt.prototype.getMatchedComponents=function(t){var e=t?t.matched?t:this.resolve(t).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(t){return Object.keys(t.components).map((function(e){return t.components[e]}))}))):[]},Vt.prototype.resolve=function(t,e,r){var n=V(t,e=e||this.history.current,r,this),o=this.match(n,e),i=o.redirectedFrom||o.fullPath;return{location:n,route:o,href:function(t,e,r){var n="hash"===r?"#"+e:e;return t?x(t+"/"+n):n}(this.history.base,i,this.mode),normalizedTo:n,resolved:o}},Vt.prototype.getRoutes=function(){return this.matcher.getRoutes()},Vt.prototype.addRoute=function(t,e){this.matcher.addRoute(t,e),this.history.current!==h&&this.history.transitionTo(this.history.getCurrentLocation())},Vt.prototype.addRoutes=function(t){this.matcher.addRoutes(t),this.history.current!==h&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Vt.prototype,Ht),Vt.install=function t(e){if(!t.installed||H!==e){t.installed=!0,H=e;var r=function(t){return void 0!==t},n=function(t,e){var n=t.$options._parentVnode;r(n)&&r(n=n.data)&&r(n=n.registerRouteInstance)&&n(t,e)};e.mixin({beforeCreate:function(){r(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,n(this,this)},destroyed:function(){n(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",g),e.component("RouterLink",F);var o=e.config.optionMergeStrategies;o.beforeRouteEnter=o.beforeRouteLeave=o.beforeRouteUpdate=o.created}},Vt.version="3.5.3",Vt.isNavigationFailure=Rt,Vt.NavigationFailureType=yt,Vt.START_LOCATION=h,D&&window.Vue&&window.Vue.use(Vt),Vt},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VueRouter=e();
/*!
 * Vue Scroller 
 * version: 2.2.4 
 * repo: https://github.com/wangdahoo/vue-scroller 
 * build: 2017-09-21 16:25:35
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("VueScroller",[],e):"object"==typeof exports?exports.VueScroller=e():t.VueScroller=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e){t.exports=function(t,e,n,o){var i,r=t=t||{},a=typeof t.default;"object"!==a&&"function"!==a||(i=t,r=t.default);var l="function"==typeof r?r.options:r;if(e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns),n&&(l._scopeId=n),o){var s=Object.create(l.computed||null);Object.keys(o).forEach(function(t){var e=o[t];s[t]=function(){return e}}),l.computed=s}return{esModule:i,exports:r,options:l}}},function(t,e,n){n(14);var o=n(0)(n(3),n(13),"data-v-ecaca2b0",null);t.exports=o.exports},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{fillColor:{type:String,default:"#AAA"}}}},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),r=o(i),a=n(6),l=o(a),s=n(10),c=o(s),_=n(9),u=o(_),f=/^[\d]+(\%)?$/,p=function(t){return"%"!=t[t.length-1]?t+"px":t},h=function(t){return f.test(t)};e.default={components:{Spinner:c.default,Arrow:u.default},props:{onRefresh:Function,onInfinite:Function,refreshText:{type:String,default:"下拉刷新"},noDataText:{type:String,default:"没有更多数据"},width:{type:String,default:"100%",validator:h},height:{type:String,default:"100%",validator:h},snapping:{type:Boolean,default:!1},snapWidth:{type:Number,default:100},snapHeight:{type:Number,default:100},animating:{type:Boolean,default:!0},animationDuration:{type:Number,default:250},bouncing:{type:Boolean,default:!0},refreshLayerColor:{type:String,default:"#AAA"},loadingLayerColor:{type:String,default:"#AAA"},cssClass:String,minContentHeight:{type:Number,default:0}},computed:{w:function(){return p(this.width)},h:function(){return p(this.height)},showInfiniteLayer:function(){var t=0;return this.content&&(t=this.content.offsetHeight),!!this.onInfinite&&t>this.minContentHeight}},data:function(){return{containerId:"outer-"+Math.random().toString(36).substring(3,8),contentId:"inner-"+Math.random().toString(36).substring(3,8),state:0,loadingState:0,showLoading:!1,container:void 0,content:void 0,scroller:void 0,pullToRefreshLayer:void 0,mousedown:!1,infiniteTimer:void 0,resizeTimer:void 0}},mounted:function(){var t=this;this.container=document.getElementById(this.containerId),this.container.style.width=this.w,this.container.style.height=this.h,this.content=document.getElementById(this.contentId),this.cssClass&&this.content.classList.add(this.cssClass),this.pullToRefreshLayer=this.content.getElementsByTagName("div")[0];var e=(0,l.default)(this.content);this.scroller=new r.default(e,{scrollingX:!1,snapping:this.snapping,animating:this.animating,animationDuration:this.animationDuration,bouncing:this.bouncing}),this.onRefresh&&this.scroller.activatePullToRefresh(60,function(){t.state=1},function(){t.state=0},function(){t.state=2,t.$on("$finishPullToRefresh",function(){setTimeout(function(){t.state=0,t.finishPullToRefresh()})}),t.onRefresh(t.finishPullToRefresh)}),this.onInfinite&&(this.infiniteTimer=setInterval(function(){var e=t.scroller.getValues(),n=(e.left,e.top);e.zoom;if(t.content.offsetHeight>0&&n+60>t.content.offsetHeight-t.container.clientHeight){if(t.loadingState)return;t.loadingState=1,t.showLoading=!0,t.onInfinite(t.finishInfinite)}},10));var n=this.container.getBoundingClientRect();this.scroller.setPosition(n.left+this.container.clientLeft,n.top+this.container.clientTop),this.snapping&&this.scroller.setSnapSize(this.snapWidth,this.snapHeight);var o=function(){return{width:t.content.offsetWidth,height:t.content.offsetHeight}},i=o(),a=i.content_width,s=i.content_height;this.resizeTimer=setInterval(function(){var e=o(),n=e.width,i=e.height;n===a&&i===s||(a=n,s=i,t.resize())},10)},destroyed:function(){clearInterval(this.resizeTimer),this.infiniteTimer&&clearInterval(this.infiniteTimer)},methods:{resize:function(){var t=this.container,e=this.content;this.scroller.setDimensions(t.clientWidth,t.clientHeight,e.offsetWidth,e.offsetHeight)},finishPullToRefresh:function(){this.scroller.finishPullToRefresh()},finishInfinite:function(t){this.loadingState=t?2:0,this.showLoading=!1,2==this.loadingState&&this.resetLoadingState()},triggerPullToRefresh:function(){this.scroller.triggerPullToRefresh()},scrollTo:function(t,e,n){this.scroller.scrollTo(t,e,n)},scrollBy:function(t,e,n){this.scroller.scrollBy(t,e,n)},touchStart:function(t){t.target.tagName.match(/input|textarea|select/i)||this.scroller.doTouchStart(t.touches,t.timeStamp)},touchMove:function(t){this.scroller.doTouchMove(t.touches,t.timeStamp)},touchEnd:function(t){this.scroller.doTouchEnd(t.timeStamp)},mouseDown:function(t){t.target.tagName.match(/input|textarea|select/i)||(this.scroller.doTouchStart([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),this.mousedown=!0)},mouseMove:function(t){this.mousedown&&(this.scroller.doTouchMove([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),this.mousedown=!0)},mouseUp:function(t){this.mousedown&&(this.scroller.doTouchEnd(t.timeStamp),this.mousedown=!1)},getPosition:function(){var t=this.scroller.getValues();return{left:parseInt(t.left),top:parseInt(t.top)}},resetLoadingState:function(){var t=this,e=this.scroller.getValues(),n=(e.left,e.top);e.zoom,this.container,this.content;n+60>this.content.offsetHeight-this.container.clientHeight?setTimeout(function(){t.resetLoadingState()},1e3):this.loadingState=0}}}},function(t,e,n){"use strict";function o(t){o.installed||(o.installed=!0,t.component("scroller",a.default))}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n(1),a=function(t){return t&&t.__esModule?t:{default:t}}(r),l={install:o,Scroller:a.default};void 0!==("undefined"==typeof window?"undefined":i(window))&&window.Vue&&window.Vue.use(l),e.default=l},function(t,e,n){"use strict";var o;!function(i){var r=function(){},a=function(t){var e=Date.now||function(){return+new Date},n={},o=1,i={effect:{}};return i.effect.Animate={requestAnimationFrame:function(){var e=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame,n=!!e;if(e&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(e.toString())&&(n=!1),n)return function(t,n){e(t,n)};var o={},i=0,r=1,a=null,l=+new Date;return function(t,e){var n=r++;return o[n]=t,i++,null===a&&(a=setInterval(function(){var t=+new Date,e=o;o={},i=0;for(var n in e)e.hasOwnProperty(n)&&(e[n](t),l=t);t-l>2500&&(clearInterval(a),a=null)},1e3/60)),n}}(),stop:function(t){var e=null!=n[t];return e&&(n[t]=null),e},isRunning:function(t){return null!=n[t]},start:function(t,r,a,l,s,c){var _=e(),u=_,f=0,p=0,h=o++;if(c||(c=document.body),h%20==0){var d={};for(var m in n)d[m]=!0;n=d}var g=function o(d){var m=!0!==d,g=e();if(!n[h]||r&&!r(h))return n[h]=null,void(a&&a(60-p/((g-_)/1e3),h,!1));if(m)for(var v=Math.round((g-u)/(1e3/60))-1,y=0;y<Math.min(v,4);y++)o(!0),p++;l&&(f=(g-_)/l)>1&&(f=1);var T=s?s(f):f;!1!==t(T,g,m)&&1!==f||!m?m&&(u=g,i.effect.Animate.requestAnimationFrame(o,c)):(n[h]=null,a&&a(60-p/((g-_)/1e3),h,1===f||null==l))};return n[h]=!0,i.effect.Animate.requestAnimationFrame(g,c),h}},i}(i),l=function(t,e){this.__callback=t,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:r,penetrationDeceleration:.03,penetrationAcceleration:.08};for(var n in e)this.options[n]=e[n]},s=function(t){return Math.pow(t-1,3)+1},c=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},_={__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(t,e,n,o){var i=this;t===+t&&(i.__clientWidth=t),e===+e&&(i.__clientHeight=e),n===+n&&(i.__contentWidth=n),o===+o&&(i.__contentHeight=o),i.__computeScrollMax(),i.scrollTo(i.__scrollLeft,i.__scrollTop,!0)},setPosition:function(t,e){var n=this;n.__clientLeft=t||0,n.__clientTop=e||0},setSnapSize:function(t,e){var n=this;n.__snapWidth=t,n.__snapHeight=e},activatePullToRefresh:function(t,e,n,o){var i=this;i.__refreshHeight=t,i.__refreshActivate=e,i.__refreshDeactivate=n,i.__refreshStart=o},triggerPullToRefresh:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()},finishPullToRefresh:function(){var t=this;t.__refreshActive=!1,t.__refreshDeactivate&&t.__refreshDeactivate(),t.scrollTo(t.__scrollLeft,t.__scrollTop,!0)},getValues:function(){var t=this;return{left:t.__scrollLeft,top:t.__scrollTop,zoom:t.__zoomLevel}},getScrollMax:function(){var t=this;return{left:t.__maxScrollLeft,top:t.__maxScrollTop}},zoomTo:function(t,e,n,o,i){var r=this;if(!r.options.zooming)throw new Error("Zooming is not enabled!");i&&(r.__zoomComplete=i),r.__isDecelerating&&(a.effect.Animate.stop(r.__isDecelerating),r.__isDecelerating=!1);var l=r.__zoomLevel;null==n&&(n=r.__clientWidth/2),null==o&&(o=r.__clientHeight/2),t=Math.max(Math.min(t,r.options.maxZoom),r.options.minZoom),r.__computeScrollMax(t);var s=(n+r.__scrollLeft)*t/l-n,c=(o+r.__scrollTop)*t/l-o;s>r.__maxScrollLeft?s=r.__maxScrollLeft:s<0&&(s=0),c>r.__maxScrollTop?c=r.__maxScrollTop:c<0&&(c=0),r.__publish(s,c,t,e)},zoomBy:function(t,e,n,o,i){var r=this;r.zoomTo(r.__zoomLevel*t,e,n,o,i)},scrollTo:function(t,e,n,o){var i=this;if(i.__isDecelerating&&(a.effect.Animate.stop(i.__isDecelerating),i.__isDecelerating=!1),null!=o&&o!==i.__zoomLevel){if(!i.options.zooming)throw new Error("Zooming is not enabled!");t*=o,e*=o,i.__computeScrollMax(o)}else o=i.__zoomLevel;i.options.scrollingX?i.options.paging?t=Math.round(t/i.__clientWidth)*i.__clientWidth:i.options.snapping&&(t=Math.round(t/i.__snapWidth)*i.__snapWidth):t=i.__scrollLeft,i.options.scrollingY?i.options.paging?e=Math.round(e/i.__clientHeight)*i.__clientHeight:i.options.snapping&&(e=Math.round(e/i.__snapHeight)*i.__snapHeight):e=i.__scrollTop,t=Math.max(Math.min(i.__maxScrollLeft,t),0),e=Math.max(Math.min(i.__maxScrollTop,e),0),t===i.__scrollLeft&&e===i.__scrollTop&&(n=!1),i.__isTracking||i.__publish(t,e,o,n)},scrollBy:function(t,e,n){var o=this,i=o.__isAnimating?o.__scheduledLeft:o.__scrollLeft,r=o.__isAnimating?o.__scheduledTop:o.__scrollTop;o.scrollTo(i+(t||0),r+(e||0),n)},doMouseZoom:function(t,e,n,o){var i=this,r=t>0?.97:1.03;return i.zoomTo(i.__zoomLevel*r,!1,n-i.__clientLeft,o-i.__clientTop)},doTouchStart:function(t,e){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var n=this;n.__interruptedAnimation=!0,n.__isDecelerating&&(a.effect.Animate.stop(n.__isDecelerating),n.__isDecelerating=!1,n.__interruptedAnimation=!0),n.__isAnimating&&(a.effect.Animate.stop(n.__isAnimating),n.__isAnimating=!1,n.__interruptedAnimation=!0);var o,i,r=1===t.length;r?(o=t[0].pageX,i=t[0].pageY):(o=Math.abs(t[0].pageX+t[1].pageX)/2,i=Math.abs(t[0].pageY+t[1].pageY)/2),n.__initialTouchLeft=o,n.__initialTouchTop=i,n.__zoomLevelStart=n.__zoomLevel,n.__lastTouchLeft=o,n.__lastTouchTop=i,n.__lastTouchMove=e,n.__lastScale=1,n.__enableScrollX=!r&&n.options.scrollingX,n.__enableScrollY=!r&&n.options.scrollingY,n.__isTracking=!0,n.__didDecelerationComplete=!1,n.__isDragging=!r,n.__isSingleTouch=r,n.__positions=[]},doTouchMove:function(t,e,n){if(null==t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var o=this;if(o.__isTracking){var i,r;2===t.length?(i=Math.abs(t[0].pageX+t[1].pageX)/2,r=Math.abs(t[0].pageY+t[1].pageY)/2):(i=t[0].pageX,r=t[0].pageY);var a=o.__positions;if(o.__isDragging){var l=i-o.__lastTouchLeft,s=r-o.__lastTouchTop,c=o.__scrollLeft,_=o.__scrollTop,u=o.__zoomLevel;if(null!=n&&o.options.zooming){var f=u;if(u=u/o.__lastScale*n,u=Math.max(Math.min(u,o.options.maxZoom),o.options.minZoom),f!==u){var p=i-o.__clientLeft,h=r-o.__clientTop;c=(p+c)*u/f-p,_=(h+_)*u/f-h,o.__computeScrollMax(u)}}if(o.__enableScrollX){c-=l*this.options.speedMultiplier;var d=o.__maxScrollLeft;(c>d||c<0)&&(o.options.bouncing?c+=l/2*this.options.speedMultiplier:c=c>d?d:0)}if(o.__enableScrollY){_-=s*this.options.speedMultiplier;var m=o.__maxScrollTop;(_>m||_<0)&&(o.options.bouncing?(_+=s/2*this.options.speedMultiplier,o.__enableScrollX||null==o.__refreshHeight||(!o.__refreshActive&&_<=-o.__refreshHeight?(o.__refreshActive=!0,o.__refreshActivate&&o.__refreshActivate()):o.__refreshActive&&_>-o.__refreshHeight&&(o.__refreshActive=!1,o.__refreshDeactivate&&o.__refreshDeactivate()))):_=_>m?m:0)}a.length>60&&a.splice(0,30),a.push(c,_,e),o.__publish(c,_,u)}else{var g=o.options.locking?3:0,v=Math.abs(i-o.__initialTouchLeft),y=Math.abs(r-o.__initialTouchTop);o.__enableScrollX=o.options.scrollingX&&v>=g,o.__enableScrollY=o.options.scrollingY&&y>=g,a.push(o.__scrollLeft,o.__scrollTop,e),o.__isDragging=(o.__enableScrollX||o.__enableScrollY)&&(v>=5||y>=5),o.__isDragging&&(o.__interruptedAnimation=!1)}o.__lastTouchLeft=i,o.__lastTouchTop=r,o.__lastTouchMove=e,o.__lastScale=n}},doTouchEnd:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);var e=this;if(e.__isTracking){if(e.__isTracking=!1,e.__isDragging)if(e.__isDragging=!1,e.__isSingleTouch&&e.options.animating&&t-e.__lastTouchMove<=100){for(var n=e.__positions,o=n.length-1,i=o,r=o;r>0&&n[r]>e.__lastTouchMove-100;r-=3)i=r;if(i!==o){var a=n[o]-n[i],l=e.__scrollLeft-n[i-2],s=e.__scrollTop-n[i-1];e.__decelerationVelocityX=l/a*(1e3/60),e.__decelerationVelocityY=s/a*(1e3/60);var c=e.options.paging||e.options.snapping?4:1;Math.abs(e.__decelerationVelocityX)>c||Math.abs(e.__decelerationVelocityY)>c?e.__refreshActive||e.__startDeceleration(t):e.options.scrollingComplete()}else e.options.scrollingComplete()}else t-e.__lastTouchMove>100&&e.options.scrollingComplete();e.__isDecelerating||(e.__refreshActive&&e.__refreshStart?(e.__publish(e.__scrollLeft,-e.__refreshHeight,e.__zoomLevel,!0),e.__refreshStart&&e.__refreshStart()):((e.__interruptedAnimation||e.__isDragging)&&e.options.scrollingComplete(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0,e.__zoomLevel),e.__refreshActive&&(e.__refreshActive=!1,e.__refreshDeactivate&&e.__refreshDeactivate()))),e.__positions.length=0}},__publish:function(t,e,n,o){var i=this,r=i.__isAnimating;if(r&&(a.effect.Animate.stop(r),i.__isAnimating=!1),o&&i.options.animating){i.__scheduledLeft=t,i.__scheduledTop=e,i.__scheduledZoom=n;var l=i.__scrollLeft,_=i.__scrollTop,u=i.__zoomLevel,f=t-l,p=e-_,h=n-u,d=function(t,e,n){n&&(i.__scrollLeft=l+f*t,i.__scrollTop=_+p*t,i.__zoomLevel=u+h*t,i.__callback&&i.__callback(i.__scrollLeft,i.__scrollTop,i.__zoomLevel))},m=function(t){return i.__isAnimating===t},g=function(t,e,n){e===i.__isAnimating&&(i.__isAnimating=!1),(i.__didDecelerationComplete||n)&&i.options.scrollingComplete(),i.options.zooming&&(i.__computeScrollMax(),i.__zoomComplete&&(i.__zoomComplete(),i.__zoomComplete=null))};i.__isAnimating=a.effect.Animate.start(d,m,g,i.options.animationDuration,r?s:c)}else i.__scheduledLeft=i.__scrollLeft=t,i.__scheduledTop=i.__scrollTop=e,i.__scheduledZoom=i.__zoomLevel=n,i.__callback&&i.__callback(t,e,n),i.options.zooming&&(i.__computeScrollMax(),i.__zoomComplete&&(i.__zoomComplete(),i.__zoomComplete=null))},__computeScrollMax:function(t){var e=this;null==t&&(t=e.__zoomLevel),e.__maxScrollLeft=Math.max(e.__contentWidth*t-e.__clientWidth,0),e.__maxScrollTop=Math.max(e.__contentHeight*t-e.__clientHeight,0)},__startDeceleration:function(t){var e=this;if(e.options.paging){var n=Math.max(Math.min(e.__scrollLeft,e.__maxScrollLeft),0),o=Math.max(Math.min(e.__scrollTop,e.__maxScrollTop),0),i=e.__clientWidth,r=e.__clientHeight;e.__minDecelerationScrollLeft=Math.floor(n/i)*i,e.__minDecelerationScrollTop=Math.floor(o/r)*r,e.__maxDecelerationScrollLeft=Math.ceil(n/i)*i,e.__maxDecelerationScrollTop=Math.ceil(o/r)*r}else e.__minDecelerationScrollLeft=0,e.__minDecelerationScrollTop=0,e.__maxDecelerationScrollLeft=e.__maxScrollLeft,e.__maxDecelerationScrollTop=e.__maxScrollTop;var l=function(t,n,o){e.__stepThroughDeceleration(o)},s=e.options.snapping?4:.001,c=function(){var t=Math.abs(e.__decelerationVelocityX)>=s||Math.abs(e.__decelerationVelocityY)>=s;return t||(e.__didDecelerationComplete=!0),t},_=function(t,n,o){e.__isDecelerating=!1,e.__didDecelerationComplete&&e.options.scrollingComplete(),e.scrollTo(e.__scrollLeft,e.__scrollTop,e.options.snapping)};e.__isDecelerating=a.effect.Animate.start(l,c,_)},__stepThroughDeceleration:function(t){var e=this,n=e.__scrollLeft+e.__decelerationVelocityX,o=e.__scrollTop+e.__decelerationVelocityY;if(!e.options.bouncing){var i=Math.max(Math.min(e.__maxDecelerationScrollLeft,n),e.__minDecelerationScrollLeft);i!==n&&(n=i,e.__decelerationVelocityX=0);var r=Math.max(Math.min(e.__maxDecelerationScrollTop,o),e.__minDecelerationScrollTop);r!==o&&(o=r,e.__decelerationVelocityY=0)}if(t?e.__publish(n,o,e.__zoomLevel):(e.__scrollLeft=n,e.__scrollTop=o),!e.options.paging){e.__decelerationVelocityX*=.95,e.__decelerationVelocityY*=.95}if(e.options.bouncing){var a=0,l=0,s=e.options.penetrationDeceleration,c=e.options.penetrationAcceleration;n<e.__minDecelerationScrollLeft?a=e.__minDecelerationScrollLeft-n:n>e.__maxDecelerationScrollLeft&&(a=e.__maxDecelerationScrollLeft-n),o<e.__minDecelerationScrollTop?l=e.__minDecelerationScrollTop-o:o>e.__maxDecelerationScrollTop&&(l=e.__maxDecelerationScrollTop-o),0!==a&&(a*e.__decelerationVelocityX<=0?e.__decelerationVelocityX+=a*s:e.__decelerationVelocityX=a*c),0!==l&&(l*e.__decelerationVelocityY<=0?e.__decelerationVelocityY+=l*s:e.__decelerationVelocityY=l*c)}}};for(var u in _)l.prototype[u]=_[u];void 0!==t&&t.exports?t.exports=l:void 0!==(o=function(){return l}.call(e,n,e,t))&&(t.exports=o)}(window)},function(t,e,n){"use strict";function o(t){var e,n=window,o=document.documentElement.style;n.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?e="presto":"MozAppearance"in o?e="gecko":"WebkitAppearance"in o?e="webkit":"string"==typeof navigator.cpuClass&&(e="trident");var i={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[e],r=document.createElement("div"),a=i+"Perspective",l=i+"Transform";return void 0!==r.style[a]?function(e,n,o){t.style[l]="translate3d("+-e+"px,"+-n+"px,0) scale("+o+")"}:void 0!==r.style[l]?function(e,n,o){t.style[l]="translate("+-e+"px,"+-n+"px) scale("+o+")"}:function(e,n,o){t.style.marginLeft=e?-e/o+"px":"",t.style.marginTop=n?-n/o+"px":"",t.style.zoom=o||""}}t.exports=o},function(t,e,n){e=t.exports=n(8)(),e.push([t.i,"._v-container[data-v-ecaca2b0]{-webkit-tap-highlight-color:rgba(0,0,0,0);width:100%;height:100%;position:absolute;top:0;left:0;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}._v-container>._v-content[data-v-ecaca2b0]{width:100%;-webkit-transform-origin:left top;-webkit-transform:translateZ(0);-moz-transform-origin:left top;-moz-transform:translateZ(0);-ms-transform-origin:left top;-ms-transform:translateZ(0);-o-transform-origin:left top;-o-transform:translateZ(0);transform-origin:left top;transform:translateZ(0)}._v-container>._v-content>.pull-to-refresh-layer[data-v-ecaca2b0]{width:100%;height:60px;margin-top:-60px;text-align:center;font-size:16px;color:#aaa}._v-container>._v-content>.loading-layer[data-v-ecaca2b0]{width:100%;height:60px;text-align:center;font-size:16px;line-height:60px;color:#aaa;position:relative}._v-container>._v-content>.loading-layer>.no-data-text[data-v-ecaca2b0]{position:absolute;left:0;top:0;width:100%;height:100%;z-index:1}._v-container>._v-content>.loading-layer>.no-data-text[data-v-ecaca2b0],._v-container>._v-content>.loading-layer>.spinner-holder[data-v-ecaca2b0]{opacity:0;transition:opacity .15s linear;-webkit-transition:opacity .15s linear}._v-container>._v-content>.loading-layer>.no-data-text.active[data-v-ecaca2b0],._v-container>._v-content>.loading-layer>.spinner-holder.active[data-v-ecaca2b0]{opacity:1}._v-container>._v-content>.loading-layer .spinner-holder[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder[data-v-ecaca2b0]{text-align:center;-webkit-font-smoothing:antialiased}._v-container>._v-content>.loading-layer .spinner-holder .arrow[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .arrow[data-v-ecaca2b0]{width:20px;height:20px;margin:8px auto 0;-webkit-transform:translateZ(0) rotate(0deg);transform:translateZ(0) rotate(0deg);transition:transform .2s linear}._v-container>._v-content>.loading-layer .spinner-holder .text[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .text[data-v-ecaca2b0]{display:block;margin:0 auto;font-size:14px;line-height:20px;color:#aaa}._v-container>._v-content>.loading-layer .spinner-holder .spinner[data-v-ecaca2b0],._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .spinner[data-v-ecaca2b0]{margin-top:14px;width:32px;height:32px;fill:#444;stroke:#69717d}._v-container>._v-content>.pull-to-refresh-layer.active .spinner-holder .arrow[data-v-ecaca2b0]{-webkit-transform:translateZ(0) rotate(180deg);transform:translateZ(0) rotate(180deg)}",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},i=0;i<this.length;i++){var r=this[i][0];"number"==typeof r&&(o[r]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&o[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(t,e,n){var o=n(0)(n(2),n(11),null,null);t.exports=o.exports},function(t,e,n){var o=n(0)(null,n(12),null,null);t.exports=o.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{staticStyle:{"enable-background":"new 0 0 63.657 63.657"},attrs:{viewBox:"0 0 63.657 63.657","xml:space":"preserve",width:"512px",height:"512px"}},[n("g",[n("g",[n("g",[n("g",[n("polygon",{attrs:{points:"31.891,63.657 0.012,35.835 2.642,32.821 31.886,58.343 61.009,32.824 63.645,35.832",fill:t.fillColor}})])]),t._v(" "),n("g",[n("g",[n("rect",{attrs:{x:"29.827",width:"4",height:"60",fill:t.fillColor}})])])]),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g")]),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g"),t._v(" "),n("g")])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("svg",{staticClass:"spinner",attrs:{viewBox:"0 0 64 64"}},[n("g",{attrs:{"stroke-width":"4","stroke-linecap":"round"}},[n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(180)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:"1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0;1",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(210)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:"0;1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(240)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".1;0;1;.85;.7;.65;.55;.45;.35;.25;.15;.1",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(270)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".15;.1;0;1;.85;.7;.65;.55;.45;.35;.25;.15",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(300)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".25;.15;.1;0;1;.85;.7;.65;.55;.45;.35;.25",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(330)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".35;.25;.15;.1;0;1;.85;.7;.65;.55;.45;.35",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(0)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".45;.35;.25;.15;.1;0;1;.85;.7;.65;.55;.45",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(30)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".55;.45;.35;.25;.15;.1;0;1;.85;.7;.65;.55",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(60)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".65;.55;.45;.35;.25;.15;.1;0;1;.85;.7;.65",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(90)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".7;.65;.55;.45;.35;.25;.15;.1;0;1;.85;.7",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(120)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:".85;.7;.65;.55;.45;.35;.25;.15;.1;0;1;.85",repeatCount:"indefinite"}})]),n("line",{attrs:{y1:"17",y2:"29",transform:"translate(32,32) rotate(150)"}},[n("animate",{attrs:{attributeName:"stroke-opacity",dur:"750ms",values:"1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0;1",repeatCount:"indefinite"}})])])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"_v-container",attrs:{id:t.containerId},on:{touchstart:function(e){t.touchStart(e)},touchmove:function(e){t.touchMove(e)},touchend:function(e){t.touchEnd(e)},mousedown:function(e){t.mouseDown(e)},mousemove:function(e){t.mouseMove(e)},mouseup:function(e){t.mouseUp(e)}}},[n("div",{staticClass:"_v-content",attrs:{id:t.contentId}},[t.onRefresh?n("div",{staticClass:"pull-to-refresh-layer",class:{active:1==t.state,"active refreshing":2==t.state}},[n("span",{staticClass:"spinner-holder"},[2!=t.state?n("arrow",{staticClass:"arrow",attrs:{fillColor:t.refreshLayerColor}}):t._e(),t._v(" "),2!=t.state?n("span",{staticClass:"text",style:{color:t.refreshLayerColor},domProps:{textContent:t._s(t.refreshText)}}):t._e(),t._v(" "),2==t.state?n("span",[t._t("refresh-spinner",[n("spinner",{style:{fill:t.refreshLayerColor,stroke:t.refreshLayerColor}})])],2):t._e()],1)]):t._e(),t._v(" "),t._t("default"),t._v(" "),t.showInfiniteLayer?n("div",{staticClass:"loading-layer"},[n("span",{staticClass:"spinner-holder",class:{active:t.showLoading}},[t._t("infinite-spinner",[n("spinner",{style:{fill:t.loadingLayerColor,stroke:t.loadingLayerColor}})])],2),t._v(" "),n("div",{staticClass:"no-data-text",class:{active:!t.showLoading&&2==t.loadingState},style:{color:t.loadingLayerColor},domProps:{textContent:t._s(t.noDataText)}})]):t._e()],2)])},staticRenderFns:[]}},function(t,e,n){var o=n(7);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(15)("1ca3e1c8",o,!0)},function(t,e,n){function o(t){for(var e=0;e<t.length;e++){var n=t[e],o=_[n.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](n.parts[i]);for(;i<n.parts.length;i++)o.parts.push(r(n.parts[i]));o.parts.length>n.parts.length&&(o.parts.length=n.parts.length)}else{for(var a=[],i=0;i<n.parts.length;i++)a.push(r(n.parts[i]));_[n.id]={id:n.id,refs:1,parts:a}}}}function i(){var t=document.createElement("style");return t.type="text/css",u.appendChild(t),t}function r(t){var e,n,o=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(o){if(h)return d;o.parentNode.removeChild(o)}if(m){var r=p++;o=f||(f=i()),e=a.bind(null,o,r,!1),n=a.bind(null,o,r,!0)}else o=i(),e=l.bind(null,o),n=function(){o.parentNode.removeChild(o)};return e(t),function(o){if(o){if(o.css===t.css&&o.media===t.media&&o.sourceMap===t.sourceMap)return;e(t=o)}else n()}}function a(t,e,n,o){var i=n?"":o.css;if(t.styleSheet)t.styleSheet.cssText=g(e,i);else{var r=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function l(t,e){var n=e.css,o=e.media,i=e.sourceMap;if(o&&t.setAttribute("media",o),i&&(n+="\n/*# sourceURL="+i.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var s="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!s)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var c=n(16),_={},u=s&&(document.head||document.getElementsByTagName("head")[0]),f=null,p=0,h=!1,d=function(){},m="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n){h=n;var i=c(t,e);return o(i),function(e){for(var n=[],r=0;r<i.length;r++){var a=i[r],l=_[a.id];l.refs--,n.push(l)}e?(i=c(t,e),o(i)):i=[];for(var r=0;r<n.length;r++){var l=n[r];if(0===l.refs){for(var s=0;s<l.parts.length;s++)l.parts[s]();delete _[l.id]}}}};var g=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e){for(var n=[],o={},i=0;i<e.length;i++){var r=e[i],a=r[0],l=r[1],s=r[2],c=r[3],_={id:t+":"+i,css:l,media:s,sourceMap:c};o[a]?o[a].parts.push(_):n.push(o[a]={id:a,parts:[_]})}return n}}])});
//# sourceMappingURL=vue-scroller.min.js.map
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).transform={})}(this,(function(e){"use strict";const t=["scale","scale3d","scaleX","scaleY","scaleZ"];e.parse=e=>{const t=e.trim().split(/\) |\)/);if(1===t.length)return{[t[0]]:!0};return t.reduce((e,t)=>{if(!t)return e;const[r,n]=t.split("("),s=n.split(",").map(e=>(e=>e.endsWith("px")?parseFloat(e):Number.isNaN(Number(e))?e:Number(e))(e.endsWith(")")?e.replace(")",""):e.trim())),i=1===s.length?s[0]:s;return Object.assign(e,{[r]:i})},{})},e.stringify=e=>{const r=(e,r)=>"number"!=typeof r||t.includes(e)?r.toString():r+"px";return Object.keys(e).reduce((t,n)=>{const s=e[n];return!0===s?n:!1===s?t:Array.isArray(s)?`${t} ${n}(${s.map(e=>r(n,e)).join(", ")})`:`${t} ${n}(${r(n,s)})`},"").trim()},Object.defineProperty(e,"__esModule",{value:!0})}));
/* Blob.js
 * A Blob implementation.
 * 2014-07-24
 *
 * By Eli Grey, http://eligrey.com
 * By Devin Samarin, https://github.com/dsamarin
 * License: X11/MIT
 *   See https://github.com/eligrey/Blob.js/blob/master/LICENSE.md
 */

/*global self, unescape */
/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,
  plusplus: true */

/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */

(function (view) {
	"use strict";

	view.URL = view.URL || view.webkitURL;

	if (view.Blob && view.URL) {
		try {
			new Blob;
			return;
		} catch (e) {}
	}

	// Internally we use a BlobBuilder implementation to base Blob off of
	// in order to support older browsers that only have BlobBuilder
	var BlobBuilder = view.BlobBuilder || view.WebKitBlobBuilder || view.MozBlobBuilder || (function(view) {
		var
			  get_class = function(object) {
				return Object.prototype.toString.call(object).match(/^\[object\s(.*)\]$/)[1];
			}
			, FakeBlobBuilder = function BlobBuilder() {
				this.data = [];
			}
			, FakeBlob = function Blob(data, type, encoding) {
				this.data = data;
				this.size = data.length;
				this.type = type;
				this.encoding = encoding;
			}
			, FBB_proto = FakeBlobBuilder.prototype
			, FB_proto = FakeBlob.prototype
			, FileReaderSync = view.FileReaderSync
			, FileException = function(type) {
				this.code = this[this.name = type];
			}
			, file_ex_codes = (
				  "NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR "
				+ "NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR"
			).split(" ")
			, file_ex_code = file_ex_codes.length
			, real_URL = view.URL || view.webkitURL || view
			, real_create_object_URL = real_URL.createObjectURL
			, real_revoke_object_URL = real_URL.revokeObjectURL
			, URL = real_URL
			, btoa = view.btoa
			, atob = view.atob

			, ArrayBuffer = view.ArrayBuffer
			, Uint8Array = view.Uint8Array

			, origin = /^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/
		;
		FakeBlob.fake = FB_proto.fake = true;
		while (file_ex_code--) {
			FileException.prototype[file_ex_codes[file_ex_code]] = file_ex_code + 1;
		}
		// Polyfill URL
		if (!real_URL.createObjectURL) {
			URL = view.URL = function(uri) {
				var
					  uri_info = document.createElementNS("http://www.w3.org/1999/xhtml", "a")
					, uri_origin
				;
				uri_info.href = uri;
				if (!("origin" in uri_info)) {
					if (uri_info.protocol.toLowerCase() === "data:") {
						uri_info.origin = null;
					} else {
						uri_origin = uri.match(origin);
						uri_info.origin = uri_origin && uri_origin[1];
					}
				}
				return uri_info;
			};
		}
		URL.createObjectURL = function(blob) {
			var
				  type = blob.type
				, data_URI_header
			;
			if (type === null) {
				type = "application/octet-stream";
			}
			if (blob instanceof FakeBlob) {
				data_URI_header = "data:" + type;
				if (blob.encoding === "base64") {
					return data_URI_header + ";base64," + blob.data;
				} else if (blob.encoding === "URI") {
					return data_URI_header + "," + decodeURIComponent(blob.data);
				} if (btoa) {
					return data_URI_header + ";base64," + btoa(blob.data);
				} else {
					return data_URI_header + "," + encodeURIComponent(blob.data);
				}
			} else if (real_create_object_URL) {
				return real_create_object_URL.call(real_URL, blob);
			}
		};
		URL.revokeObjectURL = function(object_URL) {
			if (object_URL.substring(0, 5) !== "data:" && real_revoke_object_URL) {
				real_revoke_object_URL.call(real_URL, object_URL);
			}
		};
		FBB_proto.append = function(data/*, endings*/) {
			var bb = this.data;
			// decode data to a binary string
			if (Uint8Array && (data instanceof ArrayBuffer || data instanceof Uint8Array)) {
				var
					  str = ""
					, buf = new Uint8Array(data)
					, i = 0
					, buf_len = buf.length
				;
				for (; i < buf_len; i++) {
					str += String.fromCharCode(buf[i]);
				}
				bb.push(str);
			} else if (get_class(data) === "Blob" || get_class(data) === "File") {
				if (FileReaderSync) {
					var fr = new FileReaderSync;
					bb.push(fr.readAsBinaryString(data));
				} else {
					// async FileReader won't work as BlobBuilder is sync
					throw new FileException("NOT_READABLE_ERR");
				}
			} else if (data instanceof FakeBlob) {
				if (data.encoding === "base64" && atob) {
					bb.push(atob(data.data));
				} else if (data.encoding === "URI") {
					bb.push(decodeURIComponent(data.data));
				} else if (data.encoding === "raw") {
					bb.push(data.data);
				}
			} else {
				if (typeof data !== "string") {
					data += ""; // convert unsupported types to strings
				}
				// decode UTF-16 to binary string
				bb.push(unescape(encodeURIComponent(data)));
			}
		};
		FBB_proto.getBlob = function(type) {
			if (!arguments.length) {
				type = null;
			}
			return new FakeBlob(this.data.join(""), type, "raw");
		};
		FBB_proto.toString = function() {
			return "[object BlobBuilder]";
		};
		FB_proto.slice = function(start, end, type) {
			var args = arguments.length;
			if (args < 3) {
				type = null;
			}
			return new FakeBlob(
				  this.data.slice(start, args > 1 ? end : this.data.length)
				, type
				, this.encoding
			);
		};
		FB_proto.toString = function() {
			return "[object Blob]";
		};
		FB_proto.close = function() {
			this.size = 0;
			delete this.data;
		};
		return FakeBlobBuilder;
	}(view));

	view.Blob = function(blobParts, options) {
		var type = options ? (options.type || "") : "";
		var builder = new BlobBuilder();
		if (blobParts) {
			for (var i = 0, len = blobParts.length; i < len; i++) {
				builder.append(blobParts[i]);
			}
		}
		return builder.getBlob(type);
	};
}(typeof self !== "undefined" && self || typeof window !== "undefined" && window || this.content || this));

/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(u,p){var d={},l=d.lib={},s=function(){},t=l.Base={extend:function(a){s.prototype=this;var c=new s;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
r=l.WordArray=t.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=p?c:4*a.length},toString:function(a){return(a||v).stringify(this)},concat:function(a){var c=this.words,e=a.words,j=this.sigBytes;a=a.sigBytes;this.clamp();if(j%4)for(var k=0;k<a;k++)c[j+k>>>2]|=(e[k>>>2]>>>24-8*(k%4)&255)<<24-8*((j+k)%4);else if(65535<e.length)for(k=0;k<a;k+=4)c[j+k>>>2]=e[k>>>2];else c.push.apply(c,e);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
32-8*(c%4);a.length=u.ceil(c/4)},clone:function(){var a=t.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],e=0;e<a;e+=4)c.push(4294967296*u.random()|0);return new r.init(c,a)}}),w=d.enc={},v=w.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++){var k=c[j>>>2]>>>24-8*(j%4)&255;e.push((k>>>4).toString(16));e.push((k&15).toString(16))}return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j+=2)e[j>>>3]|=parseInt(a.substr(j,
2),16)<<24-4*(j%8);return new r.init(e,c/2)}},b=w.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++)e.push(String.fromCharCode(c[j>>>2]>>>24-8*(j%4)&255));return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j++)e[j>>>2]|=(a.charCodeAt(j)&255)<<24-8*(j%4);return new r.init(e,c)}},x=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(b.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return b.parse(unescape(encodeURIComponent(a)))}},
q=l.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new r.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,e=c.words,j=c.sigBytes,k=this.blockSize,b=j/(4*k),b=a?u.ceil(b):u.max((b|0)-this._minBufferSize,0);a=b*k;j=u.min(4*a,j);if(a){for(var q=0;q<a;q+=k)this._doProcessBlock(e,q);q=e.splice(0,a);c.sigBytes-=j}return new r.init(q,j)},clone:function(){var a=t.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});l.Hasher=q.extend({cfg:t.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){q.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,e){return(new a.init(e)).finalize(b)}},_createHmacHelper:function(a){return function(b,e){return(new n.HMAC.init(a,
e)).finalize(b)}}});var n=d.algo={};return d}(Math);
(function(){var u=CryptoJS,p=u.lib.WordArray;u.enc.Base64={stringify:function(d){var l=d.words,p=d.sigBytes,t=this._map;d.clamp();d=[];for(var r=0;r<p;r+=3)for(var w=(l[r>>>2]>>>24-8*(r%4)&255)<<16|(l[r+1>>>2]>>>24-8*((r+1)%4)&255)<<8|l[r+2>>>2]>>>24-8*((r+2)%4)&255,v=0;4>v&&r+0.75*v<p;v++)d.push(t.charAt(w>>>6*(3-v)&63));if(l=t.charAt(64))for(;d.length%4;)d.push(l);return d.join("")},parse:function(d){var l=d.length,s=this._map,t=s.charAt(64);t&&(t=d.indexOf(t),-1!=t&&(l=t));for(var t=[],r=0,w=0;w<
l;w++)if(w%4){var v=s.indexOf(d.charAt(w-1))<<2*(w%4),b=s.indexOf(d.charAt(w))>>>6-2*(w%4);t[r>>>2]|=(v|b)<<24-8*(r%4);r++}return p.create(t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(u){function p(b,n,a,c,e,j,k){b=b+(n&a|~n&c)+e+k;return(b<<j|b>>>32-j)+n}function d(b,n,a,c,e,j,k){b=b+(n&c|a&~c)+e+k;return(b<<j|b>>>32-j)+n}function l(b,n,a,c,e,j,k){b=b+(n^a^c)+e+k;return(b<<j|b>>>32-j)+n}function s(b,n,a,c,e,j,k){b=b+(a^(n|~c))+e+k;return(b<<j|b>>>32-j)+n}for(var t=CryptoJS,r=t.lib,w=r.WordArray,v=r.Hasher,r=t.algo,b=[],x=0;64>x;x++)b[x]=4294967296*u.abs(u.sin(x+1))|0;r=r.MD5=v.extend({_doReset:function(){this._hash=new w.init([1732584193,4023233417,2562383102,271733878])},
_doProcessBlock:function(q,n){for(var a=0;16>a;a++){var c=n+a,e=q[c];q[c]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360}var a=this._hash.words,c=q[n+0],e=q[n+1],j=q[n+2],k=q[n+3],z=q[n+4],r=q[n+5],t=q[n+6],w=q[n+7],v=q[n+8],A=q[n+9],B=q[n+10],C=q[n+11],u=q[n+12],D=q[n+13],E=q[n+14],x=q[n+15],f=a[0],m=a[1],g=a[2],h=a[3],f=p(f,m,g,h,c,7,b[0]),h=p(h,f,m,g,e,12,b[1]),g=p(g,h,f,m,j,17,b[2]),m=p(m,g,h,f,k,22,b[3]),f=p(f,m,g,h,z,7,b[4]),h=p(h,f,m,g,r,12,b[5]),g=p(g,h,f,m,t,17,b[6]),m=p(m,g,h,f,w,22,b[7]),
f=p(f,m,g,h,v,7,b[8]),h=p(h,f,m,g,A,12,b[9]),g=p(g,h,f,m,B,17,b[10]),m=p(m,g,h,f,C,22,b[11]),f=p(f,m,g,h,u,7,b[12]),h=p(h,f,m,g,D,12,b[13]),g=p(g,h,f,m,E,17,b[14]),m=p(m,g,h,f,x,22,b[15]),f=d(f,m,g,h,e,5,b[16]),h=d(h,f,m,g,t,9,b[17]),g=d(g,h,f,m,C,14,b[18]),m=d(m,g,h,f,c,20,b[19]),f=d(f,m,g,h,r,5,b[20]),h=d(h,f,m,g,B,9,b[21]),g=d(g,h,f,m,x,14,b[22]),m=d(m,g,h,f,z,20,b[23]),f=d(f,m,g,h,A,5,b[24]),h=d(h,f,m,g,E,9,b[25]),g=d(g,h,f,m,k,14,b[26]),m=d(m,g,h,f,v,20,b[27]),f=d(f,m,g,h,D,5,b[28]),h=d(h,f,
m,g,j,9,b[29]),g=d(g,h,f,m,w,14,b[30]),m=d(m,g,h,f,u,20,b[31]),f=l(f,m,g,h,r,4,b[32]),h=l(h,f,m,g,v,11,b[33]),g=l(g,h,f,m,C,16,b[34]),m=l(m,g,h,f,E,23,b[35]),f=l(f,m,g,h,e,4,b[36]),h=l(h,f,m,g,z,11,b[37]),g=l(g,h,f,m,w,16,b[38]),m=l(m,g,h,f,B,23,b[39]),f=l(f,m,g,h,D,4,b[40]),h=l(h,f,m,g,c,11,b[41]),g=l(g,h,f,m,k,16,b[42]),m=l(m,g,h,f,t,23,b[43]),f=l(f,m,g,h,A,4,b[44]),h=l(h,f,m,g,u,11,b[45]),g=l(g,h,f,m,x,16,b[46]),m=l(m,g,h,f,j,23,b[47]),f=s(f,m,g,h,c,6,b[48]),h=s(h,f,m,g,w,10,b[49]),g=s(g,h,f,m,
E,15,b[50]),m=s(m,g,h,f,r,21,b[51]),f=s(f,m,g,h,u,6,b[52]),h=s(h,f,m,g,k,10,b[53]),g=s(g,h,f,m,B,15,b[54]),m=s(m,g,h,f,e,21,b[55]),f=s(f,m,g,h,v,6,b[56]),h=s(h,f,m,g,x,10,b[57]),g=s(g,h,f,m,t,15,b[58]),m=s(m,g,h,f,D,21,b[59]),f=s(f,m,g,h,z,6,b[60]),h=s(h,f,m,g,C,10,b[61]),g=s(g,h,f,m,j,15,b[62]),m=s(m,g,h,f,A,21,b[63]);a[0]=a[0]+f|0;a[1]=a[1]+m|0;a[2]=a[2]+g|0;a[3]=a[3]+h|0},_doFinalize:function(){var b=this._data,n=b.words,a=8*this._nDataBytes,c=8*b.sigBytes;n[c>>>5]|=128<<24-c%32;var e=u.floor(a/
4294967296);n[(c+64>>>9<<4)+15]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;n[(c+64>>>9<<4)+14]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;b.sigBytes=4*(n.length+1);this._process();b=this._hash;n=b.words;for(a=0;4>a;a++)c=n[a],n[a]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360;return b},clone:function(){var b=v.clone.call(this);b._hash=this._hash.clone();return b}});t.MD5=v._createHelper(r);t.HmacMD5=v._createHmacHelper(r)})(Math);
(function(){var u=CryptoJS,p=u.lib,d=p.Base,l=p.WordArray,p=u.algo,s=p.EvpKDF=d.extend({cfg:d.extend({keySize:4,hasher:p.MD5,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,r){for(var p=this.cfg,s=p.hasher.create(),b=l.create(),u=b.words,q=p.keySize,p=p.iterations;u.length<q;){n&&s.update(n);var n=s.update(d).finalize(r);s.reset();for(var a=1;a<p;a++)n=s.finalize(n),s.reset();b.concat(n)}b.sigBytes=4*q;return b}});u.EvpKDF=function(d,l,p){return s.create(p).compute(d,
l)}})();
CryptoJS.lib.Cipher||function(u){var p=CryptoJS,d=p.lib,l=d.Base,s=d.WordArray,t=d.BufferedBlockAlgorithm,r=p.enc.Base64,w=p.algo.EvpKDF,v=d.Cipher=t.extend({cfg:l.extend(),createEncryptor:function(e,a){return this.create(this._ENC_XFORM_MODE,e,a)},createDecryptor:function(e,a){return this.create(this._DEC_XFORM_MODE,e,a)},init:function(e,a,b){this.cfg=this.cfg.extend(b);this._xformMode=e;this._key=a;this.reset()},reset:function(){t.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},
finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(b,k,d){return("string"==typeof k?c:a).encrypt(e,b,k,d)},decrypt:function(b,k,d){return("string"==typeof k?c:a).decrypt(e,b,k,d)}}}});d.StreamCipher=v.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var b=p.mode={},x=function(e,a,b){var c=this._iv;c?this._iv=u:c=this._prevBlock;for(var d=0;d<b;d++)e[a+d]^=
c[d]},q=(d.BlockCipherMode=l.extend({createEncryptor:function(e,a){return this.Encryptor.create(e,a)},createDecryptor:function(e,a){return this.Decryptor.create(e,a)},init:function(e,a){this._cipher=e;this._iv=a}})).extend();q.Encryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize;x.call(this,e,a,c);b.encryptBlock(e,a);this._prevBlock=e.slice(a,a+c)}});q.Decryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize,d=e.slice(a,a+c);b.decryptBlock(e,a);x.call(this,
e,a,c);this._prevBlock=d}});b=b.CBC=q;q=(p.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,l=[],n=0;n<c;n+=4)l.push(d);c=s.create(l,c);a.concat(c)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};d.BlockCipher=v.extend({cfg:v.cfg.extend({mode:b,padding:q}),reset:function(){v.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var n=d.CipherParams=l.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),b=(p.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;a=a.salt;return(a?s.create([1398893684,
1701076831]).concat(a).concat(b):b).toString(r)},parse:function(a){a=r.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=s.create(b.slice(2,4));b.splice(0,4);a.sigBytes-=16}return n.create({ciphertext:a,salt:c})}},a=d.SerializableCipher=l.extend({cfg:l.extend({format:b}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var l=a.createEncryptor(c,d);b=l.finalize(b);l=l.cfg;return n.create({ciphertext:b,key:c,iv:l.iv,algorithm:a,mode:l.mode,padding:l.padding,blockSize:a.blockSize,formatter:d.format})},
decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),p=(p.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=s.random(8));a=w.create({keySize:b+c}).compute(a,d);c=s.create(a.words.slice(b),4*c);a.sigBytes=4*b;return n.create({key:a,iv:c,salt:d})}},c=d.PasswordBasedCipher=a.extend({cfg:a.cfg.extend({kdf:p}),encrypt:function(b,c,d,l){l=this.cfg.extend(l);d=l.kdf.execute(d,
b.keySize,b.ivSize);l.iv=d.iv;b=a.encrypt.call(this,b,c,d.key,l);b.mixIn(d);return b},decrypt:function(b,c,d,l){l=this.cfg.extend(l);c=this._parse(c,l.format);d=l.kdf.execute(d,b.keySize,b.ivSize,c.salt);l.iv=d.iv;return a.decrypt.call(this,b,c,d.key,l)}})}();
(function(){for(var u=CryptoJS,p=u.lib.BlockCipher,d=u.algo,l=[],s=[],t=[],r=[],w=[],v=[],b=[],x=[],q=[],n=[],a=[],c=0;256>c;c++)a[c]=128>c?c<<1:c<<1^283;for(var e=0,j=0,c=0;256>c;c++){var k=j^j<<1^j<<2^j<<3^j<<4,k=k>>>8^k&255^99;l[e]=k;s[k]=e;var z=a[e],F=a[z],G=a[F],y=257*a[k]^16843008*k;t[e]=y<<24|y>>>8;r[e]=y<<16|y>>>16;w[e]=y<<8|y>>>24;v[e]=y;y=16843009*G^65537*F^257*z^16843008*e;b[k]=y<<24|y>>>8;x[k]=y<<16|y>>>16;q[k]=y<<8|y>>>24;n[k]=y;e?(e=z^a[a[a[G^z]]],j^=a[a[j]]):e=j=1}var H=[0,1,2,4,8,
16,32,64,128,27,54],d=d.AES=p.extend({_doReset:function(){for(var a=this._key,c=a.words,d=a.sigBytes/4,a=4*((this._nRounds=d+6)+1),e=this._keySchedule=[],j=0;j<a;j++)if(j<d)e[j]=c[j];else{var k=e[j-1];j%d?6<d&&4==j%d&&(k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255]):(k=k<<8|k>>>24,k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255],k^=H[j/d|0]<<24);e[j]=e[j-d]^k}c=this._invKeySchedule=[];for(d=0;d<a;d++)j=a-d,k=d%4?e[j]:e[j-4],c[d]=4>d||4>=j?k:b[l[k>>>24]]^x[l[k>>>16&255]]^q[l[k>>>
8&255]]^n[l[k&255]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,t,r,w,v,l)},decryptBlock:function(a,c){var d=a[c+1];a[c+1]=a[c+3];a[c+3]=d;this._doCryptBlock(a,c,this._invKeySchedule,b,x,q,n,s);d=a[c+1];a[c+1]=a[c+3];a[c+3]=d},_doCryptBlock:function(a,b,c,d,e,j,l,f){for(var m=this._nRounds,g=a[b]^c[0],h=a[b+1]^c[1],k=a[b+2]^c[2],n=a[b+3]^c[3],p=4,r=1;r<m;r++)var q=d[g>>>24]^e[h>>>16&255]^j[k>>>8&255]^l[n&255]^c[p++],s=d[h>>>24]^e[k>>>16&255]^j[n>>>8&255]^l[g&255]^c[p++],t=
d[k>>>24]^e[n>>>16&255]^j[g>>>8&255]^l[h&255]^c[p++],n=d[n>>>24]^e[g>>>16&255]^j[h>>>8&255]^l[k&255]^c[p++],g=q,h=s,k=t;q=(f[g>>>24]<<24|f[h>>>16&255]<<16|f[k>>>8&255]<<8|f[n&255])^c[p++];s=(f[h>>>24]<<24|f[k>>>16&255]<<16|f[n>>>8&255]<<8|f[g&255])^c[p++];t=(f[k>>>24]<<24|f[n>>>16&255]<<16|f[g>>>8&255]<<8|f[h&255])^c[p++];n=(f[n>>>24]<<24|f[g>>>16&255]<<16|f[h>>>8&255]<<8|f[k&255])^c[p++];a[b]=q;a[b+1]=s;a[b+2]=t;a[b+3]=n},keySize:8});u.AES=p._createHelper(d)})();

(function(e,r){"object"==typeof exports?module.exports=exports=r(require("./core")):"function"==typeof define&&define.amd?define(["./core"],r):r(e.CryptoJS)})(this,function(e){return function(r){var t=e,n=t.lib,i=n.WordArray,o=n.Hasher,s=t.algo,c=[],a=[];(function(){function e(e){for(var t=r.sqrt(e),n=2;t>=n;n++)if(!(e%n))return!1;return!0}function t(e){return 0|4294967296*(e-(0|e))}for(var n=2,i=0;64>i;)e(n)&&(8>i&&(c[i]=t(r.pow(n,.5))),a[i]=t(r.pow(n,1/3)),i++),n++})();var f=[],u=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(c.slice(0))},_doProcessBlock:function(e,r){for(var t=this._hash.words,n=t[0],i=t[1],o=t[2],s=t[3],c=t[4],u=t[5],d=t[6],p=t[7],h=0;64>h;h++){if(16>h)f[h]=0|e[r+h];else{var y=f[h-15],l=(y<<25|y>>>7)^(y<<14|y>>>18)^y>>>3,m=f[h-2],x=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;f[h]=l+f[h-7]+x+f[h-16]}var v=c&u^~c&d,q=n&i^n&o^i&o,g=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),_=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),b=p+_+v+a[h]+f[h],S=g+q;p=d,d=u,u=c,c=0|s+b,s=o,o=i,i=n,n=0|b+S}t[0]=0|t[0]+n,t[1]=0|t[1]+i,t[2]=0|t[2]+o,t[3]=0|t[3]+s,t[4]=0|t[4]+c,t[5]=0|t[5]+u,t[6]=0|t[6]+d,t[7]=0|t[7]+p},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[(i+64>>>9<<4)+14]=r.floor(n/4294967296),t[(i+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(u),t.HmacSHA256=o._createHmacHelper(u)}(Math),e.SHA256});
/*
* Fingerprintjs2 1.1.1 - Modern & flexible browser fingerprint library v2
* https://github.com/Valve/fingerprintjs2
* Copyright (c) 2015 Valentin Vasilyev (valentin.vasilyev@outlook.com)
* Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
* ARE DISCLAIMED. IN NO EVENT SHALL VALENTIN VASILYEV BE LIABLE FOR ANY
* DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
* THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

(function (name, context, definition) {
  "use strict";
  if (typeof module !== "undefined" && module.exports) { module.exports = definition(); }
  else if (typeof define === "function" && define.amd) { define(definition); }
  else { context[name] = definition(); }
})("Fingerprint2", this, function() {
  "use strict";
  // This will only be polyfilled for IE8 and older
  // Taken from Mozilla MDC
  if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function(searchElement, fromIndex) {
      var k;
      if (this == null) {
        throw new TypeError("'this' is null or undefined");
      }
      var O = Object(this);
      var len = O.length >>> 0;
      if (len === 0) {
        return -1;
      }
      var n = +fromIndex || 0;
      if (Math.abs(n) === Infinity) {
        n = 0;
      }
      if (n >= len) {
        return -1;
      }
      k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);
      while (k < len) {
        if (k in O && O[k] === searchElement) {
          return k;
        }
        k++;
      }
      return -1;
    };
  }
  var Fingerprint2 = function(options) {
    var defaultOptions = {
      swfContainerId: "fingerprintjs2",
      swfPath: "flash/compiled/FontList.swf",
      detectScreenOrientation: true,
      sortPluginsFor: [/palemoon/i]
    };
    this.options = this.extend(options, defaultOptions);
    this.nativeForEach = Array.prototype.forEach;
    this.nativeMap = Array.prototype.map;
  };
  Fingerprint2.prototype = {
    extend: function(source, target) {
      if (source == null) { return target; }
      for (var k in source) {
        if(source[k] != null && target[k] !== source[k]) {
          target[k] = source[k];
        }
      }
      return target;
    },
    log: function(msg){
      if(window.console){
        console.log(msg);
      }
    },
    get: function(done){
      var keys = [];
      keys = this.userAgentKey(keys);
      keys = this.languageKey(keys);
      keys = this.colorDepthKey(keys);
      keys = this.screenResolutionKey(keys);
      keys = this.availableScreenResolutionKey(keys);
      keys = this.timezoneOffsetKey(keys);
      keys = this.sessionStorageKey(keys);
      keys = this.localStorageKey(keys);
      keys = this.indexedDbKey(keys);
      keys = this.addBehaviorKey(keys);
      keys = this.openDatabaseKey(keys);
      keys = this.cpuClassKey(keys);
      keys = this.platformKey(keys);
      keys = this.doNotTrackKey(keys);
      keys = this.pluginsKey(keys);
      keys = this.canvasKey(keys);
      keys = this.webglKey(keys);
      keys = this.adBlockKey(keys);
      keys = this.hasLiedLanguagesKey(keys);
      keys = this.hasLiedResolutionKey(keys);
      keys = this.hasLiedOsKey(keys);
      keys = this.hasLiedBrowserKey(keys);
      keys = this.touchSupportKey(keys);
      var that = this;
      this.fontsKey(keys, function(newKeys){
        var values = [];
        that.each(newKeys, function(pair) {
          var value = pair.value;
          if (!pair.value) return;      //edit by Kotobee
          if (typeof pair.value.join !== "undefined") {
            value = pair.value.join(";");
          }
          values.push(value);
        });
        var murmur = that.x64hash128(values.join("~~~"), 31);
        return done(murmur, newKeys);
      });
    },
    userAgentKey: function(keys) {
      if(!this.options.excludeUserAgent) {
        keys.push({key: "user_agent", value: this.getUserAgent()});
      }
      return keys;
    },
    // for tests
    getUserAgent: function(){
      return navigator.userAgent;
    },
    languageKey: function(keys) {
      if(!this.options.excludeLanguage) {
        // IE 9,10 on Windows 10 does not have the `navigator.language` property any longer
        keys.push({ key: "language", value: navigator.language || navigator.userLanguage || navigator.browserLanguage || navigator.systemLanguage });
      }
      return keys;
    },
    colorDepthKey: function(keys) {
      if(!this.options.excludeColorDepth) {
        keys.push({key: "color_depth", value: screen.colorDepth});
      }
      return keys;
    },
    screenResolutionKey: function(keys) {
      if(!this.options.excludeScreenResolution) {
        return this.getScreenResolution(keys);
      }
      return keys;
    },
    getScreenResolution: function(keys) {
      var resolution;
      if(this.options.detectScreenOrientation) {
        resolution = (screen.height > screen.width) ? [screen.height, screen.width] : [screen.width, screen.height];
      } else {
        resolution = [screen.width, screen.height];
      }
      if(typeof resolution !== "undefined") { // headless browsers
        keys.push({key: "resolution", value: resolution});
      }
      return keys;
    },
    availableScreenResolutionKey: function(keys) {
      if (!this.options.excludeAvailableScreenResolution) {
        return this.getAvailableScreenResolution(keys);
      }
      return keys;
    },
    getAvailableScreenResolution: function(keys) {
      var available;
      if(screen.availWidth && screen.availHeight) {
        if(this.options.detectScreenOrientation) {
          available = (screen.availHeight > screen.availWidth) ? [screen.availHeight, screen.availWidth] : [screen.availWidth, screen.availHeight];
        } else {
          available = [screen.availHeight, screen.availWidth];
        }
      }
      if(typeof available !== "undefined") { // headless browsers
        keys.push({key: "available_resolution", value: available});
      }
      return keys;
    },
    timezoneOffsetKey: function(keys) {
      if(!this.options.excludeTimezoneOffset) {
        keys.push({key: "timezone_offset", value: new Date().getTimezoneOffset()});
      }
      return keys;
    },
    sessionStorageKey: function(keys) {
      if(!this.options.excludeSessionStorage && this.hasSessionStorage()) {
        keys.push({key: "session_storage", value: 1});
      }
      return keys;
    },
    localStorageKey: function(keys) {
      if(!this.options.excludeSessionStorage && this.hasLocalStorage()) {
        keys.push({key: "local_storage", value: 1});
      }
      return keys;
    },
    indexedDbKey: function(keys) {
      if(!this.options.excludeIndexedDB && this.hasIndexedDB()) {
        keys.push({key: "indexed_db", value: 1});
      }
      return keys;
    },
    addBehaviorKey: function(keys) {
      //body might not be defined at this point or removed programmatically
      if(document.body && !this.options.excludeAddBehavior && document.body.addBehavior) {
        keys.push({key: "add_behavior", value: 1});
      }
      return keys;
    },
    openDatabaseKey: function(keys) {
      if(!this.options.excludeOpenDatabase && window.openDatabase) {
        keys.push({key: "open_database", value: 1});
      }
      return keys;
    },
    cpuClassKey: function(keys) {
      if(!this.options.excludeCpuClass) {
        keys.push({key: "cpu_class", value: this.getNavigatorCpuClass()});
      }
      return keys;
    },
    platformKey: function(keys) {
      if(!this.options.excludePlatform) {
        keys.push({key: "navigator_platform", value: this.getNavigatorPlatform()});
      }
      return keys;
    },
    doNotTrackKey: function(keys) {
      if(!this.options.excludeDoNotTrack) {
        keys.push({key: "do_not_track", value: this.getDoNotTrack()});
      }
      return keys;
    },
    canvasKey: function(keys) {
      if(!this.options.excludeCanvas && this.isCanvasSupported()) {
        keys.push({key: "canvas", value: this.getCanvasFp()});
      }
      return keys;
    },
    webglKey: function(keys) {
      if(this.options.excludeWebGL) {
        if(typeof NODEBUG === "undefined"){
          this.log("Skipping WebGL fingerprinting per excludeWebGL configuration option");
        }
        return keys;
      }
      if(!this.isWebGlSupported()) {
        if(typeof NODEBUG === "undefined"){
          this.log("Skipping WebGL fingerprinting because it is not supported in this browser");
        }
        return keys;
      }
      keys.push({key: "webgl", value: this.getWebglFp()});
      return keys;
    },
    adBlockKey: function(keys){
      if(!this.options.excludeAdBlock) {
        keys.push({key: "adblock", value: this.getAdBlock()});
      }
      return keys;
    },
    hasLiedLanguagesKey: function(keys){
      if(!this.options.excludeHasLiedLanguages){
        keys.push({key: "has_lied_languages", value: this.getHasLiedLanguages()});
      }
      return keys;
    },
    hasLiedResolutionKey: function(keys){
      if(!this.options.excludeHasLiedResolution){
        keys.push({key: "has_lied_resolution", value: this.getHasLiedResolution()});
      }
      return keys;
    },
    hasLiedOsKey: function(keys){
      if(!this.options.excludeHasLiedOs){
        keys.push({key: "has_lied_os", value: this.getHasLiedOs()});
      }
      return keys;
    },
    hasLiedBrowserKey: function(keys){
      if(!this.options.excludeHasLiedBrowser){
        keys.push({key: "has_lied_browser", value: this.getHasLiedBrowser()});
      }
      return keys;
    },
    fontsKey: function(keys, done) {
      if (this.options.excludeJsFonts) {
        return this.flashFontsKey(keys, done);
      }
      return this.jsFontsKey(keys, done);
    },
    // flash fonts (will increase fingerprinting time 20X to ~ 130-150ms)
    flashFontsKey: function(keys, done) {
      if(this.options.excludeFlashFonts) {
        if(typeof NODEBUG === "undefined"){
          this.log("Skipping flash fonts detection per excludeFlashFonts configuration option");
        }
        return done(keys);
      }
      // we do flash if swfobject is loaded
      if(!this.hasSwfObjectLoaded()){
        if(typeof NODEBUG === "undefined"){
          this.log("Swfobject is not detected, Flash fonts enumeration is skipped");
        }
        return done(keys);
      }
      if(!this.hasMinFlashInstalled()){
        if(typeof NODEBUG === "undefined"){
          this.log("Flash is not installed, skipping Flash fonts enumeration");
        }
        return done(keys);
      }
      if(typeof this.options.swfPath === "undefined"){
        if(typeof NODEBUG === "undefined"){
          this.log("To use Flash fonts detection, you must pass a valid swfPath option, skipping Flash fonts enumeration");
        }
        return done(keys);
      }
      this.loadSwfAndDetectFonts(function(fonts){
        keys.push({key: "swf_fonts", value: fonts.join(";")});
        done(keys);
      });
    },
    // kudos to http://www.lalit.org/lab/javascript-css-font-detect/
    jsFontsKey: function(keys, done) {
      var that = this;
      // doing js fonts detection in a pseudo-async fashion
      return setTimeout(function(){

        // a font will be compared against all the three default fonts.
        // and if it doesn't match all 3 then that font is not available.
        var baseFonts = ["monospace", "sans-serif", "serif"];

        //we use m or w because these two characters take up the maximum width.
        // And we use a LLi so that the same matching fonts can get separated
        var testString = "mmmmmmmmmmlli";

        //we test using 72px font size, we may use any size. I guess larger the better.
        var testSize = "72px";

        var h = document.getElementsByTagName("body")[0];

        // create a SPAN in the document to get the width of the text we use to test
        var s = document.createElement("span");
        s.style.fontSize = testSize;
        s.innerHTML = testString;
        var defaultWidth = {};
        var defaultHeight = {};
        for (var index = 0, length = baseFonts.length; index < length; index++) {
            //get the default width for the three base fonts
            s.style.fontFamily = baseFonts[index];
            h.appendChild(s);
            defaultWidth[baseFonts[index]] = s.offsetWidth; //width for the default font
            defaultHeight[baseFonts[index]] = s.offsetHeight; //height for the defualt font
            h.removeChild(s);
        }
        var detect = function (font) {
            var detected = false;
            for (var index = 0, l = baseFonts.length; index < l; index++) {
                s.style.fontFamily = font + "," + baseFonts[index]; // name of the font along with the base font for fallback.
                h.appendChild(s);
                var matched = (s.offsetWidth !== defaultWidth[baseFonts[index]] || s.offsetHeight !== defaultHeight[baseFonts[index]]);
                h.removeChild(s);
                detected = detected || matched;
            }
            return detected;
        };
        var fontList = [
          "Andale Mono", "Arial", "Arial Black", "Arial Hebrew", "Arial MT", "Arial Narrow", "Arial Rounded MT Bold", "Arial Unicode MS",
          "Bitstream Vera Sans Mono", "Book Antiqua", "Bookman Old Style",
          "Calibri", "Cambria", "Cambria Math", "Century", "Century Gothic", "Century Schoolbook", "Comic Sans", "Comic Sans MS", "Consolas", "Courier", "Courier New",
          "Garamond", "Geneva", "Georgia",
          "Helvetica", "Helvetica Neue",
          "Impact",
          "Lucida Bright", "Lucida Calligraphy", "Lucida Console", "Lucida Fax", "LUCIDA GRANDE", "Lucida Handwriting", "Lucida Sans", "Lucida Sans Typewriter", "Lucida Sans Unicode",
          "Microsoft Sans Serif", "Monaco", "Monotype Corsiva", "MS Gothic", "MS Outlook", "MS PGothic", "MS Reference Sans Serif", "MS Sans Serif", "MS Serif", "MYRIAD", "MYRIAD PRO",
          "Palatino", "Palatino Linotype",
          "Segoe Print", "Segoe Script", "Segoe UI", "Segoe UI Light", "Segoe UI Semibold", "Segoe UI Symbol",
          "Tahoma", "Times", "Times New Roman", "Times New Roman PS", "Trebuchet MS",
          "Verdana", "Wingdings", "Wingdings 2", "Wingdings 3"
        ];
        var extendedFontList = [
          "Abadi MT Condensed Light", "Academy Engraved LET", "ADOBE CASLON PRO", "Adobe Garamond", "ADOBE GARAMOND PRO", "Agency FB", "Aharoni", "Albertus Extra Bold", "Albertus Medium", "Algerian", "Amazone BT", "American Typewriter",
          "American Typewriter Condensed", "AmerType Md BT", "Andalus", "Angsana New", "AngsanaUPC", "Antique Olive", "Aparajita", "Apple Chancery", "Apple Color Emoji", "Apple SD Gothic Neo", "Arabic Typesetting", "ARCHER",
           "ARNO PRO", "Arrus BT", "Aurora Cn BT", "AvantGarde Bk BT", "AvantGarde Md BT", "AVENIR", "Ayuthaya", "Bandy", "Bangla Sangam MN", "Bank Gothic", "BankGothic Md BT", "Baskerville",
          "Baskerville Old Face", "Batang", "BatangChe", "Bauer Bodoni", "Bauhaus 93", "Bazooka", "Bell MT", "Bembo", "Benguiat Bk BT", "Berlin Sans FB", "Berlin Sans FB Demi", "Bernard MT Condensed", "BernhardFashion BT", "BernhardMod BT", "Big Caslon", "BinnerD",
          "Blackadder ITC", "BlairMdITC TT", "Bodoni 72", "Bodoni 72 Oldstyle", "Bodoni 72 Smallcaps", "Bodoni MT", "Bodoni MT Black", "Bodoni MT Condensed", "Bodoni MT Poster Compressed",
          "Bookshelf Symbol 7", "Boulder", "Bradley Hand", "Bradley Hand ITC", "Bremen Bd BT", "Britannic Bold", "Broadway", "Browallia New", "BrowalliaUPC", "Brush Script MT", "Californian FB", "Calisto MT", "Calligrapher", "Candara",
          "CaslonOpnface BT", "Castellar", "Centaur", "Cezanne", "CG Omega", "CG Times", "Chalkboard", "Chalkboard SE", "Chalkduster", "Charlesworth", "Charter Bd BT", "Charter BT", "Chaucer",
          "ChelthmITC Bk BT", "Chiller", "Clarendon", "Clarendon Condensed", "CloisterBlack BT", "Cochin", "Colonna MT", "Constantia", "Cooper Black", "Copperplate", "Copperplate Gothic", "Copperplate Gothic Bold",
          "Copperplate Gothic Light", "CopperplGoth Bd BT", "Corbel", "Cordia New", "CordiaUPC", "Cornerstone", "Coronet", "Cuckoo", "Curlz MT", "DaunPenh", "Dauphin", "David", "DB LCD Temp", "DELICIOUS", "Denmark",
          "DFKai-SB", "Didot", "DilleniaUPC", "DIN", "DokChampa", "Dotum", "DotumChe", "Ebrima", "Edwardian Script ITC", "Elephant", "English 111 Vivace BT", "Engravers MT", "EngraversGothic BT", "Eras Bold ITC", "Eras Demi ITC", "Eras Light ITC", "Eras Medium ITC",
          "EucrosiaUPC", "Euphemia", "Euphemia UCAS", "EUROSTILE", "Exotc350 Bd BT", "FangSong", "Felix Titling", "Fixedsys", "FONTIN", "Footlight MT Light", "Forte",
          "FrankRuehl", "Fransiscan", "Freefrm721 Blk BT", "FreesiaUPC", "Freestyle Script", "French Script MT", "FrnkGothITC Bk BT", "Fruitger", "FRUTIGER",
          "Futura", "Futura Bk BT", "Futura Lt BT", "Futura Md BT", "Futura ZBlk BT", "FuturaBlack BT", "Gabriola", "Galliard BT", "Gautami", "Geeza Pro", "Geometr231 BT", "Geometr231 Hv BT", "Geometr231 Lt BT", "GeoSlab 703 Lt BT",
          "GeoSlab 703 XBd BT", "Gigi", "Gill Sans", "Gill Sans MT", "Gill Sans MT Condensed", "Gill Sans MT Ext Condensed Bold", "Gill Sans Ultra Bold", "Gill Sans Ultra Bold Condensed", "Gisha", "Gloucester MT Extra Condensed", "GOTHAM", "GOTHAM BOLD",
          "Goudy Old Style", "Goudy Stout", "GoudyHandtooled BT", "GoudyOLSt BT", "Gujarati Sangam MN", "Gulim", "GulimChe", "Gungsuh", "GungsuhChe", "Gurmukhi MN", "Haettenschweiler", "Harlow Solid Italic", "Harrington", "Heather", "Heiti SC", "Heiti TC", "HELV",
          "Herald", "High Tower Text", "Hiragino Kaku Gothic ProN", "Hiragino Mincho ProN", "Hoefler Text", "Humanst 521 Cn BT", "Humanst521 BT", "Humanst521 Lt BT", "Imprint MT Shadow", "Incised901 Bd BT", "Incised901 BT",
          "Incised901 Lt BT", "INCONSOLATA", "Informal Roman", "Informal011 BT", "INTERSTATE", "IrisUPC", "Iskoola Pota", "JasmineUPC", "Jazz LET", "Jenson", "Jester", "Jokerman", "Juice ITC", "Kabel Bk BT", "Kabel Ult BT", "Kailasa", "KaiTi", "Kalinga", "Kannada Sangam MN",
          "Kartika", "Kaufmann Bd BT", "Kaufmann BT", "Khmer UI", "KodchiangUPC", "Kokila", "Korinna BT", "Kristen ITC", "Krungthep", "Kunstler Script", "Lao UI", "Latha", "Leelawadee", "Letter Gothic", "Levenim MT", "LilyUPC", "Lithograph", "Lithograph Light", "Long Island",
          "Lydian BT", "Magneto", "Maiandra GD", "Malayalam Sangam MN", "Malgun Gothic",
          "Mangal", "Marigold", "Marion", "Marker Felt", "Market", "Marlett", "Matisse ITC", "Matura MT Script Capitals", "Meiryo", "Meiryo UI", "Microsoft Himalaya", "Microsoft JhengHei", "Microsoft New Tai Lue", "Microsoft PhagsPa", "Microsoft Tai Le",
          "Microsoft Uighur", "Microsoft YaHei", "Microsoft Yi Baiti", "MingLiU", "MingLiU_HKSCS", "MingLiU_HKSCS-ExtB", "MingLiU-ExtB", "Minion", "Minion Pro", "Miriam", "Miriam Fixed", "Mistral", "Modern", "Modern No. 20", "Mona Lisa Solid ITC TT", "Mongolian Baiti",
          "MONO", "MoolBoran", "Mrs Eaves", "MS LineDraw", "MS Mincho", "MS PMincho", "MS Reference Specialty", "MS UI Gothic", "MT Extra", "MUSEO", "MV Boli",
          "Nadeem", "Narkisim", "NEVIS", "News Gothic", "News GothicMT", "NewsGoth BT", "Niagara Engraved", "Niagara Solid", "Noteworthy", "NSimSun", "Nyala", "OCR A Extended", "Old Century", "Old English Text MT", "Onyx", "Onyx BT", "OPTIMA", "Oriya Sangam MN",
          "OSAKA", "OzHandicraft BT", "Palace Script MT", "Papyrus", "Parchment", "Party LET", "Pegasus", "Perpetua", "Perpetua Titling MT", "PetitaBold", "Pickwick", "Plantagenet Cherokee", "Playbill", "PMingLiU", "PMingLiU-ExtB",
          "Poor Richard", "Poster", "PosterBodoni BT", "PRINCETOWN LET", "Pristina", "PTBarnum BT", "Pythagoras", "Raavi", "Rage Italic", "Ravie", "Ribbon131 Bd BT", "Rockwell", "Rockwell Condensed", "Rockwell Extra Bold", "Rod", "Roman", "Sakkal Majalla",
          "Santa Fe LET", "Savoye LET", "Sceptre", "Script", "Script MT Bold", "SCRIPTINA", "Serifa", "Serifa BT", "Serifa Th BT", "ShelleyVolante BT", "Sherwood",
          "Shonar Bangla", "Showcard Gothic", "Shruti", "Signboard", "SILKSCREEN", "SimHei", "Simplified Arabic", "Simplified Arabic Fixed", "SimSun", "SimSun-ExtB", "Sinhala Sangam MN", "Sketch Rockwell", "Skia", "Small Fonts", "Snap ITC", "Snell Roundhand", "Socket",
          "Souvenir Lt BT", "Staccato222 BT", "Steamer", "Stencil", "Storybook", "Styllo", "Subway", "Swis721 BlkEx BT", "Swiss911 XCm BT", "Sylfaen", "Synchro LET", "System", "Tamil Sangam MN", "Technical", "Teletype", "Telugu Sangam MN", "Tempus Sans ITC",
          "Terminal", "Thonburi", "Traditional Arabic", "Trajan", "TRAJAN PRO", "Tristan", "Tubular", "Tunga", "Tw Cen MT", "Tw Cen MT Condensed", "Tw Cen MT Condensed Extra Bold",
          "TypoUpright BT", "Unicorn", "Univers", "Univers CE 55 Medium", "Univers Condensed", "Utsaah", "Vagabond", "Vani", "Vijaya", "Viner Hand ITC", "VisualUI", "Vivaldi", "Vladimir Script", "Vrinda", "Westminster", "WHITNEY", "Wide Latin",
          "ZapfEllipt BT", "ZapfHumnst BT", "ZapfHumnst Dm BT", "Zapfino", "Zurich BlkEx BT", "Zurich Ex BT", "ZWAdobeF"];

        if(that.options.extendedJsFonts) {
          fontList = fontList.concat(extendedFontList);
        }
        var available = [];
        for (var i = 0, l = fontList.length; i < l; i++) {
          if(detect(fontList[i])) {
            available.push(fontList[i]);
          }
        }
        keys.push({key: "js_fonts", value: available});
        done(keys);
      }, 1);
    },
    pluginsKey: function(keys) {
      if(!this.options.excludePlugins){
        if(this.isIE()){
          keys.push({key: "ie_plugins", value: this.getIEPlugins()});
        } else {
          keys.push({key: "regular_plugins", value: this.getRegularPlugins()});
        }
      }
      return keys;
    },
    getRegularPlugins: function () {
      var plugins = [];
      for(var i = 0, l = navigator.plugins.length; i < l; i++) {
        plugins.push(navigator.plugins[i]);
      }
      // sorting plugins only for those user agents, that we know randomize the plugins
      // every time we try to enumerate them
      if(this.pluginsShouldBeSorted()) {
        plugins = plugins.sort(function(a, b) {
          if(a.name > b.name){ return 1; }
          if(a.name < b.name){ return -1; }
          return 0;
        });
      }
      return this.map(plugins, function (p) {
        var mimeTypes = this.map(p, function(mt){
          return [mt.type, mt.suffixes].join("~");
        }).join(",");
        return [p.name, p.description, mimeTypes].join("::");
      }, this);
    },
    getIEPlugins: function () {
      var result = [];
      if((Object.getOwnPropertyDescriptor && Object.getOwnPropertyDescriptor(window, "ActiveXObject")) || ("ActiveXObject" in window)) {
        var names = [
          "AcroPDF.PDF", // Adobe PDF reader 7+
          "Adodb.Stream",
          "AgControl.AgControl", // Silverlight
          "DevalVRXCtrl.DevalVRXCtrl.1",
          "MacromediaFlashPaper.MacromediaFlashPaper",
          "Msxml2.DOMDocument",
          "Msxml2.XMLHTTP",
          "PDF.PdfCtrl", // Adobe PDF reader 6 and earlier, brrr
          "QuickTime.QuickTime", // QuickTime
          "QuickTimeCheckObject.QuickTimeCheck.1",
          "RealPlayer",
          "RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)",
          "RealVideo.RealVideo(tm) ActiveX Control (32-bit)",
          "Scripting.Dictionary",
          "SWCtl.SWCtl", // ShockWave player
          "Shell.UIHelper",
          "ShockwaveFlash.ShockwaveFlash", //flash plugin
          "Skype.Detection",
          "TDCCtl.TDCCtl",
          "WMPlayer.OCX", // Windows media player
          "rmocx.RealPlayer G2 Control",
          "rmocx.RealPlayer G2 Control.1"
        ];
        // starting to detect plugins in IE
        result = this.map(names, function(name) {
          try {
            new ActiveXObject(name); // eslint-disable-no-new
            return name;
          } catch(e) {
            return null;
          }
        });
      }
      if(navigator.plugins) {
        result = result.concat(this.getRegularPlugins());
      }
      return result;
    },
    pluginsShouldBeSorted: function () {
      var should = false;
      for(var i = 0, l = this.options.sortPluginsFor.length; i < l; i++) {
        var re = this.options.sortPluginsFor[i];
        if(navigator.userAgent.match(re)) {
          should = true;
          break;
        }
      }
      return should;
    },
    touchSupportKey: function (keys) {
      if(!this.options.excludeTouchSupport){
        keys.push({key: "touch_support", value: this.getTouchSupport()});
      }
      return keys;
    },
    hasSessionStorage: function () {
      try {
        return !!window.sessionStorage;
      } catch(e) {
        return true; // SecurityError when referencing it means it exists
      }
    },
    // https://bugzilla.mozilla.org/show_bug.cgi?id=781447
    hasLocalStorage: function () {
      try {
        return !!window.localStorage;
      } catch(e) {
        return true; // SecurityError when referencing it means it exists
      }
    },
    hasIndexedDB: function (){
      return !!window.indexedDB;
    },
    getNavigatorCpuClass: function () {
      if(navigator.cpuClass){
        return navigator.cpuClass;
      } else {
        return "unknown";
      }
    },
    getNavigatorPlatform: function () {
      if(navigator.platform) {
        return navigator.platform;
      } else {
        return "unknown";
      }
    },
    getDoNotTrack: function () {
      if(navigator.doNotTrack) {
        return navigator.doNotTrack;
      } else {
        return "unknown";
      }
    },
    // This is a crude and primitive touch screen detection.
    // It's not possible to currently reliably detect the  availability of a touch screen
    // with a JS, without actually subscribing to a touch event.
    // http://www.stucox.com/blog/you-cant-detect-a-touchscreen/
    // https://github.com/Modernizr/Modernizr/issues/548
    // method returns an array of 3 values:
    // maxTouchPoints, the success or failure of creating a TouchEvent,
    // and the availability of the 'ontouchstart' property
    getTouchSupport: function () {
      var maxTouchPoints = 0;
      var touchEvent = false;
      if(typeof navigator.maxTouchPoints !== "undefined") {
        maxTouchPoints = navigator.maxTouchPoints;
      } else if (typeof navigator.msMaxTouchPoints !== "undefined") {
        maxTouchPoints = navigator.msMaxTouchPoints;
      }
      try {
        document.createEvent("TouchEvent");
        touchEvent = true;
      } catch(_) { /* squelch */ }
      var touchStart = "ontouchstart" in window;
      return [maxTouchPoints, touchEvent, touchStart];
    },
    // https://www.browserleaks.com/canvas#how-does-it-work
    getCanvasFp: function() {
      var result = [];
      // Very simple now, need to make it more complex (geo shapes etc)
      var canvas = document.createElement("canvas");
      canvas.width = 2000;
      canvas.height = 200;
      canvas.style.display = "inline";
      var ctx = canvas.getContext("2d");
      // detect browser support of canvas winding
      // http://blogs.adobe.com/webplatform/2013/01/30/winding-rules-in-canvas/
      // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/canvas/winding.js
      ctx.rect(0, 0, 10, 10);
      ctx.rect(2, 2, 6, 6);
      result.push("canvas winding:" + ((ctx.isPointInPath(5, 5, "evenodd") === false) ? "yes" : "no"));

      ctx.textBaseline = "alphabetic";
      ctx.fillStyle = "#f60";
      ctx.fillRect(125, 1, 62, 20);
      ctx.fillStyle = "#069";
      // https://github.com/Valve/fingerprintjs2/issues/66
      if(this.options.dontUseFakeFontInCanvas) {
        ctx.font = "11pt Arial";
      } else {
        ctx.font = "11pt no-real-font-123";
      }
      ctx.fillText("Cwm fjordbank glyphs vext quiz, \ud83d\ude03", 2, 15);
      ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
      ctx.font = "18pt Arial";
      ctx.fillText("Cwm fjordbank glyphs vext quiz, \ud83d\ude03", 4, 45);

      // canvas blending
      // http://blogs.adobe.com/webplatform/2013/01/28/blending-features-in-canvas/
      // http://jsfiddle.net/NDYV8/16/
      ctx.globalCompositeOperation = "multiply";
      ctx.fillStyle = "rgb(255,0,255)";
      ctx.beginPath();
      ctx.arc(50, 50, 50, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = "rgb(0,255,255)";
      ctx.beginPath();
      ctx.arc(100, 50, 50, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = "rgb(255,255,0)";
      ctx.beginPath();
      ctx.arc(75, 100, 50, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = "rgb(255,0,255)";
      // canvas winding
      // http://blogs.adobe.com/webplatform/2013/01/30/winding-rules-in-canvas/
      // http://jsfiddle.net/NDYV8/19/
      ctx.arc(75, 75, 75, 0, Math.PI * 2, true);
      ctx.arc(75, 75, 25, 0, Math.PI * 2, true);
      ctx.fill("evenodd");

      result.push("canvas fp:" + canvas.toDataURL());
      return result.join("~");
    },

    getWebglFp: function() {
      var gl;
      var fa2s = function(fa) {
        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        gl.enable(gl.DEPTH_TEST);
        gl.depthFunc(gl.LEQUAL);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        return "[" + fa[0] + ", " + fa[1] + "]";
      };
      var maxAnisotropy = function(gl) {
        var anisotropy, ext = gl.getExtension("EXT_texture_filter_anisotropic") || gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic") || gl.getExtension("MOZ_EXT_texture_filter_anisotropic");
        return ext ? (anisotropy = gl.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT), 0 === anisotropy && (anisotropy = 2), anisotropy) : null;
      };
      gl = this.getWebglCanvas();
      if(!gl) { return null; }
      // WebGL fingerprinting is a combination of techniques, found in MaxMind antifraud script & Augur fingerprinting.
      // First it draws a gradient object with shaders and convers the image to the Base64 string.
      // Then it enumerates all WebGL extensions & capabilities and appends them to the Base64 string, resulting in a huge WebGL string, potentially very unique on each device
      // Since iOS supports webgl starting from version 8.1 and 8.1 runs on several graphics chips, the results may be different across ios devices, but we need to verify it.
      var result = [];
      var vShaderTemplate = "attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}";
      var fShaderTemplate = "precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}";
      var vertexPosBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, vertexPosBuffer);
      var vertices = new Float32Array([-.2, -.9, 0, .4, -.26, 0, 0, .732134444, 0]);
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
      vertexPosBuffer.itemSize = 3;
      vertexPosBuffer.numItems = 3;
      var program = gl.createProgram(), vshader = gl.createShader(gl.VERTEX_SHADER);
      gl.shaderSource(vshader, vShaderTemplate);
      gl.compileShader(vshader);
      var fshader = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(fshader, fShaderTemplate);
      gl.compileShader(fshader);
      gl.attachShader(program, vshader);
      gl.attachShader(program, fshader);
      gl.linkProgram(program);
      gl.useProgram(program);
      program.vertexPosAttrib = gl.getAttribLocation(program, "attrVertex");
      program.offsetUniform = gl.getUniformLocation(program, "uniformOffset");
      gl.enableVertexAttribArray(program.vertexPosArray);
      gl.vertexAttribPointer(program.vertexPosAttrib, vertexPosBuffer.itemSize, gl.FLOAT, !1, 0, 0);
      gl.uniform2f(program.offsetUniform, 1, 1);
      gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertexPosBuffer.numItems);
      if (gl.canvas != null) { result.push(gl.canvas.toDataURL()); }
      result.push("extensions:" + gl.getSupportedExtensions().join(";"));
      result.push("webgl aliased line width range:" + fa2s(gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE)));
      result.push("webgl aliased point size range:" + fa2s(gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE)));
      result.push("webgl alpha bits:" + gl.getParameter(gl.ALPHA_BITS));
      result.push("webgl antialiasing:" + (gl.getContextAttributes().antialias ? "yes" : "no"));
      result.push("webgl blue bits:" + gl.getParameter(gl.BLUE_BITS));
      result.push("webgl depth bits:" + gl.getParameter(gl.DEPTH_BITS));
      result.push("webgl green bits:" + gl.getParameter(gl.GREEN_BITS));
      result.push("webgl max anisotropy:" + maxAnisotropy(gl));
      result.push("webgl max combined texture image units:" + gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS));
      result.push("webgl max cube map texture size:" + gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE));
      result.push("webgl max fragment uniform vectors:" + gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS));
      result.push("webgl max render buffer size:" + gl.getParameter(gl.MAX_RENDERBUFFER_SIZE));
      result.push("webgl max texture image units:" + gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS));
      result.push("webgl max texture size:" + gl.getParameter(gl.MAX_TEXTURE_SIZE));
      result.push("webgl max varying vectors:" + gl.getParameter(gl.MAX_VARYING_VECTORS));
      result.push("webgl max vertex attribs:" + gl.getParameter(gl.MAX_VERTEX_ATTRIBS));
      result.push("webgl max vertex texture image units:" + gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS));
      result.push("webgl max vertex uniform vectors:" + gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS));
      result.push("webgl max viewport dims:" + fa2s(gl.getParameter(gl.MAX_VIEWPORT_DIMS)));
      result.push("webgl red bits:" + gl.getParameter(gl.RED_BITS));
      result.push("webgl renderer:" + gl.getParameter(gl.RENDERER));
      result.push("webgl shading language version:" + gl.getParameter(gl.SHADING_LANGUAGE_VERSION));
      result.push("webgl stencil bits:" + gl.getParameter(gl.STENCIL_BITS));
      result.push("webgl vendor:" + gl.getParameter(gl.VENDOR));
      result.push("webgl version:" + gl.getParameter(gl.VERSION));

      if (!gl.getShaderPrecisionFormat) {
        if (typeof NODEBUG === "undefined") {
          this.log("WebGL fingerprinting is incomplete, because your browser does not support getShaderPrecisionFormat");
        }
        return result.join("~");
      }

      result.push("webgl vertex shader high float precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT ).precision);
      result.push("webgl vertex shader high float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT ).rangeMin);
      result.push("webgl vertex shader high float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT ).rangeMax);
      result.push("webgl vertex shader medium float precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT ).precision);
      result.push("webgl vertex shader medium float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT ).rangeMin);
      result.push("webgl vertex shader medium float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT ).rangeMax);
      result.push("webgl vertex shader low float precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT ).precision);
      result.push("webgl vertex shader low float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT ).rangeMin);
      result.push("webgl vertex shader low float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT ).rangeMax);
      result.push("webgl fragment shader high float precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT ).precision);
      result.push("webgl fragment shader high float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT ).rangeMin);
      result.push("webgl fragment shader high float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT ).rangeMax);
      result.push("webgl fragment shader medium float precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT ).precision);
      result.push("webgl fragment shader medium float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT ).rangeMin);
      result.push("webgl fragment shader medium float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT ).rangeMax);
      result.push("webgl fragment shader low float precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT ).precision);
      result.push("webgl fragment shader low float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT ).rangeMin);
      result.push("webgl fragment shader low float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT ).rangeMax);
      result.push("webgl vertex shader high int precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT ).precision);
      result.push("webgl vertex shader high int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT ).rangeMin);
      result.push("webgl vertex shader high int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT ).rangeMax);
      result.push("webgl vertex shader medium int precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT ).precision);
      result.push("webgl vertex shader medium int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT ).rangeMin);
      result.push("webgl vertex shader medium int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT ).rangeMax);
      result.push("webgl vertex shader low int precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT ).precision);
      result.push("webgl vertex shader low int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT ).rangeMin);
      result.push("webgl vertex shader low int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT ).rangeMax);
      result.push("webgl fragment shader high int precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT ).precision);
      result.push("webgl fragment shader high int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT ).rangeMin);
      result.push("webgl fragment shader high int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT ).rangeMax);
      result.push("webgl fragment shader medium int precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT ).precision);
      result.push("webgl fragment shader medium int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT ).rangeMin);
      result.push("webgl fragment shader medium int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT ).rangeMax);
      result.push("webgl fragment shader low int precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT ).precision);
      result.push("webgl fragment shader low int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT ).rangeMin);
      result.push("webgl fragment shader low int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT ).rangeMax);
      return result.join("~");
    },
    getAdBlock: function(){
      var ads = document.createElement("div");
      ads.setAttribute("id", "ads");
      try {
        // body may not exist, that's why we need try/catch
        document.body.appendChild(ads);
        return document.getElementById("ads") ? false : true;
      } catch (e) {
        return false;
      }
    },
    getHasLiedLanguages: function(){
      //We check if navigator.language is equal to the first language of navigator.languages
      if(typeof navigator.languages !== "undefined"){
        try {
          var firstLanguages = navigator.languages[0].substr(0, 2);
          if(firstLanguages !== navigator.language.substr(0, 2)){
            return true;
          }
        } catch(err){
          return true;
        }
      }
      return false;
    },
    getHasLiedResolution: function(){
      if(screen.width < screen.availWidth){
        return true;
      }
      if(screen.height < screen.availHeight){
        return true;
      }
      return false;
    },
    getHasLiedOs: function(){
      var userAgent = navigator.userAgent.toLowerCase();
      var oscpu = navigator.oscpu;
      var platform = navigator.platform.toLowerCase();
      var os;
      //We extract the OS from the user agent (respect the order of the if else if statement)
      if(userAgent.indexOf("windows phone") >= 0){
        os = "Windows Phone";
      } else if(userAgent.indexOf("win") >= 0){
        os = "Windows";
      } else if(userAgent.indexOf("android") >= 0){
        os = "Android";
      } else if(userAgent.indexOf("linux") >= 0){
        os = "Linux";
      } else if(userAgent.indexOf("iphone") >= 0 || userAgent.indexOf("ipad") >= 0 ){
        os = "iOS";
      } else if(userAgent.indexOf("mac") >= 0){
        os = "Mac";
      } else{
        os = "Other";
      }
      // We detect if the person uses a mobile device
      var mobileDevice;
      if (("ontouchstart" in window) ||
           (navigator.maxTouchPoints > 0) ||
           (navigator.msMaxTouchPoints > 0)) {
            mobileDevice = true;
      } else{
        mobileDevice = false;
      }

      if(mobileDevice && os !== "Windows Phone" && os !== "Android" && os !== "iOS" && os !== "Other"){
        return true;
      }

      // We compare oscpu with the OS extracted from the UA
      if(typeof oscpu !== "undefined"){
        oscpu = oscpu.toLowerCase();
        if(oscpu.indexOf("win") >= 0 && os !== "Windows" && os !== "Windows Phone"){
          return true;
        } else if(oscpu.indexOf("linux") >= 0 && os !== "Linux" && os !== "Android"){
          return true;
        } else if(oscpu.indexOf("mac") >= 0 && os !== "Mac" && os !== "iOS"){
          return true;
        } else if(oscpu.indexOf("win") === 0 && oscpu.indexOf("linux") === 0 && oscpu.indexOf("mac") >= 0 && os !== "other"){
          return true;
        }
      }

      //We compare platform with the OS extracted from the UA
      if(platform.indexOf("win") >= 0 && os !== "Windows" && os !== "Windows Phone"){
        return true;
      } else if((platform.indexOf("linux") >= 0 || platform.indexOf("android") >= 0 || platform.indexOf("pike") >= 0) && os !== "Linux" && os !== "Android"){
        return true;
      } else if((platform.indexOf("mac") >= 0 || platform.indexOf("ipad") >= 0 || platform.indexOf("ipod") >= 0 || platform.indexOf("iphone") >= 0) && os !== "Mac" && os !== "iOS"){
        return true;
      } else if(platform.indexOf("win") === 0 && platform.indexOf("linux") === 0 && platform.indexOf("mac") >= 0 && os !== "other"){
        return true;
      }

      if(typeof navigator.plugins === "undefined" && os !== "Windows" && os !== "Windows Phone"){
        //We are are in the case where the person uses ie, therefore we can infer that it's windows
        return true;
      }

      return false;
    },
    getHasLiedBrowser: function () {
      var userAgent = navigator.userAgent.toLowerCase();
      var productSub = navigator.productSub;

      //we extract the browser from the user agent (respect the order of the tests)
      var browser;
      if(userAgent.indexOf("firefox") >= 0){
        browser = "Firefox";
      } else if(userAgent.indexOf("opera") >= 0 || userAgent.indexOf("opr") >= 0){
        browser = "Opera";
      } else if(userAgent.indexOf("chrome") >= 0){
        browser = "Chrome";
      } else if(userAgent.indexOf("safari") >= 0){
        browser = "Safari";
      } else if(userAgent.indexOf("trident") >= 0){
        browser = "Internet Explorer";
      } else{
        browser = "Other";
      }

      if((browser === "Chrome" || browser === "Safari" || browser === "Opera") && productSub !== "20030107"){
        return true;
      }

      var tempRes = eval.toString().length;
      if(tempRes === 37 && browser !== "Safari" && browser !== "Firefox" && browser !== "Other"){
        return true;
      } else if(tempRes === 39 && browser !== "Internet Explorer" && browser !== "Other"){
        return true;
      } else if(tempRes === 33 && browser !== "Chrome" && browser !== "Opera" && browser !== "Other"){
        return true;
      }

      //We create an error to see how it is handled
      var errFirefox;
      try {
        throw "a";
      } catch(err){
        try{
          err.toSource();
          errFirefox = true;
        } catch(errOfErr){
          errFirefox = false;
        }
      }
      if(errFirefox && browser !== "Firefox" && browser !== "Other"){
        return true;
      }
      return false;
    },
    isCanvasSupported: function () {
      var elem = document.createElement("canvas");
      return !!(elem.getContext && elem.getContext("2d"));
    },
    isWebGlSupported: function() {
      // code taken from Modernizr
      if (!this.isCanvasSupported()) {
        return false;
      }

      var canvas = document.createElement("canvas"),
          glContext;

      try {
        glContext = canvas.getContext && (canvas.getContext("webgl") || canvas.getContext("experimental-webgl"));
      } catch(e) {
        glContext = false;
      }

      return !!window.WebGLRenderingContext && !!glContext;
    },
    isIE: function () {
      if(navigator.appName === "Microsoft Internet Explorer") {
        return true;
      } else if(navigator.appName === "Netscape" && /Trident/.test(navigator.userAgent)) { // IE 11
        return true;
      }
      return false;
    },
    hasSwfObjectLoaded: function(){
      return typeof window.swfobject !== "undefined";
    },
    hasMinFlashInstalled: function () {
      return swfobject.hasFlashPlayerVersion("9.0.0");
    },
    addFlashDivNode: function() {
      var node = document.createElement("div");
      node.setAttribute("id", this.options.swfContainerId);
      document.body.appendChild(node);
    },
    loadSwfAndDetectFonts: function(done) {
      var hiddenCallback = "___fp_swf_loaded";
      window[hiddenCallback] = function(fonts) {
        done(fonts);
      };
      var id = this.options.swfContainerId;
      this.addFlashDivNode();
      var flashvars = { onReady: hiddenCallback};
      var flashparams = { allowScriptAccess: "always", menu: "false" };
      swfobject.embedSWF(this.options.swfPath, id, "1", "1", "9.0.0", false, flashvars, flashparams, {});
    },
    getWebglCanvas: function() {
      var canvas = document.createElement("canvas");
      var gl = null;
      try {
        gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
      } catch(e) { /* squelch */ }
      if (!gl) { gl = null; }
      return gl;
    },
    each: function (obj, iterator, context) {
      if (obj === null) {
        return;
      }
      if (this.nativeForEach && obj.forEach === this.nativeForEach) {
        obj.forEach(iterator, context);
      } else if (obj.length === +obj.length) {
        for (var i = 0, l = obj.length; i < l; i++) {
          if (iterator.call(context, obj[i], i, obj) === {}) { return; }
        }
      } else {
        for (var key in obj) {
          if (obj.hasOwnProperty(key)) {
            if (iterator.call(context, obj[key], key, obj) === {}) { return; }
          }
        }
      }
    },

    map: function(obj, iterator, context) {
      var results = [];
      // Not using strict equality so that this acts as a
      // shortcut to checking for `null` and `undefined`.
      if (obj == null) { return results; }
      if (this.nativeMap && obj.map === this.nativeMap) { return obj.map(iterator, context); }
      this.each(obj, function(value, index, list) {
        results[results.length] = iterator.call(context, value, index, list);
      });
      return results;
    },

    /// MurmurHash3 related functions

    //
    // Given two 64bit ints (as an array of two 32bit ints) returns the two
    // added together as a 64bit int (as an array of two 32bit ints).
    //
    x64Add: function(m, n) {
      m = [m[0] >>> 16, m[0] & 0xffff, m[1] >>> 16, m[1] & 0xffff];
      n = [n[0] >>> 16, n[0] & 0xffff, n[1] >>> 16, n[1] & 0xffff];
      var o = [0, 0, 0, 0];
      o[3] += m[3] + n[3];
      o[2] += o[3] >>> 16;
      o[3] &= 0xffff;
      o[2] += m[2] + n[2];
      o[1] += o[2] >>> 16;
      o[2] &= 0xffff;
      o[1] += m[1] + n[1];
      o[0] += o[1] >>> 16;
      o[1] &= 0xffff;
      o[0] += m[0] + n[0];
      o[0] &= 0xffff;
      return [(o[0] << 16) | o[1], (o[2] << 16) | o[3]];
    },

    //
    // Given two 64bit ints (as an array of two 32bit ints) returns the two
    // multiplied together as a 64bit int (as an array of two 32bit ints).
    //
    x64Multiply: function(m, n) {
      m = [m[0] >>> 16, m[0] & 0xffff, m[1] >>> 16, m[1] & 0xffff];
      n = [n[0] >>> 16, n[0] & 0xffff, n[1] >>> 16, n[1] & 0xffff];
      var o = [0, 0, 0, 0];
      o[3] += m[3] * n[3];
      o[2] += o[3] >>> 16;
      o[3] &= 0xffff;
      o[2] += m[2] * n[3];
      o[1] += o[2] >>> 16;
      o[2] &= 0xffff;
      o[2] += m[3] * n[2];
      o[1] += o[2] >>> 16;
      o[2] &= 0xffff;
      o[1] += m[1] * n[3];
      o[0] += o[1] >>> 16;
      o[1] &= 0xffff;
      o[1] += m[2] * n[2];
      o[0] += o[1] >>> 16;
      o[1] &= 0xffff;
      o[1] += m[3] * n[1];
      o[0] += o[1] >>> 16;
      o[1] &= 0xffff;
      o[0] += (m[0] * n[3]) + (m[1] * n[2]) + (m[2] * n[1]) + (m[3] * n[0]);
      o[0] &= 0xffff;
      return [(o[0] << 16) | o[1], (o[2] << 16) | o[3]];
    },
    //
    // Given a 64bit int (as an array of two 32bit ints) and an int
    // representing a number of bit positions, returns the 64bit int (as an
    // array of two 32bit ints) rotated left by that number of positions.
    //
    x64Rotl: function(m, n) {
      n %= 64;
      if (n === 32) {
        return [m[1], m[0]];
      }
      else if (n < 32) {
        return [(m[0] << n) | (m[1] >>> (32 - n)), (m[1] << n) | (m[0] >>> (32 - n))];
      }
      else {
        n -= 32;
        return [(m[1] << n) | (m[0] >>> (32 - n)), (m[0] << n) | (m[1] >>> (32 - n))];
      }
    },
    //
    // Given a 64bit int (as an array of two 32bit ints) and an int
    // representing a number of bit positions, returns the 64bit int (as an
    // array of two 32bit ints) shifted left by that number of positions.
    //
    x64LeftShift: function(m, n) {
      n %= 64;
      if (n === 0) {
        return m;
      }
      else if (n < 32) {
        return [(m[0] << n) | (m[1] >>> (32 - n)), m[1] << n];
      }
      else {
        return [m[1] << (n - 32), 0];
      }
    },
    //
    // Given two 64bit ints (as an array of two 32bit ints) returns the two
    // xored together as a 64bit int (as an array of two 32bit ints).
    //
    x64Xor: function(m, n) {
      return [m[0] ^ n[0], m[1] ^ n[1]];
    },
    //
    // Given a block, returns murmurHash3's final x64 mix of that block.
    // (`[0, h[0] >>> 1]` is a 33 bit unsigned right shift. This is the
    // only place where we need to right shift 64bit ints.)
    //
    x64Fmix: function(h) {
      h = this.x64Xor(h, [0, h[0] >>> 1]);
      h = this.x64Multiply(h, [0xff51afd7, 0xed558ccd]);
      h = this.x64Xor(h, [0, h[0] >>> 1]);
      h = this.x64Multiply(h, [0xc4ceb9fe, 0x1a85ec53]);
      h = this.x64Xor(h, [0, h[0] >>> 1]);
      return h;
    },

    //
    // Given a string and an optional seed as an int, returns a 128 bit
    // hash using the x64 flavor of MurmurHash3, as an unsigned hex.
    //
    x64hash128: function (key, seed) {
      key = key || "";
      seed = seed || 0;
      var remainder = key.length % 16;
      var bytes = key.length - remainder;
      var h1 = [0, seed];
      var h2 = [0, seed];
      var k1 = [0, 0];
      var k2 = [0, 0];
      var c1 = [0x87c37b91, 0x114253d5];
      var c2 = [0x4cf5ad43, 0x2745937f];
      for (var i = 0; i < bytes; i = i + 16) {
        k1 = [((key.charCodeAt(i + 4) & 0xff)) | ((key.charCodeAt(i + 5) & 0xff) << 8) | ((key.charCodeAt(i + 6) & 0xff) << 16) | ((key.charCodeAt(i + 7) & 0xff) << 24), ((key.charCodeAt(i) & 0xff)) | ((key.charCodeAt(i + 1) & 0xff) << 8) | ((key.charCodeAt(i + 2) & 0xff) << 16) | ((key.charCodeAt(i + 3) & 0xff) << 24)];
        k2 = [((key.charCodeAt(i + 12) & 0xff)) | ((key.charCodeAt(i + 13) & 0xff) << 8) | ((key.charCodeAt(i + 14) & 0xff) << 16) | ((key.charCodeAt(i + 15) & 0xff) << 24), ((key.charCodeAt(i + 8) & 0xff)) | ((key.charCodeAt(i + 9) & 0xff) << 8) | ((key.charCodeAt(i + 10) & 0xff) << 16) | ((key.charCodeAt(i + 11) & 0xff) << 24)];
        k1 = this.x64Multiply(k1, c1);
        k1 = this.x64Rotl(k1, 31);
        k1 = this.x64Multiply(k1, c2);
        h1 = this.x64Xor(h1, k1);
        h1 = this.x64Rotl(h1, 27);
        h1 = this.x64Add(h1, h2);
        h1 = this.x64Add(this.x64Multiply(h1, [0, 5]), [0, 0x52dce729]);
        k2 = this.x64Multiply(k2, c2);
        k2 = this.x64Rotl(k2, 33);
        k2 = this.x64Multiply(k2, c1);
        h2 = this.x64Xor(h2, k2);
        h2 = this.x64Rotl(h2, 31);
        h2 = this.x64Add(h2, h1);
        h2 = this.x64Add(this.x64Multiply(h2, [0, 5]), [0, 0x38495ab5]);
      }
      k1 = [0, 0];
      k2 = [0, 0];
      switch(remainder) {
        case 15:
          k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 14)], 48));
        case 14:
          k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 13)], 40));
        case 13:
          k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 12)], 32));
        case 12:
          k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 11)], 24));
        case 11:
          k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 10)], 16));
        case 10:
          k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 9)], 8));
        case 9:
          k2 = this.x64Xor(k2, [0, key.charCodeAt(i + 8)]);
          k2 = this.x64Multiply(k2, c2);
          k2 = this.x64Rotl(k2, 33);
          k2 = this.x64Multiply(k2, c1);
          h2 = this.x64Xor(h2, k2);
        case 8:
          k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 7)], 56));
        case 7:
          k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 6)], 48));
        case 6:
          k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 5)], 40));
        case 5:
          k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 4)], 32));
        case 4:
          k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 3)], 24));
        case 3:
          k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 2)], 16));
        case 2:
          k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 1)], 8));
        case 1:
          k1 = this.x64Xor(k1, [0, key.charCodeAt(i)]);
          k1 = this.x64Multiply(k1, c1);
          k1 = this.x64Rotl(k1, 31);
          k1 = this.x64Multiply(k1, c2);
          h1 = this.x64Xor(h1, k1);
      }
      h1 = this.x64Xor(h1, [0, key.length]);
      h2 = this.x64Xor(h2, [0, key.length]);
      h1 = this.x64Add(h1, h2);
      h2 = this.x64Add(h2, h1);
      h1 = this.x64Fmix(h1);
      h2 = this.x64Fmix(h2);
      h1 = this.x64Add(h1, h2);
      h2 = this.x64Add(h2, h1);
      return ("00000000" + (h1[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h1[1] >>> 0).toString(16)).slice(-8) + ("00000000" + (h2[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h2[1] >>> 0).toString(16)).slice(-8);
    }
  };
  Fingerprint2.VERSION = "1.1.1";
  return Fingerprint2;
});

/* Modernizr 2.8.3 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-backgroundsize-borderradius-opacity-rgba-canvas-audio-video-localstorage-shiv-cssclasses-testprop-testallprops-prefixes-domprefixes-load
 */
window.Modernizr=function(a,b,c){function y(a){j.cssText=a}function z(a,b){return y(m.join(a+";")+(b||""))}function A(a,b){return typeof a===b}function B(a,b){return!!~(""+a).indexOf(b)}function C(a,b){for(var d in a){var e=a[d];if(!B(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function D(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:A(f,"function")?f.bind(d||b):f}return!1}function E(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+o.join(d+" ")+d).split(" ");return A(b,"string")||A(b,"undefined")?C(e,b):(e=(a+" "+p.join(d+" ")+d).split(" "),D(e,b,c))}var d="2.8.3",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k,l={}.toString,m=" -webkit- -moz- -o- -ms- ".split(" "),n="Webkit Moz O ms",o=n.split(" "),p=n.toLowerCase().split(" "),q={},r={},s={},t=[],u=t.slice,v,w={}.hasOwnProperty,x;!A(w,"undefined")&&!A(w.call,"undefined")?x=function(a,b){return w.call(a,b)}:x=function(a,b){return b in a&&A(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=u.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(u.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(u.call(arguments)))};return e}),q.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},q.rgba=function(){return y("background-color:rgba(150,255,150,.5)"),B(j.backgroundColor,"rgba")},q.backgroundsize=function(){return E("backgroundSize")},q.borderradius=function(){return E("borderRadius")},q.opacity=function(){return z("opacity:.55"),/^0.55$/.test(j.opacity)},q.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},q.audio=function(){var a=b.createElement("audio"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(d){}return c},q.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}};for(var F in q)x(q,F)&&(v=F.toLowerCase(),e[v]=q[F](),t.push((e[v]?"":"no-")+v));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)x(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},y(""),i=k=null,function(a,b){function l(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function m(){var a=s.elements;return typeof a=="string"?a.split(" "):a}function n(a){var b=j[a[h]];return b||(b={},i++,a[h]=i,j[i]=b),b}function o(a,c,d){c||(c=b);if(k)return c.createElement(a);d||(d=n(c));var g;return d.cache[a]?g=d.cache[a].cloneNode():f.test(a)?g=(d.cache[a]=d.createElem(a)).cloneNode():g=d.createElem(a),g.canHaveChildren&&!e.test(a)&&!g.tagUrn?d.frag.appendChild(g):g}function p(a,c){a||(a=b);if(k)return a.createDocumentFragment();c=c||n(a);var d=c.frag.cloneNode(),e=0,f=m(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function q(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?o(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+m().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function r(a){a||(a=b);var c=n(a);return s.shivCSS&&!g&&!c.hasCSS&&(c.hasCSS=!!l(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||q(a,c),a}var c="3.7.0",d=a.html5||{},e=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g,h="_html5shiv",i=0,j={},k;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",g="hidden"in a,k=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){g=!0,k=!0}})();var s={elements:d.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:c,shivCSS:d.shivCSS!==!1,supportsUnknownElements:k,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:r,createElement:o,createDocumentFragment:p};a.html5=s,r(b)}(this,b),e._version=d,e._prefixes=m,e._domPrefixes=p,e._cssomPrefixes=o,e.testProp=function(a){return C([a])},e.testAllProps=E,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+t.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};
/**
 * optimized UAParser library to suit our needs https://github.com/faisalman/ua-parser-js
 * 
 * @example 
 * var uaParser = new UAParser();
 * var os = uaParser.getOSDetails();
 * var browser = uaParser.getBrowserDetails();
 */
function UAParser() {
    this.ua = typeof window != "undefined" && window.navigator && window.navigator.userAgent ? window.navigator.userAgent : "";
    this.UNKNOWN = '?';
    this.OBJ_TYPE = 'object';
    this.STR_TYPE = 'string';
    this.NAME = 'name';
    this.VERSION = 'version';
    this.BLACKBERRY = 'BlackBerry';
    this.BROWSER = 'Browser';
    this.CHROME = 'Chrome';
    this.FIREFOX = 'Firefox';
    this.OPERA = 'Opera';
  
    // Safari < 3.0
    this.oldSafariMap = {
      '1.0': '/8',
      '1.2': '/1',
      '1.3': '/3',
      '2.0': '/412',
      '2.0.2': '/416',
      '2.0.3': '/417',
      '2.0.4': '/419',
      '?': '/'
    };
  
    this.windowsVersionMap = {
      'ME': '4.90',
      'NT 3.11': 'NT3.51',
      'NT 4.0': 'NT4.0',
      '2000': 'NT 5.0',
      'XP': ['NT 5.1', 'NT 5.2'],
      'Vista': 'NT 6.0',
      '7': 'NT 6.1',
      '8': 'NT 6.2',
      '8.1': 'NT 6.3',
      '10': ['NT 6.4', 'NT 10.0'],
      'RT': 'ARM'
    };
  
    this.regexes = {
      browser: [
        [
          /\b(?:crmo|crios)\/([\w\.]+)/i // Chrome for Android/iOS
        ],
        [this.VERSION, [this.NAME, 'Chrome']],
        [
          /edg(?:e|ios|a)?\/([\w\.]+)/i // Microsoft Edge
        ],
        [this.VERSION, [this.NAME, 'Edge']],
        [
          // Presto based
          /(opera mini)\/([-\w\.]+)/i, // Opera Mini
          /(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i, // Opera Mobi/Tablet
          /(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i // Opera
        ],
        [this.NAME, this.VERSION],
        [
          /opios[\/ ]+([\w\.]+)/i // Opera mini on iphone >= 8.0
        ],
        [this.VERSION, [this.NAME, this.OPERA + ' Mini']],
        [
          /\bopr\/([\w\.]+)/i // Opera Webkit
        ],
        [this.VERSION, [this.NAME, this.OPERA]],
        [
          // Mixed
          /(kindle)\/([\w\.]+)/i, // Kindle
          /(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i, // Lunascape/Maxthon/Netfront/Jasmine/Blazer
          // Trident based
          /(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i, // Avant/IEMobile/SlimBrowser
          /(ba?idubrowser)[\/ ]?([\w\.]+)/i, // Baidu Browser
          /(?:ms|\()(ie) ([\w\.]+)/i, // Internet Explorer
          // Webkit/KHTML based                                               // Flock/RockMelt/Midori/Epiphany/Silk/Skyfire/Bolt/Iron/Iridium/PhantomJS/Bowser/QupZilla/Falkon
          /(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,
          // Rekonq/Puffin/Brave/Whale/QQBrowserLite/QQ, aka ShouQ
          /(weibo)__([\d\.]+)/i // Weibo
        ],
        [this.NAME, this.VERSION],
        [
          /(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i // UCBrowser
        ],
        [this.VERSION, [this.NAME, 'UC' + this.BROWSER]],
        [
          /\bqbcore\/([\w\.]+)/i // WeChat Desktop for Windows Built-in Browser
        ],
        [this.VERSION, [this.NAME, 'WeChat(Win) Desktop']],
        [
          /micromessenger\/([\w\.]+)/i // WeChat
        ],
        [this.VERSION, [this.NAME, 'WeChat']],
        [
          /konqueror\/([\w\.]+)/i // Konqueror
        ],
        [this.VERSION, [this.NAME, 'Konqueror']],
        [
          /trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i // IE11
        ],
        [this.VERSION, [this.NAME, 'IE']],
        [
          /yabrowser\/([\w\.]+)/i // Yandex
        ],
        [this.VERSION, [this.NAME, 'Yandex']],
        [
          /(avast|avg)\/([\w\.]+)/i // Avast/AVG Secure Browser
        ],
        [
          [this.NAME, /(.+)/, '$1 Secure ' + this.BROWSER], this.VERSION
        ],
        [
          /\bfocus\/([\w\.]+)/i // Firefox Focus
        ],
        [this.VERSION, [this.NAME, this.FIREFOX + ' Focus']],
        [
          /\bopt\/([\w\.]+)/i // Opera Touch
        ],
        [this.VERSION, [this.NAME, this.OPERA + ' Touch']],
        [
          /coc_coc\w+\/([\w\.]+)/i // Coc Coc Browser
        ],
        [this.VERSION, [this.NAME, 'Coc Coc']],
        [
          /dolfin\/([\w\.]+)/i // Dolphin
        ],
        [this.VERSION, [this.NAME, 'Dolphin']],
        [
          /coast\/([\w\.]+)/i // Opera Coast
        ],
        [this.VERSION, [this.NAME, this.OPERA + ' Coast']],
        [
          /miuibrowser\/([\w\.]+)/i // MIUI Browser
        ],
        [this.VERSION, [this.NAME, 'MIUI ' + this.BROWSER]],
        [
          /fxios\/([-\w\.]+)/i // Firefox for iOS
        ],
        [this.VERSION, [this.NAME, this.FIREFOX]],
        [
          /\bqihu|(qi?ho?o?|360)browser/i // 360
        ],
        [
          [this.NAME, '360 ' + this.BROWSER]
        ],
        [
          /(oculus|samsung|sailfish)browser\/([\w\.]+)/i
        ],
        [
          [this.NAME, /(.+)/, '$1 ' + this.BROWSER], this.VERSION
        ],
        [ // Oculus/Samsung/Sailfish Browser
          /(comodo_dragon)\/([\w\.]+)/i // Comodo Dragon
        ],
        [
          [this.NAME, /_/g, ' '], this.VERSION
        ],
        [
          /(electron)\/([\w\.]+) safari/i, // Electron-based App
          /(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i, // Tesla
          /m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i // QQBrowser/Baidu App/2345 Browser
        ],
        [this.NAME, this.VERSION],
        [
          /(metasr)[\/ ]?([\w\.]+)/i, // SouGouBrowser
          /(lbbrowser)/i // LieBao Browser
        ],
        [this.NAME],
        [
          // WebView
          /((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i // Facebook App for iOS & Android
        ],
        [
          [this.NAME, 'Facebook'], this.VERSION
        ],
        [
          /safari (line)\/([\w\.]+)/i, // Line App for iOS
          /\b(line)\/([\w\.]+)\/iab/i, // Line App for Android
          /(chromium|instagram)[\/ ]([-\w\.]+)/i // Chromium/Instagram
        ],
        [this.NAME, this.VERSION],
        [
          /\bgsa\/([\w\.]+) .*safari\//i // Google Search Appliance on iOS
        ],
        [this.VERSION, [this.NAME, 'GSA']],
        [
          /headlesschrome(?:\/([\w\.]+)| )/i // Chrome Headless
        ],
        [this.VERSION, [this.NAME, this.CHROME + ' Headless']],
        [
          / wv\).+(chrome)\/([\w\.]+)/i // Chrome WebView
        ],
        [
          [this.NAME, this.CHROME + ' WebView'], this.VERSION
        ],
        [
          /droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i // Android Browser
        ],
        [this.VERSION, [this.NAME, 'Android ' + this.BROWSER]],
        [
          /(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i // Chrome/OmniWeb/Arora/Tizen/Nokia
        ],
        [this.NAME, this.VERSION],
        [
          /version\/([\w\.]+) .*mobile\/\w+ (safari)/i // Mobile Safari
        ],
        [this.VERSION, [this.NAME, 'Mobile Safari']],
        [
          /version\/([\w\.]+) .*(mobile ?safari|safari)/i // Safari & Safari Mobile
        ],
        [this.VERSION, this.NAME],
        [
          /webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i // Safari < 3.0
        ],
        [this.NAME, [this.VERSION, this.strMapper, this.oldSafariMap]],
        [
          /(webkit|khtml)\/([\w\.]+)/i
        ],
        [this.NAME, this.VERSION],
        [
          // Gecko based
          /(navigator|netscape\d?)\/([-\w\.]+)/i // Netscape
        ],
        [
          [this.NAME, 'Netscape'], this.VERSION
        ],
        [
          /mobile vr; rv:([\w\.]+)\).+firefox/i // Firefox Reality
        ],
        [this.VERSION, [this.NAME, this.FIREFOX + ' Reality']],
        [
          /ekiohf.+(flow)\/([\w\.]+)/i, // Flow
          /(swiftfox)/i, // Swiftfox
          /(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,
          // IceDragon/Iceweasel/Camino/Chimera/Fennec/Maemo/Minimo/Conkeror/Klar
          /(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,
          // Firefox/SeaMonkey/K-Meleon/IceCat/IceApe/Firebird/Phoenix
          /(firefox)\/([\w\.]+)/i, // Other Firefox-based
          /(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i, // Mozilla
  
          // Other
          /(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,
          // Polaris/Lynx/Dillo/iCab/Doris/Amaya/w3m/NetSurf/Sleipnir/Obigo/Mosaic/Go/ICE/UP.Browser
          /(links) \(([\w\.]+)/i // Links
        ],
        [this.NAME, this.VERSION]
      ],
      os: [
        [
          // Windows
          /microsoft (windows) (vista|xp)/i // Windows (iTunes)
        ],
        [this.NAME, this.VERSION],
        [
          /(windows) nt 6\.2; (arm)/i, // Windows RT
          /(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i, // Windows Phone
          /(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i
        ],
        [this.NAME, [this.VERSION, this.strMapper, this.windowsVersionMap]],
        [
          /(win(?=3|9|n)|win 9x )([nt\d\.]+)/i
        ],
        [
          [this.NAME, 'Windows'],
          [this.VERSION, this.strMapper, this.windowsVersionMap]
        ],
        [
          // iOS/macOS
          /ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i, // iOS
          /cfnetwork\/.+darwin/i
        ],
        [
          [this.VERSION, /_/g, '.'],
          [this.NAME, 'iOS']
        ],
        [
          /(mac os x) ?([\w\. ]*)/i,
          /(macintosh|mac_powerpc\b)(?!.+haiku)/i // Mac OS
        ],
        [
          [this.NAME, 'Mac OS'],
          [this.VERSION, /_/g, '.']
        ],
        [
          // Mobile OSes
          /droid ([\w\.]+)\b.+(android[- ]x86)/i // Android-x86
        ],
        [this.VERSION, this.NAME],
        [ // Android/WebOS/QNX/Bada/RIM/Maemo/MeeGo/Sailfish OS
          /(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,
          /(blackberry)\w*\/([\w\.]*)/i, // Blackberry
          /(tizen|kaios)[\/ ]([\w\.]+)/i, // Tizen/KaiOS
          /\((series40);/i // Series 40
        ],
        [this.NAME, this.VERSION],
        [
          /\(bb(10);/i // BlackBerry 10
        ],
        [this.VERSION, [this.NAME, this.BLACKBERRY]],
        [
          /(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i // Symbian
        ],
        [this.VERSION, [this.NAME, 'Symbian']],
        [
          /mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i // Firefox OS
        ],
        [this.VERSION, [this.NAME, this.FIREFOX + ' OS']],
        [
          /web0s;.+rt(tv)/i,
          /\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i // WebOS
        ],
        [this.VERSION, [this.NAME, 'webOS']],
        [
          // Google Chromecast
          /crkey\/([\d\.]+)/i // Google Chromecast
        ],
        [this.VERSION, [this.NAME, this.CHROME + 'cast']],
        [
          /(cros) [\w]+ ([\w\.]+\w)/i // Chromium OS
        ],
        [
          [this.NAME, 'Chromium OS'], this.VERSION
        ],
        [
          // Console
          /(nintendo|playstation) ([wids345portablevuch]+)/i, // Nintendo/Playstation
          /(xbox); +xbox ([^\);]+)/i, // Microsoft Xbox (360, One, X, S, Series X, Series S)
          // Other
          /\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i, // Joli/Palm
          /(mint)[\/\(\) ]?(\w*)/i, // Mint
          /(mageia|vectorlinux)[; ]/i, // Mageia/VectorLinux
          /([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,
          // Ubuntu/Debian/SUSE/Gentoo/Arch/Slackware/Fedora/Mandriva/CentOS/PCLinuxOS/RedHat/Zenwalk/Linpus/Raspbian/Plan9/Minix/RISCOS/Contiki/Deepin/Manjaro/elementary/Sabayon/Linspire
          /(hurd|linux) ?([\w\.]*)/i, // Hurd/Linux
          /(gnu) ?([\w\.]*)/i, // GNU
          /\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i, // FreeBSD/NetBSD/OpenBSD/PC-BSD/GhostBSD/DragonFly
          /(haiku) (\w+)/i // Haiku
        ],
        [this.NAME, this.VERSION],
        [
          /(sunos) ?([\w\.\d]*)/i // Solaris
        ],
        [
          [this.NAME, 'Solaris'], this.VERSION
        ],
        [
          /((?:open)?solaris)[-\/ ]?([\w\.]*)/i, // Solaris
          /(aix) ((\d)(?=\.|\)| )[\w\.])*/i, // AIX
          /\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i, // BeOS/OS2/AmigaOS/MorphOS/OpenVMS/Fuchsia/HP-UX
          /(unix) ?([\w\.]*)/i // UNIX
        ],
        [this.NAME, this.VERSION]
      ]
    };
  
    this.has = function (str1, str2) {
      return typeof str1 === this.STR_TYPE ? str2.toLowerCase().indexOf(str1.toLowerCase()) !== -1 : false;
    };
  
    this.strMapper = function (str, map) {
      for (var i in map) {
        // check if current value is array
        if (typeof map[i] === this.OBJ_TYPE && map[i].length > 0) {
          for (var j = 0; j < map[i].length; j++) {
            if (this.has(map[i][j], str)) {
              return (i === this.UNKNOWN) ? undefined : i;
            }
          }
        } else if (this.has(map[i], str)) {
          return (i === this.UNKNOWN) ? undefined : i;
        }
      }
      return str;
    };
  
    this.rgxMapper = function (obj, ua, arrays) {
      var i = 0,
        j,
        k,
        p,
        q,
        matches,
        match;
  
      // loop through all regexes maps
      while (i < arrays.length && !matches) {
        var regex = arrays[i], // even sequence (0,2,4,..)
          props = arrays[i + 1]; // odd sequence (1,3,5,..)
        j = k = 0;
  
        // try matching uastring with regexes
        while (j < regex.length && !matches) {
          matches = regex[j++].exec(ua);
  
          if (!!matches) {
            for (p = 0; p < props.length; p++) {
              match = matches[++k];
              q = props[p];
              // check if given property is actually array
              if (typeof q === this.OBJ_TYPE && q.length > 0) {
                if (q.length == 2) {
                  if (typeof q[1] == "function") {
                    // assign modified match
                    obj[q[0]] = q[1].call(obj, match);
                  } else {
                    // assign given value, ignore regex match
                    obj[q[0]] = q[1];
                  }
                } else if (q.length == 3) {
                  // check whether function or regex
                  if (typeof q[1] === "function" && !(q[1].exec && q[1].test)) {
                    // call function (usually string mapper)
                    obj[q[0]] = match ? q[1].call(obj, match, q[2]) : undefined;
                  } else {
                    // sanitize match using given regex
                    obj[q[0]] = match ? match.replace(q[1], q[2]) : undefined;
                  }
                } else if (q.length == 4) {
                  obj[q[0]] = match ? q[3].call(obj, match.replace(q[1], q[2])) : undefined;
                }
              } else {
                obj[q] = match ? match : undefined;
              }
            }
          }
        }
        i += 2;
      }
    }
  
    this.getBrowserDetails = function () {
      var browser = {};
      browser.name = undefined;
      browser.version = undefined;
      this.rgxMapper(browser, this.ua, this.regexes.browser);
      return browser;
    }
  
    this.getOSDetails = function () {
      var os = {};
      os.name = undefined;
      os.version = undefined;
      this.rgxMapper(os, this.ua, this.regexes.os);
      return os;
    };
  
}
/*! (c) Andrea Giammarchi - ISC */
var self=this||{};try{!function(t,e){if(new t("q=%2B").get("q")!==e||new t({q:e}).get("q")!==e||new t([["q",e]]).get("q")!==e||"q=%0A"!==new t("q=\n").toString()||"q=+%26"!==new t({q:" &"}).toString()||"q=%25zx"!==new t({q:"%zx"}).toString())throw t;self.URLSearchParams=t}(URLSearchParams,"+")}catch(t){!function(t,a,o){"use strict";var u=t.create,h=t.defineProperty,e=/[!'\(\)~]|%20|%00/g,n=/%(?![0-9a-fA-F]{2})/g,r=/\+/g,i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},s={append:function(t,e){p(this._ungap,t,e)},delete:function(t){delete this._ungap[t]},get:function(t){return this.has(t)?this._ungap[t][0]:null},getAll:function(t){return this.has(t)?this._ungap[t].slice(0):[]},has:function(t){return t in this._ungap},set:function(t,e){this._ungap[t]=[a(e)]},forEach:function(e,n){var r=this;for(var i in r._ungap)r._ungap[i].forEach(t,i);function t(t){e.call(n,t,a(i),r)}},toJSON:function(){return{}},toString:function(){var t=[];for(var e in this._ungap)for(var n=v(e),r=0,i=this._ungap[e];r<i.length;r++)t.push(n+"="+v(i[r]));return t.join("&")}};for(var c in s)h(f.prototype,c,{configurable:!0,writable:!0,value:s[c]});function f(t){var e=u(null);switch(h(this,"_ungap",{value:e}),!0){case!t:break;case"string"==typeof t:"?"===t.charAt(0)&&(t=t.slice(1));for(var n=t.split("&"),r=0,i=n.length;r<i;r++){var a=(s=n[r]).indexOf("=");-1<a?p(e,g(s.slice(0,a)),g(s.slice(a+1))):s.length&&p(e,g(s),"")}break;case o(t):for(r=0,i=t.length;r<i;r++){var s;p(e,(s=t[r])[0],s[1])}break;case"forEach"in t:t.forEach(l,e);break;default:for(var c in t)p(e,c,t[c])}}function l(t,e){p(this,e,t)}function p(t,e,n){var r=o(n)?n.join(","):n;e in t?t[e].push(r):t[e]=[r]}function g(t){return decodeURIComponent(t.replace(n,"%25").replace(r," "))}function v(t){return encodeURIComponent(t).replace(e,d)}function d(t){return i[t]}self.URLSearchParams=f}(Object,String,Array.isArray)}!function(d){var r=!1;try{r=!!Symbol.iterator}catch(t){}function t(t,e){var n=[];return t.forEach(e,n),r?n[Symbol.iterator]():{next:function(){var t=n.shift();return{done:void 0===t,value:t}}}}"forEach"in d||(d.forEach=function(n,r){var i=this,t=Object.create(null);this.toString().replace(/=[\s\S]*?(?:&|$)/g,"=").split("=").forEach(function(e){!e.length||e in t||(t[e]=i.getAll(e)).forEach(function(t){n.call(r,t,e,i)})})}),"keys"in d||(d.keys=function(){return t(this,function(t,e){this.push(e)})}),"values"in d||(d.values=function(){return t(this,function(t,e){this.push(t)})}),"entries"in d||(d.entries=function(){return t(this,function(t,e){this.push([e,t])})}),!r||Symbol.iterator in d||(d[Symbol.iterator]=d.entries),"sort"in d||(d.sort=function(){for(var t,e,n,r=this.entries(),i=r.next(),a=i.done,s=[],c=Object.create(null);!a;)e=(n=i.value)[0],s.push(e),e in c||(c[e]=[]),c[e].push(n[1]),a=(i=r.next()).done;for(s.sort(),t=0;t<s.length;t++)this.delete(s[t]);for(t=0;t<s.length;t++)e=s[t],this.append(e,c[e].shift())}),function(f){function l(t){var e=t.append;t.append=d.append,URLSearchParams.call(t,t._usp.search.slice(1)),t.append=e}function p(t,e){if(!(t instanceof e))throw new TypeError("'searchParams' accessed on an object that does not implement interface "+e.name)}function t(e){var n,r,i,t=e.prototype,a=v(t,"searchParams"),s=v(t,"href"),c=v(t,"search");function o(t,e){d.append.call(this,t,e),t=this.toString(),i.set.call(this._usp,t?"?"+t:"")}function u(t){d.delete.call(this,t),t=this.toString(),i.set.call(this._usp,t?"?"+t:"")}function h(t,e){d.set.call(this,t,e),t=this.toString(),i.set.call(this._usp,t?"?"+t:"")}!a&&c&&c.set&&(i=c,r=function(t,e){return t.append=o,t.delete=u,t.set=h,g(t,"_usp",{configurable:!0,writable:!0,value:e})},n=function(t,e){return g(t,"_searchParams",{configurable:!0,writable:!0,value:r(e,t)}),e},f.defineProperties(t,{href:{get:function(){return s.get.call(this)},set:function(t){var e=this._searchParams;s.set.call(this,t),e&&l(e)}},search:{get:function(){return c.get.call(this)},set:function(t){var e=this._searchParams;c.set.call(this,t),e&&l(e)}},searchParams:{get:function(){return p(this,e),this._searchParams||n(this,new URLSearchParams(this.search.slice(1)))},set:function(t){p(this,e),n(this,t)}}}))}var g=f.defineProperty,v=f.getOwnPropertyDescriptor;try{t(HTMLAnchorElement),/^function|object$/.test(typeof URL)&&URL.prototype&&t(URL)}catch(t){}}(Object)}(self.URLSearchParams.prototype,Object);
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function getElementsByAttribute(e,t,n,o){for(var i,r,a="*"==t&&e.all?e.all:e.getElementsByTagName(t),s=new Array,c=void 0!==o?new RegExp("(^|\\s)"+o+"(\\s|$)","i"):null,l=0;l<a.length;l++)"string"==typeof(r=(i=a[l]).getAttribute&&i.getAttribute(n))&&r.length>0&&(void 0===o||c&&c.test(r))&&s.push(i);return s}function toggleClass(e,t){strHasClass(e.className,t)?removeClass(e,t):addClass(e,t)}function addRemoveClass(e,t,n){var o=e.className,i=!0;if(t)for(var r=0;r<t.length;r++)strHasClass(o,t[r])||(i=!1,o+=(""==o?"":" ")+t[r]);if(n)for(r=0;r<n.length;r++)strHasClass(o,n[r])&&(i=!1,o=strRemoveClass(o,n[r]));i||(e.className=o.trim())}function addClass(e,t){var n=e.className.trim();if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)strHasClass(n,t[i])||(o=!1,n+=(""==n?"":" ")+t[i]);if(o)return}else{if(strHasClass(n,t))return;n+=(""==n?"":" ")+t}e.className=n}function removeClass(e,t){var n=e.className;if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)strHasClass(n,t[i])&&(o=!1,n=strRemoveClass(n,t[i]));if(o)return}else{if(!strHasClass(n,t))return;n=strRemoveClass(n,t)}""==(n=n.trim())?e.removeAttribute("class"):e.className=n}function getClassThatStartsWith(e,t){for(var n=e.className.trim().split(" "),o=0;o<n.length;o++)if(n[o].indexOf(t)>-1)return n[o]}function hasClass(e,t){var n=e.className;return e instanceof SVGElement&&(n=n.baseVal),strHasClass(n,t)}function strHasClass(e,t){e||(e="");for(var n=e.trim().split(" "),o=0;o<n.length;o++)if(n[o]==t)return!0;return!1}function strRemoveClass(e,t){e||(e="");for(var n=e.trim().split(" "),o=0;o<n.length;o++)n[o]==t&&(n[o]=null);return n.join(" ")}function shouldParse(e){if(!isAbsoluteURLPath(e)&&0!=e.indexOf("/")&&0!=e.indexOf("#dontparse"))return!0}function removeElement(e){e&&e.parentNode&&e.parentNode.removeChild(e)}!function(e){var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var o,i=document.implementation.createHTMLDocument(""),r=i.documentElement;return r.innerHTML=e,o=r.firstElementChild,1===r.childElementCount&&"html"===o.localName.toLowerCase()&&i.replaceChild(o,r),i}return n.apply(this,arguments)}}(DOMParser),ph={},ph.removeHash=function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},ph.getHash=function(e){if(e.indexOf("#")>=0)return e.substr(e.lastIndexOf("#")+1)},ph.normalize=function(e){var t=ph.normalizedArray(e).join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(t="file:///"+t),t},ph.normalizedArray=function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&n>0&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/kotobee:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"chrome-extension:"==t[0]&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t},ph.basename=function(e){if(-1==e.indexOf("/"))return e;var t=ph.normalizedArray(e);return t[t.length-1]},ph.removeBase=function(e){var t=ph.normalizedArray(e);t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(n="/"+n),n},ph.removeFilename=function(e){var t=ph.normalizedArray(e);if(-1==t[t.length-1].indexOf("."))return e;t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(n="/"+n),n},ph.removeExtension=function(e){if(-1==e.indexOf("."))return e;var t=e.split(".");return t.splice(t.length-1,1),t.join(".")},ph.getExtension=function(e){if(-1==e.indexOf("."))return"";var t=e.split(".");return t[t.length-1]},ph.dirname=function(e){if(-1==e.indexOf("/"))return e;var t=ph.normalizedArray(e);return t[t.length-1].indexOf(".")>=0&&t.splice(t.length-1,1),1==t.length?t[0]:t[t.length-1]},ph.relative=function(e,t){var n,o,i=ph.normalizedArray(e),r=ph.normalizedArray(t),a=new Array;for(i[i.length-1].indexOf(".")>=0&&i.splice(i.length-1,1),n=0;n<i.length&&i[n]==r[n];n++);for(o=n;o<i.length;o++)a.push("..");for(o=n;o<r.length;o++)a.push(r[o]);return a.join("/")},ph.join=function(){for(var e=new Array,t=0;t<arguments.length;t++){var n=ph.normalizedArray(arguments[t]);t<arguments.length-1&&!isAbsoluteURLPath(n[n.length-1])&&n[n.length-1].indexOf(".")>=0&&n.splice(n.length-1,1),e=e.concat(n)}var o=ph.normalize(e.join("/"));return"/"==arguments[0].substr(0,1)&&(o=desktop?"file:////"+o:"/"+o),o},ph.parent=function(e){e=ph.removeFilename(e);var t=ph.normalizedArray(e);t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(n="/"+n),n};var startDate=Date.now(),LoggerWorker,loggerWorker,kLog=function(e){if(debug){null==e&&(e="null"),debugDuration&&(e=Date.now()-startDate+" "+String(e));try{if(loggerWorker)return void loggerWorker.postMessage({func:"log",params:arguments})}catch(e){}try{console.log.apply(this,arguments)}catch(e){}}},log=kLog;function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function randStr(e,t){return null==t&&(t="s"),t+Math.random().toString(36).substring(5).substr(0,e)}function getDateTime(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),i=e.getHours(),r=e.getMinutes(),a=e.getSeconds();if(1==n.toString().length)n="0"+n;if(1==o.toString().length)o="0"+o;if(1==i.toString().length)i="0"+i;if(1==r.toString().length)r="0"+r;if(1==a.toString().length)a="0"+a;return t+"/"+n+"/"+o+" "+i+":"+r+":"+a}function getFormData(e){e||(e={});var t=new FormData;for(var n in e)e[n]&&t.append(n,e[n]);return t}function newBlob(e,t){try{return new Blob([e],{type:t})}catch(o){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==o.name&&window.BlobBuilder){var n=new BlobBuilder;return n.append(e.buffer),n.getBlob(t)}if("InvalidStateError"==o.name)return new Blob([e.buffer],{type:t})}}var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=e.length/4*3,n=new ArrayBuffer(t);return this.decode(e,n),n},decode:function(e,t){var n,o,i,r,a,s,c,l=this._keyStr.indexOf(e.charAt(e.length-1)),d=this._keyStr.indexOf(e.charAt(e.length-2)),u=e.length/4*3;64==l&&u--,64==d&&u--;var p=0,f=0;for(n=t?new Uint8Array(t):new Uint8Array(u),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;p<u;p+=3)o=this._keyStr.indexOf(e.charAt(f++))<<2|(a=this._keyStr.indexOf(e.charAt(f++)))>>4,i=(15&a)<<4|(s=this._keyStr.indexOf(e.charAt(f++)))>>2,r=(3&s)<<6|(c=this._keyStr.indexOf(e.charAt(f++))),n[p]=o,64!=s&&(n[p+1]=i),64!=c&&(n[p+2]=r);return n}},currentIndex,currentVIndex;function arrayBufferToBuffer(e){for(var t=new Buffer(e.byteLength),n=new Uint8Array(e),o=0;o<t.length;++o)t[o]=n[o];return t}function clone(e){if(null==e||"object"!=_typeof(e))return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=clone(e[n]));return t}function rgb2hex(e){if(/^#[0-9A-F]{6}$/i.test(e))return e;function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+t(e[1])+t(e[2])+t(e[3]):void 0}function timeOut(e,t){var n=setInterval((function(){clearInterval(n),e()}),t);return n}function wrapNode(e,t){var n=document.createRange();n.selectNode(e),n.surroundContents(document.createElement(t))}function wrapNodeFromTo(e,t,n,o){var i=document.createRange();i.setStart(e,n),i.setEnd(e,o),i.surroundContents(document.createElement(t))}function XMLEscape(e,t){for(var n="",o=0;o<e.length;o++){var i=e.charAt(o);n+="&"==i?"&amp;":"'"==i?t?"&apos;":"&#39;":i}return n}function replaceHTML(e,t){var n="string"==typeof e?document.getElementById(e):e,o=n.cloneNode(!1);return o.innerHTML=t,n.parentNode.replaceChild(o,n),o}function kTemplate(e,t){return"web"==t?"templates/"+e:mobile||"mobile"==t?"templates/"+e.replace(".html",".mobile.html"):"templates/"+e}function arrayContainsProperty(e,t,n){for(var o=0;o<e.length;o++)if(e[o][t]==n)return!0;return!1}function cacheBust(e){if(desktop&&(0==e.indexOf("/")||0==e.indexOf("file://")||0==e.indexOf("chrome-extension://")))return e;var t="?";return e.indexOf("?")>=0&&(t="&"),e+t+Math.floor(9999*Math.random())}function addPrefixedEvent(e,t,n){for(var o=["webkit","moz","MS","o",""],i=0;i<o.length;i++)o[i]||(t=t.toLowerCase()),e.addEventListener(o[i]+t,n,!1)}function removePrefixedEvent(e,t,n){for(var o=["webkit","moz","MS","o",""],i=0;i<o.length;i++)o[i]||(t=t.toLowerCase()),e.removeEventListener(o[i]+t,n,!1)}function redrawForChrome(e){e||(e=document.body),-1!=navigator.userAgent.toLowerCase().indexOf("chrome")&&(e.style.display="inline-block",e.offsetHeight,e.style.display="")}function pauseVideoAndAudio(e){e||(e=document);for(var t=e.getElementsByTagName("audio"),n=t.length;n--;)try{t[n].pause()}catch(e){}var o=e.getElementsByTagName("video");for(n=o.length;n--;)try{o[n].pause()}catch(e){}}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}function asyncCheck(e,t,n,o){return e?o():(n.push(o),t.apply(this,n))}function autoprefixTransform(e,t){t||(t=""),e.style.transform=e.style.msTransform=e.style.webkitTransform=e.style.mozTransform=t}function deleteTransform(e){e&&(e.style.transform=e.style.msTransform=e.style.webkitTransform=e.style.mozTransform=null)}function deleteTransformOrigin(e){e&&(e.style.transformOrigin=e.style.msTransformOrigin=e.style.webkitTransformOrigin=e.style.mozTransformOrigin=null)}function getChildIndex(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t}function getFilteredChildIndex(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}function autoprefixTransformOrigin(e,t){t||(t=""),e.style.transformOrigin=e.style.msTransformOrigin=e.style.webkitTransformOrigin=e.style.mozTransformOrigin=t}function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return!0;if(e.indexOf("Trident/")>0)return!0;e.indexOf("Edge/");return!1}function getImgDataSrc(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){var e=new FileReader;e.onloadend=function(){t&&t(e.result)},e.readAsDataURL(n.response)},n.send()}function isAbsoluteURLPath(e){return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||(0==e.trim().indexOf("file://")||(0==e.trim().indexOf("kotobee://")||(0==e.trim().indexOf("chrome-extension://")||(!!e.trim().match(/^[A-Z]:\//g)||void 0)))))))}function isAbsoluteURLAndNotDataPath(e){return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("file://")||(0==e.trim().indexOf("kotobee://")||(0==e.trim().indexOf("chrome-extension://")||void 0)))))}function isKotobeeBooks(e){e||(e=window.location.href);var t=e.split("://");if(!(t.length<=1)){var n=t[1];return 0==n.indexOf("dev.books.kotobee.com")||(0==n.indexOf("books.kotobee.com")||(0==n.indexOf("books-test.kotobee.com")||void 0))}}function isKotobeeHosted(e){e||(e=window.location.href);var t=e.split("://");if(!(t.length<=1)){var n=t[1];if(0==n.indexOf("dev.books.kotobee.com"))return!0;if(0==n.indexOf("books.kotobee.com"))return!0;if(0==n.indexOf("books-test.kotobee.com"))return!0;for(var o=["kotobee.com"],i=0;i<o.length;i++){if(n.indexOf(o[i]+"/ebook")>=0)return!0;if(n.indexOf(o[i]+"/library")>=0)return!0;if(n.indexOf(o[i]+"/lti")>=0)return!0}var r="kotobee.com";"undefined"!=typeof hostingDomain&&hostingDomain&&0==(r=hostingDomain.replace(/https?:\/\//g,"")).indexOf("www.")&&(r=r.substr(4)),"undefined"==typeof hostUrlMode&&(hostUrlMode="subdomain");var a="folder"==hostUrlMode?"":".";if(e.indexOf(a+r)>=0){if("folder"==hostUrlMode)return!0;var s=r.replace(".","\\."),c=new RegExp("https?:\\/\\/(.*?\\.)"+s+".*","g"),l=e.replace(c,"$1");if(l){var d=l.replace(/(.*?)\./g,"$1");if(r.indexOf("kotobee.com")>=0){if("www"==d)return!1;if("dev"==d)return!1;if("test"==d)return!1;if("qa"==d)return!1;if("books-test"==d)return!1;if("moodle-test"==d)return!1}else if("www"==d)return!1;return!0}}}}function decodeHTMLEntities(e){for(var t=[["amp","&"],["apos","'"],["#x27","'"],["#x2F","/"],["#39","'"],["#47","/"],["lt","<"],["gt",">"],["nbsp"," "],["quot",'"']],n=0,o=t.length;n<o;++n)e=e.replace(new RegExp("&"+t[n][0]+";","g"),t[n][1]);return e}function addFormHiddenInput(e,t,n){var o=document.createElement("input");o.setAttribute("name",e),o.setAttribute("type","hidden"),o.setAttribute("value",t),n.appendChild(o)}function getElemMargin(e,t){return getElemDim(e,"margin",t)}function getElemPadding(e,t){return getElemDim(e,"padding",t)}function getElemDim(e,t,n){n||(n={});var o={},i=n.computed?getComputedStyle(e):e.style;return o.left=i[t+"Left"].split("px")[0],o.right=i[t+"Right"].split("px")[0],"auto"==o.left||"auto"==o.left?o.x="auto":o.x=Math.round(o.left)+Math.round(o.right),o.top=i[t+"Top"].split("px")[0],o.bottom=i[t+"Bottom"].split("px")[0],"auto"==o.top||"auto"==o.bottom?o.y="auto":o.y=Math.round(o.top)+Math.round(o.bottom),o}function makeArrayUnique(e){for(var t=0;t<e.length;t++)for(var n=e[t],o=e.length;o--;)t!=o&&e[o].length+"  "+n.length&&e[o]==n&&e.splice(o,1);return e}function makeObjectArrayUnique(e){for(var t=0;t<e.length;t++)for(var n=e[t],o=e.length;o--;)t!=o&&e[o]&&n&&JSON.stringify(e[o])==JSON.stringify(n)&&e.splice(o,1);return e}function cloneNodeAttributes(e){var t=document.createElement(e.nodeName);return copyAttributes(e,t),t}function copyAttributes(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value)}function getBoundingBox(e){if(3==e.nodeType){var t=document.createRange();t.selectNode(e);var n=t.getBoundingClientRect();return t.detach(),n}return e.getBoundingClientRect()}function parents(e,t){t||(t={});for(var n=[];e&&e&&(!t.stopAtId||e.id!=t.stopAtId);e=e.parentNode){if(t.stopAtIds){for(var o,i=0;i<t.stopAtIds.length;i++)if(e.id==t.stopAtIds[i]){o=!0;break}if(o)break}t.filterByClass&&!e.classList.contains(t.filterByClass)||n.unshift(e)}return n}function getCurrentTime(){return Math.floor(Date.now()/1e3)}function getQueryStringValue(e){var t=window.location.href.split("?");if(!(t.length<=1))for(var n=t[t.length-1].split("&"),o=0;o<n.length;o++){var i=n[o].split("=");if(i[0]==e)return i[1]}}function copyObjToObj(e,t,n){for(var o in n||(n={}),e)n.onlyIfNotExists&&null!=t[o]||(t[o]=e[o])}function traverseToBottom(e,t){for(;e&&e.children.length;){if(t&&e.id==t)return e;e=e.children[0]}return e}function traverseToTop(e,t){for(;e&&e.parentNode;){if(t&&e.id==t)return e;e=e.parentNode}return!e||e.parentNode||e.id!=t?null:e}function traverseToTopWithClass(e,t){for(;e&&e.parentNode;){if(t&&e.classList.contains(t))return e;e=e.parentNode}return!e||e.parentNode?null:e.classList.contains(t)?e:null}function getDomainFromURL(e){var t=new URL(e);return t.protocol+"//"+t.hostname}function getReaderOrigin(){return window.location.href.split("#")[0].replace(/\/$/,"")}function hasParent(e,t,n,o){n||(n=3);for(var i=0;i<n;i++){if(!(e=e.parentNode))return;if("body"==e.nodeName.toLowerCase())return;if(hasClass(e,t))return!0}}function hasParentWithId(e,t,n,o){n||(n=3);for(var i=0;i<n;i++){if(!(e=e.parentNode))return;if("body"==e.nodeName.toLowerCase())return;if(e.id==t)return!0}}function hasParentNode(e,t,n){n||(n=3);for(var o=0;o<n;o++){if(!(e=e.parentNode))return;var i=e.nodeName.toLowerCase();if("body"==i)return;if(i==t)return!0}}function XORCipher(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t,i){return i=function(e,t){return o(t,(function(t,o){return t.charCodeAt(0)^n(e,o)}))}(t,i),function(t){var n,o,i,r,a,s=0,c="";if(!t)return t;do{n=(r=t[s++]<<16|t[s++]<<8|t[s++])>>12&63,o=r>>6&63,i=63&r,c+=e.charAt(r>>18&63)+e.charAt(n)+e.charAt(o)+e.charAt(i)}while(s<t.length);return a=t.length%3,(a?c.slice(0,a-3):c)+"===".slice(a||3)}(i)},decode:function(t,i){return i=function(t){var n,o,i,r,a,s,c=0,l=[];if(!t)return t;t+="";do{n=(s=e.indexOf(t.charAt(c++))<<18|e.indexOf(t.charAt(c++))<<12|(r=e.indexOf(t.charAt(c++)))<<6|(a=e.indexOf(t.charAt(c++))))>>16&255,o=s>>8&255,i=255&s,l.push(n),64!==r&&(l.push(o),64!==a&&l.push(i))}while(c<t.length);return l}(i),function(e,t){return o(t,(function(t,o){return String.fromCharCode(t^n(e,o))})).join("")}(t,i)}};return t;function n(e,t){return e.charCodeAt(Math.floor(t%e.length))}function o(e,t){for(var n=[],o=0;o<e.length;o++)n[o]=t(e[o],o);return n}}function isFunction(e){return e&&"[object Function]"==={}.toString.call(e)}function digits(e,t){return 1==t?e:e<Math.pow(10,t-1)?"0"+digits(e,t-1):e}function cleanURL(e){try{isNative&&mobile&&(e=(e=window.Ionic.WebView.convertFileSrc(e)).replace(/([^:])\/\//g,"$1/"))}catch(e){}return e}function parseHtml(e){var t=parser.parseFromString(e,"text/html");return t&&t.documentElement||(t=parser.parseFromString(e,"text/xml")),t}function parseXml(e){var t=parser.parseFromString(e,"text/xml");return t&&t.documentElement||(t=parser.parseFromString(e,"text/html")),t}function getTopOffsetRelativeTo(e,t){for(var n=0;e&&e!=t;)n+=e.offsetTop,e=e.offsetParent;return n}function existsInArray(e,t,n){n||(n={});for(var o=t.length;o--;)if(t[o]==e)return!n.index||o}function removeFromArray(e,t){for(var n=t.length;n--;)t.splice(n,1)}function serializeObject(e,t,n){var o=Object.prototype.toString.call(e);if(void 0===n)if("[object Object]"===o)n={};else{if("[object Array]"!==o)return;n=[]}for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=e[i];if(null!=r)switch(Object.prototype.toString.call(r)){case"[object Array]":case"[object Object]":serializeObject(r,a(t,i),n);break;default:n[a(t,i)]="boolean"==typeof r?Number(r):encodeURIComponent(r)}}function a(e,t){return null!=e?e+"["+t+"]":t}return n}function getBaseSuffix(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function waitFor(e,t,n){n=n||0,"string"==typeof e&&window[e]||Array.isArray(e)&&e.length||/#|\./.test(e)&&document.querySelector(e)?t():n<3e3&&setTimeout((function(){waitFor(e,t,n+100)}),100)}function base64URL(e){return e.toString(CryptoJS.enc.Base64).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function getClosest(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}function removePx(e){if(e){var t=e.split("px");return t.length?Number(t[0]):void 0}}function addDigitsToArray(e,t){if(!e)return e;for(var n=0;n<e.length;n++)e[n]=digits(e[n],t);return e}function UAParser(){this.ua="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"",this.UNKNOWN="?",this.OBJ_TYPE="object",this.STR_TYPE="string",this.NAME="name",this.VERSION="version",this.BLACKBERRY="BlackBerry",this.BROWSER="Browser",this.CHROME="Chrome",this.FIREFOX="Firefox",this.OPERA="Opera",this.oldSafariMap={"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},this.windowsVersionMap={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},this.regexes={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[this.NAME,this.VERSION],[/opios[\/ ]+([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Mini"]],[/\bopr\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[this.NAME,this.VERSION],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[this.VERSION,[this.NAME,"UC"+this.BROWSER]],[/\bqbcore\/([\w\.]+)/i],[this.VERSION,[this.NAME,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[this.VERSION,[this.NAME,"WeChat"]],[/konqueror\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[this.VERSION,[this.NAME,"IE"]],[/yabrowser\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[this.NAME,/(.+)/,"$1 Secure "+this.BROWSER],this.VERSION],[/\bfocus\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX+" Focus"]],[/\bopt\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[this.VERSION,[this.NAME,"Dolphin"]],[/coast\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.OPERA+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[this.VERSION,[this.NAME,"MIUI "+this.BROWSER]],[/fxios\/([-\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX]],[/\bqihu|(qi?ho?o?|360)browser/i],[[this.NAME,"360 "+this.BROWSER]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[this.NAME,/(.+)/,"$1 "+this.BROWSER],this.VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[this.NAME,/_/g," "],this.VERSION],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[this.NAME,this.VERSION],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[this.NAME],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[this.NAME,"Facebook"],this.VERSION],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[this.NAME,this.VERSION],[/\bgsa\/([\w\.]+) .*safari\//i],[this.VERSION,[this.NAME,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[this.VERSION,[this.NAME,this.CHROME+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[this.NAME,this.CHROME+" WebView"],this.VERSION],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[this.VERSION,[this.NAME,"Android "+this.BROWSER]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[this.NAME,this.VERSION],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[this.VERSION,[this.NAME,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[this.VERSION,this.NAME],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[this.NAME,[this.VERSION,this.strMapper,this.oldSafariMap]],[/(webkit|khtml)\/([\w\.]+)/i],[this.NAME,this.VERSION],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[this.NAME,"Netscape"],this.VERSION],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[this.VERSION,[this.NAME,this.FIREFOX+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[this.NAME,this.VERSION]],os:[[/microsoft (windows) (vista|xp)/i],[this.NAME,this.VERSION],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[this.NAME,[this.VERSION,this.strMapper,this.windowsVersionMap]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[this.NAME,"Windows"],[this.VERSION,this.strMapper,this.windowsVersionMap]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[this.VERSION,/_/g,"."],[this.NAME,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[this.NAME,"Mac OS"],[this.VERSION,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[this.VERSION,this.NAME],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[this.NAME,this.VERSION],[/\(bb(10);/i],[this.VERSION,[this.NAME,this.BLACKBERRY]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[this.VERSION,[this.NAME,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[this.VERSION,[this.NAME,this.FIREFOX+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[this.VERSION,[this.NAME,"webOS"]],[/crkey\/([\d\.]+)/i],[this.VERSION,[this.NAME,this.CHROME+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[this.NAME,"Chromium OS"],this.VERSION],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[this.NAME,this.VERSION],[/(sunos) ?([\w\.\d]*)/i],[[this.NAME,"Solaris"],this.VERSION],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[this.NAME,this.VERSION]]},this.has=function(e,t){return _typeof(e)===this.STR_TYPE&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},this.strMapper=function(e,t){for(var n in t)if(_typeof(t[n])===this.OBJ_TYPE&&t[n].length>0){for(var o=0;o<t[n].length;o++)if(this.has(t[n][o],e))return n===this.UNKNOWN?void 0:n}else if(this.has(t[n],e))return n===this.UNKNOWN?void 0:n;return e},this.rgxMapper=function(e,t,n){for(var o,i,r,a,s,c,l=0;l<n.length&&!s;){var d=n[l],u=n[l+1];for(o=i=0;o<d.length&&!s;)if(s=d[o++].exec(t))for(r=0;r<u.length;r++)c=s[++i],a=u[r],_typeof(a)===this.OBJ_TYPE&&a.length>0?2==a.length?"function"==typeof a[1]?e[a[0]]=a[1].call(e,c):e[a[0]]=a[1]:3==a.length?"function"!=typeof a[1]||a[1].exec&&a[1].test?e[a[0]]=c?c.replace(a[1],a[2]):void 0:e[a[0]]=c?a[1].call(e,c,a[2]):void 0:4==a.length&&(e[a[0]]=c?a[3].call(e,c.replace(a[1],a[2])):void 0):e[a]=c||void 0;l+=2}},this.getBrowserDetails=function(){var e={name:void 0,version:void 0};return this.rgxMapper(e,this.ua,this.regexes.browser),e},this.getOSDetails=function(){var e={name:void 0,version:void 0};return this.rgxMapper(e,this.ua,this.regexes.os),e}}function phpDateToJS(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])}function createService(e,t){window[e]=t()}function getUrlExt(e){var t=ph.getExtension(e);return t=(t=t.split("?")[0]).split("#")[0]}function getTemplate(e){var t=kTemplate(e);return templatesRepo[t]||(t=kTemplate(e,"web")),templatesRepo[t]}function isIpad(){var e=0==window.location.search.indexOf("?ipadtest"),t=window.navigator.userAgent;if(e&&window.alert("ua: "+t),t.indexOf("iPad")>-1)return!0;if(e&&window.alert("window.navigator.platform: "+window.navigator.platform),"iPad"==window.navigator.platform)return!0;if(e&&window.alert("Check 1"),t.indexOf("Mac")>-1||t.indexOf("CriOS")>-1){e&&window.alert("Check 2");try{return document.createEvent("TouchEvent"),e&&window.alert("return true"),!0}catch(t){e&&window.alert("caught")}}return!1}function removeSplashScreen(){document.getElementById("splash").innerHTML=""}function stringSimilarity(e,t){var n=e,o=t;e.length<t.length&&(n=t,o=e);var i=n.length;return 0==i?1:(i-function(e,t){e=e.toLowerCase(),t=t.toLowerCase();for(var n=new Array,o=0;o<=e.length;o++){for(var i=o,r=0;r<=t.length;r++)if(0==o)n[r]=r;else if(r>0){var a=n[r-1];e.charAt(o-1)!=t.charAt(r-1)&&(a=Math.min(Math.min(a,i),n[r])+1),n[r-1]=i,i=a}o>0&&(n[t.length]=i)}return n[t.length]}(n,o))/parseFloat(i)}function getPathForCordova(e){return isNative&&e.startsWith("file:///")?e.replace("file:///","kotobee://localhost/_app_file_/"):e}function getListIndex(e){for(var t=e.parentNode.querySelectorAll(":scope > li"),n=0;n<t.length;n++)if(t[n]==e)return n}function formatDuration(e){if("number"!=typeof e||!isFinite(e)||e<0)return"";var t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.ceil(e%60);return t>0?this.pad(t)+":"+this.pad(n)+":"+this.pad(o):this.pad(n)+":"+this.pad(o)}function pad(e){return e<10?"0"+e:""+e}function isValidDuration(e){return"number"==typeof e&&isFinite(e)&&e>0}String.prototype.includes=function(e){return-1!==this.indexOf(e)},String.prototype.toCamelCase=function(){return this.toLowerCase().replace(/(?:(^.)|(\s+.))/g,(function(e){return e.charAt(e.length-1).toUpperCase()}))};var parser=new DOMParser,preview,previewParams,app,mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),mobileDebug=!1,ios=/iPhone|iPad|iPod/i.test(navigator.userAgent);isIpad()&&(mobile=1,ios=!0);var readerV=1.8,debug=!1,isNative,bookPath,noFlash,isReaderApp,isRelease=!0,desktop,chromeApp,os,miniapps={},uuid,kotobee={},loggerWorker,partitionEnabled="Android"==mobile&&config.kotobee.segregate,isKotobee=!0,debugDuration=!1,overflowScroll=!mobile|config.overflowScroll,vueExclude=!1,firstRouteShown;if(window.location.href.indexOf("?preview")>0){preview=!0,mobileDebug=!0;var arr=window.location.href.split("?");arr=arr[1].split("&"),previewParams={};for(var i=0;i<arr.length;i++){var arr2=arr[i].split("=");previewParams[arr2[0]]=arr2[1]}mobile=!!previewParams.mobile}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}$rootScope={$$phase:!1,$apply:function(){},$on:function(){},$broadcast:function(){}},$location={path:function(e){if(e)return window.location.href="#"+e;var t=window.location.hash;return t?t.split("#")[1]:void 0},search:function(e){var t,n;if("object"==_typeof(e))for(var o in e)t=o,n=e[o];else t=e;var i=window.location.hash;i=i.split("?")[0],window.location.hash=i+"?"+t+(n?"="+n:"")}},$ionicPlatform={ready:function(e){e()},registerBackButtonAction:function(){}},$injector={get:function(e){return window[e]}},$window={open:function(e){window.open(e)}},$sce={trustAsResourceUrl:function(e){return e},trustAsHtml:function(e){return e}},$timeout=setTimeout,$interpolate=function(e){return function(t){for(var n in t){var o=new RegExp("{{"+n+"}}","g");e=e.replace(o,t[n])}return e}},$document=[document],$ionicGesture={on:function(){}},$ionicHistory={clearHistory:function(){},clearCache:function(){},forwardView:function(){return{}},backView:function(){return{}},goBack:function(){return{}},nextViewOptions:function(){return{}}},$http={get:function(){return khttp.get.apply(null,arguments)},post:function(){return khttp.post.apply(null,arguments)}},$ionicLoading={show:function(){},hide:function(){}},$compile=function(e){return function(t){var n=document.createElement("div");return n.innerHTML=e,n.children}},$q={defer:function(){var e,t,n,o,i,r,a,s={},c={};return c.resolve=function(n){e=!0,t=n,a&&(s.success?s.success():s.then&&s.then())},c.reject=function(e){n=!0,o=e,a&&(s.error?s.error():s.catch&&s.catch())},s.then=s.success=function(n){return a=!0,e?(n||(n=i),n&&n(t),s):(i=n,s)},s.error=s.catch=function(e){return a=!0,n?(e||(e=r),e&&e(o),s):(r=e,s)},c.promise=s,c}},$filter=function(e){return function(){return vueApp.$options.filters[e].apply(null,arguments)}},angular={element:function(e){return e==document.body&&(e=document.getElementById("kotobeeVue")),{scope:function(){return new Proxy({},{get:function(t,n){for(var o=e.__vue__;o&&!o[n];)o=o.$parent;if(o)return o[n]}})},injector:function(){return{get:function(e){return window[e]}}}}}},inherited=function(e,t,n){for(var o=e;o&&!o[t];)o=o.$parent;if(o)return isFunction(o[t])?o[t].apply(null,n||[]):o[t]};var log=kLog;function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}vueExclude&&(app.directive("iframeOnload",[function(){return{scope:!1,link:function(e,t,n){t.on("load",(function(){return e.modal.siteOptions.loaded()}))}}}]),app.directive("containerScroll",(function(e){return{scope:!1,link:function(t,n,o){var i=Math.round(99999*Math.random());addClass(n[0],"containerMobileScroll containerScroll"+i),function t(){e((function(){var e=document.getElementsByClassName("containerScroll"+i);e.length?e[0].addEventListener("touchstart",(function(t){e[0].getElementsByClassName("kbContent");if(t.touches&&t.touches.length>1)return;t.stopPropagation()})):++r<50&&t()}),40)}();var r=0}}})),app.directive("enterWithoutShift",(function(){return function(e,t,n){t.bind("keydown keypress",(function(t){t.shiftKey||13===t.which&&(e.$apply((function(){e.$eval(n.enterWithoutShift)})),t.preventDefault())}))}})),app.directive("enterWithCtrl",(function(){return function(e,t,n){t.bind("keydown keypress",(function(t){t.ctrlKey&&13===t.which&&(e.$apply((function(){e.$eval(n.enterWithCtrl)})),t.preventDefault())}))}})),app.directive("searchheader",(function(e,t){return{restrict:"E",replace:!1,scope:{obj:"=obj",prop:"=prop",kotobeeGradient:"=kotobeeGradient",onValue:"=onValue",offValue:"=offValue",noCancel:"=noCancel",searchKeyOb:"=searchKeyOb",onsearch:"&"},templateUrl:kTemplate("headers/headerSearch.html"),link:function(n,o,i){n.$watch("obj[prop]",(function(r,a){r===t(i.onValue)(n)&&e((function(){o[0].getElementsByTagName("input")[0].focus()}))})),n.hide=function(){n.obj[n.prop]=n.offValue}}}})),app.directive("ngEnter",(function(){return function(e,t,n){t.bind("keydown keypress",(function(t){13===t.which&&(e.$apply((function(){e.$eval(n.ngEnter)})),t.preventDefault())}))}})),app.directive("nextchapterscroll",(function(){return{restrict:"E",templateUrl:kTemplate("components/nextChapterScroll.html")}})),app.directive("autofocusme",(function(e){return{link:function(t,n,o){e((function(){n[0].focus()}),350)}}})),app.directive("readerheader",(function(){return{restrict:"E",templateUrl:kTemplate("headers/readerHeader.html"),scope:!1}})),app.directive("headerdefault",(function(){return{restrict:"E",templateUrl:kTemplate("headers/headerDefault.html"),scope:!1}})),app.directive("headerselection",(function(){return{restrict:"E",templateUrl:kTemplate("headers/headerSelection.html"),scope:!1}})),app.directive("headersearchitems",(function(){return{restrict:"E",templateUrl:kTemplate("headers/headerSearchItems.html"),scope:!1}})),app.directive("headertextsize",(function(){return{restrict:"E",templateUrl:kTemplate("headers/headerTextSize.html"),scope:!1}})),app.directive("headerfreehand",(function(){return{restrict:"E",templateUrl:kTemplate("headers/headerFreehand.html"),scope:!1}})),app.directive("headerlibrary",(function(){return{restrict:"E",templateUrl:kTemplate("headers/headerLibrary.html"),scope:!1}})),app.directive("mouseEvents",(function(e,t,n,o,i){return{restrict:"A",link:function(e,t,o){n.init(t)}}})),app.directive("vanillaScroll",(function(){return{restrict:"A",link:function(e,t,n){t[0].addEventListener("scroll",(function(){e.scroll(this)}))}}})),app.directive("selectOptions",(function(){return{restrict:"E",templateUrl:kTemplate("headers/selectOptions.html")}})),app.directive("selectionOptions",(function(){return{restrict:"E",templateUrl:kTemplate("components/selectionOptions.html")}})),app.directive("tabMenu",(function(){return{restrict:"E",replace:!0,templateUrl:kTemplate("panels/tabMenu.html")}})),app.directive("media",(function(){return{restrict:"E",replace:!0,templateUrl:kTemplate("panels/media.html"),scope:!1}})),app.directive("noteitem",(function(){return{restrict:"E",templateUrl:kTemplate("components/noteItem.html")}})),app.directive("bookmarkitem",(function(){return{restrict:"E",templateUrl:kTemplate("components/bookmarkItem.html")}})),app.directive("hlightitem",(function(){return{restrict:"E",templateUrl:kTemplate("components/hlightItem.html")}})),app.directive("bookThumb",(function(){return{restrict:"E",replace:!0,templateUrl:kTemplate("panels/bookThumb.html")}})),app.directive("thumbnail",(function(){return{restrict:"A",link:function(e,t,n){t.attr("style","background-size:cover,width:50px,height:50px")}}})),app.directive("onimgload",(function(){return{restrict:"A",link:function(e,t,n){t.bind("load",(function(o){e[n.onimgload](t),e.$apply()}))}}})),app.directive("showafterimageload",(function(){return{restrict:"A",link:function(e,t,n){t.bind("load",(function(e){e.currentTarget.style.opacity=1,autoprefixTransform(e.currentTarget,"translate(-50%, -100%) scale(1)")}))}}})),app.directive("headerShrink",(function(e){return{restrict:"A",link:function(t,n,o){e.setup(t,n,o)}}})),app.directive("sdk",(function(){return{restrict:"E",templateUrl:mobile?"":"templates/panels/sdk.html"}})),app.directive("sdkProfileForm",(function(){return{restrict:"E",templateUrl:kTemplate("panels/sdkProfileForm.html"),scope:{profile:"=profile",save:"=save",cancel:"=cancel"}}})),app.directive("bookInfo",(function(){return{restrict:"E",templateUrl:kTemplate("panels/bookInfo.html"),scope:{pageview:"=pageview",book:"=book"}}})),app.directive("stars",(function(){return{restrict:"E",templateUrl:kTemplate("components/stars.html"),scope:{rating:"=rating",type:"=type",onselect:"=onselect"},link:function(e,t,n){e.rating||(e.rating=0),"input"==e.type&&(e.rating=e.selectedRating=0),e.over=function(t){"input"==e.type&&(e.rating=t)},e.select=function(t){"input"==e.type&&(e.rating=e.selectedRating=t,e.onselect&&e.onselect(t))},e.leave=function(){"input"==e.type&&null!=e.selectedRating&&(e.rating=e.selectedRating)}}}}))),Vue.directive("showafterimageload",{bind:function(e,t){e.addEventListener("load",(function(e){e.currentTarget.style.opacity=1,autoprefixTransform(e.currentTarget,"translate(-50%, -100%) scale(1)")}))}}),Vue.directive("autofocus",{bind:function(e,t){Vue.nextTick((function(){e&&e.focus&&e.focus()}))}}),Vue.directive("headershrink",{inserted:function(e,t){}}),Vue.directive("longpress",{bind:function(e,t,n){t.value;var o=null;function i(e){"click"===e.type&&0!==e.button||null===o&&(o=setTimeout((function(){!function(e){t.value(e)}()}),1e3))}function r(e){null!==o&&(clearTimeout(o),o=null)}e.addEventListener("mousedown",i),e.addEventListener("touchstart",i),e.addEventListener("click",r),e.addEventListener("mouseout",r),e.addEventListener("touchend",r),e.addEventListener("touchcancel",r)}}),Vue.directive("imgfallback",{bind:function(e,t){e.addEventListener("error",(function(e){e.target.src=t.value}))}}),Vue.directive("tooltip",{bind:function(e,t){mobile||(e.removeAttribute("title"),e.addEventListener("mouseover",(function(){tooltip.show(e,t.value)})),e.addEventListener("mouseout",(function(){tooltip.hide()})))}}),Vue.filter("bookSetup",(function(){var e=document.getElementById("chaptersContent"),t=document.getElementById("epubContainer");function n(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}cache.setOb("epubContainer",t),cache.setOb("chaptersContent",e),config.tocMultiline?addClass(e,"multiline"):removeClass(e,"multiline"),e.addEventListener("contextmenu",(function(e){n(e)})),e.addEventListener("mousedown",(function(e){if(2===e.which)return n(e),!1})),e.addEventListener("click",(function(e){if(2===e.which)return n(e),!1})),document.getElementById("chapters").addEventListener("click",(function(e){var t=e.target;if("span"==t.nodeName.toLowerCase()&&"a"==t.parentNode.nodeName.toLowerCase()&&(t=t.parentNode),"a"==t.nodeName.toLowerCase()){if(!o(t))return;var n=t.getAttribute("href");if(n){if(n.match(/http[s]?:/g))return;if(0==n.indexOf("/"))return;if(0==n.indexOf("#"))return void $ionicSideMenuDelegate.close();e.preventDefault(),$rootScope.renderScope.chapterLink(t)}else e.preventDefault(),$rootScope.renderScope.chapterLink(t)}else if("i"==t.nodeName.toLowerCase()){if(!o(t))return;if(t.parentElement.getElementsByTagName("ol").length>0)t.offsetHeight,t.parentElement.classList.toggle("expanded")}function o(e){for(var t=e.parentNode;t&&t!=document.body;){if(hasClass(t,"menu")&&(hasClass(t,"menu-left")||hasClass(t,"menu-right")))return!0;t=t.parentNode}}}));var o=document.getElementById("chapters");function i(e){if(hasParentWithId(e.target,"epubContainer",99)){selection.active()&&selection.reset();var t=e.target;if("sections"!=t.nodeName.toLowerCase()&&!hasClass(t,"k-section")&&"video"!=t.nodeName.toLowerCase()&&"audio"!=t.nodeName.toLowerCase()){if(t.hasAttribute("contenteditable"))return e.stopPropagation(),void t.focus();for(var n=t.childNodes.length;n--;)if("#text"==t.childNodes[n].nodeName&&""!=t.childNodes[n].nodeValue.replace(/\s+/g," ").trim())return void selection.elementDown(t,e)}}}o.addEventListener("touchstart",i),o.addEventListener("mousedown",i),o.addEventListener("keyup",(function(e){if(hasParentWithId(e.target,"epubContainer",99)){var t=e.target;t&&hasClass(t,"ki-textfield")&&(kInteractive.events.add({action:"answerClicked",disableRemote:!0,param:null,elem:t}),kInteractive.action(t,e),e.stopPropagation())}})),o.addEventListener("change",(function(e){if(hasParentWithId(e.target,"epubContainer",99)){var t=e.target;t&&hasClass(t,"ki-textfield")&&(kInteractive.action(t,e),e.stopPropagation())}})),o.addEventListener("dragend",(function(e){if(hasParentWithId(e.target,"epubContainer",99)){var t=e.target;t&&hasClass(t,"ki-draggable")&&(kInteractive.events.add({action:"answerClicked",disableRemote:!0,param:null,elem:t}),kInteractive.action(t,e),e.stopPropagation())}})),o.addEventListener("click",(function(e){if(hasParentWithId(e.target,"epubContainer",99)){var n=e.target;if(n){for(var o=n;o&&o!=t;){if("a"==o.nodeName.toLowerCase()){if(hasClass(o,"ki-btn"))kInteractive.action(o,e);else{var i=o.getAttribute("href");if(!i)return kInteractive.action(o,e),void e.stopPropagation();i.match(/http[s]?:/g)?$rootScope.renderScope.externalLink(o):0==i.indexOf("/")?window.open(i):0==i.indexOf("mailto:")?window.location.href=i:(0!=i.indexOf("#")&&(i=ph.join(stg.data.book.chapter.url,i)),chapters.applyChapterStateFromURL(i))}return void e.stopPropagation()}if("input"==o.nodeName.toLowerCase()&&"submit"!=o.type)return hasClass(o,"ki-inputbox")?(kInteractive.events.add({action:"answerClicked",disableRemote:!0,param:null,elem:n}),kInteractive.action(n,o)):hasClass(n,"ki-btn")&&kInteractive.action(n,o),void e.stopPropagation();o=o.parentNode}if("video"!=n.nodeName.toLowerCase()&&"audio"!=n.nodeName.toLowerCase()){if("img"==n.nodeName.toLowerCase()){if(hasClass(n,"kInteractive")&&"none"!=kInteractive.readData(n).behavior)return kInteractive.action(n,e),void e.stopPropagation();var r=n.parentNode;if(hasClass(r,"kInteractive")){if(hasClass(r,"widget"))return kInteractive.action(n,e),void e.stopPropagation();if(hasClass(r,"questions"))return kInteractive.action(n,e),void e.stopPropagation()}var a=!0,s=kInteractive.readData(n);if(s&&s.popup||(a=!1),n.hasAttribute("static")&&(a=!1),n.hasAttribute("data-static")&&(a=!1),a){var c={};return c.thumbnail=c.src=cleanURL(s.path?ph.join(stg.data.book.chapter.absoluteURL,s.path):n.getAttribute("src")),c.large="large"==s.popupSize,c.title=n.getAttribute("title")?n.getAttribute("title"):ph.basename(c.thumbnail),c.ext=ph.getExtension(c.thumbnail),c.type="image",media.show(c),void e.stopPropagation()}}return hasClass(n,"ki-btn")||hasClass(n,"kInteractive")?(kInteractive.action(n,e),void e.stopPropagation()):"true"==n.getAttribute("contenteditable")?(n.focus(),void e.stopPropagation()):void("input"!=n.nodeName.toLowerCase()||e.stopPropagation())}}}}))})),Vue.filter("chapterHtml",(function(e){if(e){for(var t=e.getElementsByTagName("li"),n=t.length;n--;){addClass(t[n],"item"),t[n].getElementsByTagName("ol").length&&addClass(t[n],"parent");var o=t[n].getElementsByTagName("ol").length?" parent":"";t[n].innerHTML='<i class="icon'+o+'"> </i> '+t[n].innerHTML}var i=e.getElementsByTagName("a");for(n=i.length;n--;)"true"==i[n].getAttribute("data-expand")&&addClass(i[n].parentNode,"expanded"),"true"==i[n].getAttribute("data-dontshow")&&i[n].removeAttribute("href");for(n=0;n<i.length;n++)if(i[n].href){var r=i[n].getAttribute("href"),a="";book.currentBook&&(a="/book/"+book.currentBook.id);var s=chapters.indexFromUrl(i[n].getAttribute("href"));if(null!=s){var c=r.split("html#"),l=Array.isArray(c)&&c.length&&c.length>=2?"/"+c[1]:"";i[n].setAttribute("data-url",i[n].getAttribute("href")),i[n].setAttribute("href","#"+a+"/reader/chapter/"+s+l)}}}})),Vue.filter("contentHtml",(function(e,t){var n=document.createElement("div");n.setAttribute("id","epubContent"),t||(t=stg.data.book.chapter.absoluteURL),htmlParser.wrapOrphans(e),kInteractive&&kInteractive.preRender(e,{chapterUrl:t}),$filter("contentSrc")(e,t);var o=document.createElement("sections"),i=e.getElementsByTagName("body")[0];if(partitionEnabled){for(var r=new Array,a=0;;){var s=!0,c=!1,l=0;r[a]=document.createElement("section"),r[a].setAttribute("sec",a),addClass(r[a],"k-section");for(var d=i.childNodes.length;d--;)if(!i.childNodes[d].style||"absolute"!=i.childNodes[d].style.position){if(!((l+=(null!=i.childNodes[d].textContent?i.childNodes[d].textContent:i.childNodes[d].data).length)<4e3||s)){c=!0;break}s=!1,r[a].insertBefore(i.childNodes[d],r[a].firstChild)}if(!c)break;a++}for(d=0;d<r.length;d++)o.insertBefore(r[d],o.firstChild)}else{var u=document.createElement("section");u.setAttribute("sec","0"),addClass(u,"k-section");for(d=i.childNodes.length;d--;)u.insertBefore(i.childNodes[d],u.firstChild);o.appendChild(u)}i.appendChild(o);var p,f=e.getElementsByTagName("body")[0].innerHTML,h=e.getElementsByTagName("meta");for(d=0;d<h.length;d++){var g=h[d].getAttribute("name");if(g&&"viewport"==g.toLowerCase()){p=!0;break}}p&&chapters.mightCrashOnIos(f)&&(f=(f=f.replace(/<span[^>]*?><\/span>/g,"")).replace(/data-[^ ]*?=".*?"/g,"")),n.innerHTML=f;for(var m=n.getElementsByTagName("script");m.length;)m[0].parentNode.removeChild(m[0]);return pauseVideoAndAudio(n),n})),Vue.filter("contentJs",(function(e){var t,n=$q.defer(),o=cache.getOb("epubContent");return document.getElementById("epubMeta")?(document.getElementById("epubMeta").innerHTML="",t=document.getElementById("epubMeta")):((t=document.createElement("div")).setAttribute("id","epubMeta"),t.innerHTML='<div class="sideMeta"></div><div class="contentMeta"></div>',t.className="hide",o.parentNode.insertBefore(t,o.nextSibling)),cache.setOb("epubMeta",t),cache.setOb("sideMeta",t.getElementsByClassName("sideMeta")[0]),cache.setOb("contentMeta",t.getElementsByClassName("contentMeta")[0]),selection.newChapter(),function(){function e(){if(i++,"#e7e3d9"==rgb2hex(window.getComputedStyle(cache.getOb("epubContent")).getPropertyValue("background-color"))){clearInterval(o),removeClass(t,"hide");for(var e=document.getElementsByTagName("style"),i=0;i<e.length;i++)if(e[i].hasAttribute("kotobee")){var r=e[i].innerHTML;r=r.replace(/[^}]*?{[^}]*?background-color:#e7e3d9 !important;.*?}/g,""),e[i].innerHTML=r}settings.initialize(),n.resolve({})}}removeClass(cache.getOb("epubContent"),"bgInherit");var o=setInterval(e,30);e()}(),n.promise})),Vue.filter("contentSrc",(function(e,t){for(var n=getElementsByAttribute(e,"*","src"),o=0;o<n.length;o++){if(shouldParse(l=n[o].getAttribute("src"))&&n[o].setAttribute("src",ph.join(ph.removeHash(t),l)),"img"==n[o].nodeName.toLowerCase()&&(hasClass(n[o],"kInteractive")||hasClass(n[o].parentNode,"kInteractive")||n[o].style.height||n[o].getAttribute("height")||(n[o].style.maxWidth="100%"),chromeApp&&n[o].getAttribute("src"))){var i=n[o],r=i.getAttribute("src");if(isAbsoluteURLAndNotDataPath(r)){var a=i.getAttribute("chrome");stg.data.chromeAssets[r]?i.setAttribute("src",stg.data.chromeAssets[r]):a&&stg.data.chromeAssets[a]?i.setAttribute("src",stg.data.chromeAssets[a]):(a=Math.round(1e5*Math.random()),i.setAttribute("src",""),i.setAttribute("chrome",a),getImgDataSrc(r,(function(e){setTimeout((function(){stg.data.chromeAssets[a]=e;var t=getElementsByAttribute(document,"img","chrome",a);t.length&&t[0].setAttribute("src",e)}),300)})))}}}var s=getElementsByAttribute(e,"*","poster");for(o=0;o<s.length;o++){shouldParse(l=s[o].getAttribute("poster"))&&s[o].setAttribute("poster",ph.join(ph.removeHash(t),l))}var c=getElementsByAttribute(e,"image","xlink:href");for(o=0;o<c.length;o++){var l;shouldParse(l=c[o].getAttribute("xlink:href"))&&c[o].setAttribute("xlink:href",ph.join(ph.removeHash(t),l))}var d=getElementsByAttribute(e,"*","style");for(o=0;o<d.length;o++){var u=d[o].getAttribute("style");-1!=u.toLowerCase().indexOf("url(")&&(hasParent(d[o],"kInteractive",5)||d[o].setAttribute("style",u.replace(/(.*?url\()(.+?)(\).*?)/g,p)))}function p(){var e=arguments[2];return 0==e.indexOf('"')&&(e=e.split('"')[1]),0==e.indexOf("'")&&(e=e.split("'")[1]),0==e.indexOf("&quot;")&&(e=e.split("&quot;")[1]),-1!=e.indexOf("http://")||-1!=e.indexOf("https://")||0==e.indexOf("data:")?arguments[0]:(e=ph.join(ph.removeHash(t),e),arguments[1]+e+arguments[3])}})),function(){var e,t,n,o,i=[];Vue.filter("contentVirt",(function(r,a,s){if(kLog("contentVirt"),kLog(r,a,s),config.parseCachingVer)s&&s();else try{var c=function(e){if(e){for(var t=i.length;t--;)if(i[t]==e)return;var n=cache.getOb("epubContent").className;addClass(cache.getOb("epubContent"),"reveal");var o=e.offsetTop-cache.getOb("epubContent").offsetTop;0!=o&&(e.style.marginTop=o+"px",i.push(e),cache.getOb("epubContent").className=n)}},l=function(e,t){t||(t={}),t.id=Math.round(9999*Math.random());t.cb;if(null==t.includeAnnotations&&(t.includeAnnotations=!0),hasClass(e,"parsed"))return t.cb&&t.cb(e),e;addClass(e,"parsed");var n={};if("fxl"==stg.data.book.chapter.layout&&chapters.mightCrashOnIos(e.textContent)){if(isNative&&mobile){for(var o=e.getElementsByTagName("img"),i=0;i<o.length;i++){var r=o[i].getAttribute("src");r&&o[i].setAttribute("src",cleanURL(r))}o=null}var a=e.getElementsByTagName("a");for(i=0;i<a.length;i++)a[i].setAttribute("onclick","return false;");return a=null,addClass(document.body,"ios15DisabledAnnotation"),void(s&&s(e))}removeClass(document.body,"ios15DisabledAnnotation");var c=e.innerHTML;if(workers.supported()&&t.allowWorkers){var l=function(){n.html=u[0].html,n.WEBVIEW_SERVER_URL=window.WEBVIEW_SERVER_URL,n.native=window.isNative,n.mobile=window.mobile,workers.call("htmlParser","parse",[n],(function(e){var t=replaceHTML(u[0].el,e),n=u[0].options;n.includeAnnotations&&d(t),u.shift(),n.cb&&n.cb(t),u.length&&l()}))};return u.push({html:c,el:e,options:t}),1==u.length&&l(),!0}var p=replaceHTML(e,c=htmlParser.parse(c));return t.includeAnnotations&&d(p),s&&s(p),p},d=function(e){},u=[];if("reset"==r)return e=t=null,n=!0,void(i=[]);var p=cache.getOb("epubContent");if("reveal"==r)return void addClass(p,"reveal");if("undoReveal"==r)return void removeClass(p,"reveal");if("parse"==r)return void l(a,{includeAnnotations:!1,allowWorkers:!0,source:"parse mode",cb:s});if("parseAndAnnotations"==r)return void l(a,{allowWorkers:!0,source:"parseAndAnnotations mode"});var f,h=p.parentNode.parentNode,g=h.style.webkitTransform||h.style.mozTransform||h.style.transform;f=null==r&&null!=a?a:!overflowScroll||!config.overflowScroll&&preview&&mobile?-Number(g.split(",")[1].slice(0,-2)):cache.getOb("epubContainer").scrollTop;var m=o>f?"up":"down";o=f;var v,b,k=200,y=f+h.parentNode.offsetHeight,w=p.children;if(n){for(var C=[],x=0,I=0;I<w.length;I++){for(var E=[],S=w[I],T=0;T<S.childNodes.length;T++)E[T]={},S.childNodes[T].offsetTop+S.childNodes[T].offsetHeight<f-k||S.childNodes[T].offsetTop>y+k?E[T].add=["cNone","noMargin"]:(0==x&&(E[T].setMargin=!0,x=1,v=T),E[T].remove=["cNone","noMargin"],E[T].setParse=!0,b=T);for(T=0;T<E.length;T++)E[T].setMargin&&c(S.childNodes[T]),E[T].setParse&&C.push([S.childNodes[T],{source:"from clean",allowWorkers:!0}]),addRemoveClass(S.childNodes[T],E[T].add,E[T].remove);for(T=0;T<E.length;T++);null!=v&&(e=S.childNodes[v]),null!=b&&(t=S.childNodes[b])}if(n=!1,C.length)for(T=0;T<C.length;T++){var O=C[T];T==C.length-1&&(O[1].cb=s),l(O[0],O[1])}else s&&s();return}if("fxl"==stg.data.book.chapter.layout)return;if(w.length>1)return;if(1==w[0].childNodes.length)return;S=w[0];if("up"==m){if(!(e.offsetTop+e.offsetHeight)<f-0&&!(e.offsetTop>f-k))return;if(t==S.childNodes[0])return}else if("down"==m){if(!(t.offsetTop>y+0||t.offsetTop+t.offsetHeight<y+k))return;if(e==S.childNodes[S.childNodes.length-1])return}e&&(e.offsetTop+e.offsetHeight<f-0?(addClass(e,"cNone"),addClass(e,"noMargin"),e.nextSibling&&(removeClass(e=e.nextSibling,"noMargin"),c(e),e=l(e,{source:"topElem1"}))):e.offsetTop>f-k&&e.previousSibling&&(addClass(e,"noMargin"),removeClass(e=e.previousSibling,"cNone"),removeClass(e,"noMargin"),c(e),e=l(e,{source:"topElem2"}))),t&&(t.offsetTop>y+0?(addClass(t,"cNone"),t.previousSibling&&(removeClass(t=t.previousSibling,"cNone"),t=l(t,{source:"bottomElem1"}))):t.offsetTop+t.offsetHeight<y+k&&t.nextSibling&&(removeClass(t=t.nextSibling,"cNone"),t=l(t,{source:"bottomElem2"})))}catch(e){}}))}(),Vue.filter("js",(function(e,t){var n=$q.defer();t||(t={});if(chapters.disableJsLoading)return n.resolve({}),n.promise;for(var o=[],i=e.getElementsByTagName("script"),r=0;r<i.length;r++)if(i[r].getAttribute("src")){var a=i[r].getAttribute("src");if(i[r].parentNode.removeChild(i[r]),r--,a.indexOf("/kotobeeInteractive.js")>=0)continue;a.indexOf(":/"),o.push({mode:"url",val:a})}else o.push({mode:"code",val:i[r].innerHTML});var s=e.getElementsByTagName("body")[0];return s.getAttribute("onload")&&o.push({mode:"code",val:s.getAttribute("onload")}),t.noJsParse?n.resolve():jsParser.inject(o,(function(e){n.resolve(e)})),n.promise})),Vue.filter("coverPath",(function(e,t){var n=(config.kotobee.liburl?config.kotobee.liburl:"")+"img/ui/defaultCover.png";return e?isAbsoluteURLPath(e)?e:e=cleanURL(e=t?(config.kotobee.liburl?config.kotobee.liburl:"../../")+"books/"+t+"/EPUB/"+e:ph.join(bookPath,stg.data.packageURL,e)):n})),Vue.filter("categoryStyle",(function(e){var t="";isKotobeeHosted()&&(t=publicRoot);var n="";"image"!=e.display&&"imagetext"!=e.display||!e.img||(n+="background-image:url("+(t+"imgUser/"+e.img)+");");return"image"==e.display&&(n+="color:transparent;"),e.css&&(n+=e.css),n})),Vue.filter("catImgPath",(function(e){var t=(config.kotobee.liburl?config.kotobee.liburl:"")+"imgUser/"+e;return config.kotobee.liburl+"/"+ph.join(bookPath,t)})),Vue.filter("decodeHtmlEntities",(function(e){return decodeHTMLEntities(e)})),Vue.filter("nativeLinks",(function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.getElementsByTagName("a"),o=0;o<n.length;o++){var i=n[o].getAttribute("href");n[o].setAttribute("onclick","window.open('"+i+"', '_system');"),n[o].setAttribute("href","#")}return t.innerHTML})),Vue.filter("moreDataExists",(function(e,t){try{if(!stg.currentLibrary)return!1;if("categories"==t)return!1;if("downloaded"==t)return!1;var n;if("favorites"==t&&(n=stg.favorites),"all"==t&&(n=stg.currentLibrary.books),0==n.length)return!1}catch(e){return!1}return e})),Vue.filter("round",(function(e){return Math.round(e)})),Vue.filter("arrayEmpty",(function(e){if(!e)return!0;for(var t=0;t<e.length;t++)if(Array.isArray(e[t])){if(!$filter("arrayEmpty")(e[t]))return!1}else if(e[t])return!1;return!0})),Vue.filter("langFromId",(function(e){e=e.split("-")[0];for(var t=0;t<stg.data.languages.length;t++)if(stg.data.languages[t].val==e)return stg.data.languages[t].label;var n=[{label:"فارسی",val:"fa"},{label:"українська",val:"uk"}];for(t=0;t<n.length;t++)if(n[t].val==e)return n[t].label;return e})),Vue.filter("cleanurl",(function(){return cleanURL})),Vue.filter("unsafe",(function(e){return e})),Vue.filter("unsafeResource",(function(e){return e})),Vue.filter("nl2br",(function(e){return e?e.indexOf("</")>=0?e:e.replace(/\n/g,"<br>"):""})),Vue.filter("releasePlatform",(function(e){switch(e){case"win32":return"Windows 32-bit";case"win64":return"Windows 64-bit";case"win":return"Windows";case"mac":return"Macintosh"}})),Vue.filter("filesizeLabel",(function(e){return e?e>1e6?Math.round(10*e/1e6)/10+" GB":e>1e3?Math.round(10*e/1e3)/10+" MB":Math.round(10*e)/10+" KB":""})),Vue.filter("miniappIconPath",(function(e){var t=kMiniapps.getRoot(),n="icon.png";if(e.dataJson._listingIcon){if(isAbsoluteURLPath(n=e.dataJson._listingIcon))return getPathForCordova(n);n="userdata/"+n}return(t=getPathForCordova(t))+"miniapps/"+e.folder+"/"+n})),Vue.filter("metaExists",(function(e){if(e&&"N/A"!=e&&"No rights specified"!=e)return e})),Vue.filter("noteEntryStyle",(function(e,t){var n=[];return t==e&&n.push("editing"),e.public?(n.push("public"),(e.uid==stg.data.user.id||stg.data.user.perms&&stg.data.user.perms.globaldata)&&n.push("mine"),n.push("hasAvatar")):n.push("mine"),n.join(" ")})),Vue.filter("noteUsernameChar",(function(e){return e?e.name?e.name.substr(0,1):e.uid==stg.data.user.id?"ME":e.email?e.email.substr(0,1):"N/A":"N/A"})),Vue.filter("noteUsername",(function(e){return e.name?e.name:e.uid==stg.data.user.id?translit.get("me"):e.email?e.email.substr(0,1)+"***@***.***":translit.get("anonymous")})),Vue.filter("dateTimeFromServer",(function(e){return e?phpDateToJS(e).toUTCString():""})),Vue.filter("priceDecimal",(function(e){var t=parseFloat(e);return isNaN(t)?e:t.toFixed(2)})),Vue.filter("styles",(function(e,t){var n=$q.defer();if(chapters.disableCssLoading)return n.resolve({}),n.promise;t||(t={});for(var o,i=[],r=e.getElementsByTagName("link"),a=0;a<r.length;a++)if("text/css"==r[a].getAttribute("type")&&r[a].getAttribute("href").length){var s=ph.join(t.path,r[a].getAttribute("href")),c=!1;if(isAbsoluteURLPath(r[a].getAttribute("href"))&&(s=r[a].getAttribute("href"),c=!0),l(s))continue;s==bookPath+"EPUB/css/base.css"&&(o=!0),i.push({type:"path",val:s,dontCache:c})}function l(e){if(e.indexOf("/css/kotobeeInteractive.css")>=0)return!0}o||config.dontForceBaseCss||i.unshift({type:"path",val:bookPath+"EPUB/css/base.css",dontCache:!1});var d=e.getElementsByTagName("style");for(a=0;a<d.length;a++)i.push({type:"local",val:d[a].innerHTML,root:t.path});return t.noCssParse?n.resolve():cssParser.inject(i,t,(function(e){n.resolve(e)})),n.promise})),Vue.filter("t",(function(e,t){return translit.get(e,Array.prototype.slice.call(arguments,2))})),createService("annotations",(function(){var e,t,n,o={};function i(e){return e.children.length?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}function r(e){for(var t="",n=0;n<e.length;n++)t+=e[n].textContent;return t}return o.initialize=function(t){chapters.addListener((function(t,i){if("renderedChapter"==t){if(e&&e.index==currentIndex)return o.show();e={index:currentIndex,vIndex:currentVIndex},!backend.cloudParam("sync")||config.kotobee.public||n?o.show():o.sync()}}))},o.reset=function(){e=null,n=null,t=null},o.sync=function(e,o){if(backend.cloudParam("sync")){e||(e={});var i={};e.all||(i.chapter=currentIndex,i.chaptername=stg.data.currentPageOb.title,i.file=stg.getChapterFilename()),function(e,n){var o={};o.ver=readerV,null!=e.chapter&&(o.chapter=e.chapter);null!=e.chaptername&&(o.chaptername=e.chaptername);null!=e.file&&(o.file=e.file);backend.getNotebook(o,(function(e){t=e,n(e)}))}(i,(function(t){if(t&&!t.error){var i=t.notes&&t.notes.items?t.notes.items:t.notes,r=t.bookmarks&&t.bookmarks.items?t.bookmarks.items:t.bookmarks,a=t.hlights&&t.hlights.items?t.hlights.items:t.hlights,s=t.sketches&&t.sketches.items?t.sketches.items:t.sketches;freehand.addSketchesFromSync(s||{},(function(){notes.addNotesFromSync(i||{},(function(){bookmarks.addBookmarksFromSync(r||{},(function(){hlights.addHlightsFromSync(a||{},(function(){e.all&&(n=!0),o&&o()}))}))}))}))}else o&&o()}))}},o.show=function(e,t){e||(e=cache.getOb("epubContent"));for(var n=e;null!=(n=n.previousSibling);)0;var o=[];o.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&o.push(stg.data.currentRPageOb.index),$timeout((function(){stg.getBookmarks((function(e){stg.getNotes((function(n){stg.getHlights((function(o){stg.getSketches((function(i){bookmarks.addBookmarksFromOffline(e),notes.addNotesFromOffline(n),hlights.addHlightsFromOffline(o),freehand.addSketchesFromOffline(i),t&&t()}))}))}))}))}),1e3)},o.updateNotebookArray=function(e,o){e||(e={});var i=new Array;stg.getBookmarks((function(r){for(var a=0;a<r.length;a++){var s=r[a];s.chapter=chapters.getUnanchoredIndex(s.chapter),null!=s.chapter?(i[s.chapter]||(i[s.chapter]=new Array),i[s.chapter].push(s)):r.splice(a--,1)}stg.getNotes((function(a){for(var s=0;s<a.length;s++){var c=a[s];c.chapter=chapters.getUnanchoredIndex(c.chapter),null!=c.chapter?(i[c.chapter]||(i[c.chapter]=new Array),c.note&&(c.noteTrusted=c.note,c.noteTrusted=c.noteTrusted.replace(new RegExp("\r?\n\r?\n","g"),"<br />"),c.noteTrusted=c.noteTrusted.replace(new RegExp("\r?\n","g"),"<br />"),c.noteTrusted=$sce.trustAsHtml(c.noteTrusted)),c.noteTrusted||(c.noteTrusted=""),c.noteTrusted=c.noteTrusted.trim(),"<"!=c.noteTrusted.substr(0,1)&&(c.noteTrusted="<p>"+c.noteTrusted+"</p>"),i[c.chapter].push(c)):a.splice(s--,1)}stg.getHlights((function(s){for(var c=0;c<s.length;c++){(l=s[c]).chapter=chapters.getUnanchoredIndex(l.chapter),null!=l.chapter?(i[l.chapter]||(i[l.chapter]=new Array),i[l.chapter].push(l)):s.splice(c--,1)}for(var l in i)i[l].title=book.getTitleByIndex(l);for(c=0;c<i.length;c++)if(i[c])for(var d=0;d<i[c].length;d++)if(i[c][d].location){var u=String(i[c][d].location).split(",");u=String(u[0]).split("-"),i[c][d].locationDec=Number("0."+addDigitsToArray(u[0].split("."),3).join("")),i[c][d].chaptername&&(i[c].title=i[c][d].chaptername)}for(c=0;c<i.length;c++)i[c]&&(i[c]=i[c].sort((function(e,t){return e.locationDec>t.locationDec?1:-1})));var p={};backend.cloudParam("sync")&&t&&(r.length<t.bookmarks.total&&(p.moreExist=!0),a.length<t.notes.total&&(p.moreExist=!0),s.length<t.hlights.total&&(p.moreExist=!0),n=!p.moreExist),p.results=i,p.showDelete=e.showDelete,Vue.set(stg.data,"notebookContent",p),o&&o()}))}))}))},o.getMatchingElements=function(e,t){var n=traverser.getElemsByLocation(e.location,t),o=r(n);if(n&&1==n.length){var a=n[0].type;if("textarea"==a||"text"==a||"radio"==a||"checkbox"==a)return n}if(stringSimilarity(s(o),s(e.src))>=.88)return n;function s(e){return e?e.toLowerCase().trim().replace(/\s+?/g,""):e}if(e.locations&&e.locations.length)for(var c=0;c<e.locations.length;c++)if(stg.data.book.version==e.locations[c].version&&e.location!=e.locations[c].location){var l=traverser.getElemsByLocation(e.locations[c].location,t);if(stringSimilarity(s(o=r(l)),s(e.src))>=.88)return y(l,e.locations[c].version,"fromVersionElems")}var d=cache.getOb("epubContent"),u=(d=cache.getOb("epubContent"),cache.getOb("epubContent"));for(n.length&&(u=n[0].parentNode);u&&u!=d&&!(s(u.textContent).indexOf(s(e.src))>=0);)u=u.parentNode;var p=e.src.split(" ");for(c=p.length;c--;)s(p[c])||p.splice(c,1);for(var f=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,i,!1);m=f.nextNode();)if(f.currentNode=m,-1!=s(f.currentNode.textContent).indexOf(s(p[0]))){for(var h=1,g=[f.currentNode];b=f.nextNode();){if(k=s(b.textContent)){if(-1==k.indexOf(s(p[h])))break;if(g.push(b),++h>=p.length)break}}if(h>=p.length)return y(g,null,"fromWordLooping")}var m;for(f=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,i,!1);m=f.nextNode();){var v=s(e.src);if(f.currentNode=m,-1!=v.indexOf(s(f.currentNode.textContent))){v=v.replace(s(f.currentNode.textContent),"");var b;for(g=[f.currentNode];b=f.nextNode();){var k;if(k=s(b.textContent)){if(-1==v.indexOf(k))break;if(v=v.replace(k,""),g.push(b),v.length<=0)break}}if(v.length<=0)return y(g,null,"fromSlackSearching")}}function y(t,n,o){if(!config.kotobee.sync)return t;var i={};return i.bid=stg.data.book.id,i.cloudid=config.kotobee.cloudid,i.nid=e.nid,i.hid=e.hid,i.location=n,i.location||(i.location=traverser.convertElemsToLocation(t).leftRange),backend.updateAnnotation(i),t}return[]},o})),createService("audiobook",(function(){var e,t,n={};function o(e){t=-1,e||(e=stg.data.audiobook.chapters);for(var n=0;n<e.length;n++)e[n].index=++t,e[n].sub&&o(e[n].sub)}return n.initialize=function(t){e=t,Vue.set(stg.data,"currentChapter",stg.data.audiobook.chapters[0]),o();var i=n.getRedirectUrl(stg.data.currentChapter.href);$location.path(i)},n.getChapterByIndex=function(e,t){t||(t=stg.data.audiobook.chapters);for(var o=0;o<t.length;o++){var i=t[o];if(e==i.index)return i;if(i.sub){var r=n.getChapterByIndex(e,i.sub);if(r)return r}}},n.getChapterByHref=function(e,t){t||(t=stg.data.audiobook.chapters);for(var o=0;o<t.length;o++){var i=t[o];if(e==i.href)return i;if(i.sub){var r=n.getChapterByHref(e,i.sub);if(r)return r}}},n.nextChapter=function(){var e=stg.data.currentChapter.index;if(!(e>=t)){stg.data.currentChapter=n.getChapterByIndex(e+1);var o=n.getRedirectUrl(stg.data.currentChapter.href);$location.path(o)}},n.prevChapter=function(){var e=stg.data.currentChapter.index;if(!(e<=0)){stg.data.currentChapter=n.getChapterByIndex(e-1);var t=n.getRedirectUrl(stg.data.currentChapter.href);$location.path(t)}},n.loadChapterByHref=function(e){var t=n.getChapterByHref(e);n.initTrack(t)},n.getRedirectUrl=function(e,t){t||(t={});var n=book.root+"/audiobook/chapter/"+e;return t.hash&&(n+="/"+t.hash),t.vIndex&&(n+="?vi="+t.vIndex),n},n.loadBook=function(){var e=$q.defer();return stg.resetBook(),khttp.get(cacheBust(ph.join(bookPath,"data.json?v="+readerV))).success((function(t){Vue.set(stg.data,"audiobook",t),e.resolve()})),e.promise},n.initTrack=function(n){n&&Vue.set(stg.data,"currentChapter",n);var o=stg.data.currentChapter.index;0==o&&Vue.set(stg.data.currentChapter,"first",!0),o>=t&&Vue.set(stg.data.currentChapter,"last",!0),e.loadAudio()},n.selectChapter=function(e){var t=book.root+"/audiobook/chapter/"+e.href;$location.path(t)},n.closePanel=function(){stg.data.widescreen=!1,$ionicSideMenuDelegate.close(),stg.data.widescreen&&Vue.nextTick(nav.fxlZoomFit)},n.displayChapters=function(){stg.data.widescreen||(stg.data.settings.rtl?$ionicSideMenuDelegate.toggleRight():$ionicSideMenuDelegate.toggleLeft())},n.displaySettings=function(){stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},n})),createService("auth",(function(){var e={};function t(){config.kotobee.rememberme&&(stg.data.user.rememberMe=!0);var e=getQueryStringValue("code");if((e&&(stg.data.user.code=e.replace(/[#\/]/g,"")),config.kotobee.registrationsettings||(config.kotobee.registrationsettings={}),config.src="library"==config.kotobee.mode?"library":"book",config.kotobee&&(config.kotobee.js||config.kotobee.css))&&!document.getElementsByClassName("kotobeeInjectedScript").length){document.getElementsByTagName("head");if(config.kotobee.js)for(var t=0;t<config.kotobee.js.length;t++){var n=document.createElement("script");n.src=cacheBust(config.kotobee.js[t]),n.className="kotobeeInjectedScript",document.body.appendChild(n)}if(config.kotobee.css)for(t=0;t<config.kotobee.css.length;t++){var o=document.createElement("link");o.rel="stylesheet",o.href=cacheBust(config.kotobee.css[t]),o.className="kotobeeInjectedScript",document.body.appendChild(o)}}if(config.kotobee&&config.kotobee.sso)if(config.kotobee.sso.length){if(Array.isArray(config.kotobee.sso)){var i={};config.kotobee.sso.forEach((function(e){if(e.enabled){var t=Object.assign({},e);delete t.provider,t.params.clientsecret&&delete t.params.clientsecret,t.params.pkce&&delete t.params.pkce,t.params.version&&delete t.params.version,i[e.provider]=t}})),Object.keys(i).length?config.kotobee.sso=i:delete config.kotobee.sso}}else delete config.kotobee.sso;(desktop||isNative)&&config&&config.kotobee&&config.kotobee.payment&&delete config.kotobee.payment,config.kotobee&&config.kotobee.payment&&"book"==config.kotobee.mode&&config.kotobee.pricing&&config.kotobee.pricing.purchasable&&(config.kotobee.landing=!0)}return e.authenticate=function(){var t=$q.defer();return putTest("inside"),e.getPermissions((function(t){view.generate();try{var n="epub";if("audiobook"==config.kotobee.type&&(n="audiobook"),"book"==config.kotobee.mode&&isKotobeeHosted())if(config.kotobee.public)bookPath=publicRoot+n+"/";else{var o=publicRoot.split("/books/")[1].split("/")[0];bookPath="/books/"+o+"/EPUB/"+n+"/"}if("kotobee"==config.kotobee.hostType&&(bookPath=config.kotobee.public?stg.data.paths.private+"books/"+config.kotobee.hostPath+"/EPUB/"+n+"/":config.kotobee.liburl+"books/"+config.kotobee.hostPath+"/EPUB/"+n+"/"),isReaderApp)return"offline"!=t.error&&login.start(),void e.startup({tab:"local"});if((isNative||desktop)&&t&&backend.cloudParam("offline")&&"offline"==t.error)return e.startup({tab:"downloads"})}catch(e){}login.start()})),t.promise},e.getPermissions=function(e){"library"==config.kotobee.mode?backend.getUnauthLibrary((function(n){if(n||(n={}),"offline"!=n.error){if(n.cloud)for(var o in n.cloud)config.kotobee[o]=config.kotobee[o]&&Array.isArray(config.kotobee[o])?config.kotobee[o].concat(n.cloud[o]):n.cloud[o];config.kotobee.permsLoaded=!0,config.kotobee.offline=n.offline,config.kotobee.offlinedelete=n.offlinedelete,config.kotobee.js=n.js,config.kotobee.css=n.css,stg.data.currentLibrary.iskotobee&&(config.kotobee.entry=!0,config.kotobee.allowlogin=!0),t(),e()}else e(n)})):"book"==config.kotobee.mode?config.kotobee.cloudid?backend.getPermissions((function(n){for(var o in n)"sso"==o&&config.testSSO&&config.kotobee.sso&&config.kotobee.sso.length||(config.kotobee[o]=n[o]);config.kotobee.entry=null,config.kotobee.permsLoaded=!0,t(),e()})):(config.kotobee.public=!0,t(),e()):$injector.get("app").getPermissions(e)},e.startup=function(t){if(t||(t={}),isNative&&function(){if({}.watermarkPlaceholder){var e='<div id="watermark"><span>'+translit.get("createdUsing")+'</span><a href="#" class="inlineBlock" style="vertical-align: sub" onclick="nav.openInBrowser(\'https://www.kotobee.com\');return false;"><img width="163" src="'+rootDir+'img/ui/authorLogo.png"></a></div>',t=document.createElement("div");t.innerHTML=e,document.body.insertBefore(t,document.getElementById("html5Fallback")),setTimeout((function(){addClass(document.getElementById("watermark"),"show")}),4e3)}}(),"library"==config.kotobee.mode){e.authenticated=!0;var n="";t.tab&&(n="/tab/"+t.tab);try{$location.path("/library"+n)}catch(e){}kMiniapps.initialize({mode:"library"}),design.applyRichTextLibrary(),$ionicHistory.clearHistory()}else"book"==config.kotobee.mode&&("audiobook"==config.kotobee.type?audiobook.loadBook().then((function(){e.authenticated=!0,$location.path("/audiobook"),$ionicHistory.clearHistory(),setTimeout((function(){kotobee.dispatchEvent("bookOpened",stg.data.audiobook)}),1e3)})):book.loadBook().then((function(){design.applyRichTextLibrary(),e.authenticated=!0,$location.path("/reader"),$ionicHistory.clearHistory(),kMiniapps.initialize(),sync.initialize(),setTimeout((function(){chapters.initialize(),kotobee.dispatchEvent("bookOpened",stg.data.book)}),1e3)})));kotobee&&kotobee.dispatchEvent("ready")},e.redeemCode=function(e,t){var n=clone(e),o={model:{},submit:function(){modals.hide(),n.code=o.model.code,n.code&&(kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),backend.redeemCode(n,(function(e){e&&!e.error?(kStatus.update(),t()):kStatus.showAndHide(translit.get(e?e.error:"unexpectedError"),3e3)})))}};modals.show({mode:"redeemCodePanel",redeemCodeInfo:o})},e})),createService("autohide",(function(){var e,t,n,o,i,r,a,s,c={};function l(){var e={};if(document.getElementById("libraryThumbs")&&window.location.href.indexOf("#/library")>=0)e.mode="library",e.header=document.getElementById("libraryHeader"),e.scope=document.getElementById("library").__vue__,e.libTabs=document.getElementById("libraryTabs"),e.libTabs&&(e.libTabHeight=e.libTabs.offsetHeight);else{e.mode="reader",e.header=document.getElementById("readerHeader"),e.header&&(e.scope=document.getElementById("chapters").__vue__),e.tabMenu=document.getElementById("tabMenu"),e.tabMenu&&(e.tabMenuHeight=e.tabMenu.offsetHeight);var t=document.body.getElementsByClassName("navControls");if(t.length){var n=(t=t[t.length-1]).getElementsByClassName("next");n.length&&(e.navNext=n[0]);var o=t.getElementsByClassName("prev");o.length&&(e.navPrev=o[0]),e.navWidth=e.navNext.offsetWidth}}return e.headerHeight=e.header?e.header.offsetHeight:0,e}function d(e){r=null;e.target.parentNode.nodeName.toLowerCase();var t=l();if("reader"==t.mode)"neverShow"==config.autohideReaderMode&&a&&(new Date).getTime()-s<800&&Math.abs(f(e).x-a.x)<50&&function(t,n){var o=.15,i=f(e).y;if(Math.abs(i-a.y)<15)return;i<a.y?a.y>(1-o)*document.body.clientHeight&&m(t):i>(1-o)*document.body.clientHeight&&m(n);i>a.y?a.y<o*document.body.clientHeight&&m(t):i<o*document.body.clientHeight&&m(n)}("tab","hidden");else if("library"==t.mode)if("showOnScroll"==config.autohideLibMode){var n=document.getElementsByClassName("bookThumbsContainer")[0],o=document.getElementById("libraryThumbs"),i=Number(getElemPadding(o).top);i||(i=0),n&&n.offsetHeight<o.offsetHeight-i&&m("buttons")}else if("showOnTap"==config.autohideLibMode);else if("hideOnTap"==config.autohideLibMode);else if("neverShow"==config.autohideLibMode&&a){if((new Date).getTime()-s<800&&Math.abs(f(e).x-a.x)<50&&a.y<100&&f(e).y>a.y)return m("header");m("hidden")}a=null}function u(n){if(n.target){if(function(e){var t=e.nodeName.toLowerCase();if("a"==t)return!0;if("video"==t)return!0;if("audio"==t)return!0;if(hasClass(e,"kInteractive"))return!0;if(hasParent(e,"kInteractive"))return!0}(n.target))return;var o=n.target.nodeName.toLowerCase();if("span"==o)return;if("button"==o)return;if("a"==o)return;if("input"==o)return;if("textarea"==o)return;if("label"==o)return;if(hasParentNode(n.target,"button"))return;if(hasParentNode(n.target,"a"))return;if(hasParentNode(n.target,"input"))return}var i=l();if("reader"==i.mode){if(!hasParentWithId(n.target,"epubContainer",99))return;if("alwaysShow"==config.autohideReaderMode)return;if("neverShow"==config.autohideReaderMode)return}if("library"==i.mode){if(!hasParentWithId(n.target,"libraryThumbs",99))return;if("alwaysShow"==config.autohideLibMode)return;if("neverShow"==config.autohideLibMode)return;if("showOnTap"==config.autohideLibMode||"hideOnTap"==config.autohideLibMode){var r=n.target,a=r.parentNode.nodeName.toLowerCase();if("a"==a||"button"==a)return;if(r.classList.contains("thumbImg"))return}}t=!0,selection.active()?selection.reset():"hidden"==e?m("buttons"):"buttons"==e?m("hidden"):"midway"==e&&m("buttons")}function p(e){a=f(e),s=(new Date).getTime()}function f(e){return e.changedTouches&&e.changedTouches.length?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:e.touches&&e.touches.length?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}}function h(e){e||(e={});var t=e.dims;if(t||(t=l()),g(t.header,n,t.headerHeight,"up",!!ios),"reader"==t.mode){if(e.headerOnly)return;if(e.tabOnly)return void o();g(t.navNext,n*t.navWidth/t.headerHeight,t.navWidth,book.isRtl()?"left":"right"),g(t.navPrev,n*t.navWidth/t.headerHeight,t.navWidth,book.isRtl()?"right":"left"),o()}else if("library"==t.mode){if(!t.libTabs)return void(e.dims=l());if(g(t.libTabs,n,t.libTabHeight,"up"),e.headerOnly)return}function o(){g(t.tabMenu,n*t.tabMenuHeight/t.headerHeight,t.tabMenuHeight,"down",!!ios)}}function g(e,t,n,o,i){var r=1-(t=Math.min(n,t))/44;window.requestAnimationFrame((function(){var n;if(e&&("up"==o?n="translate3d(0, -"+t+"px, 0)":"down"==o?n="translate3d(0, "+t+"px, 0)":"right"==o?n="translate3d("+t+"px, 0, 0)":"left"==o&&(n="translate3d(-"+t+"px, 0, 0)"),autoprefixTransform(e,n),i))for(var a=0,s=e.children.length;a<s;a++)e.children[a].style.opacity=r}))}function m(t){if(e!=t){var i=l();if("buttons"==t)o=n=0,h();else if("header"==t)o=n=0,h({headerOnly:!0});else if("tab"==t)o=n=0,h({tabOnly:!0});else if("hidden"==t){o=n=i.headerHeight;var r="translate3d(100%, 0, 0)",a="translate3d(-100%, 0, 0)";if(i.tabMenu&&autoprefixTransform(i.tabMenu,"translate3d(0, 100%, 0)"),i.header&&autoprefixTransform(i.header,"translate3d(0, -100%, 0)"),i.libTabs&&autoprefixTransform(i.libTabs,"translate3d(0, -44px, 0)"),i.navPrev&&autoprefixTransform(i.navPrev,book.isRtl()?r:a),i.navNext&&autoprefixTransform(i.navNext,book.isRtl()?a:r),"reader"==i.mode&&!(i.header&&i.tabMenu&&i.navPrev&&i.navNext))return;if("library"==i.mode&&!i.libTabs)return}e=t}}return c.initialize=function(){mobile&&(document.body.addEventListener(mobile&&!mobileDebug?"touchend":"mouseup",d),document.body.addEventListener(mobile&&!mobileDebug?"touchstart":"mousedown",p),document.body.addEventListener("click",u),config.autohideHeader&&!config.autohideReaderMode&&(config.autohideReaderMode="showOnScroll"),config.autohideHeader||(config.autohideReaderMode="alwaysShow"),config.autohideLibHeader&&!config.autohideLibMode&&(config.autohideLibMode="showOnScroll"),config.autohideLibHeader||(config.autohideLibMode="alwaysShow"))},c.setup=function(t,n){if(e="buttons","reader"==n){if("alwaysShow"==config.autohideReaderMode)return;if("neverShow"==config.autohideReaderMode)return m("hidden"),t.$watch("header.mode",(function(e,t){e!=t&&m("selection"==e||"searchItems"==e||"textSize"==e?"header":"hidden")})),void(t.autohideEase=!0);var o,i;vueApp.$watch("data.settings.textSize",(function(e,t){if(!o){if(o=!0,"showOnTap"==config.autohideReaderMode)return;if("hideOnTap"==config.autohideReaderMode)return}m("buttons")})),t.$watch("header.mode",(function(e,t){(i||(i=!0,"showOnTap"!=config.autohideReaderMode))&&m("buttons")})),"showOnTap"==config.autohideReaderMode&&m("hidden")}if("library"==n){if("alwaysShow"==config.autohideLibMode)return;if("neverShow"==config.autohideLibMode)return void m("hidden");"showOnTap"==config.autohideLibMode&&m("hidden"),t.$watch("subMode",(function(e,t){m("buttons")})),t.$watch("searchOb.enabled",(function(e,t){m("buttons")}))}t.autohideEase=!0},c.hideBtns=function(){m("hidden")},c.showBtns=function(){m("buttons")},c.scrolled=function(s){var c=40;if(a){r||(r=l());var d=r;if("reader"==d.mode){if("alwaysShow"==config.autohideReaderMode)return;if("showOnTap"==config.autohideReaderMode)return;if("hideOnTap"==config.autohideReaderMode)return;if("neverShow"==config.autohideReaderMode)return}if("library"==d.mode){if("alwaysShow"==config.autohideLibMode)return;if("showOnTap"==config.autohideLibMode)return;if("hideOnTap"==config.autohideLibMode)return;if("neverShow"==config.autohideLibMode)return;c=5}if(i||(i=Math.max(c,s.target.scrollTop)),t)return t=!1,i=Math.max(c,s.target.scrollTop),void("hidden"==e&&(i-=d.headerHeight,o=d.headerHeight));if("reader"==d.mode){if(!d.scope.header)return;if("default"!=d.scope.header.mode)return;if($injector.get("nav").transforming)return}else if("library"==d.mode){if(d.scope.subMode)return;if(d.scope.searchOb.enabled)return}if((n=d.headerHeight-(d.headerHeight-(s.target.scrollTop-i)))>=d.headerHeight?(i=s.target.scrollTop-d.headerHeight,n=d.headerHeight,e="hidden"):n<0?(i=Math.max(c,s.target.scrollTop),n=0,e="buttons"):e="midway",null==o&&(o=0),o==d.headerHeight){if(n==d.headerHeight)return;if(n>14)return;i=Math.max(c,s.target.scrollTop),n=0}n+o!=0&&(o=n,h({dims:d}))}},c})),createService("backend",(function(){var e,t,n={},o=[],i={headers:{"Content-Type":void 0}};function r(){try{if("undefined"!=typeof lti&&lti&&email&&hash){stg.data.user.email=email,stg.data.user.pwd=hash,stg.data.user.rememberMe=!0;var e=document.getElementsByTagName("head")[0];if(e.length){e[0];for(var t=document.getElementsByTagName("script"),n=0;n<t.length;n++)if(t[n].hasAttribute("lti")){t[n].parentNode.removeChild(t[n]);break}}}}catch(e){}}n.getAuthVarsOld=function(){return{libid:config.kotobee.libid,email:stg.data.user.email,pwd:stg.data.user.pwd}},n.getAuthVars=function(){var e={env:config.kotobee.mode};return stg.data.user&&(stg.data.user.email&&stg.data.user.pwd?Object.assign(e,{email:stg.data.user.email,pwd:stg.data.user.pwd,env:config.kotobee.mode}):stg.data.user.code&&Object.assign(e,{code:stg.data.user.code,env:config.kotobee.mode})),r(),e.cloudid=config.kotobee.cloudid,"library"==e.env&&stg.data.book&&(e.bid=stg.data.book.id),uuid&&(e.fingerprint=uuid),e},n.addListener=function(e,t){o.push({event:e,func:t})},n.initialize=function(){putTest("X");var e=$q.defer();return putTest("Y"),putTest("Z"),putTest("J"),kError.detect("s_authError",n.loginErrorDetection),putTest("K"),stg.readSlot("user"+config.kotobee.cloudid,(function(t){if(config.kotobee.cloudid){var o=t;o&&Vue.set(stg.data,"user",o)}stg.data.user||Vue.set(stg.data,"user",{}),0==stg.data.user.length&&Vue.set(stg.data,"user",{}),Vue.set(stg.data.user,"loggedIn",!1),putTest("L"),preview?e.resolve():n.getFingerprint((function(t){uuid=t,e.resolve()}))})),e.promise},n.getFingerprint=function(e){function t(){var t={excludeUserAgent:!0,excludeScreenResolution:!0,excludeDoNotTrack:!0,excludeAvailableScreenResolution:!0,excludeOpenDatabase:!0,excludePlugins:!0,excludeCanvas:(!0,!1),excludeWebGL:(!0,!1),excludeJsFonts:!0};new Fingerprint2(t).get((function(t,n){try{t||(t=process.env.USERNAME),stg.writeSlot("fingerprint",t,(function(){e(t)}))}catch(e){}}))}isNative&&window.plugins&&window.plugins.uniqueDeviceID?window.plugins.uniqueDeviceID.get((function(n){n&&n.length?e(n):t()}),t):desktop?"mac"==os?t():require("child_process").exec("wmic CPU get ProcessorId",{cwd:"."},(function(n,o,i){if(o){var r=o.toUpperCase().split("PROCESSORID");if(r.length){var a=r[1].trim();a.length?e(a):t()}else t()}else t()})):t()};var a=null,s=null;n.setLibraryLoginCallback=function(e){a=e},n.setLibraryLogoutCallback=function(e){s=e},n.loginErrorDetection=function(e){stg.data.user.loggedIn=!1,e&&("email"==config.kotobee.loginmode||config.kotobee.promocodesdisabled?e.loginOptions.canLoginByEmail=!0:"code"==config.kotobee.loginmode?e.loginOptions.canLoginByCode=!0:e.loginOptions.canLoginByEmail=e.loginOptions.canLoginByCode=!0,e.loginOptions.mode=e.loginOptions.canLoginByEmail?"email":"code",e.model||(e.model={}),e.loginOptions.signIn=function(){modals.hide(),setTimeout((function(){if("code"==e.loginOptions.mode){if(!e.model||!e.model.code)return void kError.update({error:"enterYourCode"});stg.data.user.code=e.model.code,stg.data.user.email=stg.data.user.pwd=null}else{if(!stg.data.user.email)return void kError.update({error:"enterYourEmail"});if(!e.model||!e.model.pwd)return void kError.update({error:"enterYourPwd"});stg.data.user.pwd=e.model.pwd,stg.data.user.code=null}function t(){n.login({userInput:!0}).then((function(t){t.error||(e.model&&(e.model.pwd=e.model.code=null),e.loginOptions.redirectTo&&$location.path(e.loginOptions.redirectTo))}))}config.kotobee.permsLoaded?t():$injector.get("auth").getPermissions(t)}),800)},e.loginOptions.register=function(){modals.hide(),$location.path("/register")},e.loginOptions.forgotPassword=function(){modals.hide(),$location.path("/forgotpwd")},e.loginOptions.redeemCode=function(){e.loginOptions.mode="code",Vue.nextTick((function(){try{document.getElementsByClassName("codeInputTxt")[0].focus()}catch(e){}}))},e.loginOptions.signInByEmail=function(){e.loginOptions.mode="email",Vue.nextTick((function(){try{document.getElementsByClassName("emailInputTxt")[0].focus()}catch(e){}}))})};var c,l=null;n.refreshSignatures=function(e){var t=config.kotobee.liburl+"user/signatures";$http.post(t,getFormData(n.getAuthVars()),i).success((function(t){t.error||(stg.data.user.signatures=t.signatures,e&&e())}))};var d,u={ping:!0};function p(e){if(stg.data.currentLibrary=e,e&&e.categories){for(var t=[],n=0;n<e.categories.length;n++)t.push(e.categories[n]);for(n=0;n<e.categories.length;n++)for(var o=e.categories[n],i=0;i<t.length;i++)t[i].parent&&t[i].parent.id==o.id&&(o.children||Vue.set(o,"children",[]),t[i].nested=!0,o.children.push(t[i]));for(n=0;n<e.categories.length;n++)e.categories[n].nested&&(e.categories.splice(n,1),n--);Vue.set(stg.data.currentLibrary,"sectionsMode",null);for(n=0;n<e.categories.length;n++)if(e.categories[n].section){Vue.set(stg.data.currentLibrary,"sectionsMode",!0);break}}}function f(e){kotobee.popup(translit.get("unexpectedError"),{okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})}function h(e){var t=getFormData(n.getAuthVars());t.append("software",isReaderApp?"readerapp":"reader"),t.append("platform",navigator.userAgent),t.append("assetType",config.kotobee.mode);try{t.append("assetName","book"==config.kotobee.mode?stg.data.book.meta.dc.title:stg.data.currentLibrary.name)}catch(e){}var o=window.location.href;return t.append("assetPath",o.split("#")[0]),config.kotobee.cloudid&&t.append("assetId",config.kotobee.cloudid),"library"==config.kotobee.mode&&(stg.data.book&&null!=stg.data.book.id?t.append("bid",stg.data.book.id):e.bid&&t.append("bid",e.bid)),stg.data.user.email&&t.append("email",stg.data.user.email),stg.data.user.code&&t.append("code",stg.data.user.code),e.action&&t.append("action",e.action),e.param&&t.append("param",e.param),stg.data.book&&stg.data.book.chapter&&stg.data.book.chapter.title&&t.append("chapter",stg.data.book.chapter.title),t}return n.login=function(o,s){o||(o={});var d={func:arguments.callee,args:arguments};document.body.focus=null;var f,h,g=$q.defer();o.ping||(f=modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait"),timeLimit:1e4}),Vue.set(stg.data.user,"loggedIn",!1)),s&&(l=s),"book"==config.kotobee.mode&&(h=config.kotobee.liburl+"library/auth"),"library"==config.kotobee.mode&&(h=config.kotobee.liburl+"library/get"),r(),preview||(n.fingerprint=uuid);var m=n.getAuthVars(),v={},b=Boolean(o.accessToken||o.idToken);return stg.data.sso&&stg.data.sso.oauth?(v.ssoprovider=stg.data.sso.oauth.provider,v.ssoaccesstoken=stg.data.sso.oauth.accessToken,v.ssoidtoken=stg.data.sso.oauth.idToken,b=Boolean(v.ssoaccesstoken||v.ssoidtoken)):o.ssoProvider&&b&&(v.ssoprovider=o.ssoProvider,v.ssoaccesstoken=o.accessToken,v.ssoidtoken=o.idToken),Object.keys(v).length&&(m=Object.assign(m,v)),o.userInput&&(m.input=!0),m.platformdesc=navigator.userAgent,isNative?(m.platform="mobile","undefined"!=typeof device&&device&&(m.platformdesc=device.platform+" "+device.model+" "+device.version+" "+(device.manufacturer?device.manufacturer:""))):m.platform=desktop?"desktop":"web",m.v=readerV,o.ping&&(m.ping=!0,m.pwd=o.pwd),m.v=config.v,m.lang=stg.data.settings.language,b&&Vue.set(stg.data.user,"rememberMe",!0),$http.post(h,getFormData(m),i).success((function(i){if(clearTimeout(c),f&&modals.hide(f),i.error){if(i.cloud&&i.cloud.public&&(t=!0),!o.dontShowErrorDialog){var r={error:i.error,redirectTo:o.redirectTo,ref:d};kError.update(r)}return Vue.set(stg.data.user,"pwd",null),stg.writeSlot("user"+config.kotobee.cloudid,{}),o.ping&&n.logout({dontSignoutSSO:!0}),void g.resolve(i)}if(i.cloud&&i.cloud.public&&!i.email)return n.logout(null,!0),g.resolve(i),s?s():null;var h=3e5;void 0===h&&(h=3e5),e&&clearTimeout(e),e=setTimeout((function(){i.pwd&&(u.pwd=i.pwd),n.login(u)}),h),o.ping||(b&&i.email&&Vue.set(stg.data.user,"email",i.email),Vue.set(stg.data.user,"pwd",i.pwd),Vue.set(stg.data.user,"id",i.userid),Vue.set(stg.data.user,"name",i.username),Vue.set(stg.data.user,"lastchap",i.lastchap),Vue.set(stg.data.user,"perms",i.perms),Vue.set(stg.data.user,"signatures",i.signatures),Vue.set(stg.data.user,"role",i.role),n.getS3PathsIf(!stg.data.paths,(function(){if("book"==config.kotobee.mode&&i.chapters&&$injector.get("book").setAllowedChapters(i.chapters),stg.data.user.rememberMe){var e={rememberMe:!0};stg.data.user.email&&stg.data.user.pwd?(e.email=stg.data.user.email,e.pwd=stg.data.user.pwd):stg.data.user.code&&(e.code=stg.data.user.code),stg.writeSlot("user"+config.kotobee.cloudid,e,t)}else stg.clearSlot("user"+config.kotobee.cloudid,t);function t(){if(!i.cloudid&&!i.success)return o.dontShowErrorDialog||kError.update({error:"s_authError"}),void g.resolve({error:"s_authError"});Vue.set(stg.data.user,"loggedIn",!0),"library"==config.kotobee.mode&&(p(i),function(e){if(!e)return;if(!stg.data.user)return;if(!config.kotobee.offline)return;if(!config.kotobee.offlinedelete)return;if(!stg.data.downloaded.length)return;for(var t="",o=0;o<stg.data.downloaded.length;o++)t+=(t?",":"")+stg.data.downloaded[o].id;n.hasAccessTo({testagainst:t},(function(e){if(e&&!e.error&&(Array.isArray(e)||(e=[e]),e.length!=stg.data.downloaded.length)){for(var t=[],n=0;n<stg.data.downloaded.length;n++){for(var o=stg.data.downloaded[n],i=!1,r=0;r<e.length;r++)if(o.id==e[r].bid){i=!0;break}i||t.push(o)}var a=-1;s()}function s(){++a>=t.length||(isNative?crdv.deleteEbook(t[a],s):desktop&&$injector.get("np").deleteEbook(t[a],s))}}))}(i),a&&a()),g.resolve(i),l&&(l(i),l=null)}})))})).error((function(e){clearTimeout(c),modals.hide(),kError.update({error:e||"networkError",ref:d})})),g.promise},n.libraryHasPublicBooks=function(){return t},n.logout=function(e,t){if(e||(e={}),!t){if(d)return n.logout(e,!0);var o={title:translit.get("confirmation"),msg:translit.get("logoutConfirm"),barStyle:"bar-dark",dontAskChecked:d},i={label:"logout",style:"button-positive",func:function(){o.dontAskChecked&&(d=!0),modals.hide(),n.logout(e,!0)}},r={label:"cancel",func:function(){o.dontAskChecked&&(d=!0),modals.hide()}};return o.dontAsk=!0,o.btns=[i,r],modals.show({mode:"confirm",confirmOptions:o})}e.dontSignoutSSO||$injector.get("login").logout(),Vue.set(stg.data.user,"pwd",null),Vue.set(stg.data.user,"loggedIn",!1),Vue.set(stg.data.user,"email",null),Vue.set(stg.data.user,"code",null),stg.data.sso&&stg.data.sso.oauth&&delete stg.data.sso.oauth,kInteractive.questions.f.clearSavedAnswers(),stg.writeSlot("user"+config.kotobee.cloudid,stg.data.user,(function(){"library"==config.kotobee.mode?$timeout((function(){if(t||kError.update({error:"s_authError"}),n.cloudParam("entry")){stg.data.currentLibrary.books||(stg.data.currentLibrary.books=[]);for(var e=0;e<stg.data.currentLibrary.books.length;e++)stg.data.currentLibrary.books[e].favorite=!1;$injector.get("library").applyExistingBooks()}else stg.data.currentLibrary={};s&&s()}),200):$injector.get("login").toLoginScreen()}))},n.getPermissions=function(e){var t={func:arguments.callee,args:arguments},o={};return o.env=config.kotobee.mode,o.cloudid=config.kotobee.cloudid,$http.post(config.kotobee.liburl+"library/permissions",getFormData(o),i).success((function(t){if(t.error){kError.update({error:"errorAndCallback",msg:t.error,cb:crdv.exit});var n=document.getElementsByClassName("loaded");n.length&&n[0].parentNode.removeChild(n[0])}else e&&e(t)})).error((function(o){(isNative||desktop)&&n.cloudParam("offline")?e&&e({error:"offline"}):kError.update({error:o||"networkError",ref:t})}))},n.register=function(e,t){var o={func:arguments.callee,args:arguments},r=modals.show({mode:"loading",loadingMsg:translit.get("registeringAccount")}),a=n.getAuthVars();if(a.email=e.email1,a.promocode=e.promocode,a.name=e.name,e.dob){var s=new Date(e.dob);a.dob=s.getDate()+"-"+s.getMonth()+"-"+s.getFullYear()}a.organization=e.organization,a.dept=e.dept,a.univ=e.univ,a.faculty=e.faculty,a.class=e.class,a.division=e.division,a.customid=e.customid,a.gender=e.gender,a.country=e.country,a.city=e.city,a.phone=e.phone,a.info=e.info,a.root=config.kotobee.liburl,a.lang=stg.data.settings.language;var c=getFormData(a);return c.append("platform",navigator.userAgent),$http.post(config.kotobee.liburl+"user/register",c,i).success((function(e){if(modals.hide(r),e.error)return kError.update(e),t?t():null;t&&t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.forgotPwd=function(e,t){var o={func:arguments.callee,args:arguments},r=modals.show({mode:"loading",loadingMsg:translit.get("retrieving")}),a=n.getAuthVars();a.email=e.email,a.root=config.kotobee.liburl;var s=getFormData(a);return $http.post(config.kotobee.liburl+"user/forgotpwd",s,i).success((function(e){modals.hide(r),e.error?kError.update(e):t&&t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.redeemCode=function(e,t){var o={func:arguments.callee,args:arguments},r=getFormData(n.getAuthVars());r.append("redeemcode",e.code),r.append("platform",navigator.userAgent),$http.post(config.kotobee.liburl+"user/redeemcode",r,i).success((function(e){t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.getNotebook=function(e,t){var o=getFormData(n.getAuthVars());null!=e.chapter&&o.append("chapter",e.chapter),null!=e.chaptername&&o.append("chaptername",e.chaptername),null!=e.file&&o.append("file",e.file),o.append("ver",e.ver),$http.post(config.kotobee.liburl+"library/notebook/all",o,i).success((function(e){e.error&&kError.update(e),t&&t(e)})).error((function(e){Vue.set(stg.data,"syncing",!1),t&&t()}))},n.downloadBinaryFile=function(e,t,o,i){o||(o={});var r={responseType:"arraybuffer",method:"GET",showProgress:!1};return r.onProgress=o.onProgress,n.sendRawPost(e,{serial:"."},r,(function(e){desktop?np.writeArrayBuffer(e,t,{},(function(){i&&i(!0)})):isNative&&crdv.resolvePath(ph.removeFilename(t),ph.basename(t),(function(t,n){crdv.writeFile(e,n,{parentDir:t},(function(){i&&i(!0)}))}))}))},n.userLoggedIn=function(){if(stg.data.user.loggedIn)return!0;try{if("library"==config.kotobee.mode&&stg.data.book&&("public"==stg.data.book.accessmode||"all"==stg.data.book.accessmode))return!0}catch(e){}},n.downloadEbookTest=function(e,t){var o={id:e.id,mode:e.binary};return n.sendRawPost("http://192.168.1.5/files/test.zip",o,{responseType:"blob",onProgress:function(e){}},(function(e){if(e.error)return kError.update(e),void t();t(e)}))},n.downloadEbook=function(e,t,o){try{var i={func:arguments.callee,args:arguments},r={responseType:"blob",onProgress:t};mobile&&isNative&&(r.responseType="arraybuffer");var a={id:e.id,mode:"binary",requester:"reader"};return n.sendRawPost(config.kotobee.liburl+"library/ebook/download",a,r,(function(e){if(e.error)return kError.update({error:e.error?e.error:"networkError",ref:i}),void o();o(e)}))}catch(e){}},n.tincan=function(e,t){var o=getFormData(n.getAuthVars());for(var r in e)o.append(r,e[r]);$http.post(config.kotobee.liburl+"tincan",o,i).success((function(e){t&&t()})).error((function(e,t){}))},n.getUnauthLibrary=function(e){if("library"==config.kotobee.mode){var t={func:arguments.callee,args:arguments},o=getFormData(n.getAuthVars());$http.post(config.kotobee.liburl+"library/getbasic",o,i).success((function(t){t.error&&(isNative||desktop)&&n.cloudParam("offline")?e&&e({error:"offline"}):(p(t),e&&e(t))})).error((function(o){(isNative||desktop)&&n.cloudParam("offline")?e&&e({error:"offline"}):kError.update({error:o||"networkError",ref:t})}))}},n.addtoFav=function(e,t){var o={func:arguments.callee,args:arguments},r=getFormData(n.getAuthVars());r.append("bid",e.id),r.append("cloudid",n.cloudParam("cloudid")),r.append("type","book"),$http.post(config.kotobee.liburl+"library/favorite/add",r,i).success((function(e){if(e.error)return kError.update(e),void t();t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.removeFav=function(e,t){var o={func:arguments.callee,args:arguments},r=getFormData(n.getAuthVars());r.append("bid",e.id),r.append("cloudid",n.cloudParam("cloudid")),r.append("type","book"),$http.post(config.kotobee.liburl+"library/favorite/remove",r,i).success((function(e){if(e.error)return kError.update(e),void t();t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.updateAnnotation=function(e,t){var o=getFormData(n.getAuthVars());o.append("cloudid",e.cloudid),o.append("location",e.location),e.bid&&o.append("bid",e.bid),e.nid&&o.append("nid",e.nid),e.hid&&o.append("hid",e.hid),$http.post(config.kotobee.liburl+"library/notebook/update",o,i).success((function(e){t&&t(e)})).error((function(e){}))},n.createOrder=function(e,t){var o=getFormData(n.getAuthVars());e.bid&&o.append("bid",e.bid),e.platform&&o.append("platform",e.platform),e.accountemail&&o.append("accountemail",e.accountemail),e.items&&o.append("items",e.items),$http.post(config.kotobee.liburl+"library/order/add",o,i).success((function(e){t&&(e.order&&e.order.id||f(),t(e))})).error((function(e){f()}))},n.getOrder=function(e,t){var n=getFormData();n.append("orderid",e.orderid),n.append("uid",e.uid),n.append("valid",e.valid),$http.post(config.kotobee.liburl+"library/order/get",n,i).success((function(e){t&&t(e)})).error((function(e){}))},n.checkBookUpdates=function(e,t){var o=getFormData(n.getAuthVars());o.append("bid",e.bid),null!=e.checksum&&o.append("checksum",e.checksum),null!=e.ver&&o.append("ver",e.ver),$http.post(config.kotobee.liburl+"library/ebook/checkupdates",o,i).success((function(e){e.error?t():t(e)})).error((function(e){}))},n.getServerLang=function(e){if(isKotobeeHosted()&&!config.loadLangsLocally){var t=getFormData();return t.append("lang",e.lang),t.append("root",rootDir),t.append("v",readerV),t.append("base",publicRoot),khttp.post(config.kotobee.liburl+"library/getlang",t,i)}return khttp.get(cacheBust(rootDir+"locales/"+e.lang+".js"))},n.setLang=function(e,t){if(!preview&&config.kotobee.cloudid){var o=getFormData(n.getAuthVars());o.append("lang",e.lang),$http.post(config.kotobee.liburl+"user/setlang",o,i).success((function(e){t&&t(e)})).error((function(e){t&&t({error:!0})}))}},n.getS3PathsIf=function(e,t){if(e)return n.getS3Paths(t);t({})},n.getS3Paths=function(e){var t=getFormData();$http.post(config.kotobee.liburl+"library/s3paths",t,i).success((function(t){if(t.error)return kError.update(t);stg.data.paths=t,function(e){for(var t=0;t<o.length;t++)o[t].event==e&&o[t].func()}("pathsChanged"),e&&e(t)})).error((function(t){e&&e({error:!0})}))},n.verifyCloudEmail=function(e,t){var o=getFormData(n.getAuthVars());o.append("cloudemail",e.cloudemail),e.pwd&&o.append("pwd",e.pwd),$http.post(config.kotobee.liburl+"user/verify",o,i).success((function(e){t&&t(e)})).error((function(){}))},n.addBookStat=function(e,t){if(e||(e={}),!preview&&config.kotobee.cloudid){window.location.href;0;var o=getFormData(n.getAuthVars());o.append("type",e.type),$http.post(config.kotobee.liburl+"library/ebook/stat",o,i).success((function(e){})).error((function(){}))}},n.addEvent=function(e,t){if(e||(e={}),!preview&&!config.disableEventTracking){var n=window.location.href;if(debug||!(n.indexOf("localhost/")>=0||n.indexOf("localhost:")>=0)){var o=h(e);$http.post(config.kotobee.liburl+"event/add",o,i).success((function(e){t&&t(e)})).error((function(){}))}}},n.addStat=function(e,t){if(e||(e={}),!preview){var n=window.location.href;if(!(n.indexOf("localhost/")>=0||n.indexOf("localhost:")>=0)){var o=h(e);$http.post(config.kotobee.liburl+"stat/add",o,i).success((function(e){t&&t(e)})).error((function(){}))}}},n.getUserProfile=function(e,t){var o={func:arguments.callee,args:arguments},r=getFormData(n.getAuthVars());$http.post(config.kotobee.liburl+"user/profile",r,i).success((function(e){if(e.error)return kError.update(e),void t();t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.updateProfile=function(e,t){var o={func:arguments.callee,args:arguments},r=getFormData(n.getAuthVars());if(delete e.cloudid,e.dob){var a=new Date(e.dob);e.dob=a.getDate()+"-"+a.getMonth()+"-"+a.getFullYear()}for(var s in e)r.append(s,e[s]);$http.post(config.kotobee.liburl+"user/update",r,i).success((function(e){if(e.error)return kError.update(e),void t();t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.setUserData=function(e,t){var o=getFormData(n.getAuthVars());o.append("label",e.label),o.append("data",e.data),e.overwrite&&o.append("overwrite",e.overwrite),e.category&&o.append("category",e.category),e.subcategory&&o.append("subcategory",e.subcategory),e.options&&o.append("options",e.options),$http.post(config.kotobee.liburl+"cloud/set",o,i).success((function(e){if(e.error)throw e;t(e)})).error((function(){throw"Network Error. Please try again"}))},n.getUserData=function(e,t){var o=getFormData(n.getAuthVars());e.label&&o.append("label",e.label),e.category&&o.append("category",e.category),e.subcategory&&o.append("subcategory",e.subcategory),e.allUsers&&o.append("allUsers",!0),e.options&&o.append("options",e.options),$http.post(config.kotobee.liburl+"cloud/get",o,i).success((function(e){if(e.error)throw e;t(e)})).error((function(){throw"Network Error. Please try again"}))},n.getDataPerms=function(e){var t=getFormData(n.getAuthVars());$http.post(config.kotobee.liburl+"cloud/perms",t,i).success((function(t){if(t.error)throw t;e(t)})).error((function(){throw"Network Error. Please try again"}))},n.getUserList=function(e,t){var o=getFormData(n.getAuthVars());e.role&&o.append("role",e.role),$http.post(config.kotobee.liburl+"cloud/users",o,i).success((function(e){if(e.error)throw e;t(e)})).error((function(){throw"Network Error. Please try again"}))},n.getUserDataArray=function(e,t){var o=getFormData(n.getAuthVars());e.array&&o.append("array",e.array),$http.post(config.kotobee.liburl+"cloud/getarray",o,i).success((function(e){if(e.error)throw e;t(e)})).error((function(){throw"Network Error. Please try again"}))},n.setUserDataArray=function(e,t){var o=getFormData(n.getAuthVars());e.array&&o.append("array",e.array),$http.post(config.kotobee.liburl+"cloud/setarray",o,i).success((function(e){t(e)})).error((function(){throw"Network Error. Please try again"}))},n.deleteUserData=function(e,t){var o=getFormData(n.getAuthVars());o.append("label",e.label),o.append("data",e.data),e.all&&o.append("all",e.all),e.category&&o.append("category",e.category),e.subcategory&&o.append("subcategory",e.subcategory),e.options&&o.append("options",e.options),$http.post(config.kotobee.liburl+"cloud/delete",o,i).success((function(e){if(e.error)throw e;t(e)})).error((function(){throw"Network Error. Please try again"}))},n.requestClearDevices=function(e,t){var o={func:arguments.callee,args:arguments},r=getFormData(n.getAuthVars());e.email?r.append("email",e.email):r.append("code",e.code),$http.post(config.kotobee.liburl+"user/requestcleardevices",r,i).success((function(e){if(e.error)return kError.update(e),void t();t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o})}))},n.sendEmail=function(e,t){var o=getFormData(n.getAuthVars());o.append("to",e.to),o.append("message",e.message),o.append("subject",e.subject),e.cc&&o.append("cc",e.cc),e.html&&o.append("html",e.html),e.fromEmail&&o.append("fromEmail",e.fromEmail),e.fromName&&o.append("fromName",e.fromName),$http.post(config.kotobee.liburl+"cloud/send",o,i).success((function(e){if(e.error)throw e;t(e)})).error((function(){throw"Network Error. Please try again"}))},n.getReviews=function(e,t){var o=getFormData(n.getAuthVars());e.uid&&o.append("uid",e.uid),e.bid&&o.append("bid",e.bid),e.max&&o.append("max",e.max),$http.post(config.kotobee.liburl+"library/review/all",o,i).success((function(e){t(e)})).error((function(){t()}))},n.sendDeletionRequest=function(e){var t=getFormData(n.getAuthVars());$http.post(config.kotobee.liburl+"user/requestdelete",t,i).success((function(t){e(t)})).error((function(){e()}))},n.addReview=function(e,t){var o=getFormData(n.getAuthVars());o.append("content",e.content),e.bid&&o.append("bid",e.bid),null!=e.rating&&o.append("rating",e.rating),e.name&&o.append("name",e.name),$http.post(config.kotobee.liburl+"library/review/add",o,i).success((function(e){t(e)})).error((function(){}))},n.externalLink=function(e,t){try{if(t||(t={}),t.secure&&!isNative&&!desktop&&!preview)return void $window.open(e);var o=function(e,t){isNative?crdv.openInNativeBrowser(e,t):desktop?require("nw.gui").Shell.openExternal(e):window.open(e,"_blank")};if(t.target&&"_blank"==t.target.toLowerCase())return void o(e,!0);if(isNative)return void o(e);var i={title:translit.get("externalLink"),src:$sce.trustAsResourceUrl(e),openInNativeBrowser:o,status:"loading"},r=setTimeout((function(){i.status="",i.error=translit.get("errorLoadingPage"),$rootScope.$$phase||$rootScope.$apply()}),1e4);i.loaded=function(e,t,n){i.status="loaded",clearTimeout(r),$rootScope.$$phase||$rootScope.$apply()};var a=modals.show({mode:"externalSite",animation:"slide-in-up",dynamic:!0,backdropClickToClose:!1,siteOptions:i});desktop||preview||n.getXframeOptions({url:e},(function(t){if(i.status="loaded",$rootScope.$$phase||$rootScope.$apply(),t&&t.success){var n=t.success.toLowerCase();"sameorigin"!=n&&"deny"!=n||(modals.hide(a),setTimeout((function(){modals.show({mode:"xFrameError",errorOptions:{url:e,openInNativeBrowser:o}})}),500))}}))}catch(e){}},n.createRequest=function(e,t,o){t||(t={});var r=getFormData(n.getAuthVars());for(var a in t)r.append(a,t[a]);$http.post(e,r,i).success((function(e){o(e)})).error((function(){o(!1)}))},n.convertPDF=function(e,t){if(e||(e={}),!preview){var o=getFormData(n.getAuthVars());o.append("url",e.url),$http.post(config.kotobee.liburl+"library/pdf",o,i).success((function(e){t(e)})).error((function(){}))}},n.smartExplain=function(e,t){e||(e={});var o=getFormData(n.getAuthVars());o.append("keyword",e.keyword),$http.post(config.kotobee.liburl+"library/tool/smartexplain",o,i).success((function(e){t(e)})).error((function(){}))},n.validatePdfConversion=function(e,t){var o=getFormData(n.getAuthVars());for(var r in e)o.append(r,e[r]);$http.post(config.kotobee.liburl+"library/pdf/validate",o,i).success((function(e){t(e)})).error((function(e){}))},n.getXframeOptions=function(e,t){var o=getFormData(n.getAuthVars());o.append("url",e.url),$http.post(config.kotobee.liburl+"getxframe",o,i).success((function(e){e.error?t():t(e)})).error((function(e){}))},n.hasAccessTo=function(e,t){var o=getFormData(n.getAuthVars());for(var r in e||(e={}),e)o.append(r,e[r]);o.append("v",readerV),$http.post(config.kotobee.liburl+"user/access",o,i).success((function(e){if(!e||e.error)return e.error?t?t(e):null:t?t({error:""}):null;if(config.kotobee.payment);t&&t(e)})).error((function(e,n){t&&t({error:""})}))},n.setLastChapter=function(e){var t=getFormData(n.getAuthVars());t.append("chapter",currentIndex),$http.post(config.kotobee.liburl+"user/lastchap",t,i).success((function(t){e&&e(t)})).error((function(t,n){e&&e({error:""})}))},n.cloudParam=function(e){return config.kotobee[e]},n.getEbook=function(e,t){var o={func:arguments.callee,args:arguments},r=getFormData(n.getAuthVars());for(var a in e)r.append(a,e[a]);$http.post(config.kotobee.liburl+"library/ebook/get",r,i).success((function(e){e.error&&kError.update(e),e.pricing||(e.pricing=[]),config.kotobee.payment,t&&t(e)})).error((function(e){kError.update({error:e||"networkError",ref:o}),t&&t({error:e||"networkError"})}))},n.getEbooks=function(e,t,o){var r={func:arguments.callee,args:arguments},a=(n.getAuthVars(),getFormData(n.getAuthVars()));for(var s in e)a.append(s,e[s]);a.append("v",readerV),a.append("includeauthor",1),a.append("includecategory",1),$http.post(config.kotobee.liburl+"library/ebook/all",a,i).success((function(e){e.error&&kError.update(e),config.kotobee.payment,o&&o(e,t)})).error((function(e){kError.update({error:e||"networkError",ref:r}),o&&o({error:e||"networkError"},t)}))},n.sendRawPost=function(e,t,o,i,r){var a={func:arguments.callee,args:arguments};r||(r=0),t||(t={});var s="",c={};if(t&&t.forEach?t.forEach((function(e,t){c[t]=e})):Object.assign(c,t),!o.ignoreCredentials){var l=n.getAuthVars();c=Object.assign(l,c)}if(o.queryString)s=Object.entries(c).map((function(e){var t=e[1];return Array.isArray(t)?(t=serializeObject(t,e[0]),Object.entries(t).map((function(e){return e[0]+"="+encodeURIComponent(e[1])})).join("&")):e[0]+"="+encodeURIComponent(t)})).join("&"),e+=s?"?"+s:"";else if(o.requestType&&"json"==o.requestType.toLowerCase())s=JSON.stringify(c);else for(var d in c){var u=c[d];null!=u&&("object"!=_typeof(u)&&("string"==typeof u&&(u=encodeURIComponent(u=("."+u).substr(1))),"boolean"==typeof u&&(u=u?1:0),s+="&"+d+"="+u))}var p=new XMLHttpRequest;return p.id=999*Math.random(),p.open(o.method?o.method:"POST",e,!0),"GET"!=o.method&&p.setRequestHeader("Content-type",o.requestType&&"json"==o.requestType.toLowerCase()?"application/json;charset=UTF-8":"application/x-www-form-urlencoded"),o.onProgress&&(p.onprogress=function(e){var t;if(e.lengthComputable)t=e.loaded/e.total;else{if(!e.target.getResponseHeader("x-decompressed-content-length"))return;t=e.loaded/Number(e.target.getResponseHeader("x-decompressed-content-length"))}o.onProgress(t)}),o.responseType&&(p.responseType=o.responseType),p.onreadystatechange=function(t){if(!p.aborted){var o=p.status;if(0==o&&("file:"==window.location.protocol&&(o=200),"chrome-extension:"==window.location.protocol&&(o=200),"kotobee:"==window.location.protocol&&(o=200)),4==p.readyState)if(200==o){var r=p.response,a=getUrlExt(e);if(!p.responseType||"json"==p.responseType||"js"==a||"json"==a)try{r=JSON.parse(r)}catch(e){}i&&(i(r),n.abort(p))}else p.onerror()}},p.addEventListener("error",(function(e){p.aborted||(n.abort(p),i&&(a.args[4]=null,i({error:"networkError",ref:a})))}),!1),p.onerror=function(s){return p.aborted?p:r>=3?(n.abort(p),void(i&&(a.args[4]=null,i({error:"networkError",ref:a})))):(n.abort(p),n.sendRawPost(e,t,o,i,++r))},o.queryString||"GET"==o.method?p.send():p.send(s),p},n.abort=function(e){e&&(e.aborted=!0,4!=e.readyState&&e.abort&&e.abort())},n.getChapterTranslation=function(e,t){try{n.sendRawPost(config.kotobee.liburl+"library/tool/translateChapter",e,{ignoreCredentials:!1},(function(e){modals.hide(),e.error&&kError.update({error:e.error?e.error:"networkError"}),t(e)}))}catch(e){}},n})),createService("book",(function(){var e,t={};function n(){for(var e in config)"kotobee"!=e&&delete config[e]}function o(e,t){var n=e.sharedTemplateJs,o=e.version,i=(window.location.origin,Math.round(9999*Math.random()));"book"==config.kotobee.mode&&!isReaderApp&&o>=1.3&&!n?khttp.get("js/templates.js?c="+i).success(t).error((function(){kError.update({error:"networkError",ref:ref})})):t()}function i(){e&&config&&(config.gAnalyticsMeasurementId||(config.gAnalyticsMeasurementId=e.gAnalyticsMeasurementId),config.gAnalyticsID||(config.gAnalyticsID=e.gAnalyticsID))}function r(e){for(var t=document.createElement("ol"),n=0;n<e.childNodes.length;n++)if(e.childNodes[n]){var o=e.childNodes[n];if(8!=o.nodeType&&"#text"!=o.nodeName&&"navpoint"==o.nodeName.toLowerCase()){for(var i,a,s,c=0;c<o.childNodes.length;c++)if(o.childNodes[c]){var l=o.childNodes[c].nodeName.toLowerCase();"content"==l?a=o.childNodes[c].getAttribute("src"):"navlabel"==l?i=o.childNodes[c].textContent.trim():"navpoint"==l&&(s||(s=r(o)))}var d=document.createElement("li"),u=document.createElement("a");u.innerHTML=i||"",u.setAttribute("href",a?ph.join(stg.data.tocPath,a):""),d.appendChild(u),s&&d.appendChild(s),t.appendChild(d)}}return t}return t.root="",t.currentBook=null,t.initialize=function(){},t.getCoverImgPath=function(e,t){if(t||(t=e.path),!e.cover)return"img/ui/defaultCover.png";var n="";return n=stg.data.currentLibrary.cloud&&stg.data.currentLibrary.cloud.public?stg.getPublicRoot("book")+e.path+"/EPUB/"+e.cover:$filter("coverPath")(e.cover,t),e.downloaded&&(isNative?n=crdv.libEbooksDirectory.nativeURL+t+"/EPUB/"+e.cover:desktop&&(n=ph.normalize(np.getBooksPath()+t+"/"+e.cover))),(desktop||isNative)&&(e.prepackage&&(n=ph.normalize("books/"+t+"/"+e.cover)),e.downloaded&&(n=n.replace("_thumb.","."))),n=cleanURL(n)},t.getBgImgPath=function(e,t){if(t||(t=e.path),!e.cover)return"";var n=stg.getPublicRoot("book");return n+=e.path+"/"+e.bgimg},t.setAllowedChapters=function(e){if(t.allowedChapters=null,e&&e.length){for(var n=e.split(","),o=0;o<n.length;o++)n[o]=n[o];t.allowedChapters=n}},t.reload=function(){t.open(t.currentBook,{defaultIndex:currentIndex})},t.open=function(o,r){if(r||(r={}),preview)return modals.hide(),void setTimeout((function(){modals.show({mode:"generalError",errorOptions:{msg:translit.get("cantPreviewLibBook")}})}),500);var a="download";r.openRemotely?a="open":o.openmethod&&("open"==o.openmethod?a="open":0==o.openmethod.indexOf("download")&&(a="download")),bookPath=function(e,t){if((desktop||isNative)&&e.prepackage)return bookPath="books/"+e.path+"/";isNative&&"download"==t?(crdv.vibrate(),bookPath=cleanURL(crdv.libEbooksDirectory.nativeURL+e.path+"/EPUB/")):desktop&&"download"==t?(bookPath=np.getBooksPath()+e.path+"/","mac"==os&&(bookPath="file://"+bookPath)):(bookPath=(stg.data.currentLibrary.cloud.public,config.kotobee.liburl+"books/"),bookPath+=e.path+"/EPUB/");return bookPath}(o,a),t.currentBook=o,modals.hide(),setTimeout((function(){kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),function(e){if((isNative||desktop)&&"download"==a&&o.downloaded){var t={success:!0},n=np.getBooksPath()+o.path;return"mac"==os&&(n=np.getBooksPath()+"/"+o.path),isNative&&(n=cleanURL(crdv.libEbooksDirectory.nativeURL+o.path+"/EPUB")),void khttp.get(cacheBust(ph.join(n,"access.json"))).success((function(n){try{t.chapters=n.chapters}catch(e){}e(t)})).error((function(){e(t)}))}backend.hasAccessTo({testagainst:o.id,open:!0},e)}((function(a){if(a.success){t.setAllowedChapters(a.chapters),o.id&&stg.writeSlot("lastBook",o.id);var s=t.loadBook;"audiobook"==o.type&&(s=audiobook.loadBook),s().then((function(){!function(t,o){if(!t.dver||t.dver<2)return o();if(config.noBookOverride)return o();function r(){design.applyRichTextLibrary(),design.convertTabs(),security.applyContextmenu(),o&&o()}khttp.get(cacheBust(ph.join(bookPath,"_kmeta/config.js"))).success((function(t){if(!t||t.error)return o();if(-1==t.indexOf("var config"))return o();t=t.replace("var config","var bookConfig");var a=document.createElement("script");a.setAttribute("bookconfig",!0);var s=document.getElementsByTagName("head");s.length&&s[0].appendChild(a),a.innerHTML=t,e||(e=clone(config)),n(),Object.assign(config,bookConfig,{kotobee:config.kotobee}),config.src="book",setConfigDefaults(),i(),Vue.set(stg.data.settings,"viewMode",config.defaultViewMode?config.defaultViewMode:"auto"),Vue.set(stg.data.settings,"navAnim",config.defaultNavAnim?config.defaultNavAnim:"navBookBlock"),Vue.set(stg.data.settings,"pageScroll",null==config.defaultPageScroll||config.defaultPageScroll),design.injectUserCSS(config),r()})).error((function(){r()}))}(o,(function(){if(stg.data.book.accessmode=o.accessmode,stg.data.book.id=o.id,t.root="/book/"+stg.data.book.id,stg.data.epub.bookThumb=t.getCoverImgPath(o,stg.data.book.path),chromeApp)if(stg.data.chromeAssets[stg.data.book.bookThumb])stg.data.epub.bookThumb=stg.data.chromeAssets[stg.data.book.bookThumb];else{var e=stg.data.epub.bookThumb;delete stg.data.epub.bookThumb,getImgDataSrc(e,(function(t){stg.data.epub.bookThumb=t,stg.data.chromeAssets[e]=t}))}kStatus.update();var n="",i=r.defaultIndex;null!=r.defaultUrl&&(i=chapters.indexFromUrl(r.defaultUrl)),null!=i&&(n="/chapter/"+i);var a=t.root+"/reader"+n;"audiobook"==o.type&&(a=t.root+"/audiobook"+n),$location.path(a),"audiobook"!=o.type&&(sync.initialize(),kMiniapps.initialize(),freehand.initialize()),setTimeout((function(){"audiobook"!=o.type&&chapters.initialize(i),kotobee.dispatchEvent("bookOpened",stg.data.book)}),r.noDelay?0:1e3)}))}))}else kStatus.update()}))}),r.noDelay?0:200)},t.removeBookConfigElem=function(){for(var t=document.getElementsByTagName("script"),o=0;o<t.length;o++)if(t[o].hasAttribute("bookconfig")){t[o].parentNode.removeChild(t[o]);break}e&&(n(),Object.assign(config,e,{kotobee:config.kotobee}),design.injectUserCSS(config),security.applyContextmenu())},t.loadBook=function(e){e||(e={});var n={func:arguments.callee,args:arguments},a=$q.defer();function s(){$filter("contentSrc")(stg.data.toc,ph.join(bookPath,stg.data.packageURL,stg.data.tocPath)),$filter("chapterHtml")(stg.data.toc),function(){var e=stg.data.toc;if(!t.allowedChapters)return;for(var n=e.getElementsByTagName("a"),o=0;o<t.allowedChapters.length;o++){var i,r,a=t.allowedChapters[o],s=null;if(isNaN(a)){if((r=a.replace(/['"](.*?)['"]/g,"$1")).match(/\[\*\]$/g)&&(s=!0,r=r.replace(/\[\*\]$/g,"")),r.match(/^index::/g)){var c=r.replace(/^index::/g,"");i=chapters.getChapterURL(Number(c)),r=""}}else i=chapters.getChapterURL(Number(a));for(var l=0;l<n.length;l++){var d=null;r&&r==n[l].textContent&&(d=!0),i&&(i==n[l].getAttribute("data-url")&&(d=!0),i==n[l].getAttribute("href")&&(d=!0)),d&&(n[l].setAttribute("data-allow",!0),s&&n[l].setAttribute("data-allow-children",!0))}}for(l=0;l<n.length;l++){if(d=n[l].hasAttribute("data-allow")||n[l].hasAttribute("data-dontshow")||hasClass(n[l],"parentNotRestricted")){if(n[l].removeAttribute("data-allow"),n[l].hasAttribute("data-allow-children"))if((p=n[l].nextElementSibling)&&"ol"==p.nodeName.toLowerCase()){var u=p.getElementsByTagName("a");for(o=0;o<u.length;o++)addClass(u[o],"parentNotRestricted")}}else{n[l].className="restricted",n[l].setAttribute("data-index",l);var p,f=document.createElement("label");f.className="restrictedLabel",f.textContent=translit.get("restricted"),n[l].parentNode.appendChild(f),(p=n[l].parentNode.getElementsByTagName("ol")[0])&&n[l].parentNode.appendChild(p)}}for(l=0;l<n.length;l++){var h=n[l].getAttribute("href"),g=getElementsByAttribute(stg.data.epub.manifest,"item","href",h);if(g.length){var m=getElementsByAttribute(stg.data.epub.spine,"itemref","idref",g[0].id);if(m.length&&"restricted"==n[l].className)for(var v=m.length;v--;)if("no"!=m[v].getAttribute("linear")){m[v].setAttribute("linear","no");break}}}var b=e.getElementsByClassName("restricted");for(l=0;l<b.length;l++)b[l].setAttribute("href","")}(),"files"==config.serialNavMode&&function(){stg.data.toc;for(var e=stg.data.epub.spine.getElementsByTagName("itemref"),t=1;t<e.length;t++){for(var n=null,o=t-1;o>=0;o--)if("no"!=e[o].getAttribute("linear")&&e[o].getAttribute("idref")==e[t].getAttribute("idref")){n=!0;break}n&&e[t].setAttribute("linear","no")}}(),stg.data.book.chapters=stg.data.toc.innerHTML,a.resolve()}return stg.resetBook(),cssParser.clearCache(),jsParser.clearCache(),chapters.clearCache(),khttp.get(cacheBust(ph.join(bookPath,"META-INF/container.xml?v="+readerV))).success((function(t){config.kotobee.encodekey&&!kInteractive.isSDK()&&(t=config.v>=1.1?CryptoJS.AES.decrypt(t,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,t));var c=parseXml(t);stg.data.epub={};try{stg.data.packageURL=c.getElementsByTagName("rootfile")[0].getAttribute("full-path")}catch(e){return kStatus.update(),void kError.update({error:"errorAndCallback",msg:isNative?"errorLoadingBookNative":"errorLoadingBook",cb:crdv.exit})}design.convertTabs();var l=config.v,d=isNative||isKotobeeHosted();o({sharedTemplateJs:d,version:l},(function(t){var o=e.getInfoOnly?"&info":"";khttp.get(cacheBust(ph.join(bookPath,stg.data.packageURL))+o).success((function(n){if(stg.data.packageOpf=n,"book"==config.kotobee.mode&&!isReaderApp)if(l>=1.3){var o=CryptoJS.MD5(n.replace(/\s+/g,"")).toString();if(config.kotobee.hostPath&&"kotobee"==config.kotobee.hostType&&(o=""),d){if(0!=config.checksum.indexOf(o))return void u()}else{var c=CryptoJS.MD5(t).toString();if(o+c!=config.checksum&&(t=t.replace(/(\S)\n/g,"$1\r\n"),o+(c=CryptoJS.MD5(t).toString())!=config.checksum))return u()}}else if(l>=1.2&&CryptoJS.MD5(n).toString()!=config.checksum)return void u();function u(){kStatus.update(),modals.show({mode:"generalError",errorOptions:{msg:translit.get("errorLoadingPage")}});var e=document.getElementsByClassName("loaded");e.length&&e[0].parentNode.removeChild(e[0])}config.kotobee.encodekey&&!kInteractive.isSDK()&&(n=config.v>=1.1?CryptoJS.AES.decrypt(n,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,n));var p=parseXml(n=n.replace(/href="([^"]*?&[^"]*?)"/g,(function(e,t){return'href="'+t.replace(/&/g,"")+'"'})));stg.data.epub.metadata=p.getElementsByTagName("metadata")[0],stg.data.epub.manifest=p.getElementsByTagName("manifest")[0],stg.data.epub.spine=p.getElementsByTagName("spine")[0],stg.data.epub.guide=p.getElementsByTagName("guide")[0],stg.data.mediaList=[],stg.data.book.meta={},stg.data.book.version=3;try{for(var f=0;f<stg.data.epub.metadata.childNodes.length;f++){var h;if(8!=(h=stg.data.epub.metadata.childNodes[f]).nodeType&&"#text"!=h.nodeName){if(h.hasAttribute("name")&&"meta"==h.nodeName.toLowerCase())stg.data.book.meta[h.getAttribute("name")]=h.getAttribute("content");else for(var g=(h.hasAttribute("property")?h.getAttribute("property"):h.nodeName).split(":"),m=stg.data.book.meta,v=0;v<g.length;v++)v==g.length-1?m[g[v].toLowerCase()]=h.innerHTML?h.innerHTML:h.textContent:(m[g[v].toLowerCase()]||(m[g[v].toLowerCase()]={}),m=m[g[v].toLowerCase()]);if(h.hasAttribute("id")){var b=h.nodeName.toLowerCase().split(":")[0];stg.data.book.meta[b]||(stg.data.book.meta[b]={}),stg.data.book.meta[b][h.getAttribute("id")]=h.textContent}}}}catch(e){}if(stg.data.book.meta.kotobee&&stg.data.book.meta.kotobee.spine){var k=kInteractive.readRawData(stg.data.book.meta.kotobee.spine);if(k&&k.raw){var y=document.createElement("div");y.innerHTML=k.raw.replace(/\/>/g,"></itemref>"),stg.data.epub.spine=y.children[0]}}var w=stg.data.epub.spine.getAttribute("page-progression-direction");w&&(stg.data.book.meta.dir=w);var C=getElementsByAttribute(stg.data.epub.manifest,"item","properties","cover-image");if((C.length>0||stg.data.book.meta.cover&&(C=getElementsByAttribute(stg.data.epub.manifest,"item","id",stg.data.book.meta.cover)).length>0)&&(stg.data.epub.bookThumb=$filter("coverPath")(C[0].getAttribute("href"))),chromeApp&&stg.data.epub.bookThumb&&(stg.data.chromeAssets[stg.data.epub.bookThumb]?stg.data.epub.bookThumb=stg.data.chromeAssets[stg.data.epub.bookThumb]:getImgDataSrc(stg.data.epub.bookThumb,(function(e){stg.data.chromeAssets[stg.data.epub.bookThumb]=e,stg.data.epub.bookThumb=e}))),e.getInfoOnly)return a.resolve(),a.promise;function x(e,t){t||(t={});for(var n=getElementsByAttribute(stg.data.epub.manifest,"item","media-type",e+"/.*"),o=0;o<n.length;o++){var i=n[o].getAttribute("href");if(0!=i.indexOf("js/widgets/")&&(0!=i.indexOf("xhtml/pdf")||-1==i.indexOf("/page"))){var r={};r.thumbnail=cleanURL(t.thumb?t.thumb:ph.join(bookPath,stg.data.packageURL,n[o].getAttribute("href"))),r.title=ph.removeExtension(ph.basename(r.thumbnail));var a=n[o].getAttribute("media-type");r.ext=a.split(e+"/")[1],r.type=e,r.src=cleanURL(ph.join(bookPath,stg.data.packageURL,n[o].getAttribute("href"))),stg.data.mediaList.push(r),chromeApp&&isAbsoluteURLAndNotDataPath(r.thumbnail)&&(stg.data.chromeAssets[r.thumbnail]?r.thumbnail=stg.data.chromeAssets[r.thumbnail]:s(r))}}function s(e,t){getImgDataSrc(e.thumbnail,(function(n){stg.data.chromeAssets[e.thumbnail]=n,e.thumbnail=n,t&&t()}))}}stg.initializeSettings(),config.videosInMediaTab&&x("video",{thumb:"img/ui/videoFile.png"}),config.audioInMediaTab&&x("audio",{thumb:"img/ui/audioFile.png"}),config.imagesInMediaTab&&x("image",{});try{stg.data.tocPath=getElementsByAttribute(stg.data.epub.manifest,"item","properties","[s]*nav[s]*")[0].getAttribute("href")}catch(e){var I=stg.data.epub.spine.getAttribute("toc");if(!I)return void s();try{stg.data.book.version=2,stg.data.tocPath=getElementsByAttribute(stg.data.epub.manifest,"item","id",I)[0].getAttribute("href")}catch(e){return void s()}}khttp.get(cacheBust(ph.join(bookPath,stg.data.packageURL,stg.data.tocPath))).success((function(e){if(config.kotobee.encodekey&&!kInteractive.isSDK()&&(e=config.v>=1.1?CryptoJS.AES.decrypt(e,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,e)),2==stg.data.book.version){var t=parseXml(e).getElementsByTagName("navMap");t.length&&(stg.data.toc=r(t[0]))}else for(var n=parseHtml(e).getElementsByTagName("nav"),o=0;o<n.length;o++)if(!n[o].hasAttribute("epub:type")||"toc"==n[o].getAttribute("epub:type"))for(var i=n[o].getElementsByTagName("ol"),a=0,c=0;c<i.length;c++){var l=i[c].getElementsByTagName("a");if(!(l.length<a)){a=l.length,stg.data.toc=i[c];for(var d=l.length;d--;)l[d].getAttribute("href")?l[d].setAttribute("href",ph.join(stg.data.tocPath,l[d].getAttribute("href"))):l[d].setAttribute("href","")}}s()})),i(),tinCan.send({verb:"opened",activity:"Book: "+stg.data.book.meta.dc.title})})).error((function(){kError.update({error:"networkError",ref:n})}))}))})).error((function(e){kStatus.update(),isNative||desktop||"file://"!=window.location.origin?kError.update({error:"errorAndCallback",msg:isNative?"errorLoadingBookNative":"errorLoadingBook",cb:crdv.exit}):kError.update({error:"This browser failed to run the ebook app locally. Please try a different browser, or upload the web files to your server and run the web app online"})})),a.promise},t.getTitleByIndex=function(e){if(stg.data.toc)try{for(var t=stg.data.toc.getElementsByTagName("li"),n=[],o=0;o<t.length;o++)if(t[o]){var i=t[o].getElementsByTagName("a");i.length&&"true"!=i[0].getAttribute("data-dontshow")&&n.push(t[o])}return n[e].getElementsByTagName("a")[0].textContent}catch(e){}},t.getContentDir=function(){if(stg.data.book.meta){if("ltr"==stg.data.book.meta.dir)return"ltr";if("rtl"==stg.data.book.meta.dir)return"rtl"}return"ar"==stg.data.settings.language?"rtl":"ltr"},t.isRtl=function(){return"rtl"==t.getContentDir()},t})),createService("bookinfo",(function(){var e,t,n,o,i={},r=[];function a(e){var t={};return t.background="url('"+e+"')",t["background-size"]="cover",t["background-position"]="center center",t.opacity="1",t.filter="none",t}function s(){d();var n="download"==e||"open"==e;"book"==config.kotobee.mode?(e="loading",Vue.set(t,"privilege",e)):((isNative||desktop)&&n&&(t.downloaded?(e="open",Vue.set(t,"privilege",e)):"public"!=t.accessmode&&"all"!=t.accessmode&&(e="loading",Vue.set(t,"privilege",e))),isNative||desktop||!n||"public"!=t.accessmode&&"all"!=t.accessmode&&(e="loading",Vue.set(t,"privilege",e)),"login"==e&&(t.unauthredirect&&Vue.set(t,"redirect",stg.data.currentLibrary.unauthredirect),t.overrideunauthredirect&&Vue.set(t,"redirect",stg.data.currentLibrary.unauthredirect),t.pricing&&t.pricing.purchasable&&(e="https:"==location.protocol||"chrome-extension:"==location.protocol?"buy":"insecure",Vue.set(t,"privilege",e)))),u()}function c(n){if("loading"==e){if("book"==config.kotobee.mode){if(config.kotobee.payment&&config.kotobee.pricing&&config.kotobee.pricing.purchasable){Vue.set(t,"price",config.kotobee.pricing.price);var o=$filter("priceDecimal")(config.kotobee.pricing.price);Vue.set(t,"price_localized","$"+o),"https:"==location.protocol||"chrome-extension:"==location.protocol?(e="buy",Vue.set(t,"privilege",e)):(e="insecure",Vue.set(t,"privilege",e)),t.paymentOptions=payment.initialize(config.kotobee.payment)}else d();return u(),$rootScope.$$phase||$rootScope.$apply(),n?n():null}if("public"==t.accessmode||"all"==t.accessmode||config.kotobee.payment&&config.kotobee.pricing&&!config.kotobee.pricing.purchasable&&"book"==config.kotobee.mode)return n?n():null;Vue.set(t,"redirect",null),t.access=null,backend.hasAccessTo({testagainst:t.id},(function(o){if(o.success)t.access=o,d();else if(o.error&&o.purchasable){if(isNative)payment.isInAppPurchaseEnabled()?payment.handleInAppProduct(t):(e="denied",Vue.set(t,"privilege",e),Vue.set(t,"redirect",stg.data.currentLibrary.unauthredirect),Vue.set(t,"paymentOptions",o.payment),t.overrideunauthredirect&&Vue.set(t,"redirect",t.unauthredirect));else{Vue.set(t,"price",o.price);var i=$filter("priceDecimal")(o.price);Vue.set(t,"price_localized","$"+i),Vue.set(t,"paymentOptions",o.payment),"https:"==location.protocol||"chrome-extension:"==location.protocol?(e="buy",Vue.set(t,"privilege",e)):(e="insecure",Vue.set(t,"privilege",e))}t.paymentOptions=payment.initialize(t.paymentOptions)}else e="denied",Vue.set(t,"privilege",e),Vue.set(t,"redirect",stg.data.currentLibrary.unauthredirect),t.overrideunauthredirect&&Vue.set(t,"redirect",t.unauthredirect);return isNative&&"buy"==e||(u(),$rootScope.$$phase||$rootScope.$apply()),n?n():null}))}else{if("open"!=e)return n?n():null;if(!t.downloaded)return n?n():null;backend.hasAccessTo({testagainst:t.id},(function(e){if(e.success)if(t.access=e,desktop){var o=ph.join(np.getBooksPath(),t.path);"mac"==os&&(o=np.getBooksPath()+"/"+t.path),np.writeFile(o+"/access.json",JSON.stringify(t.access))}else crdv.writeFile(new Blob([JSON.stringify(t.access)],{type:"text/plain"}),t.path+"/EPUB/access.json",{relTo:"library"});return n?n():null}))}}function l(e){return stg.data.info||Vue.set(stg.data,"info",{}),stg.data.info["book"+e.id]||Vue.set(stg.data.info,"book"+e.id,{}),stg.data.info["book"+e.id]}function d(){t&&("book"==config.kotobee.mode?e="login":isNative||desktop?"download"==(e=t.updating?"updating":t.downloaded?"open":l(t).loading?"downloading":l(t).extracting?"extracting":backend.cloudParam("public")||stg.data.user.loggedIn||"public"==t.accessmode||"all"==t.accessmode?"download":backend.cloudParam("entry")?"login":"download")&&"open"==t.openmethod&&(e="open"):backend.cloudParam("public")||stg.data.user.loggedIn||"public"==t.accessmode||"all"==t.accessmode?e="open":backend.cloudParam("entry")&&(e="login"),Vue.set(t,"privilege",e))}function u(){n&&n.ui&&(Vue.set(n.ui,"privilege",e),Vue.set(n.ui,"actionBtnIcon",function(){if("open"==e)return"icon kb-book-open size20";if("login"==e)return"icon kb-user size14";if("download"==e)return"icon kb-download size20";if("downloading"==e)return null;if("updating"==e)return null;if("loading"==e)return null;if("buy"==e)return null;if("unavailable"==e)return null}()),Vue.set(n.ui,"actionBtnSpinnerIcon",function(){if("downloading"==e)return"dots";if("updating"==e)return"dots";if("loading"==e)return"dots"}()),Vue.set(n.ui,"actionBtnLabel",function(){if("buy"==e){var n=t.pricing;"book"==config.kotobee.mode&&(n=config.kotobee.pricing);var o=translit.get("buyWithPrice");if(o=o.replace("{{price}}",n.price?"$"+$filter("priceDecimal")(n.price):""),n.issubscr&&n.subscrcycle){var i="";i=7==n.subscrcycle?translit.get("week"):30==n.subscrcycle?translit.get("month"):365==n.subscrcycle?translit.get("year"):translit.get("xDays").replace("{{x}}",n.subscrcycle),o="<span class='subscr'>"+translit.get("buyWithSubscr").replace("{{price}}",$filter("priceDecimal")(n.price)).replace("{{cycle}}",i)+"</span>"}return o}if("unavailable"==e)return translit.get("bookUnavailable");if("open"==e)return"audiobook"==t.type?'<span class="kb-headphones"></span> <span>'+translit.get("listen")+"</span>":translit.get("read");if("login"==e)return"audiobook"==t.type?translit.get("loginToListen"):translit.get("loginToRead");if("download"==e)return translit.get("download");if("downloading"==e)return translit.get("downloading");if("updating"==e)return translit.get("updating");if("extracting"==e)return translit.get("extracting");if("loading"==e)return translit.get("pleaseWait");if("denied"==e)return translit.get("bookAccessDenied");if("insecure"==e)return translit.get("securityInfo")}()),Vue.set(n.ui,"actionBtnStyle","buy"==e?"buyBtn":"unavailable"==e?"unavailableBtn":"open"==e||"login"==e?"openBtn":"downloading"==e||"updating"==e||"extracting"==e?"downloadingBtn":"loading"==e?"loadingBtn":"denied"==e?"deniedBtn":"insecure"==e?"insecureBtn":"downloadBtn"))}function p(){i.show(o),$timeout((function(){i.update(t)}),800)}return i.redeemCode=function(){modals.hide(),setTimeout((function(){auth.redeemCode({source:"bookinfo"},(function(){i.show(o)}))}))},i.show=function(e,t){t||(t={});var n={serviceOb:e,options:t};if(r[e.book.id]=n,t.noModal)return i.showInternal(e.book);vueApp.$router.push("/library/book/"+e.book.id)},i.showInternal=function(e){var i=r[e.id].serviceOb,l=r[e.id].options;l||(l={}),o=i,t=i.book,isNative&&crdv.vibrate();var d={};for(var u in i.book.meta||(i.book.meta={}),i.book.meta)"object"!=_typeof(i.book.meta[u])&&(d[u]=i.book.meta[u]);if(i.book.meta.dc=Object.assign({},i.book.meta.dc,d),!i.book.meta.dc.creator&&i.book.meta.author&&(i.book.meta.dc.creator=i.book.meta.author),!i.book.coverStyle){i.book.coverImg=book.getCoverImgPath(i.book),i.book.coverStyle={"background-image":"url('"+i.book.coverImg+"')"};i.book.bannerStyle={"background-image":"linear-gradient(to bottom, rgba(67, 47, 71, 0.9) 0%, rgba(52, 80, 97, 0.7) 100%), url('"+i.book.coverImg+"')"},i.book.bgimg&&(i.book.bannerStyle=a(book.getBgImgPath(i.book))),chromeApp&&(stg.data.chromeAssets[i.book.coverImg]?i.book.coverStyle=i.book.bannerStyle={"background-image":"url('"+stg.data.chromeAssets[i.book.coverImg]+"')"}:getImgDataSrc(i.book.coverImg,(function(e){stg.data.chromeAssets[i.book.coverImg]=e,i.book.coverStyle={"background-image":"url('"+e+"')"},i.book.bgimg||(i.book.bannerStyle=i.book.coverStyle)})),i.book.bgimg&&(stg.data.chromeAssets[i.book.bgImg]?i.book.bannerStyle=a(stg.data.chromeAssets[i.book.bgImg]):getImgDataSrc(book.getBgImgPath(i.book),(function(e){stg.data.chromeAssets[i.book.bgImg]=e,i.book.bannerStyle=a(e)}))))}var p={};p.book=i.book,p.categoryClicked=i.categoryClicked,p.ui={},p.stage="info",n=p;var f="slide-in-up";"none"==l.animation&&(f="none"),l.noModal?Vue.set(stg.data.modal,"bookInfoOptions",p):modals.show({mode:"bookInfo",dynamic:!0,animation:f,bookInfoOptions:p},(function(){kotobee.dispatchEvent("bookInfoPanelOpened",p.book)}),(function(){vueApp.$router.push("/library")})),s(),function(e){if("library"!=config.kotobee.mode)return;if(!isNative&&!desktop)return;if(!t.downloaded)return;!function(e){var n=np.getBooksPath()+t.path;"mac"==os&&(n="file://"+n);isNative&&(n=cleanURL(crdv.libEbooksDirectory.nativeURL+t.path+"/EPUB"));function o(e){khttp.get(cacheBust(ph.join(n,"ver.txt"))).success((function(t){e(t)})).error((function(){e()}))}function i(e){khttp.get(cacheBust(ph.join(n,"_kmeta/config.js"))).success((function(t){if(!t)return e();t=t.replace("var config = ","");var n=JSON.parse(t).checksum;if(!n)return e();e(n)})).error((function(){e()}))}o((function(o){asyncCheck(null!=o,i,[],(function(i){var r={};r.bid=t.id,null!=o&&(r.ver=o),null!=i&&(r.checksum=i),backend.checkBookUpdates(r,(function(o){if(o){if(null==r.ver&&(desktop?np.writeFile(n+"/ver.txt",o.ver):isNative&&crdv.writeFile(new Blob([o.ver],{type:"text/plain"}),t.path+"/EPUB/ver.txt",{relTo:"library"})),o.latestVer>o.ver)return e(!0);e()}}))}))}))}((function(t){Vue.set(e,"updateAvailable",t),$rootScope.$$phase||$rootScope.$apply()}))}(p),setTimeout(c,mobile?1e3:500)},i.refetch=function(){if(e="loading",t){if(!stg.data.user||!stg.data.user.loggedIn)return n.stage="info",void modals.show({mode:"success",successOptions:{msg:translit.get("activateAndloginToAccessEbook")}});c()}},i.setBusy=function(e){n&&Vue.set(n,"busy",e)},i.getCurrentBook=function(){return t},i.inAppPurchaseCallback=function(n){function o(){if(n&&n.price){Vue.set(t,"price",n.priceMicros/1e6);var o=$filter("priceDecimal")(n.price);Vue.set(t,"price_localized",o),e="buy",Vue.set(t,"privilege",e)}else e="unavailable",Vue.set(t,"privilege",e);u(),$rootScope.$$phase||$rootScope.$apply()}n&&n.loaded&&n.valid&&n.transaction&&n.transaction.id&&payment.isCurrentUserID(n)&&payment.validateInAppPurchase(n,(function(e){e&&d(),o()}),{cache:!0}),o()},i.update=function(e){t.updating||(Vue.set(t,"updating",!0),i.download(e,(function(){Vue.set(t,"updating",!1)})),$rootScope.$$phase||$rootScope.$apply())},i.immediateEnter=function(n){var o=n.book,r=n.chapterUrl;t=o,o.clicked=!0,s(),c((function(){o.clicked=!1;var t={};r&&(t.defaultUrl=r),"open"==e?book.open(o,t):"download"==e?i.download(o):(modals.hide(),i.show(n))}))},i.download=function(e,t){function n(t){Vue.set(l(e),"progress",Math.ceil(100*t)),$rootScope.$$phase||$rootScope.$apply()}l(e).loading||(crdv.vibrate(),crdv.toast(translit.get("bookIsDownloading")),l(e).loading=!0,d(),u(),Vue.set(l(e),"progress",0),setTimeout((function(){backend.downloadEbook(e,n,(function(n){l(e).loading=null,n?(l(e).extracting=!0,d(),u(),setTimeout((function(){!function(e,t,n,o){isNative?crdv.writeEbook(e,t,n,o):desktop&&np.writeEbook(e,t,n,o)}("src.zip",e,n,(function(o){n=null,l(e).extracting=null,d(),u(),modals.hide(),setTimeout((function(){modals.show({mode:"bookDownloaded",downloadedOptions:{book:e,open:book.open},apply:!0}),backend.addBookStat({type:"download"}),t&&t()}),1e3)}))}))):modals.hide()}))}),500))},i.prevStage=function(){"paymentMethod"==n.stage?"book"==config.kotobee.mode?n.stage="emailCollection":n.stage="info":"emailCollection"==n.stage&&(n.stage="info")},i.nextStage=function(){if("info"==n.stage){if("book"==config.kotobee.mode)return Vue.set(n,"paymentEmail1",null),Vue.set(n,"paymentEmail2",null),Vue.set(n,"paymentEmailError",null),n.stage="emailCollection";if(!stg.data.user.loggedIn)return n.stage="emailCollection";var e={id:n.book.id,accountemail:stg.data.user.email,amount:n.book.price.toString()};return Vue.nextTick((function(){payment.renderPaypalButton(e,i.refetch)})),n.stage="paymentMethod"}if("emailCollection"==n.stage){if(n.paymentEmailError=null,"login"==n.emailCollectionMethod){if(!n.paymentEmail1)return n.paymentEmailError=translit.get("emailFormatError");if(!n.pwd)return n.paymentEmailError=translit.get("enterYourPwd");Vue.set(n,"verifyingEmail",!0),stg.data.user.email=n.paymentEmail1,stg.data.user.pwd=n.pwd,stg.data.user.rememberMe=!0,backend.login({userInput:!0,dontShowErrorDialog:!0}).then((function(e){if(Vue.set(n,"verifyingEmail",!1),e.error)return stg.data.user.email=stg.data.user.pwd=stg.data.user.rememberMe=null,modals.hide(),void setTimeout((function(){kError.update({error:"s_authError"==e.error?"accessDenied":e.error})}));var t={id:n.book.id,amount:n.book.price.toString(),accountemail:n.paymentEmail1};Vue.nextTick((function(){payment.renderPaypalButton(t,i.refetch)})),n.stage="paymentMethod"}))}else{if(!n.paymentEmail1||!n.paymentEmail2)return n.paymentEmailError=translit.get("emailFormatError");if(n.paymentEmail1!=n.paymentEmail2)return n.paymentEmailError=translit.get("emailsDontMatch");Vue.set(n,"verifyingEmail",!0),backend.verifyCloudEmail({cloudemail:n.paymentEmail1},(function(e){if(Vue.set(n,"verifyingEmail",!1),e&&"book"==e.mode)n.paymentEmailError=translit.get("emailAlreadyExists");else{var t={id:n.book.id,amount:n.book.price.toString(),accountemail:n.paymentEmail1};Vue.nextTick((function(){payment.renderPaypalButton(t,i.refetch)})),n.stage="paymentMethod"}}))}return!0}},i.action=function(o,r){if("loading"!=e)if("denied"!=e){if("insecure"==e)return modals.hide(),void $timeout((function(){modals.show({mode:"generalError",errorOptions:{msg:translit.get("insecureProtocolDesc")}})}),500);if("unavailable"!=e)if("buy"!=e){if("open"==e){if(n.updateAvailable)return modals.hide(),void $timeout((function(){modals.show({mode:"bookUpdateAvailable",updateAvailableOptions:{book:t,open:book.open,update:p},apply:!0})}),500);book.open(o)}else{if("login"==e){modals.hide();a=$location.path();return void setTimeout((function(){backend.login({redirectTo:a})}),100)}"download"==e&&i.download(o)}d(),u()}else{if(!(stg.data.user&&stg.data.user.loggedIn||(modals.hide(),"library"!=config.kotobee.mode))){var a=$location.path();return void setTimeout((function(){backend.login({redirectTo:a})}),100)}var s;if(isNative||desktop)return(s=stg.data.currentLibrary.cloud.site)||(s="https://"+stg.data.currentLibrary.subdomain+".kotobee.com/"),s.endsWith("/")||(s+="/"),s+=window.location.hash,void(desktop?np.openLink(s):isNative&&crdv.openInNativeBrowser(s,!0));if(Vue.set(n,"paying",null),i.nextStage())return;if(r){Vue.set(n,"paying",r);var c={};c.bookOb=o,c.paymentEmail=n.paymentEmail1,c.paymentOptions=t.paymentOptions,payment.makePayment(r,c)}else modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get("missingPaymentMethod")}})}else events.add({action:"bookUnavailableBtnClicked",param:o.name,bid:o.id})}else events.add({action:"accessDeniedBtnClicked",param:o.name,bid:o.id})},i.delete=function(e){crdv.toast(translit.get("deletingBook")),crdv.vibrate(),function(e,t){isNative?crdv.deleteEbook(e,t):desktop&&np.deleteEbook(e,t)}(e,(function(){d(),u(),$rootScope.$$phase||$rootScope.$apply()}))},i.toggleFav=function(e){e.favorite?i.removeFav(e,!0):i.addToFav(e,!0)},i.addToFav=function(e,t){t?Vue.set(e,"favorite",!0):kStatus.update(translit.get("addingToFavorites"),null,{dots:!0}),backend.addtoFav(e,(function(){Vue.set(e,"favorite",!0),t||kStatus.update()}))},i.removeFav=function(e,t){t?Vue.set(e,"favorite",!1):kStatus.update(translit.get("removingFromFavorites"),null,{dots:!0}),backend.removeFav(e,(function(){Vue.set(e,"favorite",!1),t||kStatus.update(),angular.element(document.getElementById("library")).scope().loadFavorites()}))},i.copyURL=function(e){var t=window.location.href.split("/#")[0];t+="/#/book/"+e.id,selection.copyToClipboard(t,!0)},i})),createService("cache",(function(){var e={},t={};return e.initialize=function(){e.setOb("body",document.getElementsByTagName("body")[0]);var t=document.getElementsByTagName("title"),n=null;t.length?n=t[0]:(n=document.createElement("title"),document.head.appendChild(n)),e.setOb("title",n)},e.setOb=function(e,n){return t[e]=n,n},e.getOb=function(e){return t[e]},e})),createService("cart",(function(){var e={};function t(){modals.hide(),kotobee.popup(translit.get("cartConfirmationMsg"),{title:translit.get("cartTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})}function n(){stg.readSlot("cart",(function(e){Vue.set(stg.data,"cartData",e)}))}function o(t){e.bids=[];for(var n=0;n<t.length;n++)e.bids.push({type:"book",id:+t[n].bookId,amount:+t[n].bookPrice,bookname:t[n].bookName});for(var o=0;o<stg.data.cartData.length;o++)for(var i=stg.data.cartData[o],r=0;r<t.length;r++){var a=t[r];i.bookId==a.bookId&&(a.bookImgUrl=i.bookImgUrl)}Vue.set(stg.data,"cartData",t),stg.writeSlot("cart",stg.data.cartData),modals.show({mode:"cart",dynamic:!0,animation:"slide-in-up"},(function(){}))}function i(){Vue.set(stg.data,"cartData",[]),stg.clearSlot("cart",(function(){}))}return e.initialize=function(){e.currency="$",Vue.set(stg.data,"cartData",[]),n()},e.add=function(e){n();var o={bookId:e.id,bookName:e.name,bookPrice:e.price_localized,bookImgUrl:e.coverImg};if(stg.data.cartData.length){for(var i=[],r=0;r<stg.data.cartData.length;r++){var a=stg.data.cartData[r];if(o.bookId==a.bookId){i.push(!0);break}}i.length||(stg.data.cartData.push(o),stg.writeSlot("cart",stg.data.cartData)),t()}else stg.data.cartData.push(o),stg.writeSlot("cart",stg.data.cartData),t()},e.remove=function(e){stg.data.cartData.forEach((function(t,n,o){t.bookId==e&&o.splice(n,1)})),stg.writeSlot("cart",stg.data.cartData)},e.getTotalPrice=function(){for(var e=[],t=0;t<stg.data.cartData.length;t++){var n=+stg.data.cartData[t].bookPrice.trim();e.push(n)}return e.reduce((function(e,t){return e+t}),0)},e.show=function(){e.load(o)},e.load=function(e){"library"==config.kotobee.mode&&stg.readSlot("cart",(function(t){for(var n="",o=0;o<t.length;o++){n+=t[o].bookId+","}n=n.replace(/\,$/,""),backend.sendRawPost(config.kotobee.liburl+"library/order/getproducts",{bids:n},{responseType:"json"},(function(t){t.error?kotobee.popup(translit.get("cartErrorMessageDesc"),{title:translit.get("cartTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}}):e(t)}))}))},e.checkout=function(t){modals.hide(),e.currentOrder=t,modals.show({mode:"checkout",dynamic:!0,animation:"slide-in-up"},(function(){var e;if(cart.currentOrder)e={order:cart.currentOrder};else{var t=kotobee&&kotobee.user&&kotobee.user.email?kotobee.user.email:"";e={items:cart.bids,accountemail:t}}payment.renderPaypalButton(e,i)}))},e.pay=function(t){var n=kotobee&&kotobee.user&&kotobee.user.email?kotobee.user.email:"";!function(t,n){if(e.currentOrder)return n(e.currentOrder);$injector.get("backend").createOrder(t,(function(e){e.order&&e.order.id?n(e.order):kotobee.popup(translit.get("unexpectedError"),{title:translit.get("checkoutTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})}))}({platform:t,items:JSON.stringify(e.bids),accountemail:n},(function(e){if("moyasar"===t){var o={orderid:e.id,redirecturl:isNative?"http://localhost:8100":window.location.protocol+"//"+window.location.host+window.location.pathname,price:100*+e.amount,name:payment.getOrderName(e)};payment.moyasarSettings.payment(o,i)}else"stripe"===t&&payment.stripeMakePayment(payment.initialize(config.kotobee.payment),{order:e},{paymentEmail:n},{id:""},i)}))},e.back=function(){modals.hide(),modals.show({mode:"cart",dynamic:!0,animation:"slide-in-up"},(function(){}))},e})),createService("chapterAPI",(function(){var e={},t=[];function n(){if(!(arguments.length<2)){var e,n=arguments[0],o={};2==arguments.length?e=arguments[1]:(o=arguments[1],e=arguments[2]),o.unique&&i(n);var r={event:n,cb:e};t.push(r)}}function o(e,n){if(e){n||(n={});for(var o=function(e){if(!e)return;for(var n=[],o=t.length;o--;)t[o].event==e&&n.push(t[o]);return n}(e),i=0;i<o.length;i++){var r=o[i];if(r&&r.cb){try{r.cb.apply(this,[n])}catch(e){}if(n.firstMatch)break}}}}function i(e){for(var n=t.length;n--;)e&&t[n].event!=e||t.splice(n,1)}function r(){return compInstances.tabMenu}function a(e){var t=r();t&&t.notebookClicked(e)}function s(){var e=r();e&&e.pdfClicked()}function c(){var e=r();e&&e.printClicked()}function l(){var e=r();e&&e.settingsClicked()}function d(){var e=r();e&&e.searchClicked()}function u(e){var t=r();t&&t.searchClicked((function(){if(e){document.getElementById("readerBody");var t=compInstances.search;t.clearResults(),$rootScope.$$phase||$rootScope.$apply(),setTimeout((function(){document.getElementById("searchModalField").value=e,t.search(e)}),30)}}))}function p(){var e=r();e&&e.mediaClicked()}function f(){var e=r();e&&e.chaptersClicked()}function h(){$ionicSideMenuDelegate.close(),nav.fullscreen()}function g(){return stg.data.settings.language}function m(e,t){stg.data.settings||Vue.set(stg.data,"settings",{}),Vue.set(stg.data.settings,"language",e),settings.langChanged(t)}function v(e){translit.setDirection(e)}function b(e){for(var t=compInstances.bookSettings.navAnims,n=0;n<t.length;n++)if(t[n].label==e)return stg.data.settings.navAnim=t[n].val,void settings.saveSettings()}function k(){modals.hide()}function y(){$ionicSideMenuDelegate.close()}function w(){return"undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null}function C(){chapters.nextChapter()}function x(){chapters.prevChapter()}function I(e){chapters.loadChapterByIndex(e)}function E(e){$location.search("vi"),chapters.applyChapterStateFromURL(e,{vIndex:0}),$rootScope.$$phase||$rootScope.$apply()}function S(e,t,n){chapters.preloadChapterFromApi(e,t,n)}function T(){chapters.clearCache()}function O(e){chapters.neverCache(e)}function N(){var e,t=$ionicScrollDelegate.$getByHandle("content");if(t&&(e=t.getScrollPosition()),1==e.zoom){var n=document.getElementById("epubContainer");if(hasClass(n.children[0],"scroll")){var o=n.children[0].style.transform.replace(/.*?scale\((.*?)\).*?/g,"$1");o&&(e.zoom=Number(o))}}return e}function A(e){var t=$ionicScrollDelegate.$getByHandle("content");t&&t.scrollTo(0,0,e)}function L(e,t){var n=$ionicScrollDelegate.$getByHandle("content");n&&n.scrollTo(0,e,t)}function B(e){kMiniapps.openById(e)}function P(e,t){t||(t={});var n=clone(t);n.content=e,kInteractive.alert(n)}function M(e,t){var n={};n.content=e,isFunction(t)?(n.okBtn="Yes",n.noBtn="No",n.cb=t):(t.okBtn&&(n.okBtn=t.okBtn),t.noBtn&&(n.noBtn=t.noBtn),n.cb=t.cb,n.noBackdrop=t.noBackdrop),kInteractive.confirm(n)}function R(e,t){backend.externalLink(e,t)}function D(e,t){var n=traverser.convertElemsToLocation([t]),o={};o.chapter=chapters.getElemChapterIndex(t),o.location=n.left?n.left:n.right,o.type="content",o.src=t.textContent,o.note=e,stg.addNote(o,(function(){notes.addIcon(o)}))}function $(e){chapters.disableJsLoading=e}function V(e){chapters.disableCssLoading=e}function H(e,t){scorm.setManual(e,t)}function F(e){e||(e={}),tinCan.send(e)}function q(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e.label)throw"'label' variable required.";if(!e.data)throw"'data' variable required.";backend.setUserData(e,t)}function j(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getUserData(e,t)}function z(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getUserList(e,t)}function U(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getUserDataArray({array:JSON.stringify(e)},t)}function _(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";kInteractive.helpers&&kInteractive.helpers.persister&&kInteractive.helpers.persister.instances?Object.values(kInteractive.helpers.persister.instances).find((function(e){return 1==e.testMode}))?backend.setUserDataArray({array:JSON.stringify(e)},(function(e){setTimeout((function(){t(e)}),5e3)})):backend.setUserDataArray({array:JSON.stringify(e)},t):backend.setUserDataArray({array:JSON.stringify(e)},t)}function W(e){if(!stg.data.user.loggedIn)throw"User must be logged in.";backend.getDataPerms(e)}function K(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e.label)throw"'label' variable required.";backend.deleteUserData(e,t)}function Y(){kotobee.getDataArray([{}],(function(e){!e.hasOwnProperty("error")&&e.length&&kInteractiveCommon.unique(e[0].results.map((function(e){return e.label}))).forEach((function(e){e&&kotobee.deleteData({label:e},console.warn)}))}))}function J(){kotobee.clearLocalData(),kotobee.clearRemoteData()}function X(e,t){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e.to)throw"'to' variable required.";if(!e.message)throw"'message' variable required.";if(!e.subject)throw"'subject' variable required.";if(!e.fromName)throw"'fromName' variable required.";if(!e.fromEmail)throw"'fromEmail' variable required.";backend.sendEmail(e,t)}function G(e,t,n){if(!stg.data.user.loggedIn)throw"User must be logged in.";if(!e)throw"Event name is required.";2==arguments.length&&isFunction(t)&&(n=t,t=null);var o={};o.event=e,o.data=JSON.stringify(t||{}),events.add({action:"customEvent",param:JSON.stringify(o)},n)}return e.initialize=function(){kotobee.addEventListener=n,kotobee.dispatchEvent=o,kotobee.clearListeners=i,kotobee.openNotebook=a,kotobee.exportPDF=s,kotobee.print=c,kotobee.openSettings=l,kotobee.openSearch=d,kotobee.search=u,kotobee.openMedia=p,kotobee.openChapters=f,kotobee.toggleFullscreen=h,kotobee.getLanguage=g,kotobee.setLanguage=m,kotobee.setDirection=v,kotobee.setTransition=b,kotobee.closePopups=k,kotobee.closeSidepanels=y,kotobee.openMiniapp=B,kotobee.getEnvironment=w,kotobee.nextChapter=C,kotobee.prevChapter=x,kotobee.gotoChapterIndex=I,kotobee.gotoChapterHref=E,kotobee.getChapter=S,kotobee.clearCache=T,kotobee.neverCache=O,kotobee.getScrollPosition=N,kotobee.scrollToTop=A,kotobee.scrollTo=L,kotobee.view={},kotobee.popup=P,kotobee.confirm=M,kotobee.openLink=R,kotobee.addToNotebook=D,kotobee.disableJsLoading=$,kotobee.disableCssLoading=V,kotobee.sendScorm=H,kotobee.sendTinCan=F,kotobee.setData=q,kotobee.getData=j,kotobee.getDataArray=U,kotobee.setDataArray=_,kotobee.getDataPerms=W,kotobee.getUsers=z,kotobee.deleteData=K,kotobee.clearRemoteData=Y,kotobee.sendEmail=X,kotobee.triggerEvent=G,kotobee.clearData=J,kotobee.hasOwnProperty("user")||Object.defineProperty(kotobee,"user",{get:function(){var e=clone(stg.data.user);return e&&(delete e.pwd,delete e.rememberMe,delete e.signatures),e},set:function(e){return null}}),kotobee.hasOwnProperty("book")||Object.defineProperty(kotobee,"book",{get:function(){return stg.data.book},set:function(e){return null}}),kotobee.hasOwnProperty("epub")||Object.defineProperty(kotobee,"epub",{get:function(){return stg.data.epub},set:function(e){return null}}),kotobee.hasOwnProperty("currentPage")||Object.defineProperty(kotobee,"currentPage",{get:function(){return stg.data.currentPageOb},set:function(e){return null}}),kotobee.hasOwnProperty("currentChapter")||Object.defineProperty(kotobee,"currentChapter",{get:function(){return stg.data.currentPageOb},set:function(e){return null}}),kotobee.hasOwnProperty("version")||Object.defineProperty(kotobee,"version",{get:function(){return readerV},set:function(e){return null}}),kotobee.view.hasOwnProperty("swipe")||Object.defineProperty(kotobee.view,"swipe",{get:function(){return!nav.options.swipeDisabled},set:function(e){nav.options.swipeDisabled=!e}}),kotobee.view.hasOwnProperty("doubletap")||Object.defineProperty(kotobee.view,"doubletap",{get:function(){return!nav.options.doubletapDisabled},set:function(e){nav.options.doubletapDisabled=!e}}),kotobee.view.hasOwnProperty("leftMenuOpen")||Object.defineProperty(kotobee.view,"leftMenuOpen",{get:function(){return $ionicSideMenuDelegate.isOpenLeft()}}),kotobee.view.hasOwnProperty("rightMenuOpen")||Object.defineProperty(kotobee.view,"rightMenuOpen",{get:function(){return $ionicSideMenuDelegate.isOpenRight()}}),kotobee.view.hasOwnProperty("scroll")||Object.defineProperty(kotobee.view,"scroll",{get:function(){var e=$ionicScrollDelegate.$getByHandle("content");if(e)return e.getScrollView?e.getScrollView().options.scrollingY:e.enabled},set:function(e){var t=$ionicScrollDelegate.$getByHandle("content");t&&(t.getScrollView&&(t.getScrollView().options.scrollingY=e),t.enabled=e)}}),kotobee.hasOwnProperty("documentation")||Object.defineProperty(kotobee,"documentation",{get:function(){var e=[];e.push({method:"openNotebook()",desc:"Opens the reader's notebook panel."}),e.push({method:"exportPDF()",desc:"Exports the current chapter as a PDF file."}),e.push({method:"print()",desc:"Prints the current chapter."}),e.push({method:"openSettings()",desc:"Opens the reader's settings panel."}),e.push({method:"openSearch()",desc:"Opens the reader's search panel."}),e.push({method:"search(keyword)",desc:"Search for a certain keyword, and display the results in the search panel."}),e.push({method:"openMedia()",desc:"Opens the reader's media panel."}),e.push({method:"openChapters()",desc:"Opens the reader's chapters panel (table of contents)."}),e.push({method:"toggleFullscreen()",desc:"Toggle reader into fullscreen mode."}),e.push({method:"getLanguage()",desc:"Get the reader language. Possible return values: en,fr,es,pt,nl,de,hu,it,sw,ms,no,pl,ro,ru,tr,ar,zh,jp,ko."}),e.push({method:"setLanguage(lang)",desc:"Set the reader language. This method takes the language's 2 character abbreviation as input. Possible values: en,fr,es,pt,nl,de,hu,it,sw,ms,no,pl,ro,ru,tr,ar,zh,jp,ko."}),e.push({method:"setDirection(dir)",desc:'Set the reader layout direction. Provided argument is "ltr" or "rtl".'}),e.push({method:"setTransition(type)",desc:"Set the page transition to one of the following values: flip, card, slide, stack, fade."}),e.push({method:"closePopups()",desc:"Close all displayed popups."}),e.push({method:"closeSidepanels()",desc:"Close any open sidepanels."}),e.push({method:"openMiniapp(id)",desc:"Open a specific miniapp, passing its id."}),e.push({method:"getEnvironment()",desc:"Get all details about the browser and OS"});var t=[];t.push({method:"nextChapter()",desc:"Jump to the next chapter, relative to the current chapter."}),t.push({method:"prevChapter()",desc:"Jump to the previous chapter, relative to the current chapter."}),t.push({method:"gotoChapterIndex(index)",desc:"Jump to a certain chapter, passing its index as input."}),t.push({method:"gotoChapterHref(url)",desc:"Jump to a certain chapter, passing its relative URL as input."}),t.push({method:"getChapter(url, callback, errorCallback)",desc:"Retrieve the chapter object, passing its relative URL as input. This method also takes 2 more arguments: a success callback with the chapter object, and an error callback."}),t.push({method:"clearCache()",desc:"Clear any cached chapter content."}),t.push({method:"neverCache(chapterOb)",desc:"Set the reader never to cache a specific chapter. This will cause chapters to be continuously loaded and never stored in memory. The chapter object is passed an input."}),t.push({method:"getScrollPosition()",desc:"Get the current chapter's scroll position."}),t.push({method:"scrollToTop(animate)",desc:"Scroll to the top of the chapter. This method also takes a second argument, to indicate whether scroll animation should be used."}),t.push({method:"scrollTo(y, animate)",desc:"Scroll to a certain y location. The y location is provided as an input. This method also takes a second argument, to indicate whether scroll animation should be used."});var n=[];n.push({method:"view.doubletap",desc:"Property to enable or disable double tapping (or double clicking) to zoom in."}),n.push({method:"view.swipe",desc:"Property to enable or disable swiping."}),n.push({method:"view.scroll",desc:"Property to enable or disable vertical scrolling."});var o=[];o.push({method:"popup(html, options)",desc:"Display certain HTML content inside the reader's popup. Takes an optional object with the following properties:",args:[{Property:"title",Description:"The text appearing in the title bar of the popup."},{Property:"okBtn",Description:"The label of the default OK button at the footer of the popup."},{Property:"cb",Description:"A callback function, called when the user clicks on OK."},{Property:"raw",Description:"Display only the passed HTML (raw) as a popup, without a frame and OK button. The above properties won't be effective if raw is set to true."},{Property:"noBackdrop",Description:"Don't display a backdrop when the popup is opened."}]}),o.push({method:"confirm(html,callback)",desc:"Display certain content inside a confirmation box. The second argument represents the callback function in case the user confirms.",args:[{Property:"okBtn",Description:"The label of the 'Yes' button at the footer of the popup. Defaults to 'Yes'"},{Property:"noBtn",Description:"The label of the 'No' button at the footer of the popup. Defaults to 'No'"},{Property:"cb",Description:"A callback function, called when the user clicks on the 'Yes' button."},{Property:"noBackdrop",Description:"Don't display a backdrop when the popup is opened."}]}),o.push({method:"openLink(url)",desc:"Open a certain URL inside a sliding panel."}),o.push({method:"addToNotebook(note, element)",desc:"Add certain content to the notebook. The note is provided as the first argument, and the element to attach the note to is provided as the second argument."}),o.push({method:"disableJsLoading(disabled)",desc:"Disable loading any Javascript files from subsequent chapters and pages."}),o.push({method:"disableCssLoading(disabled)",desc:"Disable loading any CSS files from subsequent chapters and pages."});var i=[];i.push({method:"sendScorm(element,value)",desc:"Set a SCORM run-time element with a value. This requires that the ebook is running as a SCORM package inside an LMS."}),i.push({method:"sendTinCan(activityOb)",desc:"Send a Tin Can activity to the LRS configured in the ebook/library settings. Available for cloud ebooks and libraries only."});var r=[];r.push({method:"setData(dataOb, callback)",desc:"Write data into the database for the currently logged in user. You will be able to fully label that data, for easy retrieval later. This methods takes an object with the following options:",args:[{Property:"label",Description:"The label (key) representing this slot of data (required)."},{Property:"data",Description:"The data to write (required)."},{Property:"overwrite",Description:"In case this data exists, overwrite it"},{Property:"unique",Description:"Ensures that only one instance exists for this data item. If other matches exist, they will be removed except the first match."},{Property:"category",Description:"For better organization, set a category for this data. This will make queries more efficient."},{Property:"subcategory",Description:"For further organization, set a subcategory for this data. This will make queries more efficient."},{Property:"options",Description:"Set options for this data. This is treated as normal text, and can be used when querying for data."}]}),r.push({method:"setDataArray(array, callback)",desc:"Set a collection of data items into the database in a single request, for the currently logged in user. It takes an array of objects, each taking the same parameters as 'setData' method above."}),r.push({method:"getData(queryOb, callback)",desc:"Retrieve data for the currently logged in user. It takes an object with the following options, and triggers a callback (the second argument) passing back the array of data.",args:[{Property:"label",Description:"The label (key) representing this slot of data."},{Property:"category",Description:"The category assigned to this data, to use as a search parameter."},{Property:"subcategory",Description:"The subcategory assigned to this data, to use as a search parameter."},{Property:"options",Description:"The options for this data, to use as a search parameter."},{Property:"allUsers",Description:"Expand the scope of search to all users with access to this cloud ebook or library. To use this option, the user must have global data permissions."},{Property:"role",Description:"Search by user role."}]}),r.push({method:"getDataArray(array, callback)",desc:"Send a collection of search queries for the currently logged in user, all in a single request. It takes an array of objects specified in the getData method, in addition to an 'id' object to label the results returned in an array."}),r.push({method:"getDataPerms(callback)",desc:"Get the list of permissions or allowed writing limits for this cloud ebook or library."}),r.push({method:"getUsers",desc:"For logged in users with global data permissions, get an array of all users added to this cloud ebook/library.",args:[{Property:"role",Description:"Limit the results to a specific user role."}]}),r.push({method:"deleteData(queryOb, callback)",desc:"Delete a certain data slot for the currently logged in user. It takes an object with the following options:",args:[{Property:"label",Description:"The label (key) representing this slot of data (required)."},{Property:"category",Description:"The category assigned to this data, to use as a search parameter."},{Property:"subcategory",Description:"The subcategory assigned to this data, to use as a search parameter."},{Property:"options",Description:"Set options for this data. This is treated as normal text, and can be used when querying for data."},{Property:"all",Description:"If this is true, all matching results will be deleted. It not, only the first result is deleted."}]}),r.push({method:"sendEmail(emailOb, callback)",desc:"Send a custom email. Note you must first contact Kotobee Support and have email sending credentials in order to activate email sending through the API. This method takes an object with the following options:",args:[{Property:"to",Description:"The email address of the recipient."},{Property:"message",Description:"The message body to send."},{Property:"html",Description:"An optional boolean specifying whether the message body is HTML formatted. Default: false."},{Property:"subject",Description:"The email subject."},{Property:"fromName",Description:"The sender name."},{Property:"fromEmail",Description:"The sender email."},{Property:"cc",Description:"An optional array of other email addresses to send a copy to."}]}),r.push({method:"triggerEvent(event, params, callback)",desc:"Trigger a custom event to notify subscribers using email, software, or push notifications. The optional params variable holds any kind of data that is needed to be sent as it is to the subscribers"});var a=[];a.push({prop:"epub",desc:"The parsed epub object, showing the metadata, manifest, spine, and book thumbnail."}),a.push({prop:"book",desc:"The book object obtained from the epub, by the reader."}),a.push({prop:"currentChapter",desc:"The current chapter object, containing all its parsed properties."}),a.push({prop:"currentPage",desc:"In the case that a reflowable layout is paginated (displayed without a scrollbar, as single page or double page view), the currently displayed page(s) is(are) returned by this property."}),a.push({prop:"user",desc:"The currently logged in user. Return an object containing his id, name, email, and user role (if exists)."});var s=[];s.push({event:"addEventListener(event, [options], callback)",desc:"Listen to a certain event (string) and call a function once the event is fired. This function takes an optional second argument (options) with the following properties:",args:[{Property:"unique",Description:"If an event listener already exists for this event, it will be removed, before adding the new one."}]}),s.push({event:null,desc:"An event object will be passed to the callback function containing the DOM element and any additional data associated with the event."}),s.push({event:"dispatchEvent(event, [options])",desc:"Fire a certain event. The function takes the event name (as a string) and an optional second argument (options) with the following properties:",args:[{Property:"firstMatch",Description:"Fire the event only for the first event listener registered."}]}),s.push({event:"clearListeners(event)",desc:"Clear all listeners that are listening to a certain event (as a string). If no event is passed, then all listeners attached to the kotobee object are cleared."});var c=[];c.push({event:"initialized",desc:"Triggered when the app is initialized."}),c.push({event:"ready",desc:"Triggered from the document object, whenever the ebook or library initialization is complete. It is fired just once."}),c.push({event:"libraryBooksFetched",desc:"Triggered when  book thumbnails are fetched in a library and displayed. An array is passed back containing the book objects."}),c.push({event:"bookOpened",desc:"Triggered when a book is opened. An object is passed back containing the book object."}),c.push({event:"chapterLoaded",desc:"Triggered whenever a new chapter is loaded and ready for use."}),c.push({event:"chapterViewed",desc:"Similar to chapterLoaded, but is triggered when the chapter is viewed on the screen."}),c.push({event:"textSelected",desc:"Text is selected in the page."}),c.push({event:"textDeselected",desc:"Text is deselected in the page."}),c.push({event:"scrolled",desc:"Triggered whenever a chapter is scrolled. An object is passed back containing the scroll position."}),c.push({event:"transformationChanged",desc:"Triggered when a chapter's scale has changed, through a zoom action."}),c.push({event:"languageChanged",desc:"Triggered when the reader UI language had changed."}),c.push({event:"directionChanged",desc:"Triggered when the reader UI language direction had changed (from left-to-right or right-to-left)."}),c.push({event:"linkClicked",desc:"Triggered when the user clicks on an external link inside any chapter."}),c.push({event:"audioPlayed",desc:"Triggered when the user clicks an audio play button."}),c.push({event:"audioLinkClicked",desc:"Triggered when a text hyperlinked to audio is clicked."}),c.push({event:"videoPlayed",desc:"Triggered when the user clicks a video play button."}),c.push({event:"popup",desc:"Triggered when a link popup is clicked and displayed on the screen."}),c.push({event:"questionPopup",desc:"Triggered when a questions component, set to display in a popup, is opened."}),c.push({event:"questionsSubmitted",desc:"Triggered when a question set is answered and submitted."}),c.push({event:"answerClicked",desc:"Triggered when a question answer box (radiobox, checkbox, textfield, etc) is changed. In the case of drag and drop questions, this even is triggered when an item is dragged into a category box."}),c.push({event:"3dModelViewed",desc:"Triggered when a 3D model is activated."}),c.push({event:"preHighlight",desc:"Triggered when the user highlights a word or phrase. An object is passed containing more information."}),c.push({event:"highlightDeleted",desc:"Triggered when the user deletes a highlight. An object is passed containing more information."}),c.push({event:"preNote",desc:"Triggered when the user adds a note. An object is passed containing more information."}),c.push({event:"noteDeleted",desc:"Triggered when the user deletes a note. An object is passed containing more information."}),c.push({event:"preBookmark",desc:"Triggered when the user adds a bookmark. An object is passed containing more information."}),c.push({event:"bookmarkDeleted",desc:"Triggered when the user deletes a bookmark. An object is passed containing more information."});var l="color: #000; font-weight: bold; font-size:18px",d="color: #224e97; font-size:12px; font-weight:bold",u="color: #224e97; font-size:12px; font-weight:bold",p="margin-left:6px;",f="font-weight:bold;";setTimeout(console.clear.bind(console)),v("%cKotobee Reader API","color: #000; font-weight: bold; font-size:22px;border:solid 1px #000;border-radius:8px;padding:5px 10px;"),v("%cThis documentation lists brief explanations of the different Kotobee Reader API methods, properties, and events, used to interact with the reader and build scalable ebook applications. A backend Developer API is also available for remotely controlling different aspects of your cloud ebooks and libraries, here: http://support.kotobee.com/en/support/solutions/folders/8000082574."),g(),v("%cUI Methods",l),v("%cThese methods are used to interact with the reader's different UI elements and components.",f);for(var h=0;h<e.length;h++)v("%c"+e[h].method,d),v("%c"+e[h].desc,p);g(),v("%cContent Methods",l),v("%cThese methods are used to display/set content in different ways.",f);for(h=0;h<o.length;h++)v("%c"+o[h].method,d),v("%c"+o[h].desc,p),o[h].args&&m(o[h].args);g(),v("%cNavigation Methods",l),v("%cThese methods are used mainly to navigate to different chapters efficiently.",f);for(h=0;h<t.length;h++)v("%c"+t[h].method,d),v("%c"+t[h].desc,p);g(),v("%cView Options",l),v("%cThese properties are used to control viewing options.",f);for(h=0;h<n.length;h++)v("%c"+n[h].method,d),v("%c"+n[h].desc,p);g(),v("%cSCORM / Tin Can Methods",l),v("%cThese methods are used to send progress to an LMS or LRS.",f);for(h=0;h<i.length;h++)v("%c"+i[h].method,d),v("%c"+i[h].desc,p);g(),v("%cCloud Methods",l),v("%cThese methods are used to store and retrieve user data into the database, for that cloud ebook or library. These methods are available for logged in users only.",f);for(h=0;h<r.length;h++)v("%c"+r[h].method,d),v("%c"+r[h].desc,p),r[h].args&&m(r[h].args);g(),v("%cProperties",l),v("%cThese properties are used to describe the book and user.",f);for(h=0;h<a.length;h++)v("%c"+a[h].prop,"color: #224e97; font-size:12px; font-weight:bold"),v("%c"+a[h].desc,p);g(),v("%cEvents Methods",l),v("%cThese methods are used to listen to and manage events fired by kotobee.",f);for(h=0;h<s.length;h++)s[h].event&&v("%c"+s[h].event,u),v("%c"+s[h].desc,p),s[h].args&&m(s[h].args);v("%cEvent types","font-weight:bold;font-size:14px;margin-top:6px;margin-bottom:6px;");for(h=0;h<c.length;h++)v("%c"+c[h].event,u),v("%c"+c[h].desc,p);function g(){v("")}function m(e){setTimeout(console.table.bind(console,e))}function v(e,t){setTimeout(console.log.bind(console,e,t||""))}return null},set:function(e){return null}}),document.dispatchEvent(new Event("kotobeeApiReady"))},e})),createService("chapters",(function(){var e,t,n,o,i,r,a,s,c,l,d,u,p={},f=[],h=[],g=[],m=kLog;function v(e){for(var t=0;t<g.length;t++)if(g[t]==e)return!0}function b(e,t){var n={leftOb:{}};p.getPageOb({page:e.index,source:"getNextIndex"},(function(o){if(!o)return t();o.pages?e.vIndex<o.pages.length-1?(n.leftOb.index=e.index,n.leftOb.vIndex=e.vIndex+1):(n.leftOb.index=e.index+1,n.leftOb.vIndex=0):n.leftOb.index=e.index+1,t(n)}))}function k(e,t){var n={leftOb:{}};if(p.shouldBePaged(e)){if(!e.vIndex||0==e.vIndex)return void p.getPageOb({page:e.index-1,source:"stepBack"},(function(o){n.leftOb.index=e.index-1,o.pages&&o.pages.length&&(n.leftOb.vIndex=o.pages.length-1),t(n)}));n.leftOb.index=e.index,n.leftOb.vIndex=e.vIndex-1}else n.leftOb.index=e.index-1;t(n)}function y(e){if(!(e<0||e>=stg.data.epub.spine.getElementsByTagName("itemref").length-1)){var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];if(t){var n=t.getAttribute("properties");if(n)for(var o=n.split(" "),i=0;i<o.length;i++)if(o[i].indexOf("-spread-")>0)return o[i].split("-spread-")[1]}}}function w(e){var t=$injector.get("book");$injector.get("chapters");if(!t.allowedChapters)return!1;for(var n=stg.data.toc.getElementsByTagName("a"),o=[],i=0;i<n.length;i++)"true"!=n[i].getAttribute("data-dontshow")&&o.push(n[i]);return!!hasClass(o[e],"restricted")}function C(e,t,n){var o=p.cacheLookup(e);if(o)n(o);else{if(existsInArray(e,B))return setTimeout((function(){C(e,t,n)}),50);p.preloadChapter(e,t,n)}}function x(){"undefined"!=typeof kotobeeReady&&kotobeeReady(),void 0!==kotobee&&kotobee.ready&&kotobee.ready()}function I(e,t){t||(t={});for(var n=0;n<f.length;n++)f[n](e);if("renderedChapter"==e){try{document.dispatchEvent(new Event("kotobeeChapterLoaded"))}catch(e){}if(kotobee){var o=Object.assign({},stg.data.currentPageOb);o.container=document.getElementById("spreadL"),kotobee.dispatchEvent("chapterLoaded",o),stg.data.currentRPageOb&&((o=Object.assign({},stg.data.currentRPageOb)).container=document.getElementById("spreadR"),kotobee.dispatchEvent("chapterLoaded",o))}scorm.setBookmark(currentIndex);var i={};i.id="chapter-"+currentIndex,i.description="View chapter: "+stg.data.book.chapter.title,i.learnerResponses="Viewed",i.type="other",i.timestamp=new Date,scorm.setInteractions([i]),events.add({action:"chapterViewed",param:stg.data.book.chapter.title,data:currentIndex}),E()}}function E(){var e=(new Date).getTime(),t=(e-l)/1e3;0!=t&&stg.data.book&&(events.add({action:"activeTime",param:t,data:{title:stg.data.book.chapter.title,index:currentIndex}}),l=e)}function S(){skeleton.isFirstChapter({first:o},(function(t){skeleton.isLastChapter({last:e},(function(e){Vue.set(stg.data.book.chapter,"notLastChapter",!e),Vue.set(stg.data.book.chapter,"notFirstChapter",!t),$rootScope.$$phase||$rootScope.$apply()}))}))}function T(){timeOut((function(){kStatus.update(null)}),1e3)}function O(e,t,n){khttp.get(cacheBust(e)).success((function(e){config.kotobee.encodekey&&!kInteractive.isSDK()&&(e=config.v>=1.1?CryptoJS.AES.decrypt(e,config.kotobee.encodekey).toString(CryptoJS.enc.Utf8):kInteractive.XORCipher().decode(config.kotobee.encodekey,e)),e=(e=e.replace(/<br\s*?\/>/g,"<br>")).replace(/(<)([^ >]+)([^>]*?)(\/>)/g,"$1$2$3></$2>"),t&&t(e)})).error((function(e,t){n&&n()}))}p.busy=!0,p.maxIndex=null,p.initialize=function(t){if(document.getElementById("chaptersInner")){d||(d=!0,function(){var e,t;window.onpageshow=window.onfocus=function(){l=(new Date).getTime()},window.onpagehide=window.onblur=function(){E()},void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange");function n(){document[e]?E():l=(new Date).getTime()}document.addEventListener(t,n,!1)}()),config.firstDoublePage||(config.firstDoublePage=0),null==stg.data.settings.pageScroll&&(stg.data.settings.pageScroll=!0),context.initialize(),$injector.get("annotations").reset(),l=(new Date).getTime(),currentIndex=null,Vue.set(stg.data,"currentPageOb",null),p.maxIndex=stg.data.epub.spine.getElementsByTagName("itemref").length,e=p.maxIndex;for(var n=stg.data.epub.spine.getElementsByTagName("itemref"),r=n.length;r--;)if(!n[r].hasAttribute("linear")||"no"!=n[r].getAttribute("linear")){e=r+1;break}o=0;for(r=0;r<n.length;r++)if(!n[r].hasAttribute("linear")||"no"!=n[r].getAttribute("linear")){o=r;break}p.displayTOC(),backend.addBookStat({type:"view"}),i||(translit.addListener((function(){var e=document.getElementById("chaptersInner");e&&replaceHTML(e,stg.data.book.chapters?stg.data.book.chapters:'<h5 class="panelEmpty"><i class="icon kb-notice vAlignMiddle size20"></i><span class="hSpace5"></span>'+translit.get("noTOC")+"</h5>")})),i=!0);var a=document.getElementById("chaptersInner").getElementsByClassName("restricted");for(r=0;r<a.length;r++)a[r].addEventListener("click",(function(e){var t={ch:e.currentTarget.textContent,chIndex:e.currentTarget.getAttribute("data-index"),currentCh:stg.data.book.chapter.title};events.add({action:"restrictedTocClicked",param:JSON.stringify(t)})}));$filter("bookSetup")(),p.showLoader(),p.resetPages(),p.preloadEdgeChapters((function(){var e=0,n=0;if(null!=p.startChapter){var o=p.getRedirectUrl(p.startChapter,{hash:p.startHash,vIndex:p.startVIndex});return $location.path(o),p.hideLoader(),void($rootScope.$$phase||$rootScope.$apply())}stg.readSlot("lastLoc"+stg.getBookId(),(function(o){stg.readSlot("lastLocY"+stg.getBookId(),(function(i){config.preserveLoc&&"app"!=config.kotobee.mode&&(e=o?Number(o):0,n=i?Number(i):0),stg.data.user&&null!=stg.data.user.lastchap&&(e=Number(stg.data.user.lastchap));var r=scorm.getBookmark();r&&(e=Number(r)),null!=t&&(e=t);var a={};n&&(a.scroll=n);var s=p.loadChapterByIndex(e,a);s&&s.then&&s.then((function(){p.hideLoader()}))}))}))}))}else setTimeout(p.initialize,50)},p.displayTOC=function(){var e=document.getElementById("chaptersInner");e&&(replaceHTML(e,stg.data.book.chapters?stg.data.book.chapters:'<h5 class="panelEmpty"><i class="icon kb-notice vAlignMiddle size20"></i><span class="hSpace5"></span>'+translit.get("noTOC")+"</h5>"),stg.data.book.meta&&cache.setOb("title",replaceHTML(cache.getOb("title"),stg.data.book.meta.dc.title)))},p.preloadEdgeChapters=function(i){p.getPageOb({page:o,source:"preloadEdgeChapters"},(function(o){p.getPageOb({page:e-1,source:"preloadEdgeChapters"},(function(o){t=null,n=null,o.pages&&(t=o.pages.length)<=1?p.getPageOb({page:e-2,source:"preloadEdgeChapters2"},(function(e){e.pages&&(n=e.pages.length),i()})):i()}))}))},p.displayChapters=function(){stg.data.widescreen&&!config.notebookTab||(stg.data.pinned?stg.data.widescreen=!0:(mobile&&$injector.get("nav").resize(),chapters.togglePanel()))},p.togglePanel=function(){var e=$ionicSideMenuDelegate.$getByHandle("menus");e._instances[0].left.width=e._instances[0].right.width=$ionicSideMenuDelegate.menuWidth,e._instances[0].left.el.style.width=e._instances[0].right.el.style.width="330px";var t=480;stg.data.widescreen&&(stg.data.settings.rtl?(e._instances[0].right.width=t,e._instances[0].right.el.style.width=t+"px"):(e._instances[0].left.width=t,e._instances[0].left.el.style.width=t+"px")),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleRight():$ionicSideMenuDelegate.toggleLeft(),isNative&&crdv.vibrate()},p.clearCache=function(){h=[]},p.neverCache=function(e){e&&(v(e.url)||g.push(e.url))},p.hideLoader=function(){var e=document.getElementById("ebookLoaderAnim");e&&addClass(e,"hide")},p.showLoader=function(){var e=document.getElementById("ebookLoaderAnim");e&&removeClass(e,"hide")},p.addListener=function(e){f.push(e)},p.removeListener=function(e){for(var t=f.length;t--;)f[t]==e&&f.splice(t,1)},p.redirectToHashPage=function(e,t){var n=t.leftOb;if(n.pages&&n.pages.length){var o=parseHtml(n.raw?n.raw:n.content);$filter("contentVirt")("parse",o.getElementById("epubContent"),(function(){var t=o.getElementById(e);if(!t){var i=o.getElementsByName(e);i.length&&(t=i[0])}if(t){var r=traverser.convertElemsToLocation([t],o.getElementById("epubContent")).left,a=traverser.getPageByLocation(n,r);p.loadChapterByIndex(n.index,{hash:e,vIndex:a})}}))}},p.getRedirectUrl=function(e,t){t||(t={});var n=$injector.get("book").root+"/reader/chapter/"+e;return t.hash&&(n+="/"+t.hash),t.vIndex&&(n+="?vi="+t.vIndex),n},p.redirect=function(e,t){t||(t={});var n=p.getRedirectUrl(e,t);p.getCurrentHash(),ph.getHash(n);if(n==$location.path()&&t.hash)return p.loadLocation(t.hash,{index:currentIndex,source:"from redirect"});$location.path(n);try{document.dispatchEvent(new Event("kotobeeBeforeChapterLoaded"))}catch(e){}kotobee.dispatchEvent("beforeChapterLoaded"),kotobee.dispatchEvent("kotobeeBeforeChapterLoaded"),$rootScope.$$phase||$rootScope.$apply()},p.getCurrentHash=function(){var e=$location.path(),t=(e=e.replace(/\?.*/g,"")).split("/"+currentIndex+"/");if(!(t.length<2))return t[1]},p.loadLocation=function(e,t){var n=$q.defer();t||(t={});var o=!e.match(/[^0-9.]/g);return p.showLoader(),p.getPageOb({page:t.index},(function(t){if(!t.pages||!t.pages.length){if(o){var i=traverser.getElemsByLocation(e);if(!i[0])return n.resolve();virt.safeScrollToElem("content",i[0],!0)}else virt.safeAnchorScroll("content",e,!0);return p.hideLoader(),n.resolve()}if(o){var r=traverser.getPageByLocation(t,e);return p.loadChapterByIndex(t.index,{vIndex:r}),n.resolve()}var a=parseHtml(t.raw?t.raw:t.content);$filter("contentVirt")("parse",a.getElementById("epubContent"),(function(){var o,i;if(!(o=a.getElementById(e))){var r=a.getElementsByName(e);r.length&&(o=r[0])}o&&(i=traverser.convertElemsToLocation([o],a.getElementById("epubContent")).left);var s=0;return i&&(s=traverser.getPageByLocation(t,i)),p.loadChapterByIndex(t.index,{vIndex:s}),n.resolve()}))})),n.promise},p.indexFromUrl=function(e,t){var n;if(t||(t={}),e){var o=ph.getHash(e);t.hash&&(o=t.hash),e=ph.removeHash(ph.normalize(e));for(var i=stg.data.epub.manifest.getElementsByTagName("item"),r=0;r<i.length;r++)if(ph.removeHash(ph.normalize(i[r].getAttribute("href")))==e){n=i[r].getAttribute("id");break}i=stg.data.epub.spine.getElementsByTagName("itemref");var a,s=t.order?t.order:1;for(r=0;r<i.length;r++)if(i[r].getAttribute("idref")==n&&(a=r,i[r].getAttribute("id")==o)){if(--s)continue;return r}return a}},p.arePagesAppearingTogether=function(e,t,n){var o=p.getCurrentView(t.index),i=e.vIndex;i<0&&e.pages&&e.pages.length&&(i+=e.pages.length),isNaN(i)&&(i=null);var r=t.vIndex;if(r<0&&t.pages&&t.pages.length&&(r+=t.pages.length),isNaN(r)&&(r=null),t.index==e.index&&t.vIndex==e.vIndex)return n(!0);!function(e,t,n){skeleton.getNextLinearIndex({index:e,vIndex:t},(function(o){skeleton.getPrevLinearIndex({index:e,vIndex:t},(function(e){o.leftOb.index,e.leftOb.index;n({first:e.leftOb,last:o.leftOb})}))}))}(e.index,e.vIndex,(function(a){if(function(e,t){if(e.index>t.first.index&&e.index<t.last.index)return!0;if(t.first.index==t.last.index&&e.index==t.first.index){if(e.vIndex>t.first.vIndex&&e.vIndex<t.last.vIndex)return!0}else{if(e.index==t.first.index&&e.vIndex>t.first.vIndex)return!0;if(e.index==t.last.index&&e.vIndex<t.last.vIndex)return!0}}(t,a))return n(!0);if("double"==o.view){if("rfl"==e.layout){if(e.index==t.index&&i==r+1)return n(!0);if(t.pages&&1==t.pages.length&&e.index==t.index+1&&0==i)return n(!0)}return"fxl"==e.layout&&e.index==t.index+1?n(!0):n()}return n()}))},p.getNextIndexOld=function(e,t){var n={},o=p.getCurrentView(e.index);if(n.leftOb={index:e.index+1,vIndex:0},e.vIndex||(e.vIndex=0),"double"==o.view)if(n.double=!0,"rfl"==e.layout)if(e.pages.length-1-e.vIndex>=2)n.leftOb.index=e.index,n.leftOb.vIndex=e.vIndex+2;else{if(e.pages.length-1-e.vIndex!=1)return void p.getPageOb({page:e.index+1,source:"getNextIndex"},(function(o){1==o.pages.length?(n.leftOb.vIndex=0,n.leftOb.index=e.index+2):(n.leftOb.vIndex=1,n.leftOb.index=e.index+1),t(n)}));n.leftOb.index=e.index+1,n.leftOb.vIndex=0}else n.leftOb.index++;else"rfl"!=e.layout||stg.data.settings.pageScroll||(e.pages.length-1-e.vIndex>=1?(n.leftOb.index=e.index,n.leftOb.vIndex=e.vIndex+1):(n.leftOb.index=e.index+1,n.leftOb.vIndex=0));return t(n),n},p.getElemChapterIndex=function(e,t){var n;return t||(t={}),"single"==stg.data.currentView||traverseToTop(e,"spreadL")?n=currentIndex:traverseToTop(e,"spreadR")&&(n=stg.data.currentRPageOb.index),t.ignoreAnchors&&(n=p.getUnanchoredIndex(n)),n},p.getElemChapterTitle=function(e){return"single"==stg.data.currentView||traverseToTop(e,"spreadL")?stg.data.currentPageOb.title:traverseToTop(e,"spreadR")?stg.data.currentRPageOb.title:stg.data.currentPageOb.title},p.getElemChapterFilename=function(e){return"single"==stg.data.currentView||traverseToTop(e,"spreadL")?stg.getChapterFilename():traverseToTop(e,"spreadR")?ph.relative(ph.join(bookPath,stg.data.packageURL),stg.data.currentRPageOb.url):stg.getChapterFilename()},p.getUnanchoredIndex=function(e){var t=p.getChapterURL(e);if(t)return t=ph.removeHash(t),p.indexFromUrl(t)},p.getNextIndex=function(t,n){var o=p.getCurrentView(t.index,{vIndex:t.vIndex});b(t,(function(t){if(!t)return n();"double"==o.view?t.leftOb.index>=e-1?n(t):b(t.leftOb,n):n(t)}))},p.getPrevIndexOld=function(e,t){var n={};n.leftOb={index:e.index-1,vIndex:0},e.vIndex||(e.vIndex=0);if("double"==p.getCurrentView(e.index-1,{}).view)if(n.double=!0,config.firstDoublePage||(config.firstDoublePage=0),"rfl"==e.layout)if(e.vIndex>1)n.leftOb.index=e.index,n.leftOb.vIndex=e.vIndex-2,n.leftOb.index<config.firstDoublePage&&n.leftOb.vIndex++;else{if(1!=e.vIndex)return void p.getPageOb({page:e.index-1,source:"getPrevIndex"},(function(o){1==o.pages.length?(n.leftOb.index=e.index-2,n.leftOb.vIndex=-1,n.leftOb.index<config.firstDoublePage&&(n.leftOb.index=e.index-1,n.leftOb.vIndex=0)):(n.leftOb.index=e.index-1,n.leftOb.vIndex=e.vIndex-2,n.leftOb.index<config.firstDoublePage&&(n.leftOb.vIndex=e.vIndex-1)),t(n)}));n.leftOb.index=e.index-1,n.leftOb.vIndex=-1,n.leftOb.index<config.firstDoublePage&&(n.leftOb.index=e.index,n.leftOb.vIndex=0)}else n.leftOb.index=e.index-2,n.leftOb.index<config.firstDoublePage&&(n.leftOb.index=e.index-1);else"rfl"!=e.layout||stg.data.settings.pageScroll||(e.vIndex>0?(n.leftOb.index=e.index,n.leftOb.vIndex=e.vIndex-1):(n.leftOb.index=e.index-1,n.leftOb.vIndex=-1));return t(n),n},p.getPrevIndex=function(e,t){k(e,(function(e){"double"==p.getCurrentView(e.leftOb.index,{vIndex:e.leftOb.vIndex}).view?e.leftOb.index<=o?t(e):k(e.leftOb,t):t(e)}))},p.nextChapter=function(e,t){e||(e={}),skeleton.isLastChapter(null,(function(n){n?crdv.toast(translit.get("inLastChapter")):(context.interruptAnimation(),skeleton.getNextIndex({index:currentIndex,vIndex:currentVIndex},(function(n){if(!n)return null;if(n.leftOb.index=context.nextLinearIndex(n.leftOb.index),e.skipRestricted&&w(n.leftOb.index))return currentIndex=n.leftOb.index,p.nextChapter(e,t);n.leftOb.index>=stg.data.epub.spine.getElementsByTagName("itemref").length-1&&crdv.toast(translit.get("inLastChapter"));var o=stg.data.epub.spine.getElementsByTagName("itemref")[n.leftOb.index].getAttribute("id");$rootScope.renderScope.applyHeader("default"),null!=n.leftOb.vIndex&&(o=null),p.redirect(n.leftOb.index,{hash:o,vIndex:n.leftOb.vIndex}),$rootScope.$$phase||$rootScope.$apply(),t&&t(n)})))}))},p.prevChapter=function(e,t){e||(e={}),skeleton.isFirstChapter(null,(function(n){n?crdv.toast(translit.get("inFirstChapter")):(context.interruptAnimation(),skeleton.getPrevIndex({index:currentIndex,vIndex:currentVIndex},(function(n){n.vIndex;if(n.leftOb.index<0&&(n.leftOb.index=0),n.leftOb.index=context.prevLinearIndex(n.leftOb.index),e.skipRestricted&&w(n.leftOb.index))return currentIndex=n.leftOb.index,p.prevChapter(e,t);n.leftOb.index<0&&crdv.toast(translit.get("inFirstChapter"));var o=stg.data.epub.spine.getElementsByTagName("itemref")[n.leftOb.index];$rootScope.renderScope.applyHeader("default");var i=o.getAttribute("id");null!=n.leftOb.vIndex&&(i=null),p.redirect(n.leftOb.index,{hash:i,vIndex:n.leftOb.vIndex}),$rootScope.$$phase||$rootScope.$apply(),t&&t(n)})))}))},p.getCurrentView=function(e,t){t||(t={});var n=t.returnType;if(null!=e){var o=skeleton.getCurrentView(e,t);if(o)return r(o);if(e<config.firstDoublePage)return r({view:null,index:e});var i=stg.data.settings.viewMode;return"single"==i?r({view:null,index:e,scroll:stg.data.settings.pageScroll}):"double"==i?config.singleViewOnPortrait&&1.3*window.innerWidth<window.innerHeight?r({view:null,index:e}):r(skeleton.isSingle(e,t.vIndex)?{view:null,index:e}:{view:"double",index:e}):"auto"==i?"left"==y(e)&&"right"==y(e+1)?r({view:"double",index:e}):"right"==y(e)&&"left"==y(e-1)?r({view:"double",index:e-1}):r({view:null,index:e,scroll:stg.data.settings.pageScroll}):r({view:null,index:e,scroll:stg.data.settings.pageScroll})}function r(e){return e.view||(e.view="single"),"view"==n?(t.cb&&t.cb(e.view),e.view):"page"==n?(t.cb&&t.cb(e.page),e.page):(t.cb&&t.cb(e),e)}},p.loadChapterByIndex=function(e,t){t||(t={});var n=t.deferred;return n||(n=$q.defer()),null==e&&(e=currentIndex),e<0?(n.resolve(),n.promise):(e>p.maxIndex&&(e=p.maxIndex-1),w(e)?(currentIndex=e,p.nextChapter({skipRestricted:!0})):(p.showLoader(),p.getPageOb({page:e,source:"loadChapterByIndex"},(function(o){if(!o)return p.loadChapterByIndex(0,t);p.getSurroundingPages({index:o.index,vIndex:t.vIndex},(function(){p.hideLoader();var i={index:e,vIndex:t.vIndex,layout:o.layout};if(skeleton.normalize(i),!t.hash&&(i.index!=e||null!=i.vIndex&&i.vIndex!=t.vIndex))return p.loadChapterByIndex(i.index,{hash:t.hash,vIndex:i.vIndex,reload:t.reload,deferred:n}),n.promise;var r=p.getChapterURL(e),a=!1;if(0==r.indexOf("#")&&(a=!0),t.hash&&o.pages&&o.pages.length&&(a=!0),a)return p.loadLocation(t.hash,{index:e,source:"from loadChapterByIndex"}).then((function(e){}));t.leftOb=o,t.leftOb.index=e,t.leftOb.currentVIndex=t.leftOb.vIndex,t.leftOb.vIndex=t.vIndex,asyncCheck(!(o.pages&&t.leftOb.vIndex>=o.pages.length-1),p.getPageOb,[{page:e+1,source:"loadChapterByIndex"}],(function(){p.planPageMapping(t,(function(o){if(o||(o={}),o.redirect)return p.redirect(o.redirect.index,{hash:t.hash,vIndex:t.vIndex,reload:t.reload,deferred:n}),n.promise;if(t.deferred=null,stg.data.currentPageOb||Vue.set(stg.data,"currentPageOb",t.leftOb),p.urlMatchesIndex(r,currentIndex)&&!t.reload&&currentVIndex==t.vIndex){currentIndex=e,S();var i=t.hash;return i||(i=ph.getHash(t.leftOb.url)),i?p.loadLocation(i,{index:currentIndex,source:"from loadChapterByIndex2"}).then((function(){p.highlightCurrentTocChapter()})):($ionicScrollDelegate.$getByHandle("content").scrollTop(!0),p.highlightCurrentTocChapter()),Vue.set(stg.data.book.chapter,"url",r),Vue.set(stg.data.book.chapter,"absoluteURL",ph.join(bookPath,stg.data.packageURL,stg.data.book.chapter.url)),n.resolve(),n.promise}context.startTransition(t,n)}))}))}))})),n.promise))},p.getSurroundingPages=function(e,t){if("single"==stg.data.settings.viewMode)return t();if(!e)return t();var n=skeleton.getJoint(e.index,e.vIndex);if(n&&n.length>1)return p.getPageOb({page:e.index-1},t);asyncCheck(n,p.getPageOb,[{page:e.index}],(function(){p.getPageOb({page:e.index+1},(function(){p.getPageOb({page:e.index-1},t)}))}))},p.planPageMapping=function(e,t){var n=p.getCurrentView(e.leftOb.index,{vIndex:e.leftOb.vIndex});if(n.index==e.leftOb.index)if(p.shouldBePaged(e.leftOb)||"double"==n.view)if(e.view="double",e.rightOb||(e.rightOb={}),"fxl"==e.leftOb.layout){p.getChapterURL(e.leftOb.index+1)?(e.rightOb.index=e.leftOb.index+1,e.rightOb.url=ph.join(bookPath,stg.data.packageURL,p.getChapterURL(e.leftOb.index+1))):e.rightOb=null,r()}else{if(e.rightOb.url=e.leftOb.url,e.leftOb.viewport=$injector.get("spread").getViewport(e.leftOb),e.vIndex=Number(e.vIndex),isNaN(e.vIndex)&&(e.vIndex=0),e.leftOb.vIndex=e.vIndex,e.vIndex<0||e.vIndex>=e.leftOb.pages.length){var o=0;return e.vIndex<0&&(o=e.vIndex),e.vIndex=e.leftOb.pages.length+o,e.leftOb.vIndex=e.leftOb.pages.length+o,e.rightOb.vIndex=e.leftOb.vIndex+1,e.rightOb.index=e.leftOb.index,void t({redirect:{index:n.index}})}if(e.leftOb.content=e.leftOb.pages[e.vIndex].content,"single"==n.view)return e.rightOb=null,void r();if(e.vIndex+1<e.leftOb.pages.length)e.rightOb=clone(e.leftOb),e.rightOb.vIndex=e.vIndex+1,e.rightOb.index=e.leftOb.index,e.rightOb.content=e.leftOb.pages[e.rightOb.vIndex].content,r();else{if(e.leftOb.index>=p.maxIndex-1)return e.rightOb=null,void r();e.rightOb.index=e.leftOb.index+1;var i=p.getChapterURL(e.rightOb.index);p.getPageOb({page:e.rightOb.index},(function(t){e.rightOb=t,e.rightOb.vIndex=0,e.rightOb.url=ph.join(bookPath,stg.data.packageURL,i),e.rightOb.pages&&e.rightOb.pages.length&&(e.rightOb.content=e.rightOb.pages[0].content),e.rightOb.viewport=$injector.get("spread").getViewport(e.rightOb),r()}))}}else e.view="single","fxl"!=e.leftOb.layout&&(e.leftOb.viewport=null),e.leftOb.raw&&(e.leftOb.content=e.leftOb.raw),r();else t({redirect:{index:n.index}});function r(){t&&t({url:e.leftOb.url})}},p.getCacheOrPreload=C,p.currentUrlMatchesVIndex=function(e){return getQueryStringValue("vi")==e},p.urlMatchesIndex=function(e,t){if(null!=t){e=ph.normalize(e);ph.getHash(e);var n,o=ph.removeHash(e),i=stg.data.epub.spine.getElementsByTagName("itemref")[t];if(i){for(var r=stg.data.epub.manifest.getElementsByTagName("item"),a=0;a<r.length;a++)r[a].getAttribute("id")==i.getAttribute("idref")&&(n=r[a].getAttribute("href"));return!!n&&ph.removeHash(ph.normalize(n))==ph.removeHash(ph.normalize(o))}}},p.applyChapterStateFromURL=function(e,t){if(t||(t={}),0!=e.indexOf("#")){var n=ph.getHash(e),o=t.index?t.index:p.indexFromUrl(e);null!=o&&($rootScope.renderScope.applyHeader("default"),p.redirect(o,{hash:n,vIndex:t.vIndex}),$rootScope.$$phase||$rootScope.$apply())}else p.redirect(currentIndex,{hash:e.substr(1)})},p.loadChapterByURL=function(e,t){var n=ph.relative(ph.join(bookPath,stg.data.packageURL),e.leftOb.url);e||(e={});var o=$q.defer(),i=e.hash?e.hash:ph.getHash(n),r=e.leftOb.index;if(0==n.indexOf("#")&&(i=n.substr(1)),null!=r){if(!e.reload&&p.urlMatchesIndex(n,currentIndex)&&currentVIndex==e.vIndex)return currentIndex=r,S(),i?(t&&t(),p.loadLocation(i,{index:currentIndex,source:"from loadChapterByUrl"})):(vueApp.$route.params.hash?($ionicScrollDelegate.$getByHandle("content").scrollTop(!0),o.resolve()):o.resolve(),t&&t(),o.promise);if(desktop)require("nw.gui").App.clearCache();kInteractive.clearAudioVideo(document),currentVIndex=e.vIndex;var a=p.getCurrentView(r,{vIndex:currentVIndex});stg.data.currentView=a.view,u=null==currentIndex;var s=currentIndex;if(currentIndex=r=a.index,S(),Vue.set(stg.data,"currentPageOb",e.leftOb),Vue.set(stg.data,"currentRPageOb",e.rightOb),delete e.leftOb.currentVIndex,mobile){var c=$ionicScrollDelegate.$getByHandle("content");c&&c.resize()}return p.busy=!0,cache.getOb("epubContainer").style.pointerEvents="none",p.loadChapterByURLRaw(e).then((function(n){if(p.busy=!1,e.scroll){var o=$ionicScrollDelegate.$getByHandle("content");o&&o.scrollTo(0,e.scroll,!1)}config.kotobee.cloudid&&(config.kotobee.public||backend.setLastChapter()),setTimeout((function(){virt.reset(e.scroll?e.scroll:0,(function(){cache.getOb("epubContainer").style.pointerEvents=null,i?p.loadLocation(i,{index:currentIndex,source:"loadChapterByURLRaw"}).then((function(){(u||currentIndex!=s)&&(p.disableJsLoading||jsParser.replaceScript(n||[]),kInteractive.postRender(document)),I("renderedChapter"),p.highlightCurrentTocChapter(),T(),x(),t&&t()})):(p.disableJsLoading||jsParser.replaceScript(n||[]),kInteractive.postRender(document),I("renderedChapter"),p.highlightCurrentTocChapter(),T(),x(),t&&t())}))}))}))}t&&t()},p.cacheLookup=function(e,t){if(!v(e))for(var n=0;n<h.length;n++)if(h[n].url==ph.removeHash(e)){var o=h[n];return h.splice(n,1),h.push(o),o}},p.removeFromCache=function(e,t){for(var n=0;n<h.length;n++)if(h[n].url==ph.removeHash(e)&&h[n].view==t)return void h.splice(n,1)},p.addToCache=function(e,t){if(t||(t={}),e.url=ph.removeHash(e.url),!v(e.url)){var n=p.cacheLookup(e.url,e.view);n?t.update&&(n.url=e.url,n.title=e.title,n.viewport=e.viewport,n.content=e.content,n.layout=e.layout,n.styles=e.styles,e.script&&(n.script=e.script)):(h.length>20&&h.shift(),t.lowPriority?h=[e].concat():h.push(e))}},p.loadChapterByURLRaw=function(e){e||(e={});var t=ph.relative(ph.join(bookPath,stg.data.packageURL),e.leftOb.url),n=$q.defer();Vue.set(stg.data.book.chapter,"url",t),Vue.set(stg.data.book.chapter,"absoluteURL",ph.join(bookPath,stg.data.packageURL,stg.data.book.chapter.url));ph.getHash(stg.data.book.chapter.url);virt.disable(),virt.lock(),kStatus.update(null);var o=[];return function(e){var t;if(t=p.cacheLookup(stg.data.book.chapter.absoluteURL,"single"))return copyObjToObj(t,e.leftOb,{onlyIfNotExists:!0}),e.leftOb.cached=!0,void r();var o=_defineProperty({showError:!0,deferred:n,view:e.view,id:e.id},"view",null);function r(){if("single"!=e.view&&e.rightOb){var n=e.rightOb.url;(t=p.cacheLookup(n,"single"))?(copyObjToObj(t,e.rightOb,{onlyIfNotExists:!0}),e.rightOb.cached=!0,i(e)):p.preloadChapter(n,o,(function(t){copyObjToObj(t,e.rightOb,{onlyIfNotExists:!0}),i(e)}))}else i(e)}p.preloadChapter(stg.data.book.chapter.absoluteURL,o,(function(t){copyObjToObj(t,e.leftOb,{onlyIfNotExists:!0}),r()}))}(e),n.promise;function i(t,i){t||(t={});var r=t.leftOb.title,a=(t.leftOb.content,t.leftOb.bodyClass),s=t.leftOb.viewport,c=(t.leftOb.styles,t.leftOb.script,t.leftOb.layout),l=t.isCached,d=t.leftOb,h=t.rightOb;d&&(o=o.concat(d.script)),h&&(o=o.concat(h.script)),makeArrayUnique(o),r||(r=d.title),Vue.set(stg.data.book.chapter,"title",r),Vue.set(stg.data.book.chapter,"viewport",s),Vue.set(stg.data.book.chapter,"layout",c),Vue.set(stg.data.book.chapter,"view",t.view),Vue.set(stg.data.book.chapter,"paged",p.shouldBePaged(d)),S(),Vue.nextTick((function(){tinCan.send({verb:"navigated",activity:(currentIndex?"Chapter "+currentIndex+": ":"")+r}),mobile||(u||Boolean(s)!=Boolean(stg.data.book.chapter.viewport))&&$injector.get("nav").resetEpubContainer(s);var i=document.getElementById("epubInner");t.source="from chapters",pauseVideoAndAudio(i=context.populateSpreads(i,t)),cache.setOb("epubContent",document.getElementById("epubContent")),cache.getOb("epubContainer").focus(),l||context.setContentSize(cache.getOb("epubContent"),e),a&&addClass(cache.getOb("epubContent").getElementsByTagName("section")[0],a);var c=document.getElementById("chapters");removeClass(c,["rfl","fxl","double","single"]),addClass(c,stg.data.book.chapter.viewport?"fxl":"rfl"),addClass(c,t.view),stg.data.book.chapter.paged?addClass(c,"paged"):removeClass(c,"paged");var p=cache.getOb("epubContainer");if(removeClass(p,["rfl","fxl","double","single"]),addClass(p,stg.data.book.chapter.viewport?"fxl":"rfl"),addClass(p,t.view),stg.data.book.chapter.paged?addClass(p,"paged"):removeClass(p,"paged"),!chapters.disableCssLoading){l||(cssParser.replaceStyles(""),cssParser.replaceStyles(d.styles.replace(/#spreadR/g,"#spreadL"),{append:!0}),h&&h.viewport&&cssParser.replaceStyles(h.styles.replace(/#spreadL/g,"#spreadR"),{append:!0})),cssParser.replaceStyles("#epubContainer div#epubContent, #epubContainer.stylesEnabled div#epubContent { background-color:#e7e3d9 !important;}",{append:!0})}config.preserveLoc&&"app"!=config.kotobee.mode&&stg.writeSlot("lastLoc"+stg.getBookId(),currentIndex),stg.writeSlot("lastLocY"+stg.getBookId(),0);for(var g=0;g<f.length;g++)f[g]("newChapter",t);$filter("contentJs")(l).then((function(){selection.reset(),virt.unlock(),n.resolve(o)}))}))}},p.preloadChapterFromApi=function(e,t){return p.preloadChapter(ph.join(bookPath,stg.data.packageURL,e),{},t)},p.loadAndDecrypt=function(e,t,n){return O(ph.join(bookPath,stg.data.packageURL,e),t,n)};var N,A,L,B=[];function P(e,t){e||(e={});var n=e.first,o=e.page,i=e.vIndex;(null==o&&(o=currentIndex),null==i&&(i=currentVIndex),"single"==p.getCurrentView(o,{vIndex:i}).view)?p.shouldBePaged(e.page?e:stg.data.currentPageOb)?t(o<=n&&0==currentVIndex):t(o<=n):stg.data.currentPageOb.pages?t(o<=n&&0==currentVIndex):t(o<=n)}function M(e,o){e||(e={});var i=e.max,r=e.page,a=e.vIndex,s=e.view;return null==r&&(r=currentIndex,a=currentVIndex,s=p.getCurrentView(r,{returnType:"view"})),"single"==s?(null==e.index&&(e.index=e.page),p.shouldBePaged(null!=e.page?e:stg.data.currentPageOb,s)?c(r>=i-1&&a>=t-1):c(r>=i-1)):c(r>=i-1?!t||a>=t-2:r>=i-2&&(!(t&&a>=n-1)||t<=1));function c(e){return o&&o(e),e}}function R(){var e=ph.removeHash(window.location.href),t=document.getElementsByTagName("base");if(t.length)for(var n=0;n<t.length;n++)if(t[n].getAttribute("href")){e=window.location.origin+"/"+t[n].getAttribute("href");break}return e.indexOf("chrome-extension://")>=0||isAbsoluteURLPath(stg.data.book.chapter.absoluteURL)?stg.data.book.chapter.absoluteURL:"/"==stg.data.book.chapter.absoluteURL[0]?getDomainFromURL(e)+stg.data.book.chapter.absoluteURL:ph.join(e,stg.data.book.chapter.absoluteURL)}function D(){return"library"==config.kotobee.mode?stg.data.paths.private+"books/"+stg.data.book.chapter.absoluteURL.split("/books/")[1]:stg.data.paths.private+stg.data.book.chapter.absoluteURL.substr(1)}function $(e){try{if("none"!=e.style.display)return e;if(e.previousElementSibling)return $(e.previousElementSibling);if("none"!=e.parentNode.style.display)return $(e.parentNode);var t=e.parentNode.previousElementSibling.getElementsByTagName("li");return $(t[t.length-1])}catch(t){return e}}return p.preloadChapter=function(e,t,n){var o={func:arguments.callee,args:arguments};t||(t={}),B.push(e),O(e,(function(o){var i=parseHtml(o),r="",a=i.getElementsByTagName("body");a.length&&(r=a[0].className);for(var s=$filter("contentHtml")(i,e),c=i.getElementsByTagName("meta"),l=null,d=0;d<c.length;d++){var u=c[d].getAttribute("name");if(u&&"viewport"==u.toLowerCase()){l={};var f=c[d].getAttribute("content");if(!f)break;for(var h=f.split(","),g=0;g<h.length;g++){var m=h[g].split("=");m[1]&&(m[1]=m[1].replace("px",""),l[m[0].trim()]=Number(m[1].trim()))}l.width||l.height||(l=null)}}var v=l?"fxl":"rfl";$filter("js")(i).then((function(o){$filter("styles")(i,{path:e,id:t.id}).then((function(a){var c,d=i.getElementsByTagName("title");if(d.length)c=d[0].textContent.trim();else{var u=i.getElementsByTagName("h1");u.length&&(c=u[0].textContent.trim())}c||(c=stg.data.book.meta.dc.title);var f={url:e,title:c,bodyClass:r,viewport:l,layout:v,content:s.outerHTML,styles:a,script:o};t.dontCache||p.addToCache(f,t),removeFromArray(e,B),n&&n(f)}))}))}),(function(){removeFromArray(e,B),t.showError&&(kError.update({error:"networkError",ref:o}),t.deferred&&t.deferred.reject({}),T())}))},p.clearContent=function(){document.getElementById("epubInner")&&replaceHTML("epubInner",""),E()},p.getChapterURL=function(e){var t;null==e&&(e=currentIndex),e<0&&(e=0);try{var n=stg.data.epub.spine.getElementsByTagName("itemref");if(e>=n.length)return;t=n[e]}catch(e){}var o=getElementsByAttribute(stg.data.epub.manifest,"item","id",t.getAttribute("idref"))[0].getAttribute("href"),i=t.getAttribute("id");return i&&(o+="#"+i),o},p.isFirstChapter=function(e){P({first:0},e)},p.isFirstVisibleChapter=function(e){P({first:o},e)},p.isLastChapter=function(e){return M({max:p.maxIndex},e)},p.isLastVisibleChapter=function(t){return M({max:e},t)},p.isLastVisibleSingleChapter=function(t,n,o){return M({max:e,page:t,vIndex:n,view:"single"},o)},p.getPageOb=function(e,t){e||(e={});var n=e.page;null==n&&(n=currentIndex);var o=p.getChapterURL(n);if(!o)return t?t():null;C(ph.join(bookPath,stg.data.packageURL,o),{},(function(o){if(o.index=n,"fxl"==o.layout&&(o.spread=y(o.index)),o.nonlinear=function(e){if(stg.data.epub.spine){var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];return t?"no"==t.getAttribute("linear"):void 0}}(o.index),o.pages||"fxl"==o.layout||!p.shouldBePaged(o)||e.dontParse)return skeleton.add(o),t?t(o):null;$injector.get("spread").parseReflowableChapter(o,(function(e){return o.pages=e.pages,o.raw=e.raw,skeleton.add(o),t?t(o):null}))}))},p.shouldBePaged=function(e,t){return(!e||"fxl"!=e.layout)&&("double"==stg.data.settings.viewMode||("single"==stg.data.settings.viewMode?!stg.data.settings.pageScroll:(!t&&e&&(t=p.getCurrentView(e.index).view),"single"!=t||!stg.data.settings.pageScroll)))},p.convertPDF=function(){var e={func:arguments.callee,args:arguments};if(preview)kError.update({error:"savePdfUnsupportedInPreview"});else if(!desktop&&!isNative)if(config.pdfsavingOptions||config.pdfbooksaving){var t={scale:100,range:"chapter",submit:function(){modals.hide(),n(t)}};modals.show({mode:"pdfSave",pdfSaveOptions:t})}else n();function n(t){t||(t={}),t.scale||(t.scale=100),t.range||(t.range="chapter");var n=R();isKotobeeHosted()&&config.kotobee.cloudid&&!config.kotobee.public&&(n=D()),-1!=window.location.href.indexOf("http://localhost:8080/#/book/")&&(n=D());var o=stg.data.book.chapter.title,i={url:n,filename:o};kStatus.update(translit.get("pleaseWait"),null,{dots:!0,timeoutDuration:12e4}),backend.createRequest(config.kotobee.liburl+"library/pdf/status",{},(function(o){if("converting"==o.status)return kStatus.update(),kStatus.showAndHide(translit.get("pdfInProgress"),2500);backend.createRequest(config.kotobee.liburl+"link/pdfgenerate/url",i,(function(o){if(!o)return kStatus.update(),void kError.update({error:"networkError",ref:e});var s=o;asyncCheck(!t.includeNotes,stg.getHlights,[],(function(e){asyncCheck(!t.includeNotes,stg.getNotes,[],(function(o){r&&r.parentNode&&r.parentNode.removeChild(r),(r=document.createElement("iframe")).setAttribute("style","display:none"),r.setAttribute("name","pdfFrame"),document.body.appendChild(r),a&&a.parentNode&&a.parentNode.removeChild(a),(a=document.createElement("form")).setAttribute("style","visibility:hidden:position:absolute"),a.setAttribute("method","post"),a.setAttribute("action",s),a.setAttribute("target","pdfFrame"),addFormHiddenInput("url",n,a),addFormHiddenInput("filename",stg.data.book.chapter.title,a),addFormHiddenInput("fileext","pdf",a),addFormHiddenInput("scale",t.scale,a),addFormHiddenInput("range",t.range,a),t.includeNotes&&addFormHiddenInput("includenotes",!0,a);var c=backend.getAuthVars();for(var l in c)c[l]&&addFormHiddenInput(l,c[l],a);if("book"==t.range&&(stg.data.book.id?addFormHiddenInput("bid",stg.data.book.id,a):addFormHiddenInput("bookpath",bookPath.replace(/^.*\/(f\d*?)\/.*$/g,"$1"),a)),o){for(var d=0;d<o.length;d++)if(o[d]&&o[d].location){var u=String(o[d].location).split(",");o[d].locationDec=Number("0."+addDigitsToArray(u[0].split("."),3).join(""))}o=o.sort((function(e,t){return e.locationDec>t.locationDec?1:-1}));var p=[];for(d=0;d<o.length;d++)"book"!=t.range&&o[d].chapter!=currentIndex||p.push({chapter:o[d].chapter,note:o[d].note,src:o[d].src});addFormHiddenInput("notes",JSON.stringify(makeObjectArrayUnique(p)),a)}if(e){for(d=0;d<e.length;d++){if(e[d]&&e[d].location)-1!=(u=String(e[d].location)).indexOf(",")&&(u=u.split(",")[0]),-1!=u.indexOf("-")&&(u=u.split("-")[0]),e[d].locationDec=Number("0."+addDigitsToArray(u.split("."),3).join(""))}e=e.sort((function(e,t){return e.locationDec>t.locationDec?1:-1}));var f=[];for(d=0;d<e.length;d++)"book"!=t.range&&e[d].chapter!=currentIndex||f.push({chapter:e[d].chapter,color:e[d].color,src:e[d].src,location:e[d].location});addFormHiddenInput("hlights",JSON.stringify(makeObjectArrayUnique(f)),a)}addFormHiddenInput("format",config.pdfMode?config.pdfMode:"imgpdf",a);var h=config.kotobee.encodekey&&!kInteractive.isSDK();function g(){r&&r.parentNode&&r.parentNode.removeChild(r),a&&a.parentNode&&a.parentNode.removeChild(a),kStatus.update()}e&&e.length&&(h=!0),asyncCheck(!h,O,[stg.data.book.chapter.absoluteURL],(function(e){h&&(i.data=e,addFormHiddenInput("data",e,a)),document.body.appendChild(a),setTimeout((function(){backend.validatePdfConversion(i,(function(e){if(e.error)return modals.show({mode:"generalError",errorOptions:{msg:translit.get("errorConvertingPDF")}}),void g();a.submit(),setTimeout((function(){var e=setInterval((function(){var t=s.replace(/(https?:\/\/.*?\/).*/g,"$1");backend.createRequest(t+"library/pdf/status",{},(function(t){"converting"!=t.status&&(clearInterval(e),g())}))}),2e3)}),4e3)}))}))}))}))}))}))}))}},p.pdfPrintOld=function(){preview?kError.update({error:"savePdfUnsupportedInPreview"}):desktop||isNative||(kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),window.location.href="https://www.kotobee.com/link/pdfgenerate?url="+R(),setTimeout((function(){kStatus.update()}),4e3))},p.printAsBitmap=function(){var e={func:arguments.callee,args:arguments};var t=R();isKotobeeHosted()&&config.kotobee.cloudid&&!config.kotobee.public&&(t=D());var n=stg.data.book.chapter.title,o={url:t,filename:n};kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),backend.createRequest(config.kotobee.liburl+"link/pdfgenerate/url",o,(function(o){if(!o)return kStatus.update(),void kError.update({error:"networkError",ref:e});var i=o;function r(){try{var e=this.contentWindow;setTimeout((function(){e.__container__=this,e.focus(),e.print(),kStatus.update()}),2500)}catch(e){kStatus.update()}}s&&s.parentNode&&s.parentNode.removeChild(s),(s=document.createElement("iframe")).setAttribute("style","display:none"),s.setAttribute("name","printFrame"),s.id="printContainer",s.style.visibility="hidden",s.style.position="fixed",s.style.right="0",s.style.bottom="0",document.body.appendChild(s),c&&c.parentNode&&c.parentNode.removeChild(c),(c=document.createElement("form")).setAttribute("style","visibility:hidden:position:absolute"),c.setAttribute("method","post"),c.setAttribute("action",i),c.setAttribute("target","printFrame"),addFormHiddenInput("url",t,c),addFormHiddenInput("filename",stg.data.book.chapter.title,c),addFormHiddenInput("fileext","pdf",c),addFormHiddenInput("print",!0,c),addFormHiddenInput("format","imghtml",c);var a=config.kotobee.encodekey&&!kInteractive.isSDK();asyncCheck(!a,O,[stg.data.book.chapter.absoluteURL],(function(e){a&&addFormHiddenInput("data",e,c),document.body.appendChild(c);var o={url:t,filename:n};backend.validatePdfConversion(o,(function(e){if(e.error)return p.print({force:!0});c.submit(),setTimeout((function(){kStatus.update()}),8e3)})),s.onload=r}))}))},p.print=function(e){e||(e={}),isNative||mobile||(kStatus.update(translit.get("pleaseWait"),null,{dots:!0}),closePrintIframe(),O(R(),(function(e){var t,n=ph.removeFilename(R());return e=(e=(e=e.replace("<head>","<head><meta http-equiv=\"Content-Security-Policy\" content=\"default-src * gap://ready file: filesystem: data:; style-src * 'self' 'unsafe-inline' filesystem: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' kotobee: https://*.amazonaws.com https://*.google.com https://*.googleapis.com https://*.youtube.com https://*.stripe.com https://*.paypal.com https://*.kotobee.com http://*.youtube.com https://*.ytimg.com http://*.ytimg.com;img-src * filesystem: data: blob: android-webview-video-poster:\">")).replace("<head>","<head><script> window.onload = function() { window.print(); setTimeout(parent.closePrintIframe,1000); }<\/script>")).replace("<head>","<head><base href='"+n+"/'/>"),(t=document.createElement("iframe")).id="printContainer",t.style.visibility="hidden",t.style.position="fixed",t.style.right="0",t.style.bottom="0",t.setAttribute("srcdoc",e),document.body.appendChild(t),void kStatus.update()})))},p.regenerateSpreads=function(e,t){var n;(e||(e={}),p.shouldBePaged(stg.data.currentPageOb))&&(p.regeneratingSpreads?A=!0:(A=!1,cache.getOb("epubContainer").style.opacity=0,p.showLoader(),stg.data.currentPageOb.pages&&stg.data.currentPageOb.pages.length&&(n=currentVIndex/stg.data.currentPageOb.pages.length),N&&clearTimeout(N),N=setTimeout((function(){p.regeneratingSpreads=!0,L&&clearTimeout(L),L=setTimeout((function(){p.regeneratingSpreads=!1,p.regenerateSpreads(e,t)}),2e4),p.resetPages(),p.preloadEdgeChapters((function(){p.getPageOb({page:currentIndex},(function(e){var o={};o.viewMode=stg.data.settings.viewMode,o.vIndex=currentVIndex,n&&e.pages&&(o.vIndex=Math.floor(e.pages.length*n),o.vIndex!=currentVIndex&&$location.search({vi:o.vIndex})),o.reload=!0,p.loadChapterByIndex(currentIndex,o).then((function(){p.regeneratingSpreads=!1,clearTimeout(L),A?setTimeout((function(){A=!1,p.regenerateSpreads(o,t)}),100):(t&&t(),cache.getOb("epubContainer").style.opacity=1,p.hideLoader())}))}))}))}),e.resize?600:30)))},p.resetPages=function(t){t||(t={});for(var n=0;n<h.length;n++)h[n].pages=null;return skeleton.reset(),t.buildChapterMode||stg.data.book.meta.rendition&&"pre-paginated"==stg.data.book.meta.rendition.layout||"double"!=stg.data.settings.viewMode&&stg.data.settings.pageScroll?skeleton.initialize({first:o,last:e}):void 0},p.getIndexFromTocElem=function(e){var t=e.getAttribute("href");try{if(0==t.indexOf("#"))return t.split("/reader/chapter/")[1].split("/")[0]}catch(t){try{return e.getAttribute("data-index")}catch(e){}}for(var n=document.getElementById("chaptersInner").getElementsByTagName("a"),o=0,i=0;i<n.length&&(n[i].getAttribute("href")!=t||"restricted"==n[i].className||(o++,e!=n[i]));i++);return p.indexFromUrl(e.getAttribute("href"),{order:o})},p.highlightCurrentTocChapter=function(){if(mobile&&$injector.get("nav").resize(),stg.data.currentPageOb){var e=stg.data.currentPageOb.index;if(stg.data.book){stg.data.book.chapter.url;for(var t=document.getElementById("chaptersInner").getElementsByTagName("a"),n=[],o=0;o<t.length;o++)m(p.getIndexFromTocElem(t[o]),e),p.getIndexFromTocElem(t[o])==e&&n.push({elem:t[o],id:ph.getHash(t[o].getAttribute("href"))});p.deApplySelectedChapter(),n.length&&p.applySelectedChapter($(n[0].elem.parentNode))}}},p.applySelectedChapter=function(e,t){if(e&&(null==t&&(t=!0),addClass(e,"selected"),addClass(e,"currentChapter"),t)){for(var n=e,o=cache.getOb("chaptersContent");(e=e.parentNode)&&e!=o;)"li"==e.nodeName.toLowerCase()&&(addClass(e,"expanded"),addClass(e,"containsSelection"));if(overflowScroll)o.scrollTo?o.scrollTo(0,Math.round(getTopOffsetRelativeTo(n,o)),!0):o.scrollTop=Math.round(getTopOffsetRelativeTo(n,o));else{var i=$ionicScrollDelegate.$getByHandle("chapters");i&&i.scrollTo(0,Math.round(n.offsetTop-o.parentNode.offsetHeight/2),!1)}}},p.deApplySelectedChapter=function(){for(var e=cache.getOb("chaptersContent"),t=e.getElementsByClassName("containsSelection"),n=t.length;n--;)removeClass(t[n],"containsSelection");var o=e.getElementsByClassName("selected");for(n=o.length;n--;)removeClass(o[n],"selected");for(n=(o=e.getElementsByClassName("currentChapter")).length;n--;)o[n].removeAttribute("name")},p.elemInChapterElem=function(e,t){return!(stg.data.currentPageOb.index!=t||!hasParentWithId(e,"spreadL",99))||(!(!stg.data.currentRPageOb||stg.data.currentRPageOb.index!=t||!hasParentWithId(e,"spreadR",99))||void 0)},p.mightCrashOnIos=function(e){if(mobile&&ios){var t=/iPhone OS (\d+)/g.exec(window.navigator.userAgent);if(!t)return;if("15"==t[1]||"16"==t[1]){if(0==window.location.search.indexOf("?ioscompatible"))return!0;if(e.length>2e3&&e.split(" ").length>400)return!0}}},p})),createService("context",(function(){var e,t,n,o,i={};function r(t,n){if(t||(t={}),t.reload)n&&n();else{var i=cache.getOb("epubContainer");if(null==currentIndex)return i.style.opacity=0,e.showLoader(),void(n&&n());!function(t,n){var o;null!=stg.data.currentPageOb.currentVIndex&&(isNaN(stg.data.currentPageOb.currentVIndex)||(o=stg.data.currentPageOb.vIndex,stg.data.currentPageOb.vIndex=currentVIndex)),skeleton.getNextLinearIndex({index:stg.data.currentPageOb.index,vIndex:stg.data.currentPageOb.vIndex},(function(i){null!=o&&(stg.data.currentPageOb.vIndex=o);var r=i?[t,i.leftOb]:null;asyncCheck(!i,e.arePagesAppearingTogether,r,(function(r){if(r&&i)return n("next");null!=currentVIndex&&(stg.data.currentPageOb.vIndex=currentVIndex),skeleton.getPrevLinearIndex({index:stg.data.currentPageOb.index,vIndex:stg.data.currentPageOb.vIndex},(function(i){null!=o&&(stg.data.currentPageOb.vIndex=o),e.arePagesAppearingTogether(t,i.leftOb,(function(e){return n(e?"prev":null)}))}))}))}))}(t.pageOb,(function(a){if(!a)return i.style.opacity=0,t.pageOb.index!=currentIndex&&e.showLoader(),void(n&&n());var s=document.getElementById(a+"Page");s.style.opacity=null;var c=s.getElementsByTagName("iframe");if(c.length){var l=c[0].contentDocument.getElementById("epubContent"),u=c[0].srcdoc;if(l||!u){if(c[0].style.visibility="visible",l){var p=$injector.get("nav").viewFromElem(l);"fxl"==p.layout&&d(c[0],p)}}else if(requestAnimationFrame)return void requestAnimationFrame((function(){r(t,n)}))}if("navSlide"==stg.data.settings.navAnim)book.isRtl()?s.style.transform="translate3d("+("next"==a?"-":"")+i.offsetWidth+"px,0,0)":s.style.transform="translate3d("+("next"==a?"":"-")+i.offsetWidth+"px,0,0)",requestAnimationFrame((function(){t.animID==o&&(book.isRtl()?autoprefixTransform(i,"translate3d("+("next"==a?"":"-")+i.offsetWidth+"px,0,0)"):autoprefixTransform(i,"translate3d("+("next"==a?"-":"")+i.offsetWidth+"px,0,0)"),s.style.transform="translate3d(0,0,0)",addClass(i,"anim"),addClass(s,"anim"),addClass(s,"activeSlidePage"),s.addEventListener("transitionend",(function e(){if(s.removeEventListener("transitionend",e),t.animID!=o)return;autoprefixTransform(i,null),removeClass(i,"anim"),n&&n()})))}));else if("navStack"==stg.data.settings.navAnim)setTimeout((function(){t.animID==o&&(book.isRtl()?autoprefixTransform(i,"translate3d("+("next"==a?"":"-")+i.offsetWidth+"px,0,0)"):autoprefixTransform(i,"translate3d("+("next"==a?"-":"")+i.offsetWidth+"px,0,0)"),s.style.transform="translate3d(0,0,0)",addClass(i,"anim"),addClass(s,"anim"),addClass(s,"activeSlidePage"),setTimeout((function(){t.animID==o&&(autoprefixTransform(i,null),removeClass(i,"anim"),n&&n())}),330))}),30);else if("navFade"==stg.data.settings.navAnim)s.style.left=0,s.style.opacity=1,addClass(s,"anim"),addClass(s,"activeSlidePage"),setTimeout((function(){t.animID==o&&n&&n()}),330);else if("navFlip"==stg.data.settings.navAnim)addClass(i,"anim"),book.isRtl()?(autoprefixTransform(i,"next"==a?"rotateY(90deg)":"rotateY(-90deg)"),autoprefixTransform(s,"next"==a?"rotateY(-90deg)":"rotateY(90deg)")):(autoprefixTransform(i,"next"==a?"rotateY(-90deg)":"rotateY(90deg)"),autoprefixTransform(s,"next"==a?"rotateY(90deg)":"rotateY(-90deg)")),i.style.opacity=0,setTimeout((function(){t.animID==o&&(autoprefixTransform(s,null),addClass(s,"anim"),addClass(s,"activeSlidePage"),setTimeout((function(){t.animID==o&&(removeClass(i,"anim"),autoprefixTransform(i,null),n&&n())}),630))}),30);else if("navBookBlock"==stg.data.settings.navAnim){var f=document.createElement("div");f.className="shadow",f.style.opacity=0,f.appendChild(document.createElement("div")),i.appendChild(f),addClass(i,"anim"),book.isRtl()?autoprefixTransform(i,"next"==a?"rotateY(90deg)":"rotateY(-90deg)"):autoprefixTransform(i,"next"==a?"rotateY(-90deg)":"rotateY(90deg)");var h=i.style.transform||i.style.webkitTransform||i.style.mozTransform,g="right";if(stg.data.book.chapter.viewport){var m=$injector.get("nav").getFxlFit();g=m.innerWidth+m.marginLeft+"px"}var v="left";stg.data.book.chapter.viewport&&(v=i.style.paddingLeft||"left"),autoprefixTransformOrigin(i,"rotateY(90deg)"==h?g+" top":v+" top"),i.style.opacity=0,addClass(s,"anim"),addClass(s,"activeSlidePage");var b=document.createElement("div");b.className="shadow",b.style.opacity=.7,s.appendChild(b),f.style.opacity=0,f.style.height=i.scrollHeight+"px",b.style.width=i.style.width,b.style.height=i.style.height,stg.data.book.chapter.viewport&&(b.style.right=f.style.right="auto",b.style.marginLeft=f.style.marginLeft=i.style.paddingLeft,f.style.width=i.style.width,t.pageOb.viewport||(s.style.opacity=0)),b.style.marginRight=i.style.marginRight,b.style.marginBottom=i.style.marginBottom;var k=getElemMargin(i);k.top||(k.top=0);var y=getComputedStyle(i).paddingTop.split("px");b.style.marginTop=Number(k.top)+Number(y[0])+"px";var w=getComputedStyle(i).backgroundColor,C="rgba(0,0,0,0)"==(w=w.replace(/ /g,""));C&&(i.style.backgroundColor="#fff"),setTimeout((function(){t.animID==o&&(b.style.opacity=null,setTimeout((function(){f.style.opacity=.4,setTimeout((function(){autoprefixTransformOrigin(i,null),b.parentNode&&b.parentNode.removeChild(b),f.parentNode&&f.parentNode.removeChild(f),t.animID==o&&(removeClass(i,"anim"),i.style.opacity=null,C&&(i.style.backgroundColor=null),autoprefixTransform(i,null),n&&n())}),430)}),200))}),30)}}))}}function a(t,n){if(t||(t={}),t.reload)return n?n():null;var o=cache.getOb("epubContainer");null!=o.style.opacity&&(o.style.opacity=null,e.hideLoader());var i=document.getElementsByClassName("activeSlidePage");if(!i.length)return n?n():null;var r=i[0];"navSlide"==stg.data.settings.navAnim||"navStack"==stg.data.settings.navAnim?r.style.transform=null:"navFade"==stg.data.settings.navAnim?r.style.opacity=null:"navFlip"==stg.data.settings.navAnim?autoprefixTransform(r,null):"navBookBlock"==stg.data.settings.navAnim&&(deleteTransform(r),deleteTransform(o),o.style.opacity=null);for(var a=0;a<o.children.length;a++)if("shadow"==o.children[a].className){o.removeChild(o.children[a]);break}removeClass(r,"anim"),removeClass(r,"activeSlidePage");var s='<h3 id="ebookLoaderAnim"><div class="splashSpinner large"><div class="dot1"></div><div class="dot2"></div></div></h3>';document.getElementById("nextPage").innerHTML=s,document.getElementById("prevPage").innerHTML=s,n&&n()}function s(e,o){if(n)o(cssParser.applyRoot(e,n));else{var i=isKotobeeHosted(),r="lib/ionic/release/css/ionic.min.css";i&&(r=getReaderOrigin()+"/bundles/vijualib/templates/reader/cloud/lib/ionic/release/css/ionic.min.css"),khttp.get(r).success((function(r){if(t=r,i)khttp.get(getReaderOrigin()+"/bundles/vijualib/templates/reader/cloud/css/styles.min.css").success((function(e){n=e,a()})).error((function(){o(cssParser.applyRoot(e,n))}));else{var s="css/styles.min.css",c="http://localhost:8080"==window.location.origin;c&&(s="css/style.css"),khttp.get(s).success((function(e){n=e,c?khttp.get("css/base.css").success((function(e){n=e+" "+n,khttp.get("css/kotobeeInteractive.css").success((function(e){n+=e,a()})).error((function(){a()}))})).error((function(){a()})):a()})).error((function(){o(cssParser.applyRoot(e,n))}))}})).error((function(){o(cssParser.applyRoot(e,n))}))}function a(){o(n)}}function c(t,n){t||(t={});var o=t.styles;t.container&&(o||(o=""),e.shouldBePaged(t.leftOb)&&(t.leftOb&&(t.leftOb.viewport=$injector.get("spread").getViewport(t.leftOb)),t.rightOb&&(t.rightOb.viewport=$injector.get("spread").getViewport(t.rightOb))),t.simulate?l(t,n):e.getPageOb({page:t.leftOb.index},(function(o){copyObjToObj(o,t.leftOb,{onlyIfNotExists:!0}),t.leftOb.pages&&t.leftOb.vIndex<0&&(t.leftOb.vIndex+=t.leftOb.pages.length),t.rightOb?e.getPageOb({page:t.rightOb.index},(function(e){copyObjToObj(e,t.rightOb,{onlyIfNotExists:!0}),t.rightOb.pages&&t.rightOb.vIndex<0&&(t.rightOb.vIndex+=t.rightOb.pages.length),l(t,n)})):l(t,n)})))}function l(o,r){o.id=Math.round(999*Math.random());var a=o.container,s=o.leftOb,c=o.rightOb,l=s.url,u=ph.removeHash(window.location.href),p=document.createElement("html"),f=document.createElement("head");ios&&(f.innerHTML="<meta http-equiv=\"Content-Security-Policy\" content=\"default-src * filesystem: data:; style-src 'self' 'unsafe-inline' filesystem: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.youtube.com http://*.youtube.com https://*.ytimg.com http://*.ytimg.com;img-src * filesystem: data: file:\">"),p.appendChild(f);var h=document.getElementsByTagName("base");if(h.length)for(var g=0;g<h.length;g++){var m=h[g].getAttribute("href");if(m){u=0==m.indexOf("/")||isAbsoluteURLPath(m)?m:ph.join(window.location.origin,m);break}}var v=document.createElement("base");function b(e){var o="";t&&(o+=t);var i=!mobile&&!s.viewport,r=" body{margin:0; padding-top:0px;} #epubContainer{padding-top:0px;position:absolute;top:0;left:0;right:0;bottom:0 !important}";mobile||(r+="body, #epubContainer{padding-top:1px;}"),o+=r,o+="html,#epubContainer{overflow-y:"+(i?"auto":"hidden")+"}",o+="#epubContainer.rtl{direction:rtl}",o+="#epubScroller{position: static;height: 100%;width: 100%;box-sizing: border-box;transform-origin:left top;direction:ltr}",i&&(o+="#epubContainer{overflow:auto !important}"),mobile&&(o+=" #epubContent ::-webkit-scrollbar {display: none;} #epubContent {-ms-overflow-style: none;overflow: -moz-scrollbars-none;}");var a=cache.getOb("epubContainer").getElementsByClassName("scroll")[0],c={left:0};return a&&(c=getElemPadding(a,{computed:!0})),o+="#epubScroller{padding:"+c.left+"px}",s.viewport&&s.viewport.width&&(o+="#epubContent{width:"+s.viewport.width+"px;height:"+s.viewport.height+"px; overflow:hidden; position: relative;}",o+="html{overflow-x:"+(mobile?"hidden":"auto")+"}",o+=" #epubInner{height:0;} ",o+=" #spreadL,#spreadR{position:absolute !important; top:0 !important;font-size: 1em !important;overflow:hidden;}"),s.viewport||mobile||(o+="#epubScroller{overflow:auto}"),o+=" html{overflow-x:hidden} ",o+=" #epubContent{padding:0px; line-height: 1.6;} ",o+=" #epubContent{box-sizing:border-box; font-size:"+stg.data.settings.textSize+" !important;}",o+=" #epubContent.hide{display:block !important}",o+=" #epubContent section{margin-top:0 !important}",stg.data.settings.textSize&&(o+=" #epubContent{font-size: "+stg.data.settings.textSize+"}"),o+=n,e||(e=""),o=(o+=e=e.replace(/#spreadL /g,"")).replace("background-color:#e7e3d9 !important;","")}function k(){var e=arguments[2];if(0==e.indexOf('"')&&(e=e.split('"')[1]),0==e.indexOf("'")&&(e=e.split("'")[1]),0==e.indexOf("&quot;")&&(e=e.split("&quot;")[1]),!e||!e.trim())return arguments[0];if(-1!=e.indexOf("http://"))return arguments[0];if(-1!=e.indexOf("https://"))return arguments[0];if(0==e.indexOf("data:"))return arguments[0];if(0==e.indexOf("kotobee:"))return arguments[0];var t=e.split(" ").length>1,n=(e='"'+ph.relative(ph.removeFilename(l),e)+'"').split(" ").length>1;return!t&&n&&(e='"'+e+'"'),arguments[1]+cleanURL(e)+arguments[3]}0==l.indexOf("/")||isAbsoluteURLPath(l)?v.setAttribute("href",cleanURL(ph.removeFilename(l)+"/")):v.setAttribute("href",cleanURL(ph.join(u,ph.removeFilename(l))+"/")),o.simulate||f.appendChild(v);var y=document.createElement("div");y.className="stylesEnabled",y.id="epubContainer";var w=document.createElement("div");w.id="epubScroller",w.className="scroll",y.appendChild(w);var C=document.createElement("div");function x(e){e||(e=""),e=(e=(e=e.replace(/<div class="answer correct">/g,'<div class="answer">')).replace(/<div class="correct">/g,"<div>")).replace(/<p class="explanation">.*?<\/p>/g,""),o.simulate||(e=e.replace(/(style=".*?url\()(.+?)(\).*?")/g,k));isKotobeeHosted();isReaderApp||o.simulate||(e=(e=e.replace(/src="(.*?)"/g,(function(e,t){return isAbsoluteURLPath(t)?'src="'+t+'"':'src="'+ph.relative(l,t)+'"'}))).replace(/xlink:href="(?!http[s]?\:\/\/)([^"]*)?"/g,(function(e,t){return'xlink:href="'+ph.relative(l,t)+'"'})));s.title;return isNative&&mobile&&(e=e.replace(/(<img[^>]*src=)"(.*?)"/g,(function(e,t){return arguments[1]+'"'+cleanURL(arguments[2])+'"'}))),e}C.id="epubInner",w.appendChild(C);var I=document.createElement("style");if(I.setAttribute("type","text/css"),s.pages&&null!=s.vIndex?s.content=s.pages[s.vIndex].content:!s.content&&s.raw&&(s.content=s.raw),s.content=x(s.content),c&&(c.pages&&null!=c.vIndex?c.content=c.pages[c.vIndex].content:!c.content&&c.raw&&(c.content=c.raw),c.content=x(c.content)),o.cached=!1,C=i.populateSpreads(C,o),!e.disableCssLoading){o.cached||(s.styles=s.styles.replace(/#spreadR/g,"#spreadL"),o.simulate||(s.styles=s.styles.replace(/(url\()(.*?)(\))/g,k)),c&&(c.styles=c.styles.replace(/#spreadL/g,"#spreadR"),o.simulate||(c.styles=c.styles.replace(/(url\()(.*?)(\))/g,k))));s.styles;var E=b(s.styles);!o.cached&&c&&(E+=" "+b(c.styles)," "+c.styles),I.innerHTML=E,f.appendChild(I)}var S=C.getElementsByTagName("audio");for(g=S.length;g--;){try{S[g].pause(),S[g].children.length||(S[g].src="")}catch(e){}var T=S[g].parentNode;T.previousSibling&&hasClass(T.previousSibling,"playBtn")&&removeClass(T.previousSibling,"hide"),T.removeChild(S[g])}var O=C.getElementsByTagName("video");for(g=O.length;g--;){try{O[g].pause(),O[g].children.length||(O[g].src="")}catch(e){}var N=O[g].parentNode;N.previousSibling&&hasClass(N.previousSibling,"playBtn")&&removeClass(N.previousSibling,"hide"),N.removeChild(O[g])}var A=document.createElement("body");stg.data.settings.rtl&&addClass(A,"rtl"),addClass(A,s.layout),addClass(A,o.view),addClass(A,"transitionFrame"),A.appendChild(y),p.appendChild(A);var L=document.createElement("iframe");if(L.setAttribute("srcdoc",p.outerHTML),L.style.visibility="hidden",detectIE()||isNative&&ios){var B="javascript: window.frameElement.getAttribute('srcdoc');";L.setAttribute("src",B),L.contentWindow&&(L.contentWindow.location=B)}L.onload=function(){L.style.visibility="visible",d(L,o)},a&&(a.innerHTML="",a.appendChild(L),r&&r(L))}function d(e,t){t||(t={});var n=t.leftOb,o={},r=!!t.rightOb,a=e.contentDocument,s=a.getElementById("epubContent"),c=a.getElementById("epubContainer");if(i.setContentSize(s,t),n.viewport){o.epubContainer=c,o.epubContent=s,o.viewport=n.viewport,o.view=r?"double":"single",o.stylesFromEpubContent=!0;var l=c.children[0],d=!1;if(compInstances.pan&&("fxl"==n.layout&&(d=!0),r||"double"!=stg.data.settings.viewMode||(d=!0)),d){o.viewport.double=r;var u=compInstances.pan.getBestFit("width",o.viewport);if(config.fitToScreen){var p=compInstances.pan.getBestFit("height",o.viewport);u=u.scale<p.scale?u:p}u.translate3d[0]<0&&(u.translate3d[0]=0),u.translate3d[1]<0&&(u.translate3d[1]=0),autoprefixTransform(l,"translate3d("+u.translate3d[0]+"px,"+u.translate3d[1]+"px,0px) scale("+u.scale+")"),autoprefixTransformOrigin(l,"top left;")}l.style.height="100%",vueExclude&&$injector.get("nav").fxlAdjustAlignment(o)}else{deleteTransform(s);var f=a.getElementById("spreadL");f.style.width=f.style.height=null;var h=a.getElementById("spreadR");h&&h.parentNode.removeChild(h)}}return i.initialize=function(){e=$injector.get("chapters")},i.startTransition=function(t,n){stg.data.settings.navAnim||Vue.set(stg.data.settings,"navAnim","navFlip"),kotobee.dispatchEvent("preTransition",t),a(t),requestAnimationFrame((function(){var i={animID:o=Math.round(1e4*Math.random()),reload:t.reload,pageOb:t.leftOb};r(i,(function(){e.loadChapterByURL(t,(function(){setTimeout((function(){i.animID==o&&a(t,(function(){!function(t){function n(t,n,o){t&&e.getPageOb({page:t.leftOb.index},(function(i){if(i){var r={};r.leftOb=clone(i),r.vIndex=t.leftOb.vIndex,r.vIndex<0&&i.pages&&i.pages.length&&(r.vIndex+=i.pages.length),e.planPageMapping(r,(function(t){s(r.leftOb.url,(function(t){r.styles=t,r.container=document.getElementById(n),r.view=e.getCurrentView(r.leftOb.index,r.leftOb).view,r.source="from preloadchapters",c(r,o)}))}))}}))}e.isFirstChapter((function(o){e.isLastChapter((function(i){if(!i){var r={index:t.leftOb.index,vIndex:t.leftOb.vIndex};skeleton.getNextLinearIndex(t.leftOb,(function(t){e.getSurroundingPages(t?t.leftOb:null,(function(){n(t,"nextPage")}))}))}if(!o){r={index:t.leftOb.index,vIndex:t.leftOb.vIndex};skeleton.getPrevLinearIndex(r,(function(t){e.getSurroundingPages(t?t.leftOb:null,(function(){n(t,"prevPage")}))}))}}))}))}(t),n&&n.resolve()}))}),500)}))}))}))},i.interruptAnimation=function(){a()},i.simulateChapter=function(t,n){s(t.url,(function(o){var i=document.createElement("div"),r={};(r.styles=o,r.styles+="#spreadL{left:0 !important;width:auto !important;height:auto !important;position:static !important;}",r.styles+="#epubContent{width:auto !important;height: auto !important;}",r.container=i,r.leftOb=clone(t),e)&&("double"==e.getCurrentView(r.leftOb.index).view&&(r.rightOb={},r.rightOb.content="<div><sections class='blankForSimulation'></sections></div>",r.rightOb.styles="",r.rightOb.layout="rfl"),r.simulate=!0,c(r,n))}))},i.nextLinearIndex=function(e){for(var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];t&&t.hasAttribute("linear")&&"no"==t.getAttribute("linear");){if(++e>=t.length-1)return e;t=stg.data.epub.spine.getElementsByTagName("itemref")[e]}return e},i.prevLinearIndex=function(e){for(var t=stg.data.epub.spine.getElementsByTagName("itemref")[e];t&&t.hasAttribute("linear")&&"no"==t.getAttribute("linear");){if(--e<0)return 0;t=stg.data.epub.spine.getElementsByTagName("itemref")[e]}return e},i.populateSpreads=function(e,t){t||(t={});var n=0;"rfl"==t.leftOb.layout&&"double"==t.view&&(n=config.spreadSpacing?Number(config.spreadSpacing):0);var o=config.spreadTopMargin?Number(config.spreadTopMargin):0,i=t.leftContent?t.leftContent:t.leftOb.content;if(!t.cached){(d=document.createElement("div")).innerHTML=t.leftContent?t.leftContent:t.leftOb.content;var r=d.children[0],a=r.children[0];copyAttributes(r,a),removeClass(a,"adjustedLineHeight"),a.id="spreadL",a.style.transform=a.style.transformOrigin=a.style.height=null,t.leftOb.viewport?(a.style.left="0px",a.style.paddingTop=o+"px",a.style.width=t.leftOb.viewport.width+"px",a.style.height=t.leftOb.viewport.height+"px",book.isRtl()&&(a.style.left="auto",a.style.right="0px")):(a.style.left=null,a.style.width=null,a.style.height=null),addClass(a,t.leftOb.layout),t.leftOb.bodyClass&&addClass(d.getElementsByTagName("section")[0],t.leftOb.bodyClass),i=d.innerHTML}var s=replaceHTML(e,i);if(t.rightOb){var c;if(s.children[0].children.length>1)for(var l=0;l<s.children[0].children.length;l++)if("spreadR"==s.children[0].children[l].id){c=s.children[0].children[l];break}if(!c){var d;(d=document.createElement("div")).innerHTML=t.rightContent?t.rightContent:t.rightOb.content;var u=d.children[0];copyAttributes(u,c=u.children[0]),removeClass(c,"adjustedLineHeight"),c.id="spreadR",c.style.transform=c.style.transformOrigin=c.style.height=null,s.children[0].appendChild(c)}t.rightOb.viewport&&(t.leftOb.viewport&&(c.style.left=t.leftOb.viewport.width+n+"px",book.isRtl()&&(c.style.right=c.style.left,c.style.left="auto")),c.style.width=t.rightOb.viewport.width+"px",c.style.height=t.rightOb.viewport.height+"px",c.style.paddingTop=o+"px",addClass(c,t.rightOb.layout))}return s},i.test=function(e){},i.setContentSize=function(e,t){t||(t={});var n=t.leftOb,o=t.rightOb;e.style.width=e.style.height=null;var i=0;"rfl"==t.leftOb.layout&&"double"==t.view&&(i=config.spreadSpacing?Number(config.spreadSpacing):0);var r=n.viewport;if(r){if(r.width){var a=r.width;o&&o.viewport&&(a+=o.viewport.width+i),e.style.width=a+0+"px"}if(r.height){var s=r.height;o&&o.viewport&&(s=Math.max(s,o.viewport.height)),e.style.height=s+0+0+"px"}}},i})),createService("crdv",(function(){var e,t={},n=[];function o(){!function(){try{var e=10;window.waitForAndCallHandlerFunction=function(t){"function"==typeof window.handleOpenURL?(cordova.exec(null,null,"LaunchMyApp","clearIntent",[]),window.handleOpenURL(t)):e-- >0&&setTimeout((function(){waitForAndCallHandlerFunction(t)}),500)},window.triggerOpenURL=function(){cordova.exec(waitForAndCallHandlerFunction,null,"LaunchMyApp","checkIntent",[])};var t={getLastIntent:function(e,t){cordova.exec(e,t,"LaunchMyApp","getLastIntent",[])}};window.handleOpenURL=function(e){window.dispatchEvent(new CustomEvent("cordovaHandleOpenUrl",{detail:e}))},window.launchmyapp=t,triggerOpenURL()}catch(e){}}();try{MobileAccessibility.setTextZoom(100,(function(e){}))}catch(e){}try{StatusBar&&(StatusBar.overlaysWebView(!1),ios?StatusBar.styleDefault():StatusBar.styleLightContent())}catch(e){}try{document.addEventListener("deviceready",(function(){}),!1)}catch(e){}try{navigator.splashscreen&&setTimeout((function(){navigator.splashscreen.hide()}),1e3)}catch(e){}try{mobile&&isNative&&"undefined"!=typeof Keyboard&&Keyboard.hideFormAccessoryBar(!1)}catch(e){}}function i(e){stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()}function r(e){if(e||(e={}),!e.canceled)if(kInteractive.frameIsOpen)kInteractive.closeFrame();else if(kInteractive.alertIsOpen)kInteractive.closeAlert();else if(kInteractive.videoIsFullscreen)kInteractive.closeFullscreenVideo();else{if(!modals.shown()){var t=vueApp.$route.name;return"library"==t?compInstances.library.androidBackBtnClicked(e):"reader"==t?compInstances.reader.androidBackBtnClicked(e):"forgotPwd"==t?compInstances.forgotPwd.androidBackBtnClicked(e):"register"==t?compInstances.register.androidBackBtnClicked(e):"audiobook"==t?compInstances.audiobook.androidBackBtnClicked(e):void modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}modals.hide()}}function a(){try{return cordova,!0}catch(e){return!1}}function s(e,n,o,i){try{kStatus.updateProgress(0),e.getEntries((function(r){var a=0;!function s(){if(a>=r.length)e.close((function(){o&&o()}));else{kStatus.updateProgress(a/r.length);var c=r[a];a++,c.getData(new zip.BlobWriter,(function(e){try{if("/"==c.filename.substr(-1))return void s();t.writeFile(e,ph.join(n,c.filename),{relTo:"library"},(function(){s()}))}catch(e){i&&i()}}),(function(e,t){}))}}()}))}catch(e){i&&i()}}function c(e){switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:0;break;case FileError.NOT_FOUND_ERR:0;break;case FileError.SECURITY_ERR:0;break;case FileError.INVALID_MODIFICATION_ERR:0;break;case FileError.INVALID_STATE_ERR:0;break;default:0}}return t.addEventListener=function(e,t){n.push({event:e,func:t})},t.initialize=function(e){a()?(stg.data.cordova=!0,document.addEventListener("deviceready",(function(){o(),$rootScope.$$phase||$rootScope.$apply();stg.copyLocalToNativeStorage(),sleep.initialize(),t.cleanHtml(),t.initAds(),t.initDirectories({},(function(){khttp.get("permit.json").success((function(n){function o(){var e={error:"errorAndCallback",msg:"noAppPermit",cb:t.exit};kError.update(e),$rootScope.$$phase||$rootScope.$apply()}("udid"==n.type?window.plugins.uniqueDeviceID.get:"mac"==n.type?window.MacAddress.getMacAddress:window.plugins.imeiplugin.getImei)((function(t){t||o();try{for(var i,r=n.list.split("\n"),a=0;a<r.length;a++){var s=r[a].trim().split(" ")[0].trim(),c=r[a].trim().split("/")[0].trim();if(s==t||c==t){i=!0;break}}}catch(e){return void o()}i?e():o()}),o)})).error((function(){e()}))})),document.addEventListener("menubutton",i,!1),document.addEventListener("backbutton",r,!1),$rootScope.$$phase||$rootScope.$apply();t.ready=!0,function(e,t){for(var o=0;o<n.length;o++)n[o].event==e&&n[o].func(t)}("ready")}),!1)):e()},t.cleanHtml=function(){for(var e=document.getElementsByTagName("link"),t=e.length;t--;)"shortcut icon"==e[t].getAttribute("rel")&&e[t].parentNode.removeChild(e[t])},t.initDirectories=function(e,n){function o(e){if(t.initError=1,t.docDirectory.nativeURL!=cordova.file.dataDirectory)return t.initError=2,window.resolveLocalFileSystemURL(cordova.file.dataDirectory,(function(e){t.initError=3,t.initDirectories({useDir:e},n)}));t.initError=4}e||(e={}),window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(LocalFileSystem.TEMPORARY,10485760,(function(i){t.cacheDirectory=i.root,window.requestFileSystem(LocalFileSystem.PERSISTENT,0,(function(i){t.docDirectory=i.root,e.useDir&&(t.docDirectory=e.useDir);var r="kotobeeReader";isReaderApp?r="kotobeeReaderApp":config.kotobee.cloudid&&(r+=config.kotobee.cloudid),t.docDirectory.getDirectory(r,{create:!0},(function(e){t.appDirectory=e,t.appDirectory.getDirectory("library",{create:!0},(function(e){t.libEbooksDirectory=e,t.appDirectory.getDirectory("temp",{create:!0},(function(e){t.tempDirectory=e,t.appDirectory.getDirectory("local",{create:!0},(function(e){t.localDirectory=e,t.localDirectory.getDirectory("books",{create:!0},(function(e){t.localBooksDirectory=e,t.localDirectory.getDirectory("thumbs",{create:!0},(function(e){t.localThumbsDirectory=e,t.libEbooksDirectory.getFile(".nomedia",{create:!0},(function(){t.localDirectory.getFile(".nomedia",{create:!0},(function(){n()}),o)}),o)}),o)}),o)}),o)}),o)}),o)}),o)}),o)}),o)},t.resolvePath=function(e,n,o){window.resolveLocalFileSystemURL(e,(function(e){o(e,n)}),(function(i){n=ph.basename(e)+"/"+n,e=ph.removeBase(e),t.resolvePath(e,n,o)}))},t.backBtnPressed=r,t.showKeyboard=function(){try{if(!a())return;Keyboard.show()}catch(e){}},t.hideKeyboard=function(){try{Keyboard.hide()}catch(e){}},t.tts=function(e,n){var o={text:e,rate:(config.ttsRate?config.ttsRate:100)/100};config.defaultTtsLanguage&&(o.locale=config.defaultTtsLanguage);try{"iOS"==window.device.platform&&(o.rate+=.5)}catch(e){}TTS.speak(o,(function(){n(!0)}),(function(e){t.toast(translit.get("ttsUnavailableMsg")),n(!1)}))},t.toast=function(n,o){if(a()){o||(o={});var i=2e3;o.long&&(i=4e3),o.duration&&(i=o.duration);var r=document.getElementById("kReaderToast");r||((r=document.createElement("div")).id="kReaderToast",document.body.appendChild(r),setTimeout((function(){r.className="fadeIn"}),30)),removeClass(r,"fadeOut"),r.innerHTML=n,e&&clearTimeout(e),e=setTimeout(t.hideToast,i)}},t.hideToast=function(){if(a()){var e=document.getElementById("kReaderToast");e&&(hasClass(e,"fadeOut")||(addClass(e,"fadeOut"),e.addEventListener("transitionend",(function(){hasClass(e,"fadeOut")&&e.parentNode&&e.parentNode.removeChild(e)}))))}},t.copyToClipboard=function(e){if(a())try{cordova.plugins.clipboard?cordova.plugins.clipboard.copy(e):window.plugins.clipboard.copy(e),t.toast(translit.get("copiedToClipboard"))}catch(e){}},t.share=function(e){if(a())try{window.plugins.socialsharing.share(e)}catch(e){}},t.fileExists=function(e,t){window.resolveLocalFileSystemURL(e,(function(){t&&t(!0)}),(function(){t&&t(!1)}))},t.removeFile=function(e,n){t.resolvePath(ph.removeFilename(e),ph.basename(e),(function(e,t){e.getFile(t,{},(function(e){e.remove((function(e){n&&n()}))}))}))},t.removeDirectory=function(e,t){window.resolveLocalFileSystemURL(e,(function(e){e.removeRecursively((function(){t&&t()}))}))},t.createPDF=function(e,t,n){try{if(document.body.querySelector('script[src*="pdf/pdf"]'))r();else{var o=document.createElement("script");o.src=rootDir+"lib/pdf/pdf.js",o.addEventListener("load",r),document.body.appendChild(o)}}catch(e){}function i(){return document.body.dir&&"rtl"===document.body.dir}function r(){var o=new jspdf.jsPDF("p","pt","a4"),r=isArabic(e);r&&(e=(e=e.replace("<html>",'<html lang="ar">')).replace("<body",'<body dir="rtl" style="direction:rtl"'));var s=parser.parseFromString(e,"text/html");r&&s.querySelectorAll("*").forEach((function(e){-1===["BR","HR"].indexOf(e.nodeName)&&(!function(e){e&&[].slice.call(e.children).forEach((function(e){[].slice.call(e.childNodes).forEach((function(e){if(3===e.nodeType&&isArabic(e.textContent)&&""!==e.textContent.trim()){e.textContent=normalize(e.textContent);var t=/[\u0600-\u06FF\u0750-\u077F]+/g,n=e.textContent.match(t);if(Array.isArray(n)&&n.length){var o=n.map((function(e){return"<span style=\"font-family: 'Amiri-Regular'; xfloat: right; text-align: right;\">"+e.trim()+"&nbsp;&nbsp;</span>"})).join("");e.textContent=e.textContent.replace(t,"").replace(/'|"|:/g,""),e.parentNode.insertAdjacentHTML("beforeend","<span dir='rtl'>"+o+"</span>")}}}))}))}(e),e.style.wordWrap="initial",e.style.direction="rtl")}));var c,l,d=!0,u=0,p=0,f=s.querySelector("h1");(c=document.createElement("h1")).innerHTML=f.innerHTML,document.body.appendChild(c),u+=c.offsetHeight,document.body.removeChild(c),s.querySelectorAll("h2,p,div").forEach((function(e){(c=document.createElement(e.nodeName.toLowerCase())).innerHTML=e.innerHTML,document.body.appendChild(c),e.textContent.match(/[а-яА-ЯЁё]+/g)&&(e.style.fontFamily="NotoSansCJKjp-Regular");var t=c.offsetHeight;document.body.removeChild(c),l=p*t,(d&&u+l>=842||!d&&l>=842)&&(d=!1,p=0,e.style.pageBreakAfter="always"),p++}));var h=s.getElementById("container");h.style.width="550px",s.querySelector("body").style.width="550px";var g=i();g&&(document.body.dir="ltr"),o.html(h,{x:20,y:20,margin:[0,0,0,0],callback:function(e){if(a())!function(e,t,n){var o=e.output("blob");(i=o,new Promise((function(e,t){var n=new FileReader;n.readAsDataURL(i),n.onload=function(){e(n.result)},n.onerror=function(e){t(e)}}))).then((function(e){window.plugins.socialsharing.shareWithOptions({files:["df:"+t+";"+e]},o,i);var o=function(e){n&&n()},i=function(e){n&&n()}})).catch((function(e){n&&n()}));var i}(e,t,(function(){g&&!i()&&(document.body.dir="rtl")}));else try{setTimeout((function(){e.save(t),g&&!i()&&(document.body.dir="rtl"),n&&n({success:!0})}),1e3)}catch(e){n&&n({error:!0,data:e})}}}).catch((function(e){n&&n({error:!0,data:e})}))}},t.exit=function(){a()&&(navigator.app?navigator.app.exitApp():navigator.device&&navigator.device.exitApp())},t.vibrate=function(e){a()&&(config.noVibration||(e||(e=28),ios||(ios&&(e/=4),"high"==config.vibrationIntensity?e=40:"medium"==config.vibrationIntensity?e=28:"low"==config.vibrationIntensity&&(e=15),navigator&&navigator.vibrate?navigator.vibrate(e):navigator&&navigator.notification&&navigator.notification.vibrate&&navigator.notification.vibrate(e))))},t.deleteEbook=function(e,n){t.libEbooksDirectory.getDirectory(e.path,{},(function(t){t.removeRecursively((function(){for(var t=0;t<stg.data.downloaded.length;t++)stg.data.downloaded[t].path==e.path&&(e.downloaded=!1,stg.data.downloaded.splice(t,1),t--);stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,(function(){n()}))}),(function(e){}))}),c)},t.writeEbook=function(e,n,o,i){var r=o;o=null,t.libEbooksDirectory.getDirectory(n.path,{create:!0},(function(o){var a=ph.join(n.path,e);t.writeFile(r,a,{relTo:"library"},(function(){t.unzipViaPlugin(ph.join(t.libEbooksDirectory.nativeURL,a),ph.join(t.libEbooksDirectory.nativeURL,n.path,"EPUB"),(function(e){Vue.set(n,"downloaded",!0);var o=Object.assign({},n,{searchresults:null});stg.data.downloaded.push(o),stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,(function(){r=null,n.access&&t.writeFile(new Blob([JSON.stringify(n.access)],{type:"text/plain"}),n.path+"/EPUB/access.json",{relTo:"library"}),i()}))}),(function(e){}))}))}))},t.unzip=function(e,n,o,i){t.unzipViaPlugin(url,n,o,i)},t.unzipBlob=function(e,t,n,o){zip.workerScriptsPath="lib/zip/",zip.createReader(new zip.BlobReader(e),(function(e){s(e,t,n,o)}))},t.unzipViaPlugin=function(e,t,n,o){zip.unzip(e,t,n,o)},t.unzipData64=function(e,t,n,o){zip.workerScriptsPath="lib/zip/",setTimeout((function(){zip.createReader(new zip.Data64URIReader(e),(function(e){setTimeout((function(){s(e,t,n,o)}),100)}))}),100)},t.writeFile=function(e,n,o,i){o||(o={});var r=t.appDirectory;"library"==o.relTo&&(r=t.libEbooksDirectory),o.parentDir&&(r=o.parentDir),"number"==typeof e&&(e+="");var a=ph.basename(n);try{t.getDirEntryRecursively(ph.normalize(n),r,(function(t){try{t.getFile(a,{create:!0,exclusive:!1},(function(t){t.createWriter((function(t){var n=e.byteLength?e.byteLength:e.size,o=0;function r(){var i=Math.min(4194304,n-o);try{var r=e.slice(o,o+i)}catch(e){}t.write(r),o+=i}t.onwrite=function(t){o<n?r():(e=null,i&&i(!0))},t.onerror=function(t){e=null,i&&i(!1)},r()}),c)}),(function(e,t){}))}catch(e){}}))}catch(e){}},t.getDirEntryRecursively=function(e,n,o){n||(n=t.appDirectory);var i=e.split("/");if(1!=i.length){var r=i[0];n.getDirectory(r,{create:!0},(function(e){i.shift();var n=i.join("/");t.getDirEntryRecursively(n,e,o)}),(function(e){}))}else o(n)},t.openInNativeBrowser=function(e,n){e=e.toString();try{for(var o=e.replace(/\?.*/gi,""),i=["pdf","doc","docx","epub","odt","xls","ppt","pptx","mp3","mp4","exe","pkg"],r=0;r<i.length;r++)if(new RegExp(".*."+i[r]+"$","i").test(o)){n=!0;break}try{if(cordova.InAppBrowser){if(n)return window.cordova.InAppBrowser.open(e,"_system","location=no");t.toast("  "+translit.get("loadingExternalPage")+"  ",{duration:4e3});var a=ios?"yes":"no",s=cordova.InAppBrowser.open(e,"_blank","location=no,hidden=no,clearcache=yes,closebuttoncaption=Go back to App,toolbar="+a+",presentationstyle=formsheet");return s.addEventListener("loadstart",(function(){})),s.addEventListener("loadstop",(function(){ios||t.hideToast()})),void s.addEventListener("loaderror",(function(){if(!ios){try{s&&s.close()}catch(e){}t.hideToast(),t.toast("  "+translit.get("errorLoadingPage")+"  ",{long:!0})}}))}}catch(e){}try{if(window.inAppBrowserXwalk){return void window.inAppBrowserXwalk.open(e,{toolbarColor:"#FFFFFF",toolbarHeight:"40",closeButtonText:"< Close",closeButtonSize:"25",closeButtonColor:"#000000",openHidden:!1})}}catch(e){}return void window.open(e,"_system")}catch(e){}},t.initAds=function(){try{if("undefined"==typeof adMob)return;if(!adMob)return}catch(e){return}try{config.kotobee.admobBannerId&&adMob.banner(config.kotobee.admobBannerId,adMob.ad_sizes.RESIZE,adMob.ad_positions.TOP).then((function(){})).catch((function(e){}))}catch(e){return}try{config.kotobee.admobInterstitialId&&adMob.interstitial(config.kotobee.admobInterstitialId).then((function(){config.kotobee.admobInterstitialDelay||(config.kotobee.admobInterstitialDelay=60),config.kotobee.admobInterstitialRepeat||(config.kotobee.admobInterstitialRepeat=1);var e=setInterval((function(){if(adMob.showInterstitial(),config.kotobee.admobInterstitialRepeat<=1)return clearInterval(e);--config.kotobee.admobInterstitialRepeat}),1e3*config.kotobee.admobInterstitialDelay)})).catch((function(e){}))}catch(e){return}},t.mobileDownload=function(e){if(a()&&cordova.plugins.fileOpener2){var t=new XMLHttpRequest;t.open("GET",cleanURL(e.replace("../../","epub/EPUB/"))),t.responseType="arraybuffer",t.addEventListener("error",(function(e){})),t.addEventListener("load",(function(){var n=t.response,o="";switch(device.platform.toLowerCase()){case"android":o=cordova.file.externalRootDirectory;break;case"ios":o=cordova.file.documentsDirectory}var i=o;window.resolveLocalFileSystemURL(i,(function(t){t.getFile(ph.basename(e),{create:!0,exclusive:!1},(function(e){e.createWriter((function(t){t.write(n),t.onwriteend=function(){var t=e.toURL();cordova.plugins.fileOpener2.open(t,n.type,{error:function(e){},success:function(){}})},t.onerror=function(e){}}),(function(e){}))}),(function(e){}))}),(function(e){}))})),t.send()}},t.bookDownloaded=function(e,n){t.fileExists(t.libEbooksDirectory.nativeURL+"/"+e.path,n)},t.readFile=function(e,t,n){t||(t={});var o=new FileReader;return"data"==t.type?o.readAsDataURL(e):o.readAsText(e),o.onloadend=function(){n&&n()},o.onerror=function(e){},o},t.getBlobJs=function(e,t,n){if(a()){var o=cordova.file.applicationDirectory+"www/"+e;n||(n=function(e){}),window.resolveLocalFileSystemURL(o,(function(e){e.file((function(e){var o=new FileReader;o.onload=function(e){var n=e.target.result,o=window.URL.createObjectURL(new Blob([n],{type:"text/javascript"}));t(o)},o.onerror=n,o.readAsText(e)}),n)}),n)}},t.readList=function(e,t){e.createReader().readEntries(t)},t.write=function(e,t,n){e.create(t,{create:!0},(function(e){e.getFile((function(e){e.createWriter((function(e){e.onwriteend=function(){n&&n()},e.onerror=function(e){},fwriterile.write(content)}))}))}))},t.testInit=function(){t.resolvePath(qfOb.assetsPath,"",(function(e){D=e})),D.createReader().readEntries((function(e){D1=e})),D1[0].createReader().readEntries((function(e){D2=e})),D2[0].createReader().readEntries((function(e){D3=e})),D3[0].createReader().readEntries((function(e){D4=e}))},t.test1=function(e){e||(e="https://www.quranflash.com/v3/assets/audio/verses/Hudhaify/002001.mp3");var t=qfOb.assetsPath+"Audio/test1.mp3";backend.downloadBinaryFile(e,t,{},(function(){}))},t.test2=function(e){e||(e="https://filesamples.com/samples/audio/mp3/sample3.mp3");var t=qfOb.assetsPath+"Audio/test2.mp3";backend.downloadBinaryFile(e,t,{},(function(){}))},t.test3=function(e){e||(e="https://enterprise.quranflash.com/file.zip");var t=qfOb.assetsPath+"Audio/test3.zip";backend.downloadBinaryFile(e,t,{},(function(){crdv.unzipViaPlugin(t,qfOb.assetsPath+"Audio",(function(e){}))}))},t.test4=function(e){e||(e="https://quranflash.fra1.digitaloceanspaces.com/assets/audio/verses/Qasim/001.zip?X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=OTZAZEJRFKMUSBV6W655%2F20220328%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20220328T140417Z&X-Amz-SignedHeaders=host&X-Amz-Expires=86400&X-Amz-Signature=faea875da8af567f8e3cefb57bb958d3b5c93431df922a9fe3dce9a36afdea71");var t=qfOb.assetsPath+"Audio/test4.zip";backend.downloadBinaryFile(e,t,{},(function(){crdv.unzipViaPlugin(t,qfOb.assetsPath+"Audio",(function(e){}))}))},t.test5=function(e,t){e||(e="https://enterprise.quranflash.com/asset/audio/Akhdar/1"),fileEntry,t||(t=qfOb.assetsPath+"Audio/test5.zip"),(new FileTransfer).download(e,t,(function(e){crdv.unzipViaPlugin(t,qfOb.assetsPath+"Audio",(function(e){}))}),(function(e){}))},t})),createService("cssParser",(function(){var e,t={},n=[];return t.clearCache=function(){n=[]},t.inject=function(e,o,i){o||(o={});var r="",a=0;function s(e){n.length>7&&n.shift(),n.push(e)}!function i(c,l){if(!c)return c={},void f();if("path"==c.type){var d=c.val;if(!d||d.indexOf("EPUB/css/kotobeeInteractive.css")>=0)return void f();var u=function(e,t){for(var o=0;o<n.length;o++)if(n[o].url==e&&n[o].id==t)return n.push(n[o]),n[o]}(d,o.id);u?f(u.val):khttp.get(c.dontCache?d:cacheBust(d)).success((function(e){p(e,d,"url")})).error((function(){f()}))}else p(c.val,c.root);function p(e,n,i){if(!e)return f();if(config.dontParseCss)return"url"==i&&s({url:d,val:e,id:o.id}),void f(e);if(workers.supported()){var r={};return r.data=e,r.rootPath=n,r.cssOb=c,r.desktop=desktop,r.native=isNative,r.mobile=mobile,void workers.call("cssParser","parse",[r],(function(e){"url"==i&&s({url:d,val:e,id:o.id}),f(e)}))}e=(e=(e=(e=(e=(e=(e=t.applyRoot(n,e)).replace(/\/\*[\s\S]*?\*\//g,"")).replace(/<!--/g,"")).replace(/-->/g,"")).replace(/@charset.*?;/g,"")).replace(/@namespace.*?;/g,"")).replace(/:root{/g,"html{");var a="spreadL";o.id&&(a=o.id);var l=(c.parentClass?c.parentClass:"#epubContainer.stylesEnabled")+" #"+a,u=function(e){e=e.replace(/\r?\n|\r/g," ");var t,n=[],o="key",i=[0],r=n,a=[r];function s(e){return e||(e=1),i[i.length-e]}for(var c=0;c<e.length;c++)t||(t={}),"}"==e[c]?("properties"==o&&(t.properties=e.substring(s(),c).trim(),t.keys&&t.keys.length&&(t.keys[t.keys.length-1]=t.keys[t.keys.length-1].trim()),r.push(t)),"key"==o&&a.length>1&&(a.pop(),r=a[a.length-1]),t=null,o="key",i.push(c+1)):"{"==e[c]?("properties"==o&&(t.children||(t.children=[]),t.keys&&t.keys.length&&(t.keys[t.keys.length-1]=t.keys[t.keys.length-1].trim()),n.push(t),r=t.children,a.push(r),(t={keys:[]}).keys.push(e.substring(s(),c).trim())),i.push(c+1),o="properties"):"key"==o&&(t.keys||(t.keys=[""]),","==e[c]?t.keys.push(""):t.keys[t.keys.length-1]+=e[c]);return n}(e),p="";try{for(var h=0;h<u.length;h++){var g=y(u[h].keys);if(p+=g.joined,p+="{",u[h].children&&u[h].children.length)for(var m=0;m<u[h].children.length;m++){var v,b=y(u[h].children[m].keys);if(p+=b.joined,p+="{"+u[h].children[m].properties+"}",b.hasBody)(v=k(u[h].properties))&&(p+="#epubContainer{"+v+"}")}if(u[h].properties&&(p+=u[h].properties),p+="}",g.hasBody)(v=k(u[h].properties))&&(p+="#epubContainer{"+v+"}")}}catch(e){}function k(e){if(e){for(var t=e.split(";"),n="",o=0;o<t.length;o++)t[o]&&-1!=t[o].trim().indexOf("background")&&(n=t[o].trim().replace(/url\(.*?\)/g,"")+";");return n}}function y(e){for(var t={},n=0;n<e.length;n++)if(e[n]){var o=e[n].trim();0!=o.indexOf("body")?0!=o.indexOf("html")?0!=o.indexOf("@media")&&0!=o.indexOf("@")&&isNaN(o[0])&&"from"!=o&&"to"!=o&&(e[n]=l+" "+o):e[n]=o.replace("html",l):(e[n]=o.replace("body",l),0==e[n].indexOf("html")&&(e[n]=e[n].replace("html",l)),t.hasBody=!0)}return t.joined=e.join(","),t}e=function(e){var t=e;return t=(t=(t=(t=(t=t.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"")).replace(/ {2,}/g," ")).replace(/ ([{:}]) /g,"$1")).replace(/([;,]) /g,"$1")).replace(/ !/g,"!")}(e=p),"url"==i&&s({url:d,val:e,id:o.id}),f(e)}function f(t){t&&(r+=t),++a<e.length?i(e[a],l):l&&l(r)}}(e[a],i)},t.applyRoot=function(e,t){if(t){var n=t.replace(/url\((.*?)\)/g,(function(t,n){if(!n||!n.trim())return arguments[0];var o="";if(0==n.indexOf('"')?(n=n.substr(1,n.length-2),o='"'):0==n.indexOf("'")&&(n=n.substr(1,n.length-2),o="'"),-1!=n.indexOf("http://"))return arguments[0];if(-1!=n.indexOf("https://"))return arguments[0];if(0==n.indexOf("data:"))return arguments[0];if(0==n.indexOf("kotobee:"))return arguments[0];var i=n.split(" ").length>1,r=(n=ph.join(e,n)).split(" ").length>1;return!i&&r&&(o='"'),"url("+o+cleanURL(n)+o+")"}));return n}},t.getStyles=function(){return e},t.replaceStyles=function(t,n){var o;n||(n={});for(var i=document.getElementsByTagName("style"),r=0;r<i.length;r++)if(null!=i[r].getAttribute("kotobee")){o=i[r];break}e=t,n.append&&(e=o.innerHTML+" "+t),o=replaceHTML(o,e)},t.hideStyles=function(){removeClass(cache.getOb("epubContainer"),"stylesEnabled")},t.showStyles=function(){addClass(cache.getOb("epubContainer"),"stylesEnabled")},t.stylize=function(e,t){var n=document.getElementById(e);if(n){for(var o=n.getAttribute("style"),i=Object.keys(t),r=o?o+";":"",a=0;a<i.length;a++)r+=i[a]+":"+t[i[a]]+";";n.setAttribute("style",r)}},t})),createService("design",(function(){var e,t,n={};return n.getBgStyle=function(){if(!e){var t="";isKotobeeHosted()&&(t=publicRoot),"stretch"==(e={"background-image":'url("'+(config.splashBg?t+"imgUser/"+config.splashBg:"none")+'")',"background-color":config.splashBgColor?config.splashBgColor:"#3f3248",color:(config.splashColor?config.splashColor:"#fff")+" !important","background-size":config.splashBgSize?config.splashBgSize:"cover"})["background-size"]&&(e["background-size"]="100% 100%")}return e},n.convertTabs=function(){if(config.tabs){config.customTabs=[];for(var e=0;e<config.tabs.length;e++){var t=document.createElement("div");if(t.setAttribute("data-kotobee",config.tabs[e]),config.customTabs[e]=kInteractive.readData(t),config.customTabs[e]&&config.customTabs[e].icon){var n="";isKotobeeHosted()&&(n=publicRoot),isReaderApp&&(n=ph.join(bookPath,"_kmeta")+"/");var o=cleanURL(n+"imgUser/"+config.customTabs[e].icon);if("library"==config.kotobee.mode&&"book"==config.src)if(isNative||desktop)o=cleanURL(bookPath+"_kmeta/imgUser/"+config.customTabs[e].icon);else{var i=bookPath.split("/books/")[1].split("/")[0];o=config.kotobee.public?cleanURL(stg.data.paths.private+"books/"+i+"/EPUB/_kmeta/imgUser/"+config.customTabs[e].icon):cleanURL(config.kotobee.liburl+"books/"+i+"/EPUB/_kmeta/imgUser/"+config.customTabs[e].icon)}config.customTabs[e].iconStyle={"background-image":'url("'+o+'")'}}}}},n.injectUserCSS=function(e){function n(){for(var n=document.getElementsByTagName("style"),o=0;o<n.length;o++)if(n[o].hasAttribute("user")){n[o].innerHTML=$interpolate(t)(e);break}}t?n():khttp.get(cacheBust(rootDir+"css/user.css")).success((function(e){t=e,n()}))},n.applyRichTextLibrary=function(){for(var e,t,n=document.getElementsByTagName("script"),o=0;o<n.length;o++)if(n[o].getAttribute("src")&&n[o].getAttribute("src").indexOf("quill/quill.min.js")>=0){e=n[o];break}var i=document.getElementsByTagName("link");for(o=0;o<i.length;o++)if(i[o].getAttribute("href")&&i[o].getAttribute("href").indexOf("quill/quill.snow.css")>=0){t=i[o];break}if(config.htmlInNotes){var r=document.getElementsByTagName("head")[0];if(!e){var a=document.createElement("script");a.src=rootDir+"lib/quill/quill.min.js",r.appendChild(a)}if(!t){var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href",rootDir+"lib/quill/quill.snow.css"),r.appendChild(s)}}else e&&e.parentNode.removeChild(e),t&&t.parentNode.removeChild(t)},n.stylize=function(e,t){cssParser.stylize(e,t)},n})),createService("events",(function(){var e={};return e.initialize=function(){},e.add=function(e,t){readerV<1.5||(e.target=e.currentTarget=e.elem,kotobee.dispatchEvent(e.action,e),e.disableRemote||backend.addEvent(e,t))},e})),createService("htmlParser",(function(){var e={wrapOrphans:function(e){var t=[],n=e.getElementsByTagName("body")[0];if(n){for(var o=0;o<n.childNodes.length;o++)3==n.childNodes[o].nodeType&&t.push(n.childNodes[o]);for(o=0;o<t.length;o++){var i=t[o],r=document.createElement("span");r.textContent=i.textContent,i.nextSibling?n.insertBefore(r,i.nextSibling):n.appendChild(r),n.removeChild(i)}}},parse:function(e){var t=[],n=[];t.push(/([< \/][^>]*?>)((\s*[^<\s]+\s+?)+)([^<\s]+\s*)(<)/g),n.push(/(>)([^<\n]*?[^<]+?)(<[^\/])/g),n.push(/(<\/[^>]*?>)([^<]*?)(<\/)/g);for(var o=0;o<t.length;o++){var i=t[o];e=e.replace(i,(function(e,t){if(arguments[1].match(/<[^>]*?class="[^"]*?parsed.*?>/g))return e;if(0==arguments[1].indexOf("<pre"))return e;if(0==arguments[1].indexOf("<code"))return e;if(0==arguments[1].indexOf("<script"))return e;var n="",o=arguments[2].split(" ");""==o[o.length-1]&&o.splice(-1,1),o.push(arguments[4]);for(var i=0;i<o.length;i++){var r=i==o.length-1?"":" ";n+="<span>"+o[i]+r+"</span>"}return arguments[1]+n+"<"}))}for(o=0;o<n.length;o++)e=e.replace(n[o],(function(e,t){return arguments[2].trim()?arguments[1]+("<span>"+arguments[2]+"</span>")+arguments[3]:e}));return e=e.replace(/(<a [\s\S]*?)(>)/g,'$1 onclick="return false;" $2'),isNative&&mobile&&(e=e.replace(/(<img[^>]*src=)"(.*?)"/g,(function(e,t){return arguments[1]+'"'+cleanURL(arguments[2])+'"'}))),e}};return e})),createService("initializer",(function(){var e,t,n={},o=[];function i(e){if(!(preview&&-1!=window.location.href.indexOf("&screenshot")&&window.location.href.indexOf("&startup")>=0))return e()}function r(){var t=require("nw.gui");e||(e=new t.Menu({type:"menubar"}));var n=new t.Menu;n.append(l({label:translit.get("exit")},s)),e.append(l({label:translit.get("file")},s,n));for(var o=new t.Menu,i=new t.Menu,r=stg.data.languages,a=0;a<r.length;a++)i.append(l({label:r[a].label},c));function s(e){this.label.toLowerCase()==translit.get("exit").toLowerCase()&&t.App.quit()}function c(e){var t=this.label;setTimeout((function(){for(var e=0;e<stg.data.languages.length;e++)if(stg.data.languages[e].label==t)return stg.data.settings.language=stg.data.languages[e].val,settings.langChanged(),void($rootScope.$$phase||$rootScope.$apply())}),300)}function l(e,n,o){return n&&(e.click=n),o&&(e.submenu=o),new t.MenuItem(e)}o.append(l({label:translit.get("language")},s,i)),e.append(l({label:translit.get("settings")},s,o)),t.Window.get().menu=e}function a(e,t){return function(e){var t=new URLSearchParams("?"+e.slice(1)).get("id_token")||null;if(t&&sso&&sso.parseJWT){var n=sso.parseJWT(t);if(n&&n.iss)return-1!==n.iss.indexOf("microsoft")}return!1}(e)?"microsoft":t.get("provider")||""}return n.initialize=function(){var a;n.initialized||n.initializing||($location.path("/"),a=function(){$ionicPlatform.ready((function(){var e=null==config.startupScreenDelay?700:1e3*config.startupScreenDelay;config.noLoadingScreen&&(e=0),setTimeout((function(){var e;e=function(){removeClass(document.body,"loading")},i((function(){backend.initialize().then((function(){!function(e){var t;config.kotobee.cloudid&&(t=!0),isKotobeeHosted()&&(t=!0),"kotobee"==config.kotobee.hostType&&(t=!0),config.kotobee.offline&&(t=!1),isReaderApp&&(t=!1),t?backend.getS3Paths(e):e()}((function(){"library"==config.kotobee.mode||isReaderApp||("book"==config.kotobee.mode?(bookPath="epub/","audiobook"==config.kotobee.type&&(bookPath="audiobook/"),preview&&(bookPath=config.kotobee.bookPath),bookPath||(bookPath="epub/")):(kStatus.update(),kError.update({error:"errorAndCallback",msg:"cantReadConfigFile",cb:crdv.exit}))),auth.authenticate(),e&&e()}))})),$timeout((function(){$ionicPlatform.registerBackButtonAction((function(e){var t=$ionicHistory.currentView();kInteractive.frameIsOpen?kInteractive.closeFrame():kInteractive.alertIsOpen?kInteractive.closeAlert():kInteractive.videoIsFullscreen?kInteractive.closeFullscreenVideo():"forgotPwd"==t.stateId||"register"==t.stateId?$ionicHistory.goBack():"library"==t.stateId&&isReaderApp?$location.path("/app"):modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}}),$rootScope.$apply()}),101)}),500),$rootScope.$apply(),n.initialized=!0,n.initializing=!0,kotobee.dispatchEvent("initialized"),function(){for(var e=0;e<o.length;e++)o[e].apply(this,arguments)}()}))}),e)}))},n.initializing=!0,stg.initialize(),np.initialize(),chapterAPI.initialize(),crdv.initialize((function(){workers.initialize(),design.injectUserCSS(config);var o=n.getLogo();n.playAudio(),n.displayBg(),backend.addListener("pathsChanged",n.playAudio),backend.addListener("pathsChanged",n.displayBg);for(var i=document.getElementsByTagName("link"),s=0;s<i.length;s++)if("shortcut icon"==i[s].getAttribute("rel")){if(!i[s].getAttribute("href")){var c=config.icon?config.icon:o.logo;try{desktop&&np.require("nw.gui").App.manifest.window.icon&&(c=np.require("nw.gui").App.manifest.window.icon)}catch(e){}i[s].setAttribute("href",c)}break}cache.initialize(),tinCan.initialize(),scorm.initialize(),events.initialize(),autohide.initialize(),freehand.initialize(),annotations.initialize(),login.initialize(),nav.initialize(),cart.initialize(),tts.initialize(),stg.initializeSettings((function(){settings.langChanged(),function(){function e(e){var t=e.data&&"string"==typeof e.data?e.data.split(":"):[""];if("object"===_typeof(e.data)&&(t[0]=e.data.action,t[1]=e.data.params),"next"==t[0])chapters.nextChapter();else if("prev"==t[0])chapters.prevChapter();else if("notebook"==t[0])angular.element(document.getElementById("tabMenu")).scope().notebookClicked();else if("addtonotebook"==t[0]){var n=JSON.parse(decodeURIComponent(t[1])).nOb,o=document.createElement("div");o.innerHTML=n.elem,n.elem=o.children[0],n.noSuccessMsg=!0,compInstances.global.questionsAddToNotebookShortcut(n)}else if("goto"==t[0])$location.path($injector.get("library").root+"/reader/chapter/"+Number(t[1]));else if("zoom"==t[0])for(var i=document.getElementsByTagName("meta"),r=0;r<i.length;r++)"viewport"==i[r].getAttribute("name")&&i[r].setAttribute("content","initial-scale="+t[1])}window.addEventListener("message",e,!1),window.kbOpenChapterURL=function(e){e&&(isAbsoluteURLPath(e)?window.location.href=e:(e=ph.join(stg.data.book.chapter.url,e),chapters.applyChapterStateFromURL(e)))}}(),window.addEventListener("keydown",(function(e){if("a"==e.key&&(e.ctrlKey||e.metaKey)){var t=e.target;if(!t||!t.nodeName)return;"input"!=t.nodeName.toLowerCase()&&"textarea"!=t.nodeName.toLowerCase()||t.select()}})),desktop&&r(),isNative||(document.onkeydown=function(e){document.activeElement&&"epubContainer"==document.activeElement.id&&(modals.shown()||kotobee.disableKeyboardInteraction||(e=e||window.event).shiftKey||("37"==e.keyCode?(stg.data.settings.rtl?chapters.nextChapter():chapters.prevChapter(),$rootScope.$$phase||$rootScope.$apply()):"39"==e.keyCode&&(stg.data.settings.rtl?chapters.prevChapter():chapters.nextChapter(),$rootScope.$$phase||$rootScope.$apply())))}),vueExclude&&cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("loading")+"..")),translit.addListener((function(){desktop&&function(){if(e)for(;e.items.length;)e.removeAt(0);r()}(),t||vueExclude&&(stg.data.book||stg.data.book.meta||cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("loading")+"..")))})),t=!0,a&&a()}))})))},n.displayBg=function(){design.stylize("home",design.getBgStyle())},n.playAudio=function(){if(config.audio&&!document.bgAudio){var e="";isKotobeeHosted()&&(e=publicRoot);var t=e+"imgUser/"+config.audio,n=document.createElement("audio");n.setAttribute("data-dontclose",!0),n.setAttribute("controls","true"),n.setAttribute("autoplay","true"),n.setAttribute("src",t),config.audioLoop&&n.setAttribute("loop","true"),n.setAttribute("data-tap-disabled","false");var o=document.createElement("source");o.src=t,n.appendChild(o),n.appendChild(document.createTextNode("Your browser does not support the audio element")),n.oncanplay=function(){kInteractive.tinCan({verb:"played",activity:"Audio: "+t})},n.play(),document.bgAudio=n}},n.getLogo=function(){var e="";return isKotobeeHosted()&&(e=publicRoot),{logo:config.logo?e+"imgUser/"+config.logo:rootDir+"img/ui/defaultWelcomeLogoNew.png",slogan:config.slogan?config.slogan:""}},n.addListener=function(e){o.push(e)},n.handleRedirect=function(e){var t=!1,n=new URLSearchParams(window.location.search),o=a(e,n),i=n.get("state")||"",r=n.get("payment")||"",s=n.get("success")||"",c=n.get("book_id")||"",l=n.get("user_id")||"";if(o){var d=new URLSearchParams("?"+e.slice(1)),u=d.get("id_token"),p=d.get("access_token");(u||p)&&(u||(u="-"),p||(p="-"),t=!0,$location.path("/authredirect/"+o+"/"+encodeURIComponent(u)+"/"+encodeURIComponent(p)))}else if(i)t=!0,window.location.replace(getBaseSuffix());else if(r&&s&&l){t=!0;var f="/payment/"+r+"/"+("true"==s?"success":"cancel");c&&(f+="/"+c),f+="/"+l,$location.path(f)}return t},n})),createService("jsParser",(function(){var e,t,n,o={},i=[];return o.clearCache=function(){i=[]},o.inject=function(t,n){var o=[];(function n(r,a){if(!r)return void l();if("code"==r.mode)o.push(r.val),l();else{var s=function(e){e&&o.push(e),l()},c=function(e){for(var t=0;t<i.length;t++)if(i[t].url==e)return i.push(i[t]),i[t]}(r.val);c?s(c.val):khttp.get(cacheBust(r.val)).success((function(e){!function(e){i.length>5&&i.shift();i.push(e)}({url:r.val,val:e}),s(e)})).error((function(){s()}))}function l(){++e<t.length?n(t[e],a):(!function(){for(var e=0;e<o.length;e++){var t;if(o[e])o[e].indexOf("window.location.href")>=0&&(t=/window\.location\.href[\s]*?=(.*?)[;\n]/g,o[e]=o[e].replace(t,"try { kbOpenChapterURL($1); } catch(er){};")),o[e].indexOf("event.stopPropagation()")>=0&&(t=/event\.stopPropagation\(\)/g,o[e]=o[e].replace(t,"void(0)")),o[e].indexOf("<![CDATA[")>=0&&(t=/<!\[CDATA\[/g,o[e]=o[e].replace(t,"//<![CDATA["),t=/\]\]>/g,o[e]=o[e].replace(t,"//]]>"))}}(),a&&a(o))}})(t[e=0],n)},o.getScript=function(){return t},o.replaceScript=function(e){if(t=e,n&&n.length)for(var o=0;o<n.length;o++)n[o].parentNode&&n[o].parentNode.removeChild(n[o]);n=[];for(o=0;o<e.length;o++){var i=document.createElement("script");i.setAttribute("kotobee",""),i.setAttribute("type","text/javascript"),i.innerHTML=e[o],n.push(i);try{document.head.appendChild(i)}catch(e){}try{try{document.dispatchEvent(new Event("DOMContentLoaded"))}catch(e){}}catch(e){}}},o})),createService("kError",(function(){var e={},t=[];function n(){modals.hide(),kStatus.update(translit.get("pleaseWait"),null,{dots:!0,timeoutDuration:5e3}),backend.requestClearDevices({email:stg.data.user.email,code:stg.data.user.code},(function(e){kStatus.update(),e&&modals.show({mode:"success",successOptions:{msg:translit.get("clearDevicesRequested")}})}))}return e.modal=null,e.update=function(o){var i;if(o)switch(o.error){case"s_authError":if("library"==config.kotobee.mode){var r={mode:"loginPanel",dynamic:!0,animation:"slide-in-up",loginOptions:{errorReason:o.reason,redirectTo:o.redirectTo}};config.kotobee.public&&(i=r),!config.kotobee.public&&backend.cloudParam("entry")&&(i=r)}i||login.toLoginScreen({redirectTo:o.redirectTo});break;case"networkError":i={mode:"networkError",errorOptions:{ref:o.ref,retry:e.retry}};break;case"localonlyError":i={mode:"localOnlyError",errorOptions:{ref:o.ref,retry:e.retry}};break;case"errorAndCallback":i={mode:"generalError",errorOptions:{msg:translit.get(o.msg),cb:o.cb}};break;case"ssoEmailError":i={mode:"ssoEmailError",errorOptions:{provider:{name:o.provider},cb:o.cb}};break;case"s_exceededMaxDevices":i={mode:"exceededMaxDevicesError",errorOptions:{requestClearDevices:n,cb:o.cb}};break;default:i={mode:"generalError",errorOptions:{msg:translit.get(o.error)}}}for(var a=0;a<t.length;a++)t[a].error==o.error&&t[a].func(i);i&&modals.show(i)},e.retry=function(e){modals.hideAll(),setTimeout((function(){e&&e.func&&e.func.apply(null,e.args)}),100)},e.detect=function(e,n){t.push({error:e,func:n})},e.removeDetection=function(e,n){for(var o=0;o<t.length;o++)if(n==t[o].func&&e==t[o].error)return void t.splice(o,1)},e})),createService("khttp",(function(){var e={};return e.get=function(e){var t=$q.defer();return(isNative||desktop)&&-1==e.indexOf("http")&&-1!=e.indexOf("?")&&(e=e.split("?")[0]),backend.sendRawPost(cleanURL(e),{},{ignoreCredentials:!0,method:"GET"},(function(e){if(!e||"d_connectionTimedOut"==e.error||"networkError"==e.error)return t.reject();t.resolve(e)})),t.promise},e.post=function(e,t,n){var o=$q.defer();return backend.sendRawPost(cleanURL(e),t,n,(function(e){if(!e)return o.reject();o.resolve(e)})),o.promise},e})),createService("kMiniapps",(function(){var service={},miniappsConfig={},log=kLog;function openPreviewApp(){if(previewParams&&previewParams.appfolder)for(var e=0;e<stg.data.miniapps.length;e++)if(stg.data.miniapps[e].folder==previewParams.appfolder){document.getElementById("readerHeader");return compInstances.headerDefault.miniappsClicked(),void setTimeout((function(){service.openFromMenu(stg.data.miniapps[e])}),1e3)}}function validate(e,t){if(kInteractive.isSDK())return!0;var n,o=e.join(";");"book"==config.kotobee.mode?n=CryptoJS.MD5(stg.data.packageOpf.replace(/\s+/g,"")+o).toString():"library"==config.kotobee.mode&&(n=CryptoJS.MD5(config.kotobee.cloudid+o).toString());return n==t[window.atob("Y2hlY2tzdW0=")]}return service.initialize=function(ob){if(ob||(ob={}),ob.mode||(ob.mode="book"),!config.disableMiniapps){var book=$injector.get("book");if("library"!=config.kotobee.mode||"book"!=ob.mode||!config.noBookOverride){var appids=[],miniapps=[];Vue.set(stg.data,"miniapps",miniapps);var css="",root=service.getRoot();khttp.get(cacheBust(root+"miniapps.js")).success((function(miniappScript){if(miniappScript&&!miniappScript.error){eval(miniappScript);var json=miniappJson.apps,arr=[];for(var item in json)arr.push({folder:item,code:json[item]});arr.length&&next(0)}function next(index){if(index>=arr.length)return finalize();var folder=arr[index].folder;khttp.get(cacheBust(root+"miniapps/"+folder+"/config.js")).success((function(configScript){function proceed(dataJson){dataJson=dataJson||{},eval(configScript);var configJson=window.miniappConfig;"string"==typeof configJson&&(configJson=JSON.parse(configJson));var appid=configJson.appid;appids.push(appid);var regex=new RegExp("{{"+appid+"Root}}","g"),regexEncoded=new RegExp(encodeURIComponent("{{"+appid+"Root}}"),"g"),code=arr[index].code;code=code.replace(regex,root+"miniapps/"+folder),code=code.replace(regexEncoded,root+"miniapps/"+folder),code=code.replace(/{{www}}/g,root+"../..");try{eval(code)}catch(e){return void next(++index)}var miniappClass=window.miniappOutput;if(css+=arr[index].css,!miniappClass.open)return next(++index);var lang=translit.getLang();"fr"!=lang&&"es"!=lang&&"ar"!=lang&&(lang="en"),miniapps.push({appid:appid,folder:folder,appClass:miniappClass,configJson:configJson,dataJson:dataJson}),delete window.miniappConfig,delete window.miniappOutput,next(++index)}kInteractive.isSDK()?proceed():khttp.get(cacheBust(root+"miniapps/"+folder+"/userdata/data.json")).success(proceed).error(proceed)}))}function finalize(){if(validate(appids,miniappJson)){var e=document.createElement("style");e.setAttribute("data-miniapps","stylesheet"),e.setAttribute("type","text/css"),e.innerHTML=css,document.body.appendChild(e),$rootScope.$$phase||$rootScope.$apply(),preview&&setTimeout(openPreviewApp,1e3)}}}))}}},service.openFromMenu=function(e){e.appClass.externalLink||service.open(e),$ionicSideMenuDelegate.isOpenLeft()?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},service.openById=function(e){(stg.data.miniapps||[]).forEach((function(t){t.appid==e&&service.open(t)}))},service.open=function(e){e.appClass&&e.appClass.open&&(kInteractive.events&&kInteractive.events.add({action:"miniappOpened",param:e.appid,data:e}),e.appClass.open())},service.getRoot=function(){var e;if("library"==config.src)e="undefined"!=typeof publicRoot?publicRoot:"./";else if(e=bookPath+"_kmeta/",isKotobeeHosted())if(isAbsoluteURLPath(bookPath))e=bookPath+"_kmeta/";else if(config.kotobee.public)e=publicRoot+"epub/_kmeta/";else{var t=publicRoot.split("/books/")[1].split("/")[0];e=config.kotobee.liburl+"books/"+t+"/EPUB/epub/_kmeta/"}return e},service})),createService("kStatus",(function(){var e,t={},n=1e4;function o(){e&&(clearTimeout(e),e=null)}function i(){o(),n&&(e=setTimeout((function(){t.update().then((function(){t.showAndHide(translit.get("statusTimeoutError"),3e3)}))}),n))}return t.update=function(e,r,a){var s,c=$q.defer();if(a||(a={}),a.dots&&(e+=' <ion-spinner icon="dots" class="loadingSpinner"></ion-spinner>'),a.progress&&(e+='<div class="loadingProgress"></div>'),n=a.timeoutDuration?a.timeoutDuration:1e4,o(),e){i();var l={template:e};for(var d in a)l[d]=a[d];!function(e){var t=document.getElementById("ionicLoading");if(!t){var n;(t=document.createElement("div")).id="ionicLoading",document.getElementById("kotobeeVue").appendChild(t),(n=new compClasses.ionicLoading).$mount(t)}(n=compInstances.ionicLoading).show&&n.show(e)}(l),t.updateProgress()}else(s=compInstances.ionicLoading)&&s.hide();return timeOut((function(){c.resolve()}),r||250),c.promise},t.updateProgress=function(e){e||(e=0),e>1&&(e=1);var t=document.getElementsByClassName("loadingProgress");t.length&&(t[0].style.width=Math.round(100*e)+"%"),e>0&&i()},t.showAndHide=function(e,n){t.update(e,n).then((function(){t.update()}))},t})),createService("landing",(function(){return{}})),createService("library",(function(){var e,t={},n=[];function o(e){e||(e={}),t.maxResults=e.large?40:20}function i(){for(var e=0;e<n.length;e++)n[e].apply(this,arguments)}return t.root="",t.run=0,t.initialize=function(e){t.setBrowserTitle(),t.run++,o(),n=[],t.readDownloadedBooks((function(){t.readPrepackagedBooks((function(){i("initialized"),e&&e()}))}))},t.setMax=function(e){t.maxResults=e},t.setBrowserTitle=function(){stg.data.currentLibrary&&cache.setOb("title",replaceHTML(cache.getOb("title"),stg.data.currentLibrary.name?stg.data.currentLibrary.name:translit.get("library")))},t.addListener=function(e){n.push(e)},t.getEbooks=function(n,r,a){n||(n={}),i("preload",n),backend.getS3PathsIf(!stg.data.paths,(function(s){if(!s||s.error)return i("postload",n,s={empty:!0}),r?r(s):null;e=Math.round(1e5*Math.random()),n.more?function(e){e||(e={}),t.maxResults+=e.large?20:6}(n.contentkey?{large:!0}:{}):o(n.contentkey?{large:!0}:{}),stg.data.sortOb.method&&(n.sort=stg.data.sortOb.method.data,n.sortDir=stg.data.sortOb.method.dir),n.max=t.maxResults,backend.getEbooks(n,e,(function(o,s){if(s==e){document.getElementById("libraryThumbs");if(!o.error){if(n.sections){Vue.set(stg.data.currentLibrary,"sections",o);for(var c=0;c<stg.data.currentLibrary.sections.length;c++){var l=stg.data.currentLibrary.sections[c];t.applyExistingBooks(l.books.books,Object.assign({filterCat:l.id},n))}}else t.applyExistingBooks(o,n);t.applyCoverImgs(o),payment.registerInAppProducts(o),function(e){try{kotobee.dispatchEvent("libraryBooksFetched",e),n.favs?stg.data.favorites=e:stg.data.currentLibrary.books=e}catch(e){}}(o)}o&&o.length||(o.empty=!0),i("postload",n,o),r&&r(o)}else a&&a()}))}))},t.applyCoverImgs=function(e){var t={};if(stg.data.currentLibrary.books){for(var n=0;n<stg.data.currentLibrary.books.length;n++)t[stg.data.currentLibrary.books[n].id]=stg.data.currentLibrary.books[n];for(n=0;n<e.length;n++)t[e[n].id]&&(e[n].coverImg=t[e[n].id].coverImg)}},t.readDownloadedBooks=function(e){try{return isNative||desktop?stg.readSlot("downloaded"+stg.getBookId(!0),(function(t){stg.data.downloaded=t;for(var n=0;n<stg.data.downloaded.length;n++)Vue.set(stg.data.downloaded[n],"downloaded",!0),Vue.delete(stg.data.downloaded[n],"coverImg"),Vue.delete(stg.data.downloaded[n],"coverStyle"),Vue.delete(stg.data.downloaded[n],"bannerStyle");n=stg.data.downloaded.length-1;!function t(){if(n<0)return stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,e);(desktop?np:crdv).bookDownloaded(stg.data.downloaded[n],(function(e){e||stg.data.downloaded.splice(n,1),t(--n)}))}()})):e?e():null}catch(e){stg.data.downloaded=[]}stg.data.downloaded||(stg.data.downloaded=[]),e&&e()},t.readPrepackagedBooks=function(e){if(!isNative&&!desktop)return e?e():null;Vue.set(stg.data,"prepackaged",[]),khttp.get("books/books.json").success((function(t){if(!t)return e?e():null;Vue.set(stg.data,"prepackaged",t),e&&e()})).error((function(t){return e?e():null}))},t.applyExistingBooks=function(e,t){if(t||(t={}),(isNative||desktop)&&!t.catid&&!t.favs&&(e||stg.data.currentLibrary&&(e=stg.data.currentLibrary.books),e&&(!stg.data.currentLibrary.sectionsMode||stg.data.currentLibrary.sections!=e))){for(var n=[],o=[],i=0;i<stg.data.downloaded.length;i++)if(t.filterCat){for(var r=[],a=0;a<stg.data.downloaded[i].categories.length;a++)r.push(stg.data.downloaded[i].categories[a].id);-1!==r.indexOf(t.filterCat)&&n.push(stg.data.downloaded[i].id)}else n.push(stg.data.downloaded[i].id);for(i=0;i<stg.data.prepackaged.length;i++)o.push(stg.data.prepackaged[i].id);for(i=n.length;i--;)l(n[i],n)>=2&&(stg.data.downloaded.splice(i,1),n.splice(i,1));for(i=0;i<o.length;i++)e.unshift(Object.assign({downloaded:!0},stg.data.prepackaged[i]));for(i=0;i<n.length;i++)for(a=0;a<stg.data.downloaded.length;a++)if(stg.data.downloaded[a].id==n[i]){e.unshift(Object.assign({},stg.data.downloaded[a]));break}var s=[];for(i=0;i<e.length;i++)s.push(e[i].id);for(i=e.length;i--;)if(l(s[i],s)>=2){var c=existsInArray(s[i],s,{index:!0});Object.assign(e[c],e[i]),e.splice(i,1),s.splice(i,1)}}function l(e,t){for(var n=0,o=0;o<t.length;o++)t[o]==e&&n++;return n}},t})),createService("login",(function(){var e={};function t(e,t,o,i){e&&t&&(o||i)&&(Vue.set(stg.data,"user",{email:t,loggedIn:!0}),backend.login({accessToken:o,idToken:i,ssoProvider:e}).then((function(e){stg.data.sso.ssoBusy=!1,e.error?kError.update({error:"s_authError"==e.error?"accessDenied":e.error}):n(!0)})).catch((function(e){})))}function n(t){if(!backend.cloudParam("public")&&!backend.cloudParam("entry")||backend.cloudParam("allowlogin"))if(t)o();else{var n=backend.cloudParam("public")&&backend.cloudParam("allowlogin");backend.cloudParam("entry")&&(n=!0),backend.login({dontShowErrorDialog:n}).then(o)}else auth.startup();function o(t){!stg.data.user.email&&stg.data.sso&&stg.data.sso.oauth?e.toLoginScreen():(modals.hide(),t&&t.error?backend.cloudParam("allowlogin")&&auth.startup():auth.startup())}}return e.initialize=function(){vueApp.$on("SignIn",(function(e){sso.signInBrowser(e,t)}))},e.start=function(){config.kotobee&&config.kotobee.sso?sso.initialize((function(){if(!stg.data.user.email&&stg.data.sso&&stg.data.sso.oauth){var e=stg.data.sso.oauth.provider;sso.getSSOEmail(e,(function(e){n()}))}else n()})):n()},e.logout=function(){config.kotobee&&config.kotobee.sso&&stg.data.sso.oauth&&sso.signOutBrowser(stg.data.sso.oauth.provider),stg.data.user.rememberMe=!1},e.toLoginScreen=function(){config.kotobee.landing?$injector.get("book").loadBook({getInfoOnly:!0}).then((function(){$location.path("/landing")})):$location.path("/login"),setTimeout((function(){$ionicHistory.clearHistory();var e=document.getElementById("chapters");e&&e.parentNode.removeChild(e)}),1e3)},e})),createService("markers",(function(){var e={},t=new Array,n={};function o(e,t){var n=Number(e.style.top.split("px")[0]),o=Number(t.style.top.split("px")[0]);if(Math.abs(n-o)<10)return!0}return e.addMarker=function(n){t.push(n),e.refreshMarker(n)},e.deleteMarker=function(e){for(var n=0;n<t.length;n++)t[n].id==e&&t.splice(n,1)},e.windowResize=function(){(function(){if($location.path()&&$location.path().indexOf("/reader")>=0)return!1;return!0})()||n.width==window.innerWidth&&n.height==window.innerHeight||(e.refreshMarkers(),n.width=window.innerWidth,n.height=window.innerHeight)},e.refreshMarkers=function(){for(var n=0;n<t.length;n++)e.refreshMarker(t[n])},e.refreshMarkerById=function(n){for(var o=0;o<t.length;o++)if(t[o].id==n)return void e.refreshMarker(t[o])},e.getMarker=function(e){for(var n=0;n<t.length;n++)if(t[n].id==e)return t[n]},e.refreshMarker=function(e){var t=e.target();if(t&&e.elem){var n="",o="page";(hasClass(e.elem,"contentSideNoteMarker")||hasClass(e.elem,"contentBookMarker"))&&(o="side");var i=cache.getOb("epubContainer").getElementsByClassName("scroll")[0],r=cache.getOb("epubContent");if(i){var a=t.getBoundingClientRect(),s=i.getBoundingClientRect(),c=r.getBoundingClientRect(),l=getElemPadding(cache.getOb("epubContainer")),d=0,u=0,p=1,f=cache.getOb("epubContainer").__vue__.getScrollProxy().getPosition();d=i.scrollTop,u=i.scrollLeft,d=f.top,(u=f.left)||(u=0),d||(d=0);var h=$injector.get("nav");stg.data.book.chapter.viewport&&(p=h.getFxlScale());var g,m,v,b=(a.top-(s.top+0))/p;if("side"==o){g=0;var k=Number(l.left)+(c.left-s.left+u),y=s.right-c.right+u;(v=stg.data.book.chapter.viewport||k<y?k:y)<30&&(v=30),stg.data.settings.rtl&&(m=0,g=null),g-=k}else{if(0==e.elem.offsetWidth)return;g=(a.left+u-s.left)/p}null!=b&&(n+="top: "+(b+e.offsetTop)+"px; "),null!=g&&(n+="left: "+(g+e.offsetLeft)+"px; "),null!=m&&(n+="right: "+(m-e.offsetLeft)+"px; "),null!=v&&(n+="width: "+v+"px; ");var w=1/p;""!=(n+="transform:translateZ(0) scale("+w+");-webkit-transform:translateZ(0) scale("+w+");-moz-transform:translateZ(0) scale("+w+");")&&(e.elem.style.cssText=n),e.callback&&e.callback()}}},e.checkMarkerExistsAtSameLocation=function(e,t){stg.getNotes((function(n){for(var i=0;i<n.length;i++){var r=n[i];if("page"==r.type){var a=document.getElementById("knote"+r.nid);if(a&&a!=e&&o(a,e))return t(!0)}}stg.getBookmarks((function(n){for(var i=0;i<n.length;i++){var r=n[i],a=document.getElementById("bookmark"+r.bmid);if(a&&(a!=e&&o(a,e)))return t(!0)}t()}))}))},e.show=function(){for(var e=0;e<t.length;e++)t[e].elem.style.visibility="shown"},e.hide=function(){for(var e=0;e<t.length;e++)t[e].elem.style.visibility="hidden"},window.addEventListener("resize",e.windowResize,!0),e})),createService("media",(function(){var e={};return e.show=function(e){"image"==e.type?(tinCan.send({verb:"viewed image",activity:e.title?e.title:e.thumbnail}),modals.show({mode:"image",dynamic:!0,animation:"slide-in-up",image:e,large:e.large})):"video"==e.type?(tinCan.send({verb:"viewed video",activity:e.title?e.title:e.thumbnail}),modals.show({mode:"video",animation:"slide-in-up",video:e,large:e.large},null,pauseVideoAndAudio)):"audio"==e.type&&(tinCan.send({verb:"listened to audio",activity:e.title?e.title:e.thumbnail}),modals.show({mode:"audio",animation:"slide-in-up",audio:e,large:e.large},null,pauseVideoAndAudio))},e.hide=function(){modals.hide()},e})),createService("modals",(function(){var e,t,n,o,i,r={},a=[],s={animation:"zoom-in",focusFirstInput:!1,backdropClickToClose:!1};function c(){o&&clearTimeout(o),i=!1,n&&n._closedCb&&n._closedCb(),a.shift(),d(),function(){for(var e=document.getElementsByClassName("modal-backdrop"),t=e.length;t--;)hasClass(e[t],"hide")&&e[t].parentNode.removeChild(e[t])}()}r.setScope=function(i){vueExclude||((t=i).hideModal=r.hide,e||l(),t.$on("modal.shown",(function(e){n&&n._cb&&n._cb(e.target||e)})),t.$on("modal.hidden",(function(e){o&&clearTimeout(o),n&&n._closeCb&&n._closeCb(event.target),setTimeout((function(){a.shift(),d(),function(){for(var e=document.getElementsByClassName("modal-backdrop"),t=e.length;t--;)hasClass(e[t],"hide")&&e[t].parentNode.removeChild(e[t])}()}),500)})))},r.getScope=function(){return t};var l=function(){var n=$q.defer();if(vueExclude){var o=clone(s);o.scope=t,$ionicModal.fromTemplateUrl(kTemplate("system/modals.html"),o).then((function(t){e=t,n.resolve()}))}else n.resolve();return n.promise};function d(){if(n=null,a.length){var i=a[0];if(i){if((n=i).hidden)return a.shift(),d();s.backdropClickToClose=!!i.backdropClickToClose&&i.backdropClickToClose,i.animation||(i.animation="zoom-in"),i.large?addClass(document.body,"largeModal"):removeClass(document.body,"largeModal"),l().then((function(){vueExclude?t.modal=i:Vue.set(stg.data,"modal",i),(vueExclude||e)&&(vueExclude&&e.show(),t.$$phase||t.$apply(),n&&n.timeLimit&&(o=setTimeout((function(){var e=n;r.hide(n);var t={wait:function(){r.hide(),r.show(e)}};r.show({mode:"waitTimeout",timeoutOptions:t})}),n.timeLimit)),setTimeout((function(){i.cb&&i.cb(e)}),750))}))}}}return r.show=function(t,n,o){if(!vueExclude||e)return t._cb=n,t._closedCb=o,a.push(t),i||1==a.length&&d(),t;l().then((function(){r.show(t)}))},r.obShown=function(e){return n==e},r.shown=function(){return vueExclude?e.isShown():stg.data.modal&&stg.data.modal.mode},r.hideAll=function(e){a=[],r.hide(null,e)},r.hide=function(t,o){if(vueExclude&&!e)return o?o():null;t?n==t?(stg.data.modal&&stg.data.modal.mode?(stg.data.modal.mode=null,i=!0,stg.data.modal._hiddenCb=c):c(),isNative&&$injector.get("crdv").hideKeyboard()):t.hidden=!0:(stg.data.modal&&stg.data.modal.mode?(stg.data.modal.mode=null,stg.data.modal._hiddenCb=c,i=!0):c(),isNative&&$injector.get("crdv").hideKeyboard()),o&&o()},r})),createService("nav",(function(){var e,t,n,o,i,r={},a=0,s={},c=[];function l(e,t){for(var n=0;n<c.length;n++)c[n].event==e&&c[n].func(t)}function d(e,n){"newChapter"==e&&((t=$ionicScrollDelegate.$getByHandle("content")).scrollTo(0,0,!1),stg.data.book.chapter.viewport&&r.fxlZoomFit({noAnim:!0,immediateScrollRefresh:!0,dir:config.fitToScreen?null:"x"}),setTimeout(markers.refreshMarkers,1e3))}function u(){if(!config.hideTOCAtWidescreen){var e=s.width>=1300;stg.data.widescreen!=e&&(l("widescreenChanged"),Vue.set(stg.data,"widescreen",e)),Vue.set(stg.data,"pinned",stg.data.widescreen),e?$ionicSideMenuDelegate.close():removeClass(document.body,"widescreen"),$rootScope.$$phase||$rootScope.$apply()}}function p(e){if(vueExclude){var t=cache.getOb("epubContainer");"margin"==e?(t.style.paddingLeft&&(t.style.setProperty("margin-left",t.style.paddingLeft,"important"),t.style.paddingLeft=null),t.style.paddingTop&&(t.style.setProperty("margin-top",t.style.paddingTop,"important"),t.style.paddingTop=null)):(t.style.marginLeft&&(t.style.setProperty("padding-left",t.style.marginLeft,"important"),t.style.marginLeft=null),t.style.marginTop&&(t.style.setProperty("padding-top",t.style.marginTop,"important"),t.style.marginTop=null))}}function f(e,n){if(vueExclude){e||(e=r.getFxlScale());var o=r.getFxlFit(null,"from fxlRefreshHorizontalVerticalScrolling"),i=t.getScrollView().options;e*o.widthFit<=o.widthFit?i.scrollingX=!1:i.scrollingX=!0,e*o.widthFit<=o.heightFit?i.scrollingY=!1:i.scrollingY=!0}}function h(e){if(!r.options.swipeDisabled&&!(a>15||mobile&&function(){var e=document.getElementById("readerBody").style.transform||document.getElementById("readerBody").style.webkitTransform;if(e&&"translate3d(0px, 0px, 0px)"!=e&&"translate3d(0px, 0, 0)"!=e)return!0}())){var t=stg.data.book.chapter.viewport?1:.8,n=stg.data.book.chapter.viewport?100:70;if(!(Math.abs(e.gesture.velocityX)<t||Math.abs(e.gesture.distance)<n||e.gesture.touches.length>1))return!0}}function g(){return!($location.path()&&$location.path().indexOf("/reader")>=0)}function m(){i&&clearTimeout(i),i=setTimeout((function(){kotobee.dispatchEvent("transformationChanged")}),500)}function v(e,t){if(vueExclude){e=r.getFxlFit({scale:e/t});cache.getOb("epubContainer").style.setProperty("padding-left",e.marginLeft-0+"px","important")}}function b(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement)return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozExitFullscreen?document.mozExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),!0}return r.options={},r.initialize=function(t){e||(window.addEventListener("resize",r.windowResize,!0),s.width=window.innerWidth,s.height=window.innerHeight,mobile||u(),chapters.addListener(d),e=!0,r.addListener("widescreenChanged",(function(){setTimeout(r.fxlZoomFit,400)})),document.body.addEventListener("keyup",(function(e){27==e.keyCode&&b()})))},r.resetEpubContainer=function(e){},r.addListener=function(e,t){c.push({event:e,func:t})},r.windowResize=function(){g()||s.width==window.innerWidth&&s.height==window.innerHeight||(r.fxlZoomFit(),s.width=window.innerWidth,s.height=window.innerHeight,mobile||u(),chapters.regenerateSpreads({resize:!0}))},r.getScroller=function(){return t},r.transformstart=function(){r.transforming=!0,stg.data.book.chapter.viewport&&(!function(e){if(!e){(e=cache.getOb("epubContainer").getElementsByClassName("scroll")).length&&(e=e[0])}e&&deleteTransformOrigin(e)}(),n=(new Date).getTime(),o=r.getFxlScale(),p("margin"))},r.transformend=function(){if(r.transforming=!1,!g()){if(stg.data.book.chapter.viewport){var e=(new Date).getTime(),i=r.getFxlScale();if(mobile&&i<o&&e-n<800)return void r.fxlZoomFit();var a=r.getFxlFit(null,"from transformend").bestFit;i<a?($ionicScrollDelegate.$getByHandle("content").zoomTo(a,!0),i=a):i>3&&($ionicScrollDelegate.$getByHandle("content").zoomTo(3,!0),i=a),f(3,"transformend"),setTimeout(markers.refreshMarkers,1e3),r.repaint()}else{if(!config.textSizeControls)return;var s=t.getScrollPosition().zoom,c=settings.getTextSize(),l=Math.round(s*c*10)/10;l<.2&&(l=.2),stg.data.settings.textSize=l+"em",settings.updateTextSize(),settings.writeTextSize(),t.zoomTo(1,!0);var d=angular.element(cache.getOb("epubContent")).scope();d.header.mode="textSize",d.$$phase||d.$apply(),setTimeout(markers.refreshMarkers,1e3)}m()}},r.repaint=function(){redrawForChrome(cache.getOb("epubContent"))},r.resize=function(){t||(t=$ionicScrollDelegate.$getByHandle("content")),t&&t.resize()},r.swipeRight=function(e){g()||h(e)&&(t.resize(),isNative&&crdv.vibrate(),stg.data.settings.rtl?chapters.nextChapter():chapters.prevChapter())},r.swipeLeft=function(e){g()||h(e)&&(t.resize(),isNative&&crdv.vibrate(),stg.data.settings.rtl?chapters.prevChapter():chapters.nextChapter())},r.dragStart=function(){g()||(stg.data.book.chapter.viewport||t.zoomTo(1,!1),a=0,t.freezeScroll(!1))},r.drag=function(e){a++},r.tap=function(e){l("tap",e)},r.fxlToggleTapZoom=function(e){if(vueExclude){try{if(!e.gesture.srcEvent.isTrusted)return}catch(e){}if(!r.options.doubletapDisabled&&cache.getOb("epubContent")&&stg.data.book.chapter.viewport&&stg.data.book.chapter.viewport.width){var n=r.getFxlScale(),o=r.getFxlFit(null,"from fxlToggleTapZoom").bestFit,i=t.getScrollView().options.minZoom;if(null==i&&(i=n-1),Math.round(100*n)!=Math.round(100*o)&&n>i)r.fxlZoomFit();else{var a=2*r.getFxlFit(null,"from fxlToggleTapZoom").bestFit,s=r.getFxlFit(null,"from fxlToggleTapZoom");$ionicScrollDelegate.$getByHandle("content").zoomTo(a,!0,e.gesture.center.pageX-s.marginLeft,e.gesture.center.pageY-s.marginTop),selection.reset(),v(a,s.bestFit),p("margin"),f(a)}setTimeout(markers.refreshMarkers,1e3),setTimeout(r.repaint,1e3),m()}}},r.fxlZoomIn=function(e){selection.reset();var t=1.2*r.getFxlScale();$ionicScrollDelegate.$getByHandle("content").zoomTo(t,!0)},r.fxlZoomOut=function(e){selection.reset();var t=.8*r.getFxlScale();$ionicScrollDelegate.$getByHandle("content").zoomTo(t,!0),p("margin"),f(t),setTimeout(markers.refreshMarkers,1e3),m()},r.fxlZoomFit=function(e){if(t&&(e||(e={}),cache.getOb("epubContent")&&stg.data.book&&stg.data.book.chapter.viewport&&stg.data.book.chapter.viewport.width)){if(selection.reset(),!e.dir){var n=clone(stg.data.book.chapter.viewport);"double"==stg.data.book.chapter.view&&(n.double=!0);var o=compInstances.pan.getBestFit("width",n),i=compInstances.pan.getBestFit("height",n);e.dir=i.scale>o.scale?"x":"y"}"y"==e.dir?t.fitToHeight(!e.noAnim,{disableEvents:!0}):t.fitToWidth(!e.noAnim,{top:!0,disableEvents:!0}),setTimeout(markers.refreshMarkers,1e3),m()}},r.fxlAdjustAlignment=function(e){e||(e={}),e.epubContent||(e.epubContent=cache.getOb("epubContent")),e.epubContainer||(e.epubContainer=cache.getOb("epubContainer"));var t=r.getFxlFit(e,"from fxlAdjustAlignment"),n=getElemMargin(e.epubContent,{computed:!0});"auto"==n.left&&(n.left=0),"auto"==n.top&&(n.top=0);var o=e.newScale?e.newScale:t.widthFit;autoprefixTransform(e.epubContent,"scale("+o+")"),autoprefixTransformOrigin(e.epubContent,-n.left+"px "+-n.top+"px"),vueExclude&&(e.epubContainer.style.marginLeft=e.epubContainer.style.marginRight=null,e.epubContainer.style.paddingLeft=e.epubContainer.style.paddingRight=null,e.epubContainer.style.setProperty("padding-left",t.marginLeft+"px","important"),e.epubContainer.style.setProperty("padding-top",t.marginTop+"px","important"));e.epubContainer.getElementsByClassName("scroll")[0];e.epubContainer.style.width=t.outerWidth+"px"},r.getSpreadHeight=function(e){for(var t=0,n=0;n<e.children.length;n++){var o=e.children[n];o.id&&0==o.id.indexOf("spread")&&(t=Math.max(t,Number(o.style.height.split("px")[0])))}return t},r.getSpreadWidth=function(e){for(var t=0,n=0;n<e.children.length;n++){var o=e.children[n];o.id&&0==o.id.indexOf("spread")&&(t+=Number(o.style.width.split("px")[0]))}return t},r.viewFromElem=function(e){for(var t={maxHeight:0,totalWidth:0},n=0;n<e.children.length;n++){var o=e.children[n];if(o.id&&0==o.id.indexOf("spread")){var i=Number(o.style.height.split("px")[0]),r=Number(o.style.width.split("px")[0]),a={width:r,height:i};"spreadL"==o.id?(t.leftOb||(t.leftOb={}),t.leftOb.viewport=a,t.leftOb.layout=hasClass(o,"fxl")?"fxl":"rfl",t.layout=t.leftOb.layout):"spreadR"==o.id&&(t.view="double",t.rightOb||(t.rightOb={}),t.rightOb.left=Number(o.style.left.split("px")[0]),t.rightOb.viewport=a,t.rightOb.layout=hasClass(o,"fxl")?"fxl":"rfl"),t.maxHeight=Math.max(i,t.maxHeight),t.totalWidth+=r}}return t.leftOb&&t.rightOb&&t.rightOb.left&&(t.totalWidth+=t.rightOb.left-t.leftOb.viewport.width),t},r.getFxlFit=function(e,t){e||(e={}),e.viewport||(e.viewport=stg.data.book.chapter.viewport);var n={};e.epubContent||(e.epubContent=cache.getOb("epubContent"));var o=e.view;o||(o=stg.data.currentView);var i={x:0};e.epubContainer||(e.epubContainer=cache.getOb("epubContainer"));var a=e.epubContainer.getElementsByClassName("scroll");a.length&&(i=getElemPadding(a[0],{computed:!0}),n.scrollContainer=a[0]),"auto"==i.x&&(i.x=0),"auto"==i.y&&(i.y=0);var s=getElemMargin(e.epubContent,{computed:!0}),c=getElemPadding(e.epubContent,{computed:!0}),l=s.x,d=s.y;"auto"==l&&(l=0),"auto"==d&&(d=0);var u=c.x,p=c.y;"auto"==u&&(u=0),"auto"==p&&(p=0),e.scale||(e.scale=1);var f=e.viewport.width*e.scale+l,h=e.viewport.height+d;if("double"==o){var g=r.viewFromElem(e.epubContent);f=g.totalWidth,h=g.maxHeight}var m=document.getElementById("readerBody"),v=document.getElementById("readerHeader"),b=document.getElementById("tabMenu"),k=m.getBoundingClientRect().width,y=m.getBoundingClientRect().height;mobile&&"alwaysShow"!=config.autohideReaderMode&&"showOnScroll"!=config.autohideReaderMode||(y-=v.getBoundingClientRect().height+b.getBoundingClientRect().height),e.includeScrollPadding||(k-=i.x,y-=i.y);var w=k/f,C=y/h;if(n.readerWidth=k,n.readerHeight=y,n.widthFit=w,n.heightFit=C,config.fitToScreen)n.bestFit=C<w?C:w,n.bestFitType=C<w?"vertical":"horizontal";else{var x=w;x>=1&&(x=1);var I=C/x;n.bestFitType="vertical",I<1&&I>=.7&&(x=C,n.bestFitType="vertical"),n.bestFit=x}return n.bestFit=n.bestFit/n.widthFit,n.innerWidth=f,n.innerHeight=h,n.outerWidth=k,n.outerHeight=y,n.marginLeft=Math.round((n.outerWidth-n.widthFit*n.bestFit*n.innerWidth)/2),n.marginTop=Math.round((n.outerHeight-n.widthFit*n.bestFit*n.innerHeight)/2),n.marginTop<0&&(n.marginTop=0),n},r.getFxlScale=function(){return $ionicScrollDelegate.$getByHandle("content").getScrollPosition().zoom},r.fullscreen=function(){var e=document.body;b()||(e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen())},r.openInBrowser=function(e){isNative?crdv.openInNativeBrowser(e):desktop?require("nw.gui").Shell.openExternal(e):window.open(e,"_blank")},r})),createService("np",(function(){var e,t,n,o,i,r,a,s,c,l={},d=kLog,u=[];return l.addEventListener=function(e,t){u.push({event:e,func:t})},l.initialize=function(p){if(desktop){try{e=require("nw.gui"),n=require("child_process"),t=n.exec,o=e.Window.get(),process.cwd(),(process.env.HOME||process.env.USERPROFILE)+"/Desktop",c=require("path"),i=c.dirname(process.execPath),r=e.App.dataPath,a=r+"/temp",s=r+"/Books";try{o.removeAllListeners()}catch(e){d("ERROR "+e,1)}o.on("close",(function(){l.exitConfirmation()}))}catch(e){}!function(e){var t=document.createElement("script");t.setAttribute("src",isRelease?"npmModules.min.js":"js/app/npmModules.js"),t.addEventListener("load",(function(){e&&e()})),document.body.appendChild(t)}((function(){l.npmModulesLoaded=!0,l.createIfNotExists(s),l.createIfNotExists(a),p&&p(),function(e,t){for(var n=0;n<u.length;n++)u[n].event==e&&u[n].func(t)}("npmModulesLoaded")}))}else p&&p()},l.existsSync=function(e){return fs.existsSync(e)},l.createIfNotExists=function(e,t){desktop&&fs.exists(e,(function(n){n?t&&t():l.createIfNotExists(ph.parent(e),(function(){fs.mkdirSync(e),t&&t()}))}))},l.createIfNoParentsExists=function(e,t){desktop&&fs.exists(e,(function(n){n?t&&t():l.createIfNoParentsExists(ph.parent(e),(function(){fs.mkdirSync(e),t&&t()}))}))},l.writeEbook=function(e,t,n,o){desktop&&l.createTempDir((function(e){var i=new FileReader;i.onload=function(){var n=ph.join(e,"book.zip");"mac"==os&&(n=e+"/book.zip"),fs.writeFileSync(n,Buffer.from(new Uint8Array(i.result)));var r=ph.join(s,t.path);"mac"==os&&(r=s+"/"+t.path),l.removeDirectory(r,(function(){l.createIfNotExists(r,(function(){l.extractZip(n,r,(function(){t.access&&fs.writeFileSync(r+"/access.json",JSON.stringify(t.access)),Vue.set(t,"downloaded",!0);var n=Object.assign({},t,{searchresults:null});stg.data.downloaded.push(n),stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,(function(){l.removeDirectory(e,(function(){o&&o()}))}))}))}))}))},i.readAsArrayBuffer(n)}))},l.deleteEbook=function(e,t){l.removeDirectory(ph.join(s,e.path),(function(){for(var n=0;n<stg.data.downloaded.length;n++)stg.data.downloaded[n].path==e.path&&(e.downloaded=!1,stg.data.downloaded.splice(n,1),n--);stg.writeSlot("downloaded"+stg.getBookId(!0),stg.data.downloaded,(function(){t&&t()}))}))},l.bookDownloaded=function(e,t){var n=fs.existsSync(s+"/"+e.path);return t&&t(n),n},l.fileExists=function(e,t){fs.exists(e,(function(e){t(e)}))},l.removeFile=function(e,t){l.removeDirectory(e,t)},l.removeDirectory=function(e,t){if(!fs.existsSync(e))return t?t():null;rimraf(e,(function(e){t&&t(e)}))},l.extractZip=function(e,t,n){"mac"==os||"linux"==os?l.extractZipViaCli(e,t,n):l.extractZipViaNpmModule(e,t,n)},l.extractZipViaCli=function(e,n,o){var r=t('unzip "'+e+'" -d "'+n+'"',{cwd:i,maxBuffer:512e4},(function(e,t,n){r.kill(),o(e)}))},l.extractZipViaNpmModule=function(e,t,n){var o=new decompressZip(e);o.on("error",(function(e){n&&n(!1)})),o.on("extract",(function(e){n&&n(!0)})),o.on("progress",(function(e,t){})),o.extract({path:t,restrict:!1,filter:function(e){return"SymbolicLink"!==e.type}})},l.require=function(n){return"nw.gui"==n?e:"child_process"==n||"exec"==n?t:"path"==n?c:"fs"==n?fs:void 0},l.readFile=function(e){return isAbsoluteURLPath(e)||(e=process.mainModule.filename.split("index.html")[0]+e),fs.readFileSync(e)+""},l.writeFile=function(e,t,n){fs.writeFileSync(e,t,n)},l.createTempDir=function(e){var t=a+"/f"+randStr(5);l.fileExists(t,(function(n){n?l.createTempDir(e):fs.mkdir(t,(function(){e(t)}))}))},l.openLink=function(t){e.Shell.openExternal(t)},l.getBooksPath=function(){return s+"/"},l.writeArrayBuffer=function(e,t,n,o){var i=arrayBufferToBuffer(e);l.existsSync(ph.removeFilename(t))||fs.mkdirSync(ph.removeFilename(t),{recursive:!0}),fs.open(t,"w",(function(e,t){if(e)throw"error opening file: "+e;fs.write(t,i,0,i.length,null,(function(e){e?o&&o(!1):fs.close(t,(function(){o&&o(!0)}))}))}))},l.copy=function(e,t,n,o){if(n||(n={}),n.replace)for(var i=0;i<n.replace.length;i++)e=e.replace(n.replace[i].key,n.replace[i].val);n.header&&(e=n.header+e),n.footer&&(e+=n.footer),n.encoding||(n.encoding="ascii"),e=(e+="").replace(/\xA0/g," "),e=utf8Encode(e),fs.writeFile(t,e,n.encoding,(function(t,n){o&&o(e)}))},l.exit=function(){stg.getActions((function(t){if(t&&t.length){modals.hide();var n={title:"confirmation",msg:"annotationsSyncExitWarning",barStyle:"bar-dark"},o={label:"delete",style:"button-assertive",func:function(){e.App.quit()}},i={label:"cancel",func:function(){modals.hide()}};n.btns=[o,i],modals.show({mode:"confirm",confirmOptions:n})}else e.App.quit()}))},l.exitConfirmation=function(){kotobee.confirm(translit.get("exitConfirmationMsg"),{okBtn:translit.get("yes"),noBtn:translit.get("cancel"),noBackdrop:!1,cb:function(){e.App.quit()}})},l})),createService("payment",(function(){var e={},t="http://localhost:8100";function n(e){return"b"+("library"==config.kotobee.mode?e.id:"0")+"xid"+config.kotobee.cloudid}function o(e){return e&&e.pricing&&e.pricing[device.platform.toLowerCase()+"inappid"]||""}function i(e){if("function"==typeof $injector.get("bookinfo").getCurrentBook){var t=$injector.get("bookinfo").getCurrentBook();return t&&o(t)==e.id}return!1}function r(t){if(e.isInAppPurchaseEnabled())return t&&t!="com.kotobee."+stg.data.currentLibrary.subdomain}function a(e){"function"==typeof $injector.get("bookinfo").inAppPurchaseCallback&&$injector.get("bookinfo").inAppPurchaseCallback(e)}function s(e){i(e)&&$injector.get("bookinfo").refetch(),e.finish(),$injector.get("bookinfo").setBusy(!1)}e.initialize=function(t){if(t){if(stg.data.payment||(stg.data.payment={}),Array.isArray(t)){var n={};t.forEach((function(e){if(e.enabled){var t=Object.assign({},e);delete t.provider,t.params&&t.params.clientsecret&&delete t.params.clientsecret,(!isNative&&"paypal"==e.provider||"paypal"!=e.provider)&&(n[e.provider]=t)}})),t=n}var o;if(t.none=!0,t.stripe)if(delete t.none,isNative);else if(!document.head.querySelector("#stripe-sdk"))(o=document.createElement("script")).id="stripe-sdk",o.src="https://js.stripe.com/v3/",document.head.appendChild(o);if(t.paypal)if(delete t.none,isNative);else if(!document.head.querySelector("#paypal-sdk"))(o=document.createElement("script")).id="paypal-sdk",o.src="https://www.paypal.com/sdk/js?client-id="+t.paypal.params.clientid+"&disable-funding=card",document.head.appendChild(o);return t.moyasar&&(delete t.none,isNative||c.sdk()),e.isInAppPurchaseEnabled()&&(store.verbosity=store.QUIET,store.error((function(e){$injector.get("bookinfo").setBusy(!1),store.verbosity,store.QUIET}))),t}},e.getPaymentOptions=function(){var e=config.kotobee.payment?Object.keys(config.kotobee.payment).map((function(e){return{gateway:e,logo:stg.data.payment?stg.data.payment[e+"Logo"]:null}})):[];return e=isNative?e.filter((function(e){return-1!=e.gateway.indexOf("inapp")})):e.filter((function(e){return-1==e.gateway.indexOf("inapp")}))},e.getOrderName=function(e){return e&&e.orderitems&&Array.isArray(e.orderitems)&&e.orderitems.length?e.orderitems.map((function(e){return e.book&&e.book.name?e.book.name:e.subscr&&e.subscr.name?e.subscr.name:"N/A"})).join(", "):"N/A"},e.renderPaypalButton=function(t,n){!function(){var o="#paypal-button-container";if(isNative);else{var i;if(!(i=document.body.querySelector(o)))(i=document.createElement("div")).id=o.slice(1),document.body.querySelector("#paypal-button-wrapper").appendChild(i);i.innerHTML="",waitFor("paypal",(function(){paypal.Buttons({style:{color:"blue",label:"pay"},createOrder:function(n,o){return new Promise((function(e,n){if(t.order)return e(t.order);var o={platform:"paypal",accountemail:t.accountemail};"library"===config.kotobee.mode&&(o.items=JSON.stringify(t.items?t.items:[{type:"book",id:t.id}])),backend.createOrder(o,(function(t){if(!t.order||!t.order.id)return n();e(t.order)}))})).then((function(n){var i={payer:{email_address:t.accountemail?t.accountemail:stg.data.user.email},purchase_units:[{reference_id:n.id,amount:{value:n.amount,currency_code:"USD",breakdown:{item_total:{value:n.amount,currency_code:"USD"}}},redirect_urls:{return_url:config.kotobee.liburl+"library/payment/paypalsuccess",cancel_url:config.kotobee.liburl},items:[{name:e.getOrderName(n),unit_amount:{value:n.amount,currency_code:"USD"},quantity:"1",sku:n.product}]}]};return o.order.create(i)}))},onApprove:function(e,o){return o.order.capture().then((function(e){backend.sendRawPost(config.kotobee.liburl+"library/payment/paypalsuccess",{checkoutid:e.id,bid:t.id},{responseType:"json"},(function(e){e.error?(modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get(e.error)}})):n&&n()}))}))},onError:function(e){if(-1!==e.toString().toLowerCase().indexOf("unauthorized order"))return modals.hide(),void setTimeout((function(){modals.show({mode:"generalError",errorOptions:{msg:translit.get("paypalUnauthorizedOrder")}})}),0);modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get("errorProcessingPayment")}})}}).render(o)}))}}()},e.registerInAppProducts=function(t){e.isInAppPurchaseEnabled()&&(t.forEach((function(t){var c=o(t);!store.get(c)&&r(c)&&(store.register({id:c,alias:n(t),type:store.CONSUMABLE}),store.when(c).updated((function(t){i(t)&&(t.state==store.APPROVED&&e.isCurrentUserID(t)&&t.finish(),a(t))})),store.when(c).approved((function(t){i(t)&&e.validateInAppPurchase(t,(function(e,n){e?s(t):($injector.get("bookinfo").setBusy(!1),modals.hide(),modals.show({mode:"generalError",errorOptions:{msg:translit.get(n.error.message)}}))}))})),store.when(c).cancelled((function(e){})))})),store.refresh().finished((function(){})).cancelled((function(){})).failed((function(e){})))},e.isInAppPurchaseEnabled=function(){return!!isNative&&(!!config.kotobee.payment&&(!!window.store&&(config.kotobee.payment.iosinapp||config.kotobee.payment.androidinapp)))},e.isCurrentUserID=function(e){return!!e.additionalData&&e.additionalData.applicationUsername==stg.data.user.id},e.handleInAppProduct=function(t){if(e.isInAppPurchaseEnabled()){var n=o(t);if(r(n)){var i=store.get(n);i&&i.loaded&&!i.valid?a():store.update()}else a()}},e.validateInAppPurchase=function(e,t,n){try{n||(n={}),e&&e.id?"function"!=typeof t?t(!1,{code:store.INTERNAL_ERROR,error:{message:translit.get("internalError")}}):e.transaction?function(e,t){t&&(e&&e.id||t(!1),stg.readSlot("in-app-transactions",(function(n){t(n.find((function(t){return t.uid=stg.data.user.id&&t.tid==e&&t.type==e.type})))})))}(e.transaction,(function(i){var r;i?t(!0,e.transaction):(n.cache&&(r=JSON.parse(sessionStorage.getItem("transaction"+e.transaction.id)||"{}")),r?o(r):backend.sendRawPost(config.kotobee.liburl+"library/payment/inapp",{id:e.id,cloudid:e.transaction.cloudid,priceMicros:e.priceMicros,currency:e.currency,transactionType:e.transaction.type,transactionReceipt:e.transaction.receipt,transactionPurchaseToken:e.transaction.purchaseToken,transactionAppStoreReceipt:e.transaction.appStoreReceipt,applicationUsername:String(stg.data.user.id)},{requestType:"json",responseType:"json"},o))})):t(!1,{code:store.INVALID_PAYLOAD,error:{message:translit.get("invalidTransaction")}}):t(!1,{code:store.NEED_MORE_DATA,error:{message:translit.get("invalidProductId")}})}catch(e){t(!1,{code:store.NEED_MORE_DATA,error:{message:e.message||e.toString()}})}function o(o){var i;n.cache&&sessionStorage.setItem("transaction"+e.transaction.id,JSON.stringify(o)),o.error?t(!1,{code:o.error.code?store[o.error.code]:0,error:{message:translit.get(o.error.message||o.error.toString())}}):o.success?(e.transaction&&e.transaction.id&&(i=e.transaction,stg.readSlot("in-app-transactions",(function(e){e.push({uid:stg.data.user.id,tid:i.id,type:i.type}),stg.writeSlot("in-app-transactions",e.filter((function(e,t,n){return n.findIndex((function(t){return t.uid==e.uid&&t.tid==e.tid&&t.type==e.type}))==t})))}))),t(!0,e.transaction)):t(!1,{code:store.INVALID_PAYLOAD,error:{message:translit.get("invalidTransaction")}})}},e.makePayment=function(o,i){var r=i.bookOb;if(-1==o.indexOf("inapp")){if("paypal"!=o){var a={platform:o,accountemail:i.paymentEmail};"library"===config.kotobee.mode&&(a.items=JSON.stringify([{type:"book",id:r.id}])),backend.createOrder(a,(function(n){if(n.order&&n.order.id){if("moyasar"===o){var a={orderid:n.order.id,redirecturl:isNative?t:window.location.protocol+"//"+window.location.host+window.location.pathname,price:100*+i.bookOb.price,name:i.bookOb.name||"N/A"};return c.payment(a)}"stripe"===o&&e.stripeMakePayment(i.paymentOptions,{order:n.order},i,r)}}))}}else{if(!window.store)return;var s=n(r),l=store.get(s);l&&l.loaded&&(l.canPurchase||l.owned)&&(store.getApplicationUsername()||(store.applicationUsername=""+stg.data.user.id),store.order(s).error((function(e){$injector.get("bookinfo").setBusy(!1)})),$injector.get("bookinfo").setBusy(!0))}};var c={delay:2e3,url:null,sdk:function(){!function(){if(!document.getElementById("moyasar-style")){var e=document.createElement("link");e.id="moyasar-style",e.rel="stylesheet",e.href="https://cdn.moyasar.com/mpf/1.5.0/moyasar.css",document.head.appendChild(e)}}(),function(){if(!document.getElementsByClassName("mysr-form")[0]){var e=document.createElement("div");e.className="mysr-form";var t=document.createElement("div");t.className="moyasar-form-warpper";var n=document.createElement("button");n.type="button",n.className="moyasar-form-warpper--closeBtn",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"></path></svg>',n.addEventListener("click",(function(e){t&&"block"==t.style.display&&c.resetMoyasar()})),t.appendChild(n),t.appendChild(e),document.body.appendChild(t)}}(),[{src:"https://polyfill.io/v3/polyfill.min.js?features=fetch",id:"moyasar-polyfill"},{src:"https://cdn.moyasar.com/mpf/1.5.0/moyasar.js",id:"moyasar-sdk"}].forEach((function(e){if(!document.getElementById(e.id)){var t=document.createElement("script");t.id=e.id,t.src=e.src,document.body.appendChild(t)}}))},payment:function(e,t){if(!isNative){c.resetMoyasar(),c.sdk();var n={element:".mysr-form",amount:e.price,currency:"USD",description:e.name,publishable_api_key:config.kotobee.payment.moyasar.params.clientid,methods:["creditcard","applepay","stcpay"],apple_pay:{country:"SA",label:e.name,validate_merchant_url:"https://mystore.com/checkout/applepay/validate-merchant"},supported_networks:["mada","visa","mastercard","amex"],metadata:e,callback_url:config.kotobee.liburl+"library/payment/moyasar_redirect?orderid="+e.orderid,on_redirect:function(e){c.url=e},on_completed:function(n){var o=config.kotobee.liburl+"library/payment/moyasar_save_payment",i="&orderid="+e.orderid+"&paymentid="+n.id;c.ajax(o,i,t)},on_failure:function(e){}};Moyasar.init(n),c.showMoyasar()}},ajax:function(e,t,n){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4===o.readyState)if(4===o.readyState&&o.status>=200&&o.status<=299){var e=JSON.parse(o.responseText);e.success?(n&&n(),c.success()):e.error&&c.error(e.error)}else c.error()},o.onerror=function(e){c.error(e)},o.send(t)},success:function(){setTimeout((function(){null!==c.url&&window.location.replace(c.url)}),c.delay)},error:function(e){c.tryAgain()},tryAgain:function(){c.resetMoyasar(),kotobee.popup(translit.get("moyasarErrorMessageDesc"),{title:translit.get("moyasarErrorMessageTitle"),okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})},resetMoyasar:function(){c.url=null;var e=document.getElementsByClassName("moyasar-form-warpper")[0];e&&e.remove();var t=Array.from(document.getElementsByClassName("paymentOption"));t.length&&t.forEach((function(e){if(e){var t=e.getElementsByTagName("a")[0];t&&-1===t.className.split(" ").indexOf("enableBtn")&&(t.className+=" enableBtn")}}))},showMoyasar:function(){var e=document.getElementsByClassName("moyasar-form-warpper")[0];e&&(e.style.display="block")}};return e.moyasarSettings=c,e.stripeMakePayment=function(e,n,o,i,r){var a=config.kotobee.liburl+"library/payment/getstripesession",s={url:isNative?t:window.location.protocol+"//"+window.location.host+window.location.pathname,gateway:"stripe"};s.orderid=n.order.id,backend.sendRawPost(a+"",s,{responseType:"json"},(function(n){n.error||(n.success?(r&&r(),isNative?function(e,n){if(cordova.InAppBrowser){var o="location=no,hidden=no,clearsessioncache=yes,clearcache=yes,closebuttoncaption=Go back to App,toolbar="+(ios?"yes":"no")+",presentationstyle=formsheet",i=cordova.InAppBrowser.open("about:blank","_blank",o);i.addEventListener("loadstart",(function(e){if(0===e.url.indexOf(t)){i.close();var n=new URL(e.url),o=new URLSearchParams(n.search),r="/payment/"+o.get("gateway")+"/success/"+o.get("book_id")+"/"+o.get("user_id");modals.hide(),$location.path(r),$ionicHistory.clearHistory()}})),i.addEventListener("loadstop",(function(){i.executeScript({code:n})})),i.addEventListener("loaderror",(function(e){if(!ios)try{i&&i.close()}catch(e){}})),i.addEventListener("exit",(function(e){}))}}(0,"var script = document.createElement('script');                      script.src = 'https://js.stripe.com/v3/';                      script.onload = function() {                          var stripe = Stripe('"+e.stripe.params.clientid+"');                          stripe.redirectToCheckout({                              sessionId:'"+n.session+"'                          }).then(function(result) {                              console.error(result.error.message);                          });                      };                      document.head.appendChild(script);"):waitFor("Stripe",(function(){Stripe(e.stripe.params.clientid).redirectToCheckout({sessionId:n.session}).then((function(e){}))}))):(s.cloudid=config.kotobee.cloudid,s.accountemail=o.paymentEmail))}))},e})),createService("popovers",(function(){var e,t,n={},o=[];n.setScope=function(n){vueExclude||(t=n,e||i())};var i=function(){var n=$q.defer();return vueExclude?(t||(t=$rootScope),$ionicPopover.fromTemplateUrl(kTemplate("system/popovers.html"),{scope:t}).then((function(t){e=t,n.resolve()}))):n.resolve(),n.promise};function r(){if(0!=o.length){var t=o.shift();0,t.animation||(t.animation="zoom-in"),vueExclude?e&&(e.isShown()||e.show(t.event)):Vue.set(stg.data,"popover",t)}}return n.show=function(t){!vueExclude||e?(o.push(t),1==o.length&&r()):i().then((function(){n.show(t)}))},n.shown=function(){return!!e&&(stg.data.popover&&stg.data.popover.mode)},n.hide=function(){vueExclude&&!e||(vueExclude?(t.popover=null,e&&e.hide()):stg.data.popover&&(stg.data.popover.mode=null),r())},n})),createService("scorm",(function(){var e,t,n={};function o(){s.doLMSCommit("")}function i(e,t,n){var o=r(e+"."+t+"."+n);return o&&""!=o||(o=r(e+"_"+t+"."+n)),o}function r(e){return s.doLMSGetValue(e)}function a(e,t){return s.doLMSSetValue(e,t)}n.initialize=function(){if(!(config.v<1.2)){try{if(!scormEnabled)return}catch(e){return}s.doLMSInitialize(""),1.2==(t=s.getAPIVersion())?"not attempted"==r("cmi.core.lesson_status")&&(a("cmi.core.lesson_status","browsed"),o()):"not attempted"==r("cmi.completion_status")&&(a("cmi.completion_status","unknown"),o()),e=function(){try{var e=r("cmi.suspend_data");return JSON.parse(e)}catch(e){return[]}}();try{for(var n=0;n<config.scorm.objectives.length;n++){var c=Number(r("cmi.objectives._count"));c||(c=0);for(var l=c,d=config.scorm.objectives[n],u=0;u<c;u++)i("cmi.objectives",u,"id")==d.id&&(l=u);a("cmi.objectives."+l+".id",d.id),1.2!=t&&a("cmi.objectives."+l+".description",d.name)}}catch(e){}o()}},n.setBookmark=function(e,n){try{if(!scormEnabled)return}catch(e){return}a(1.2==t?"cmi.core.lesson_location":"cmi.location",e),n||o()},n.getBookmark=function(){try{if(!scormEnabled)return}catch(e){return}return r(1.2==t?"cmi.core.lesson_location":"cmi.location")},n.setInteractions=function(s){try{if(!scormEnabled)return}catch(e){return}for(var c=0;c<s.length;c++){for(var l=e.length,d=0;d<e.length;d++)e[d].id==s[c].id&&(l=d);e[l]=s[c],n.setInteraction(l,s[c],!0)}!function(){if(!e.length)return;for(var o=Number(r("cmi.objectives._count")),s={},c=0;c<e.length;c++)s[e[c].qid]=e[c];for(c=0;c<o;c++){var l=r("cmi.objectives."+c+".id");if(l){var d=0;for(var u in s)s[u].objective==l&&(d+=s[u].scoreMax);n.setObjective({id:l,scoreMax:d},!0),n.setObjective({id:l,scoreRaw:0},!0)}}d=0;for(var u in s)d+=s[u].scoreMax;a(1.2==t?"cmi.core.score.max":"cmi.score.max",d),a(1.2==t?"cmi.core.score.min":"cmi.score.min",0),a(1.2==t?"cmi.core.score.raw":"cmi.score.raw",0);for(var p=0;p<e.length;p++){var f=e[p],h=null,g=null;for(c=0;c<o;c++)f.objective==i("cmi.objectives",c,"id")&&(h=f.objective,g=c);if(h){var m=Number(r("cmi.objectives."+g+".score.raw"));m||(m=0);var v={};v.id=h,v.scoreRaw=f.result*f.weighting+m,v.scoreMin=0,v.scoreScaled=v.scoreRaw/v.scoreMax,v.completionStatus="unknown",v.successStatus="unknown",n.setObjective(v,!0)}var b=Number(r(1.2==t?"cmi.core.score.raw":"cmi.score.raw"));b||(b=0),a(1.2==t?"cmi.core.score.raw":"cmi.score.raw",f.result*f.weighting+b)}}(),function(e){try{a("cmi.suspend_data",JSON.stringify(e))}catch(e){}}(e),o()},n.setInteraction=function(e,n,i){try{if(!scormEnabled)return}catch(e){return}n.id&&a("cmi.interactions."+e+".id",n.id),n.result&&a("cmi.interactions."+e+".result",n.result),n.correctResponses&&a("cmi.interactions."+e+".correct_responses.0.pattern",n.correctResponses),n.type&&a("cmi.interactions."+e+".type",n.type),n.weighting&&a("cmi.interactions."+e+".weighting",n.weighting),n.objective&&a("cmi.interactions."+e+".objectives.0.id",n.objective),1.2==t?(n.timestamp&&a("cmi.interactions."+e+".time",function(e){var t=e.getSeconds();t<10&&(t="0"+t);var n=e.getMinutes();n<10&&(n="0"+n);var o=e.getHours();return o<10&&(o="0"+o),o+":"+n+":"+t}(n.timestamp)),n.latency&&a("cmi.interactions."+e+".latency",function(e){var t=Math.floor(e/3600);e-=60*t*60;var n=Math.floor(e/60);return(e-=60*n)<10&&(e="0"+e),t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n+":"+e}(n.latency)),n.learnerResponses&&a("cmi.interactions."+e+".student_response",n.learnerResponses)):(n.timestamp&&a("cmi.interactions."+e+".timestamp",function(e){var t=e.toISOString().split(".");return t.splice(t.length-1,1),t.join(".")}(n.timestamp)),n.latency&&a("cmi.interactions."+e+".latency",function(e){var t=e,n=31104e3,o=2592e3,i=Math.floor(t/n);t=e-i*n;var r=Math.floor(t/o);t=e-r*o;var a=Math.floor(t/86400);t=e-86400*a;var s=Math.floor(t/3600);t=e-3600*s;var c=Math.floor(t/60);return"P"+i+"Y"+r+"M"+a+"DT"+s+"H"+c+"M"+(t=e-60*c)+"S"}(n.latency)),n.learnerResponses&&a("cmi.interactions."+e+".learner_responses",n.learnerResponses),n.description&&a("cmi.interactions."+e+".description",n.description)),i||o()},n.setObjective=function(e,n){try{if(!scormEnabled)return}catch(e){return}for(var s=Number(r("cmi.objectives._count")),c=s,l=0;l<s;l++)i("cmi.objectives",l,"id")==e.id&&(c=l);null!=e.id&&a("cmi.objectives."+c+".id",e.id),null!=e.scoreRaw&&a("cmi.objectives."+c+".score.raw",e.scoreRaw),null!=e.scoreMin&&a("cmi.objectives."+c+".score.min",e.scoreMin),null!=e.scoreMax&&a("cmi.objectives."+c+".score.max",e.scoreMax),1.2==t?null!=e.successStatus&&a("cmi.objectives."+c+".status",e.successStatus):(null!=e.description&&a("cmi.objectives."+c+".description",e.description),null!=e.successStatus&&a("cmi.objectives."+c+".success_status",e.successStatus),null!=e.completionStatus&&a("cmi.objectives."+c+".completion_status",e.completionStatus),null!=e.scoreScaled&&a("cmi.objectives."+c+".score.scaled",e.scoreScaled)),n||o()},n.setManual=function(e,t){a(e,t),o()},n.interactionExistsOld=function(e){try{if(!scormEnabled)return}catch(e){return}for(var t=Number(r("cmi.interactions._count")),n=0;n<t;n++)if(i("cmi.interactions",n,"id")==e)return!0},n.interactionExists=function(t){try{if(!scormEnabled)return}catch(e){return}for(var n=0;n<e.length;n++)if(e[n].id==t)return!0},n.objectiveExists=function(e){try{if(!scormEnabled)return}catch(e){return}for(var t=Number(r("cmi.objectives._count")),n=0;n<t;n++)if(i("cmi.objectives",n,"id")==e)return!0};var s={version:"Auto",API:!1,scormVersions:["Auto","1.2","2004"],setAPIVersion:function(e){e=e||"Auto";var t=s.scormVersions.indexOf(e.toString());return t>-1&&(s.version=s.scormVersions[t]),s.version},getAPIVersion:function(){return s.version},isAvailable:function(){return!0},doLMSInitialize:function(){return s.cmiBooleanToJs(s.getAPICall("LMSInitialize","Initialize")(""))},doLMSFinish:function(){return s.cmiBooleanToJs(s.getAPICall("LMSFinish","Terminate")(""))},doLMSGetValue:function(e){return s.getAPICall("LMSGetValue","GetValue")(e)},doLMSSetValue:function(e,t){return s.cmiBooleanToJs(s.getAPICall("LMSSetValue","SetValue")(e,t))},doLMSCommit:function(){return s.cmiBooleanToJs(s.getAPICall("LMSCommit","Commit")(""))},doLMSGetLastError:function(){return s.getAPICall("LMSGetLastError","GetLastError")()},doLMSGetErrorString:function(e){return s.getAPICall("LMSGetErrorString","GetErrorString")(e.toString())},doLMSGetDiagnostic:function(e){return s.getAPICall("LMSGetDiagnostic","GetDiagnostic")(e.toString())},LMSIsInitialized:function(){return s.API},ErrorHandler:function(){return s.getAPICall("LMSGetLastError","GetLastError")()},cmiBooleanToJs:function(e){return"1"===e||1===e||"true"===e||!0===e},getAPIHandle:function(){var e=window;e.parent&&e.parent!=e&&s.findAPI(e.parent),!s.API&&e.top.opener?s.findAPI(e.top.opener):s.API},findAPI:function(e){for(var t=0;t<500;t++){if(e.API&&("1.2"===s.version||"Auto"===s.version)){s.API=e.API,s.version="1.2";break}if(e.API_1484_11&&("2004"===s.version||"Auto"===s.version)){s.API=e.API_1484_11,s.version="2004";break}e.parent&&e.parent!=e&&(t++,e=e.parent)}},getAPICall:function(e,t){if(!s.API&&(s.getAPIHandle(),!s.API))return function(){};switch(s.version){case"2004":return function(){return s.API[t].apply(s.API,arguments)};case"1.2":return function(){return s.API[e].apply(s.API,arguments)}}}};return n})),createService("sdk",(function(){var e={};return e.initialize=function(){},e})),createService("search",(function(){var e,t={};function n(e,o,i,r){if(e)if(0!=e.children.length){for(var a=0;a<e.children.length;a++)0!=c(e.children[a])&&(r=!1,hasClass(e.children[a],"k-section")&&virt.checkIfRequiresParse(e.children[a]),n(e.children[a],o,i,!0));r&&s(e)}else c(e)>0&&s(e);function s(e){for(var n=e,r=traverser.convertElemsToLocation([n],o).left,a='<span class="searchItem">'+n.textContent+"</span>",s=(a.toLowerCase().indexOf(t.key.toLowerCase()),a.length+Math.round((70-a.length)/2));n.previousSibling&&!(a.length>=s);)n.previousSibling.textContent&&(a=n.previousSibling.textContent+a),n=n.previousSibling;a.length;for(n=e;n.nextSibling&&!(a.length>=70);)n.nextSibling.textContent&&(a+=n.nextSibling.textContent),n=n.nextSibling;t.result[i]&&t.result[i].matches&&t.result[i].matches.push({chapter:i,elem:e,hint:a.trim(),location:r})}function c(e){var n=t.normalize(e.textContent),o=t.normalize(t.key),i="gi";return t.isMatchCase&&(i="g"),t.isExactWord?(n.match(new RegExp("^"+o+"\\s|\\s"+o+"\\s|\\s"+o+"$",i))||[]).length:(n.match(new RegExp(o,i))||[]).length}}function o(){t.result=t.cleanArr(t.result);for(var e=0,n=t.result.length;n--;)if(t.result[n])for(var o=t.result[n].matches.length;o--;)e++;return e}function i(o,i){var r=stg.data.epub.spine.getElementsByTagName("itemref");return o>r.length-1?i(!1):(o=e[o],chapters.getPageOb({page:o,dontParse:!0},(function(e){var r=document.createElement("div"),a=parseHtml(e.raw?e.raw:e.content),s=a.getElementById("epubContent");r.appendChild(s);a.getElementsByTagName("title");t.result[o]=[],t.result[o].title=e.title,t.result[o].matches=[],$filter("contentVirt")("parse",s,(function(e){n(e,e,o),i(!0)}))})))}return t.start=function(r,a){if(t.key=r.key,t.isExactWord=r.isExactWord,t.isMatchCase=r.isMatchCase,r.array?t.result=r.array:t.result=new Array,t.result=t.cleanArr(t.result),"all"==r.mode)!function(n,r){var a=0;n.start&&(a=n.start);e=function(){for(var e=[],t=stg.data.epub.spine.getElementsByTagName("itemref"),n=0;n<t.length;n++)e.push(chapters.getUnanchoredIndex(n));return e=e.filter((function(t,n){return e.indexOf(t)==n})),e}();var s=o(),c=function(e){n.limit&&o()-s>=n.limit?r({results:t.result,more:!0,key:t.key}):e?i(++a,c):r({results:t.result,key:t.key})};i(a,c)}(r,a);else if("chapter"==r.mode){var s=cache.getOb("epubContent");t.result[currentIndex]=[],t.result[currentIndex].matches=[],n(s,s,currentIndex),a({results:t.result,key:t.key})}},t.removeHighlights=function(){for(var e=document.getElementsByClassName("searchItemHighlight"),t=e.length;t--;)removeClass(e[t],"searchItemHighlight")},t.searchItemClicked=function(e,n,o){n||(n={});var i=e.item,r=e.index,a=e.matches;function s(){kStatus.update(translit.get("pleaseWait"),null,{dots:!0});var e=i.chapter,n=i.location;chapters.getPageOb({page:e},(function(o){t.removeHighlights(),kotobee.addEventListener("processedRoute",c),chapters.redirect(e,{hash:n}),$rootScope.$$phase||$rootScope.$apply()}))}function c(){kStatus.update(),kotobee.clearListeners("processedRoute"),a.index=r,$rootScope.renderScope.applyHeader("searchItems"),o&&o()}modals.hide(),n.timer?timeOut(s,300):s()},t.normalize=function(e){e=(e=(e=(e=(e=e.replace(/(ٱ|آ|إ|أ)/g,"ا")).replace(/(ة)/g,"ه")).replace(/(ئ|ؤ)/g,"ء")).replace(/(ى)/g,"ي")).replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"");for(var t=0;t<10;t++)e.replace(String.fromCharCode(1632+t),String.fromCharCode(48+t));return e},t.cleanArr=function(e){return e.filter((function(e){return e}))},t})),createService("security",(function(){var e={};return e.initialize=function(){},e.applyContextmenu=function(){config.disableContextmenu&&!window.contextMenuBlock?(window.contextMenuBlock=function(e){e.preventDefault()},document.addEventListener("contextmenu",window.contextMenuBlock)):!config.disableContextmenu&&window.contextMenuBlock&&(document.removeEventListener("contextmenu",window.contextMenuBlock),window.contextMenuBlock=null)},e})),createService("selection",(function(){var e,t,n,o,r,a,s,c,l,d,u,p,f,h,g,m,v,b,k,y,w,C={},x=-14;function I(e){return parents(e,{stopAtIds:["spreadL","spreadR"],filterByClass:"ki-noHighlight"}).length>0}C.getLocation=function(){return g},C.elementDown=function(e,t){if(!(t.touches&&t.touches.length>1)){d=e;var n=!0;mobile||("a"==e.nodeName.toLowerCase()&&(n=!1),I(e)&&(n=!1),e.parentNode&&"a"==e.parentNode.nodeName.toLowerCase()&&(n=!1),n&&addClass(e,"highlightOver")),redrawForChrome(d.parentElement);var o=mobile&&!mobileDebug?400:200;if(n||(o*=4),p&&clearTimeout(p),mobile&&!mobileDebug){if(!t.touches||!t.touches.length)return;h=t.touches[0],k=h.clientX,y=h.clientY}else k=t.clientX,y=t.clientY,h=t;p=setTimeout(C.elementHeld,o),document.body.addEventListener(mobile&&!mobileDebug?"touchend":"mouseup",C.elementUp),document.body.addEventListener(mobile&&!mobileDebug?"touchmove":"mousemove",E)}};var E=function(e){e&&e.touches&&e.touches.length>1||(h=mobile&&!mobileDebug?e.touches[0]:e,p&&(clearTimeout(p),!mobile&&d&&C.elementHeld()),"activated"==m&&e.stopPropagation())};C.elementUp=function(e){e&&e.touches&&e.touches.length>1||(d&&(mobile||removeClass(d,"highlightOver"),d=null,p&&clearTimeout(p)),w&&removeClass(cache.getOb("epubContent"),"disableEvents"),w=!1,document.body.removeEventListener(mobile&&!mobileDebug?"touchend":"mouseup",C.elementUp),document.body.removeEventListener(mobile&&!mobileDebug?"touchmove":"mousemove",E),$rootScope.$$phase||$rootScope.$apply())},C.elementHeld=function(){d&&($injector.get("nav").transforming||stg.data.pinching||h&&(Math.abs(h.clientX-k)>(mobile?30:10)||Math.abs(h.clientY-y)>(mobile?30:10)||I(d)||(addClass(d,"highlightSelected"),V(d),C.elementUp())))};var S=["p","div","ol","ul","table","h1","h2","h3","h4","h5","h6","h7","blockquote","sections","section","article","dl","form","pre","img","footer"];function T(e){r=e.parents1,a=e.parents2,s=e.index1,c=e.index2,l=e.commonParent,f=e.reversed}function O(e){return 8==e.nodeType||"#text"==e.nodeName||"br"==e.nodeName.toLowerCase()||(0==e.offsetWidth||void 0)}C.getBlocksArray=function(e){e||(e={});for(var t=document.getElementsByClassName("highlightSelected"),n=[],o={acceptNode:function(t){return t.classList.contains("noTTS")?NodeFilter.FILTER_REJECT:-1!=S.indexOf(t.nodeName.toLowerCase())?e.hasText&&!function(e){for(var t=e.getElementsByTagName("img"),n=0;n<t.length;n++)if(t[n].getAttribute("alt")&&t[n].getAttribute("alt").trim())return!0;return e.textContent.trim()}(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},i=document.createTreeWalker(cache.getOb("epubContent"),NodeFilter.SHOW_ELEMENT,o),r=i.firstChild();r;){var a=n.length?n[n.length-1].elem:null;a&&a.contains(r)&&n.pop();var s={elem:r};t&&t.length&&r.contains(t[0])&&(s.current=!0),n.push(s),r=i.nextNode()}return n},C.getSelectedText=function(e){var t=[];e||(e=document.getElementsByClassName("highlightSelected")),[].slice.call(e).forEach((function(e){t.push(e.cloneNode(!0))})),t.forEach((function(e,n){if("IMG"===e.nodeName){if(e.getAttribute("alt")){var o=document.createElement("p");o.textContent=e.getAttribute("alt"),t.splice(n,1,o)}}else[].slice.call(e.getElementsByTagName("img")).forEach((function(e){if(e.getAttribute("alt")){var t=document.createElement("p");t.textContent=e.getAttribute("alt"),e.replaceWith(t)}}))}));for(var n="",o=0;o<t.length;o++)n+=t[o].textContent;return n},C.expand=function(){n=n.parentNode,T(traverser.analyzeNodes(n,o)),n=o=l,L(),mobile&&N(),A()},C.extendRight=function(e){if(e||"rtl"!=getComputedStyle(n).direction){if(f){var t=traverser.nextTextNode(n,cache.getOb("epubContent"));if(O(n=t.parentNode))return void C.extendRight(e)}else{t=traverser.nextTextNode(o,cache.getOb("epubContent"));if(O(o=t.parentNode))return void C.extendRight(e)}T(traverser.analyzeNodes(n,o)),L(),mobile&&N(),A()}else C.extendLeft(!0)},C.extendLeft=function(e){if(e||"rtl"!=getComputedStyle(n).direction){if(f){var t=traverser.prevTextNode(n,cache.getOb("epubContent"));if(O(o=t.parentNode))return void C.extendLeft(e)}else{t=traverser.prevTextNode(n,cache.getOb("epubContent"));if(O(n=t.parentNode))return void C.extendLeft(e)}T(traverser.analyzeNodes(n,o)),L(),mobile&&N(),A()}else C.extendRight(!0)},C.newChapter=function(){mobile&&(markers.deleteMarker("anchor1Marker"),markers.deleteMarker("anchor2Marker"),e=C.createAnchorMarker("anchor1"),t=C.createAnchorMarker("anchor2"),addClass(e,"disable"),addClass(t,"disable"))};var N=function(){markers.refreshMarkerById("anchor1Marker"),markers.refreshMarkerById("anchor2Marker")},A=function(){return g=traverser.convertElemsToLocation(document.getElementsByClassName("highlightSelected"))};C.refreshSelectionLocation=A;var L=function(){try{if(P(),addClass(n,"highlightSelected"),addClass(o,"highlightSelected"),n==o)return void(g={left:traverser.getAbsoluteIndex(n)});if(n==l)return void(g={left:traverser.getAbsoluteIndex(n)});if(o==l)return void(g={left:traverser.getAbsoluteIndex(o)});B(f?o:n,f?n:o)}catch(e){}},B=function(e,t,n){var o;if(n||(n="first"),"first"==n){if(e.parentNode==l)return void B(e,t,"second");for(o=e;(o=o.nextSibling)&&o;)"#text"!=o.nodeName&&8!=o.nodeType&&addClass(o,"highlightSelected");B(e.parentNode,t,"first")}else if("second"==n){if(t.parentNode==l)return void B(e,t,"third");for(o=t;(o=o.previousSibling)&&o;)"#text"!=o.nodeName&&8!=o.nodeType&&addClass(o,"highlightSelected");B(e,t.parentNode,n)}else if("third"==n){var d,u=f?a[c-1]:r[s-1],p=f?r[s-1]:a[c-1];for(i=0;i<l.childNodes.length;i++)if(u!=l.childNodes[i]){if(p==l.childNodes[i])break;d&&"#text"!=l.childNodes[i].nodeName&&8!=l.childNodes[i].nodeType&&addClass(l.childNodes[i],"highlightSelected")}else d=!0}},P=function(){try{var e=document.getElementsByClassName("highlightSelected");if(!e)return;for(var t=e.length;t--;)removeClass(e[t],"highlightSelected");mobile&&virt.forceRepaint()}catch(e){}};function M(e){var t=1;return stg.data.book.chapter.viewport&&(t=$injector.get("nav").getFxlScale()),e.getBoundingClientRect().width/t}C.listener=null,C.addSpanAtCloseTag=function(){var e=document.createElement("span"),t=f?n:o;return t.parentNode.insertBefore(e,t.nextSibling),e},C.getSelectedNodes=function(){return document.getElementsByClassName("highlightSelected")},C.reset=function(){P(),mobile&&(e&&(addClass(e,"disable"),addClass(t,"disable")),t&&(removeClass(e,"tween"),removeClass(t,"tween"))),m=null,f=null,C.listener&&C.listener("deactivated")},C.deleteNoteMarker=function(e){var t=document.getElementById("knote"+e);t&&t.parentNode&&t.parentNode.removeChild(t),markers.deleteMarker("noteMarker"+e)},C.getNoteMarker=function(e){return markers.getMarker("noteMarker"+e)},C.createAnchorMarker=function(e){var t=document.createElement("span");return t.setAttribute("id",e+"Marker"),t.setAttribute("anchor",e),addClass(t,"anchorMarker"),cache.getOb("contentMeta").appendChild(t),t.addEventListener(mobileDebug?"mousedown":"touchstart",(function(e){(addClass(u=t,"selected"),b=null,document.body.addEventListener(mobileDebug?"mousemove":"touchmove",R),v&&clearInterval(v),v=setInterval(D,60),document.body.addEventListener(mobileDebug?"mouseup":"touchend",$),addClass(cache.getOb("epubContent"),"defaultCursor"),m="anchorDragged",mobile)&&addClass(cache.getOb("epubContainer"),"disableScroll");e.stopPropagation()})),markers.addMarker({id:e+"Marker",elem:t,offsetTop:-36,offsetLeft:x,target:function(){var t,i=0;if("anchor1"==e){if(!(t=n))return void(this.offsetLeft=x);try{r="rtl"==getComputedStyle(t).direction}catch(e){}i=f?r?0:M(t):r?M(t):0}else{if(!(t=o))return void(this.offsetLeft=x);var r;try{r="rtl"==getComputedStyle(t).direction}catch(e){}i=f?r?M(t):0:r?0:M(t)}return this.offsetLeft=x+i,t}}),t},C.createNoteMarker=function(e,t,n){if(n||(n={}),!document.getElementById("knote"+e.nid)){var o=document.createElement("span");o.setAttribute("id","knote"+e.nid),addClass(o,n.class?n.class:"contentNoteMarker"),"page"==e.type?cache.getOb("sideMeta").appendChild(o):cache.getOb("contentMeta").appendChild(o);var i=0;return i||(i=0),i=-18,markers.addMarker({id:"noteMarker"+e.nid,elem:o,offsetTop:i,target:function(){return hasClass(this.elem,"contentNoteMarker")?this.offsetLeft=M(t)-13:this.offsetLeft=0,hasClass(this.elem,"contentNoteMarker")||this.offsetTop<10&&(this.offsetTop=10),t},callback:function(){var t=this;markers.checkMarkerExistsAtSameLocation(this.elem,(function(n){return n?(t.offsetTop+=39,void markers.refreshMarker(t)):e.callback?e.callback():void 0}))}}),o}},C.deleteBookMarker=function(e){var t=document.getElementById("bookmark"+e);t&&t.parentNode&&t.parentNode.removeChild(t),markers.deleteMarker("bookMarker"+e)},C.createBookMarker=function(e,t){var n=document.createElement("span");n.setAttribute("id","bookmark"+e.bmid),addClass(n,"contentBookMarker"),cache.getOb("sideMeta").appendChild(n);var o=0;return o||(o=0),markers.addMarker({id:"bookMarker"+e.bmid,elem:n,offsetLeft:0,offsetTop:o,target:function(){return this.offsetTop<10&&(this.offsetTop=10),t},callback:function(){var t=this;markers.checkMarkerExistsAtSameLocation(this.elem,(function(n){return n?(t.offsetTop+=39,void markers.refreshMarker(t)):e.callback?e.callback():void 0}))}}),n},C.embedAnchorMarker=function(e){};var R=function(e){b=e,e.stopPropagation()},D=function(t){try{if(t&&t.stopPropagation(),mobile){if("anchorDragged"!=m)return;if(!b)return}var i;if(mobile){var r=mobileDebug?b:b.targetTouches[0];i=document.elementFromPoint(r.clientX,Math.round(r.clientY+e.offsetHeight/2))}else i=t.target;if(cache.getOb("epubContent")==i)return;if(!cache.getOb("epubContent").contains(i))return;if((i.textContent.match(new RegExp(" ","g"))||[]).length>1)return;if(mobile)if("anchor1"==u.getAttribute("anchor")){if(n==i)return;n=i}else{if(o==i)return;o=i}else o=i;T(traverser.analyzeNodes(n,o)),L(),redrawForChrome(n.parentElement),redrawForChrome(o.parentElement),mobile&&N()}catch(e){}},$=function(e){try{var t=cache.getOb("epubContainer");document.body.removeEventListener(mobile&&!mobileDebug?"touchend":"mouseup",$),mobile?(document.body.removeEventListener(mobileDebug?"mousemove":"touchmove",R),removeClass(u,"selected"),clearInterval(v),removeClass(t,"disableScroll")):t.removeEventListener("mousemove",D),removeClass(cache.getOb("epubContent"),"defaultCursor"),u=null,g=A(),m="selectionFixed",C.listener&&C.listener(m),e.stopPropagation()}catch(e){}},V=function(i){try{var r=cache.getOb("epubContainer");n=o=i,mobile?(removeClass(e,"disable"),removeClass(t,"disable"),timeOut((function(){addClass(e,"tween"),addClass(t,"tween")}),100),N()):(r.addEventListener("mousemove",D),document.body.addEventListener("mouseup",$)),A(),m="activated",C.listener&&C.listener(m)}catch(e){}};return C.active=function(){return"selectionFixed"==m||"activated"==m},C.copyToClipboard=function(e,t){if((config.clipboardCopy||t)&&(e||(e=C.getSelectedText()),e))if(isNative)$injector.get("crdv").copyToClipboard(e);else if(desktop){require("nw.gui").Clipboard.get().set(e,"text"),kStatus.showAndHide(translit.get("copiedToClipboard"),500)}else{var n=document.createElement("textarea");document.body.appendChild(n),n.value=e,n.focus(),n.select();try{document.execCommand("Copy"),$injector.get("kStatus").showAndHide(translit.get("copiedToClipboard"),500)}catch(t){$injector.get("modals").show({mode:"flashUnsupported",flashOb:{text:e}}),setTimeout((function(){document.getElementById("clipboardText").focus(),document.getElementById("clipboardText").select()}),200)}n.remove()}},C})),createService("settings",(function(){var e={};return e.pinchActive=!1,e.stylesInitialize=function(){},e.initialize=function(){e.stylingChanged(),e.lineAdjustChanged(),e.updateTextSize(),markers.refreshMarkers()},e.getTextSize=function(){return Number(stg.data.settings.textSize.slice(0,-2))},e.viewModeChanged=function(){spread.applyMode(stg.data.settings.viewMode)},e.updateTextSize=function(){try{var e=cache.getOb("epubContent"),t=cache.getOb("epubContent").style;if(t.fontSize==stg.data.settings.textSize)return;t.fontSize=stg.data.settings.textSize;for(var n=0;n<e.children.length;n++)try{e.children[n].style.fontSize="1em"}catch(e){}var o=cache.getOb("epubContainer"),i=e.parentNode.parentNode,r=i.style.webkitTransform||i.style.mozTransform||i.style.transform,a=0;overflowScroll?a=cache.getOb("epubContainer").scrollTop:r&&(a=Number(r.split(",")[1].slice(0,-2)));var s=e.offsetHeight,c=o.offsetTop,l=o.offsetHeight;s+a<l+c?virt.safeScroll("content",0,c+s-l,!0):s<l&&$ionicScrollDelegate.$getByHandle("content").scrollTop(!1),virt.reset()}catch(e){}},e.writeTextSize=function(){stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings,(function(){markers.refreshMarkers()}))},e.stylingChanged=function(){stg.data.settings.styling?cssParser.showStyles():cssParser.hideStyles(),markers.refreshMarkers()},e.saveSettings=function(){stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings)},e.langChanged=function(e){$injector.get("nav").fxlZoomFit(),stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings,(function(){translit.setLang(stg.data.settings.language,e),markers.refreshMarkers()})),backend.setLang({lang:stg.data.settings.language})},e.lineAdjustChanged=function(){stg.data.settings.lineAdjust?addClass(cache.getOb("epubContent"),"adjustedLineHeight"):removeClass(cache.getOb("epubContent"),"adjustedLineHeight"),markers.refreshMarkers()},e.sync=function(){sync.onOnline((function(){isNative?crdv.toast(translit.get("syncComplete")):modals.show({mode:"success",successOptions:{msg:translit.get("syncComplete")}})}))},e})),createService("skeleton",(function(){var e,t,n={},o=[],i=[];function r(){var e=stg.data.settings.viewMode;return"double"==e&&config.singleViewOnPortrait&&1.3*window.innerWidth<window.innerHeight&&(e="single"),e}function a(e){e||(e={}),o=[],e.firstBone||(e.firstBone=s());for(var t=e.firstBone,n=r(),i=e.lastJoint;t;){var a=[];if(t.joint=a,"single"==n?a.push(t):"double"==n?(a.push(t),i&&delete t.alone,t.alone||t.index>=config.firstDoublePage&&t.next&&(a.push(t=t.next),t.joint=a)):"auto"==n&&a.push(t),i&&(a.prev=i,i.next=a),o.push(a),i=null,t.next&&(i=a),e.lastBone==t)break;t=l(t,e)}return o[o.length-1]}function s(e){var t;e||(e=0);for(var n=0;n<i.length;n++)i[n].index<e||(t?(i[n].index<t.index||i[n].index==t.index&&i[n].vIndex<t.vIndex)&&(t=i[n]):t=i[n]);return t}function c(e){for(var t,n=0;n<i.length;n++)i[n].index>e||(t?(i[n].index>t.index||i[n].index==t.index&&i[n].vIndex>t.vIndex)&&(t=i[n]):t=i[n]);return t}function l(e,t){return t||(t={}),e.next?e.next:t.connectedOnly?void 0:d(e.index+1)}function d(e){var t,o,i=c();if(i)for(;e<=i.index;){if(t&&(e=t.index+1),o=n.getBone(e))return o;t=null,e++}}function u(e){var t=d(e);if(t)return t.joint}function p(e,t){var n;for(t||(t="");e;)t+=e.index+"."+e.vIndex,n=e,(e=e.next)&&(t+="->");return n}function f(e,t){var n;for(t||(t="");e;){t+=" [";for(var o=0;o<e.length;o++)t+=e[o].index+"."+e[o].vIndex+",";t=t.substr(0,t.length-1)+"]",n=e,(e=e.next)&&(t+="->")}return n}return n.reset=function(){i=[],o=[]},n.initialize=function(e){n.reset(),e||(e={});for(var t=e.first;t<e.last;t++)n.add({index:t})},n.trace=function(){var e=-1;for(;;){var t=d(e+1);if(!t)break;e=p(t).index}var n=-1;for(;;){var o=u(n+1);if(!o)break;var i=f(o);n=i[i.length-1].index}},n.add=function(e){var t,o,s,c,l=n.getBone(e.index);if(l){var d=e.pages&&e.pages.length;if(l.total&&d)return;if(!l.total&&!d)return;n.remove(l)}if(e.pages&&e.pages.length)for(var u=0;u<e.pages.length;u++)(c={}).index=e.index,c.vIndex=u,c.total=e.pages.length,t&&(c.prev=t,t.next=c),i.push(c),t=c,0==u&&(o=c),u==e.pages.length-1&&(s=c);else(c={}).index=e.index,c.vIndex=null,i.push(c),o=s=c;!function(e,t){var o=n.getBone(e.index-1);if(o){var i=o;o.total>1&&(i=n.getBone(e.index-1,o.total-1)),i.next=e,e.prev=i}var s,c=n.getBone(t.index+1);c&&(c.prev=t,t.next=c);if("double"==r()){var l=n.getJoint(e.index-1),d=n.getJoint(t.index+1);if(l)return void a();var u=t.total?t.total:1;if(d&&1==d.length&&d[0].index>=config.firstDoublePage&&(s=!0),d){var p;if(s||u%2==0&&(p=!0),s&&u%2==1&&(p=!0),p)return void a();e.alone=!0}}a()}(o,s)},n.remove=function(e){e.prev&&e.prev.next&&(e.prev.next=null),e.next&&e.next.prev&&(e.next.prev=null);for(var t=0;t<i.length;t++)if(i[t]==e)return void i.splice(t,1)},n.getBone=function(e,t){for(var n=0;n<i.length;n++)if(i[n].index==e){if(null==t)return i[n];if(i[n].vIndex==t)return i[n]}},n.normalize=function(e){if("double"==n.getCurrentView(e.index,e).view&&"rfl"!=e.layout)if(null!=e.vIndex){var t=n.getJoint(e.index,e.vIndex);if(t){var o=t[0].index,i=t[0].vIndex;(o!=e.index||null!=i&&i!=e.vIndex)&&(e.index=o,null!=i&&(e.vIndex=i))}}else(e.index-config.firstDoublePage)%2==1&&e.index--},n.getJoint=function(e,t){for(var n=0;n<o.length;n++)for(var i=0;i<o[n].length;i++)if(o[n][i].index==e){if(t<=-1&&o[n][i].total&&(t+=o[n][i].total),null==t)return o[n];if(null==o[n][i].vIndex)return o[n];if(o[n][i].vIndex==t)return o[n]}},n.nextJoint=function(e,t){var o=n.getBone(e,t);if(o){var i=o.joint.next;if(i)return{index:i.index,vIndex:i.vIndex}}},n.prevJoint=function(e,t){var o=n.getBone(e,t);if(o){var i=o.joint.prev;if(i)return{index:i.index,vIndex:i.vIndex}}},n.getNextLinearIndex=function(t,o){var i=stg.data.epub.spine.getElementsByTagName("itemref"),r=i[t.index];e||(e=r.getAttribute("idref")),n.getNextIndex(t,(function(r){if(!r)return o({leftOb:t});if(r.leftOb.index>=i.length-1)return o(r);var a=i[r.leftOb.index];if(a){if(null==r.leftOb.vIndex&&a.getAttribute("idref")==e)return n.getNextLinearIndex({index:r.leftOb.index,vIndex:r.leftOb.vIndex},o);if("no"==a.getAttribute("linear"))return n.getNextLinearIndex({index:r.leftOb.index,vIndex:r.leftOb.vIndex},o)}return e=null,o(r)}))},n.getNextIndex=function(e,t){var o={},i=n.getJoint(e.index,e.vIndex);return i?(i&&i.next?o.leftOb={index:i.next[0].index,vIndex:i.next[0].vIndex}:o.leftOb={index:i[i.length-1].index+1,vIndex:0},t&&t(o),o):t?t():null},n.getPrevLinearIndex=function(e,o){if(0==e.index){if(null==e.vIndex)return o({leftOb:e});if(0==e.vIndex)return o({leftOb:e})}var i=stg.data.epub.spine.getElementsByTagName("itemref"),r=i[e.index];t||(t=r.getAttribute("idref")),n.getPrevIndex(e,(function(r){if(!r)return o({leftOb:e});var a=i[r.leftOb.index];if(a){if(null==r.leftOb.vIndex&&a.getAttribute("idref")==t)return n.getPrevLinearIndex({index:r.leftOb.index,vIndex:r.leftOb.vIndex,source:"first"},o);if("no"==a.getAttribute("linear"))return n.getPrevLinearIndex({index:r.leftOb.index,vIndex:r.leftOb.vIndex,source:"second"},o)}return t=null,o(r)}))},n.getPrevIndex=function(e,t){var o={},i=n.getJoint(e.index,e.vIndex);return i?(i&&i.prev?o.leftOb={index:i.prev[0].index,vIndex:i.prev[0].vIndex}:(o.leftOb={index:i[0].index-1,vIndex:-1},o.leftOb.index<0&&(o.leftOb.index=0),o.leftOb.vIndex<0&&(o.leftOb.vIndex=null==e.vIndex?null:0)),t&&t(o),o):t?t():null},n.isSingle=function(e,t){var o=n.getJoint(e,t);if(o)return 1==o.length},n.getCurrentView=function(e,t){var o=n.getJoint(e,t.vIndex);if(o){var i={};return i.view=1==o.length?"single":"double",i.index=e,i}},n.isLastChapter=function(e,t){e||(e={});var o=null==e.index?currentIndex:e.index,i=null==e.vIndex?currentVIndex:e.vIndex;return t(n.getJoint(o,i)==c(e.last).joint)},n.isFirstChapter=function(e,t){return e||(e={}),t(n.getJoint(currentIndex,currentVIndex)==s(e.first).joint)},n.isNeighbor=function(e,t){for(var o=n.getJoint(currentIndex,currentVIndex),i=o.next,r=o.prev,a=0;a<2;a++){var s=[i,r][a],c=["next","prev"][a];if(s)for(var l=0;l<s.length;l++)if(s[l].index==e.index){if(null==s[l].vIndex)return t(c);if(s[l].vIndex==e.vIndex)return t(c)}}t()},n})),createService("sleep",(function(){var e={};function t(){var e=document.getElementById("preventSleepingContainer");if(e){var t=e.getElementsByTagName("video")[0];if(t)return t}return null}return e.initialize=function(){config&&config.noSleep&&(!function(){isKotobee&&void 0!==kotobee?kotobee.addEventListener("chapterLoaded",(function(){e.enableSleep()})):window.addEventListener("load",(function(){e.enableSleep()}));document.addEventListener("resume",(function(){e.enableSleep()}))}(),initializer.initialized?e.setup():kotobee.addEventListener("initialized",e.setup))},e.setup=function(){var e="preventSleepingContainer",t=" !important;",n="position: absolute"+t,o="top: 0px"+t,i="left: 0px"+t,r="width: 1px"+t,a="height: 1px"+t,s="display: inline-block"+t,c="z-index: -2"+t;if(!document.getElementById(e)){var l=document.createElement("div");l.id=e,l.style.cssText=n+o+i+s+c;var d=document.createElement("video");d.loop=!0,d.autoplay=!0,d.muted=!0,d.playsInline=!0,d.setAttribute("webkit-playsinline","true"),d.style.cssText=r+a;var u=document.createElement("source");u.setAttribute("src",rootDir+"img/ui/blank_vid.mp4"),u.setAttribute("type","video/mp4"),d.appendChild(u),l.appendChild(d),setTimeout((function(){document.body.appendChild(l)}),500)}},e.enableSleep=function(){var e=t();e&&e.play()},e.disableSleep=function(){var e=t();e&&e.pause()},e})),createService("spread",(function(){var e={};function t(e,t){if(t||(t={}),!e.childNodes.length)return!1;if(t.supportsPageBreakStyles){if(n(e,{deep:!1}))return!1;if(e.style&&("avoid"==e.style.pageBreakInside||"avoid"==getComputedStyle(e).pageBreakInside))return!1}if(e.className.indexOf&&e.className.indexOf("kInteractive")>=0){if(hasClass(e,"video"))return!1;if(hasClass(e,"gallery"))return!1;if(hasClass(e,"audio"))return!1;if(hasClass(e,"widget"))return!1;if(hasClass(e,"widget"))return!1;if(hasClass(e,"threed"))return!1}return!0}function n(e,t){t||(t={});try{if("span"==e.nodeName.toLowerCase())return!1;if(e.style){if("always"==e.style.pageBreakBefore||"always"==getComputedStyle(e).pageBreakBefore)return e;if(e.previousSibling&&e.previousSibling.nodeName&&"span"!=e.previousSibling.nodeName.toLowerCase()&&e.previousSibling.style&&("always"==e.previousSibling.style.pageBreakAfter||"always"==getComputedStyle(e).pageBreakAfter))return e}if(t.deep)for(var o=0;o<e.childNodes.length;o++){var i=n(e.childNodes[o],t);if(i)return i}}catch(e){}return!1}function o(e,t,n){var o=getFilteredChildIndex(t);if(o>0){var i=e.parentNode,r=getFilteredChildIndex(e);o!=r&&(i.getAttribute("kb-offset")||i.setAttribute("kb-offset",o-r))}}return e.initialize=function(){},e.applyMode=function(t){"double"==t?e.activateDblPage():"single"==t?e.activateSinglePage():"auto"==t&&e.activateAutoPage()},e.activateSinglePage=function(){if(chapters.shouldBePaged(stg.data.currentPageOb))chapters.regenerateSpreads();else{chapters.resetPages({buildChapterMode:!0});var e={viewMode:"single",reload:!0};chapters.loadChapterByIndex(currentIndex,e,(function(){}))}},e.activateDblPage=function(){if(chapters.shouldBePaged(stg.data.currentPageOb))chapters.regenerateSpreads();else{chapters.resetPages({buildChapterMode:!0});var e={viewMode:"double",reload:!0};chapters.loadChapterByIndex(currentIndex,e,(function(){}))}},e.activateAutoPage=function(){"double"==chapters.getCurrentView(currentIndex,{vIndex:currentVIndex}).view?e.activateDblPage():e.activateSinglePage()},e.getViewport=function(e){e||(e={});var t=document.getElementById("readerBody"),n=document.getElementById("readerHeader"),o=document.getElementById("tabMenu"),i=t.getBoundingClientRect().width,r=t.getBoundingClientRect().height;mobile&&"alwaysShow"!=config.autohideReaderMode&&"showOnScroll"!=config.autohideReaderMode&&"showOnTap"!=config.autohideReaderMode||(r-=n.getBoundingClientRect().height+o.getBoundingClientRect().height);var a=chapters.getCurrentView(e.index,{vIndex:e.vIndex});a||(a={view:"double"});var s={},c=config.spreadSpacing?config.spreadSpacing:0;return"double"==a.view?s.width=Math.round((i-c)/2):(s.width=i,"double"==stg.data.settings.viewMode&&(s.width=i/2),1.3*window.innerWidth<window.innerHeight&&(s.width=i)),s.height=r,s},e.parseReflowableChapter=function(i,r){i.raw&&!i.pages&&(i.content=i.raw),$injector.get("context").simulateChapter(i,(function(a){var s=e.getViewport(i),c={pages:[]};c.pageWidth=s.width,c.pageHeight=s.height,c.url=i.url,c.index=i.index,a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.zIndex=-1,a.style.visibility="hidden",a.setAttribute("data-index",c.index),document.body.appendChild(a),a.addEventListener("error",(function(e){})),a.addEventListener("load",(function(){var e=a.contentDocument.documentElement,i=e.getElementsByTagName("body")[0];i.style.width=s.width+"px",i.style.height=2*s.height+"px";var l=e.getElementsByTagName("style")[0].innerHTML;c.supportsPageBreakStyles=l.indexOf("page-break-after")>=0||l.indexOf("page-break-before")>=0;var d=a.contentDocument.getElementById("spreadR");d&&d.parentNode.removeChild(d),a.contentDocument.getElementById("epubScroller").style.overflowY="hidden";var u=a.contentDocument.getElementById("epubContent"),p=u.outerHTML;$filter("contentVirt")("parse",u,(function(){var e=function(e,i){i.pages||(i.pages=[]);i.index||(i.index=0);i.lastStop||(i.lastStop=document.createElement("div"));var r=i.lastStop,a=[];e.style.width=i.pageWidth+"px";var s=e,c=0,l=config.spreadTopMargin?Number(config.spreadTopMargin):0,d=config.spreadBottomMargin?Number(config.spreadBottomMargin):0;c+=l+d;var u=i.pageHeight,p=getElemMargin(e,{computed:!0}),f=getElemPadding(e,{computed:!0}),h=p.top,g=p.bottom,m=f.top,v=f.bottom;"auto"==h&&(h=0);"auto"==g&&(g=0);"auto"==m&&(m=0);"auto"==v&&(v=0);h||(h=0);g||(g=0);m||(m=0);v||(v=0);p=Number(p),f=Number(f);var b=h+m,k=g+v,y=traverseToBottom(e,"epubContent");for(;;){if(!s||8==s.nodeType){if("continue"==E())continue;break}var w=getBoundingBox(s);if(w.bottom<u-k){if(i.supportsPageBreakStyles&&n(s,{deep:!0})){if(I(s,{src:"breakStyle"}),u=w.bottom+i.pageHeight-b-k-c,"break"==E())break;continue}var C=s.cloneNode(!0);if(r.appendChild(C),a.length&&o(C,s,"less"),"break"==E())break}else if(t(s,i)){C=cloneNodeAttributes(s);r.appendChild(C),a.length&&o(C,s,"canDigInside"),r=r.childNodes[r.childNodes.length-1],s=s.childNodes[0]}else if(I(s,{src:"end"}),"break"==E())break}function x(e){if(!e)return"";i.url;for(var t=getElementsByAttribute(e,"*","src"),n=0;n<t.length;n++){t[n].getAttribute("src");0}return e.outerHTML}function I(e,t){t||(t={}),u=w.top+i.pageHeight-b-k-c,r&&a.push({content:x(traverseToTop(r,"epubContent")),lastLocation:traverser.convertElemsToLocation([e],y).left}),r=function(e,t){t||(t={});var n,i=parents(e);for(var r=0;r<i.length-1;r++)if("#document"!=i[r].nodeName.toLowerCase()&&"html"!=i[r].nodeName.toLowerCase()){var a=cloneNodeAttributes(i[r]);if(n){var s=a.nodeName.toLowerCase();"p"==s&&r!=i.length-1&&(a.style.textIndent="initial"),"li"==s&&"ol"==n.nodeName.toLowerCase()&&(n.setAttribute("start",getListIndex(i[r])+1),a.style.listStyle="none"),n.appendChild(a),o(a,i[r],"duplicate"),n=n.childNodes[0]}else n=a}return n}(e,{markOffset:!0}),r.appendChild(e.cloneNode(!0))}function E(e){return s.nextSibling?(s=s.nextSibling,"sibling"):s.parentNode&&"body"!=s.nodeName.toLowerCase()?(s=s.parentNode,r=r.parentNode?r.parentNode:traverseToBottom(r,"epubContent"),E()):(r&&a.push({content:x(traverseToTop(r,"epubContent"))}),"break")}if(1==a.length){s=traverseToBottom(e,"epubContent");a[0].content=x(s)}return a}(i,c);var a={};a.pages=e,a.raw=p,a.viewport=s,r(a)}))}))}))},e})),createService("sso",(function(){var e,t={},n=["facebook","google","auth0"],o="http://localhost:8100";function i(e){config.kotobee.sso[e]&&(stg.data.sso[e]=!0,stg.data.sso[e+"Logo"]=rootDir+"img/ui/sso/"+e+".png")}function r(e){if(!stg.data.sso.oauth)return null;var t=Object.assign({},stg.data.sso.oauth);return t.provider==e?t:null}function a(e,t){var n=getBaseSuffix();return isNative&&(n=o,n+=window.location.pathname),t||(n+=function(e){return"?provider="+e}(e)),config.ssoRedirectUrl&&(localStorage.kotobeeRedirect=JSON.stringify({url:n.split("?")[0],provider:e}),n=config.ssoRedirectUrl),n}function s(e,t){if(isNative){if(cordova.InAppBrowser){if(e.provider&&-1!=n.indexOf(e.provider))return cordova.InAppBrowser.open(e.url,"_system","location=yes"),void window.addEventListener("cordovaHandleOpenUrl",(function(e){if(e&&e.detail&&t){var n=new URL(e.detail);t(n)}}),{once:!0});var i=cordova.InAppBrowser.open(e.url,"_blank",e.options);i.addEventListener("loadstart",(function(e){if(0===e.url.indexOf(o)){i.close();var n=new URL(e.url);t&&t(n)}})),i.addEventListener("loaderror",(function(e){if(!ios)try{i&&i.close()}catch(e){}})),i.addEventListener("exit",(function(e){}))}}else window.location.replace(e.url)}return t.initialize=function(t){e=ios?"yes":"no",stg.data.sso||(stg.data.sso={}),Object.keys(config.kotobee.sso).forEach(i),t&&t()},t.setTokens=function(e,t,n){stg.data.sso||(stg.data.sso={});var o={provider:e,idToken:t,accessToken:n};stg.data.sso.oauth=o},t.getSSOEmail=function(e,n){var o=r(e);if(o)switch(e){case"facebook":var i={fields:"id,email",access_token:o.accessToken};$injector.get("backend").sendRawPost("https://graph.facebook.com/v7.0/me",i,{ignoreCredentials:!0,queryString:!0,responseType:"json"},(function(t){if(t){var o=t.email;Vue.set(stg.data.user,"email",o),Vue.set(stg.data.user,"loggedIn","string"==typeof t.email),o||kError.update({error:"ssoEmailError",provider:e.toCamelCase()}),n(o)}else n()}));break;case"microsoft":if(o.idToken){var a=t.parseJWT(o.idToken);a&&a.email&&Vue.set(stg.data.user,"email",a.email)}default:n()}else n()},t.signInBrowser=function(o,i){var r,c,l;switch(o){case"okta":r=("/"==config.kotobee.sso[o].params.domain.slice(-1)?config.kotobee.sso[o].params.domain.slice(0,-1):config.kotobee.sso[o].params.domain)+"/oauth2/default/v1/authorize";break;case"google":r="https://accounts.google.com/o/oauth2/v2/auth";break;case"microsoft":r="https://login.microsoftonline.com/common/oauth2/v2.0/authorize";break;case"facebook":r="https://www.facebook.com/v7.0/dialog/oauth",c="token",l="public_profile email";break;case"auth0":r="https://"+config.kotobee.sso[o].params.domain.replace(/http[s]?:\/\//g,"")+"/authorize";break;case"fusionauth":r="https://"+config.kotobee.sso[o].params.domain.replace(/http[s]?:\/\//g,"")+"/oauth2/authorize"}c=encodeURIComponent(c||"token id_token"),l=encodeURIComponent(l||"openid profile email");var d=randStr(11,""),u=a(o);"microsoft"==o&&(u=u.replace(/\/\?.*/,"/")),isNative&&-1!=n.indexOf(o)&&(u=config.kotobee.liburl+"sso/index.html?provider="+o);var p="";if(isNative)try{p="-appid-"+BuildInfo.packageName.replace(/\./g,"")}catch(e){p=""}var f=r+"?client_id="+config.kotobee.sso[o].params.clientid+"&response_type="+c+"&scope="+l+"&state="+uuid+p+"&nonce="+d+"&redirect_uri="+encodeURIComponent(u);if("fusionauth"===o)config.kotobee.sso[o].params.tenantid&&(f+="&tenant_id="+config.kotobee.sso[o].params.tenantid);s({url:f,options:"location=no,hidden=no,clearsessioncache=yes,clearcache=yes,closebuttoncaption=Go back to App,toolbar="+e+",presentationstyle=formsheet",provider:o},(function(e){var n=new URLSearchParams(e.hash.slice(1));if(n.get("state").split("-appid-")[0]!=uuid);else{var r=n.get("access_token")||"",a=n.get("id_token")||"";if(t.setTokens(o,a,r),a){var s=t.parseJWT(a);s&&s.nonce!=d||i&&(i(o,s.email,r,a),modals.hide(),$location.path("/loading"),$ionicHistory.clearHistory(),auth.startup())}else if(r&&"facebook"===o)t.getSSOEmail(o,(function(e){e?i&&(i(o,e,r,a),modals.hide(),$location.path("/loading"),$ionicHistory.clearHistory(),auth.startup()):(modals.hide(),kError.update({error:"ssoEmailError",provider:o.toCamelCase()}))}))}}))},t.signOutBrowser=function(e){var t="location=no,hidden=yes",n=r(e);if(n)switch(e){case"okta":s({url:o=("/"==config.kotobee.sso[e].params.domain.slice(-1)?config.kotobee.sso[e].params.domain.slice(0,-1):config.kotobee.sso[e].params.domain)+"/oauth2/default/v1/logout?id_token_hint="+n.idToken+"&state="+uuid+"&post_logout_redirect_uri="+encodeURIComponent(a(e,!0)),options:t});break;case"google":$injector.get("backend").sendRawPost("https://oauth2.googleapis.com/revoke",{token:n.accessToken},{ignoreCredentials:!0},(function(e){isNative||(delete stg.data.sso.oauth,$injector.get("login").toLoginScreen())}));break;case"microsoft":isNative||(delete stg.data.sso.oauth,$injector.get("login").toLoginScreen());break;case"facebook":$injector.get("backend").sendRawPost("https://graph.facebook.com/v7.0/me/permissions",{token:n.accessToken},{method:"delete",ignoreCredentials:!0},(function(e){isNative||(delete stg.data.sso.oauth,$injector.get("login").toLoginScreen())}));break;case"auth0":"/"==config.kotobee.sso[e].params.domain.slice(-1)?config.kotobee.sso[e].params.domain.slice(0,-1):config.kotobee.sso[e].params.domain;s({url:o="https://"+config.kotobee.sso[e].params.domain+"/v2/logout?client_id="+config.kotobee.sso[e].params.clientid+"&returnTo="+a(e,!0),options:t});break;case"fusionauth":"/"==config.kotobee.sso[e].params.domain.slice(-1)?config.kotobee.sso[e].params.domain.slice(0,-1):config.kotobee.sso[e].params.domain;var o="https://"+config.kotobee.sso[e].params.domain+"/oauth2/logout?client_id="+config.kotobee.sso[e].params.clientid+"&post_logout_redirect_uri="+a(e,!0);config.kotobee.sso[e].params.tenantid&&(o+="&tenant_id="+config.kotobee.sso[e].params.tenantid),s({url:o,options:t})}},t.parseJWT=function(e){var t=e.split(".")[1];if(t){var n=t.replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(n).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(o)}},t})),createService("stg",(function(){var e={data:{},view:{}};return e.initialize=function(){vueExclude&&($rootScope.data=e.data,$rootScope.view=e.view),e.reset(),e.setLanguages(),e.setSort(),preview&&e.clearSlots()},e.initializeSettings=function(t){try{e.readSlot("settings"+e.getBookId(!0),(function(t){Vue.set(e.data,"settings",t),0==e.data.settings.length&&Vue.set(e.data,"settings",{}),n()}))}catch(t){Vue.set(e.data,"settings",{}),n()}function n(){e.applyDefaultSettings();try{if(config.defaultLanguage&&(Vue.set(e.data.settings,"language",config.defaultLanguage),e.langChanged()),Vue.set(e.data.settings,"navAnim",config.defaultNavAnim?config.defaultNavAnim:"navBookBlock"),Vue.set(e.data.settings,"viewMode",config.defaultViewMode?config.defaultViewMode:"auto"),Vue.set(e.data.settings,"pageScroll",null==config.defaultPageScroll||config.defaultPageScroll),!preview)return void e.readSlot("settings"+e.getBookId(!0),(function(n){n&&(n.language&&config.languageOptional&&(Vue.set(e.data.settings,"language",n.language),e.langChanged()),n.navAnim&&Vue.set(e.data.settings,"navAnim",n.navAnim),n.viewMode&&Vue.set(e.data.settings,"viewMode",n.viewMode)),config.forcedLanguage&&(Vue.set(e.data.settings,"language",config.forcedLanguage),e.langChanged()),config.forcedViewMode&&Vue.set(e.data.settings,"viewMode",config.viewMode=config.forcedViewMode),config.forcedNavAnim&&Vue.set(e.data.settings,"navAnim",config.navAnim=config.forcedNavAnim),t&&t()}))}catch(e){}t&&t()}},e.langChanged=function(){"ar"==e.data.settings.language?Vue.set(e.data.settings,"rtl",!0):Vue.set(e.data.settings,"rtl",!1)},e.reset=function(){e.resetBook(),e.resetLibrary()},e.setSort=function(){var t={method:null,model:"default",options:[{name:"default",data:"default",dir:"asc",val:"default"},{name:"dateAddedNewestFirst",data:"date",dir:"desc",val:"dateDesc"},{name:"dateAddedOldestFirst",data:"date",dir:"asc",val:"dateAsc"},{name:"titleA-Z",data:"name",dir:"asc",val:"titleAsc"},{name:"titleZ-A",data:"name",dir:"desc",val:"titleDesc"},{name:"categoryA-Z",data:"cat",dir:"asc",val:"catAsc"},{name:"categoryZ-A",data:"cat",dir:"desc",val:"catDesc"},{name:"viewsHighestFirst",data:"views",dir:"desc",val:"viewsDesc"},{name:"viewsLowestFirst",data:"views",dir:"asc",val:"viewsAsc"},{name:"ratingHighestFirst",data:"rating",dir:"desc",val:"ratingAsc"},{name:"ratingLowestFirst",data:"rating",dir:"asc",val:"ratingDesc"}]};Vue.set(e.data,"sortOb",t)},e.setLanguages=function(){var t=[{label:"English",val:"en"},{label:"Français",val:"fr"},{label:"Español",val:"es"},{label:"Português",val:"pt"},{label:"Nederlands",val:"nl"},{label:"Deutsch",val:"de"},{label:"Magyar",val:"hu"},{label:"Italiano",val:"it"},{label:"Svenska",val:"sw"},{label:"Melayu",val:"ms"},{label:"Norsk",val:"no"},{label:"Polski",val:"pl"},{label:"Român",val:"ro"},{label:"Pусский",val:"ru"},{label:"Türkçe",val:"tr"},{label:"Cymraeg",val:"cy"},{label:"العربية",val:"ar"},{label:"汉语",val:"zh-cn"},{label:"漢語",val:"zh-tw"},{label:"日本語",val:"jp"},{label:"한국어",val:"ko"}];if(config.languageAllowed)for(var n=t.length;n--;)existsInArray(t[n].val,config.languageAllowed)||t.splice(n,1);Vue.set(e.data,"languages",t)},e.resetBook=function(){Vue.set(e.data,"epub",{}),Vue.set(e.data,"toc",""),Vue.set(e.data,"mediaList",[]),Vue.set(e.data,"packageURL",""),Vue.set(e.data,"book",{}),Vue.set(e.data.book,"chapter",{}),Vue.set(e.data,"chromeAssets",[])},e.resetLibrary=function(){Vue.set(e.data,"downloaded",[]),Vue.set(e.data,"favorites",[]),Vue.set(e.data,"currentLibrary",{})},e.applyDefaultSettings=function(){e.data.settings&&(e.data.settings.styling||Vue.set(e.data.settings,"styling",!0),e.data.settings.textSize||Vue.set(e.data.settings,"textSize","1em"),e.data.settings.lineAdjust||Vue.set(e.data.settings,"lineAdjust",!0),e.data.settings.language||Vue.set(e.data.settings,"language","en"),e.data.settings.visualizerStyle||Vue.set(e.data.settings,"visualizerStyle","lines"),"curves"==e.data.settings.visualizerStyle&&(e.data.settings.visualizerStyle="lines"),null==config.viewModeOptional&&(config.viewModeOptional=!0),null==config.pageScrollOptional&&(config.pageScrollOptional=!0),null==config.navAnimOptional&&(config.navAnimOptional=!0),null==config.languageOptional&&(config.languageOptional=!0))},e.getBookId=function(t){if(!config.kotobee.cloudid){var n,o="",i="";try{n=e.data.book.meta.dc.identifier}catch(e){}if(desktop){var r=require("nw.gui");i=n||r.App.manifest.name+(r.App.manifest.rand?r.App.manifest.rand:"")}else if(isNative)i=n||(cordova.rand?cordova.rand:"");else{i=(i=(i=(i=location.href.split("#")[0]).replace("https://","http://")).replace("http://www.","http://")).replace("http://","");try{o=t?"":n||e.data.book.meta.dc.title}catch(e){}}var a="_"+(i+o).replace(/[\/\s:#]/g,"");return config.ignoreQueryStringInLocalStorage&&(a=a.replace(/\?.*/g,"")),a}return"book"==config.kotobee.mode?"_"+config.kotobee.cloudid:"library"==config.kotobee.mode?"_"+config.kotobee.cloudid+"_"+(t?"":e.data.book?e.data.book.id:""):void 0},e.isManipulated=function(t){if(!t.file&&t.chapter==currentIndex&&t.chaptername!=e.data.currentPageOb.title)return!0;if(ph.removeExtension(t.file)==ph.removeExtension(e.getChapterFilename())){if(t.chapter!=currentIndex)return!0;if(t.chaptername!=e.data.currentPageOb.title)return!0}},e.isManipulatedOld=function(t){var n=0;return t.chapter!=currentIndex&&n++,t.chaptername!=e.data.currentPageOb.title&&n++,"library"==config.kotobee.mode&&t.file!=e.getChapterFilename()&&n++,1==n||2==n},e.addBookmark=function(t,n){e.readSlot("bookmark"+e.getBookId(),(function(o){var i=o;function r(o){o&&(i=o),t.chapter=currentIndex,t.chaptername||(t.chaptername=e.data.currentPageOb.title),t.file||(t.file=e.getChapterFilename()),t.cloudid=config.kotobee.cloudid,i.push(t),e.writeSlot("bookmark"+e.getBookId(),i,(function(){return sync.queue("bookmark/add",t),n&&n(!0),!0}))}null!=t.bmid?e.deleteBookmark(t.bmid,null,r):e.uniqueId(i,"bmid",(function(e){t.bmid=e,r()}))}))},e.getChapterFilename=function(){var t;try{t=e.data.book.chapter.url}catch(n){t=e.data.currentPageOb.url.replace(/.*?\/(xhtml\/.*)/g,"$1")}return t.substr(0,60)},e.getBookmarks=function(t){e.readSlot("bookmark"+e.getBookId(),(function(e){t&&t(e)}))},e.deleteBookmark=function(t,n,o){e.readSlot("bookmark"+e.getBookId(),(function(i){for(var r=0;r<i.length;r++)if(i[r].bmid==t){var a=i[r];return i.splice(r,1),void e.writeSlot("bookmark"+e.getBookId(),i,(function(){n||sync.queue("bookmark/delete",a),o&&o(i)}))}o&&o(i)}))},e.addSketch=function(t,n){try{e.readSlot("sketch"+e.getBookId(),(function(o){function i(i){i&&(o=i),null==t.chapter&&(t.chapter=currentIndex),t.chaptername||(t.chaptername=e.data.currentPageOb.title),t.file||(t.file=e.getChapterFilename()),t.cloudid=config.kotobee.cloudid;var r={};for(var a in t)"event"!=a&&(r[a]=t[a]);o.push(r),e.writeSlot("sketch"+e.getBookId(),o,(function(){return sync.queue("freehand/add",r),n&&n(!0),!0}))}null!=t.id?e.deleteSketch(t.id,null,i):i()}))}catch(e){}return!0},e.getSketches=function(t){e.readSlot("sketch"+e.getBookId(),(function(e){t&&t(e)}))},e.deleteSketch=function(t,n,o){e.readSlot("sketch"+e.getBookId(),(function(i){for(var r=0;r<i.length;r++)if(i[r].id==t){var a=i[r];return i.splice(r,1),void e.writeSlot("sketch"+e.getBookId(),i,(function(){n||sync.queue("freehand/delete",a),o&&o(i)}))}o&&o(i)}))},e.deleteNote=function(t,n,o){e.readSlot("note"+e.getBookId(),(function(i){for(var r=0;r<i.length;r++)if(i[r].nid==t){var a=i[r];return i.splice(r,1),void e.writeSlot("note"+e.getBookId(),i,(function(){n||sync.queue("note/delete",a),o&&o(i)}))}o&&o(i)}))},e.addNote=function(t,n){try{e.readSlot("note"+e.getBookId(),(function(o){function i(i){i&&(o=i),null==t.chapter&&(t.chapter=currentIndex),t.chaptername||(t.chaptername=e.data.currentPageOb.title),t.file||(t.file=e.getChapterFilename()),t.cloudid=config.kotobee.cloudid;var r={};for(var a in t)"event"!=a&&(r[a]=t[a]);o.push(r),e.writeSlot("note"+e.getBookId(),o,(function(){return sync.queue("note/add",r),n&&n(!0),!0}))}null!=t.nid?e.deleteNote(t.nid,null,i):e.uniqueId(o,"nid",(function(e){t.nid=e,i()}))}))}catch(e){}return!0},e.getNotes=function(t){e.readSlot("note"+e.getBookId(),t)},e.deleteHlight=function(t,n,o){e.readSlot("hlight"+e.getBookId(),(function(i){for(var r=0;r<i.length;r++)if(i[r].hid==t){var a=i[r];return i.splice(r,1),void e.writeSlot("hlight"+e.getBookId(),i,(function(){n||sync.queue("hlight/delete",a),o&&o(i)}))}o&&o(i)}))},e.addHlight=function(t,n){e.readSlot("hlight"+e.getBookId(),(function(o){function i(i){i&&(o=i),null==t.chapter&&(t.chapter=currentIndex),t.chaptername||(t.chaptername=e.data.currentPageOb.title),t.file||(t.file=e.getChapterFilename()),t.cloudid=config.kotobee.cloudid,o.push(t),e.writeSlot("hlight"+e.getBookId(),o,(function(){return sync.queue("hlight/add",t),n&&n(!0),!0}))}null!=t.hid?e.deleteHlight(t.hid,null,i):e.uniqueId(o,"hid",(function(e){t.hid=e,i()}))}))},e.getHlightById=function(t,n){e.getHlights((function(e){for(var o=0;o<e.length;o++)if(e[o].hid==t)return n&&n(e[o]),e[o]}))},e.getHlights=function(t){e.readSlot("hlight"+e.getBookId(),t)},e.addAction=function(t,n){e.readSlot("actions"+e.getBookId(),(function(o){o.push(t),e.writeSlot("actions"+e.getBookId(),o,(function(){return n&&n(!0),!0}))}))},e.deleteAction=function(t,n){e.readSlot("actions"+e.getBookId(),(function(o){for(var i=0;i<o.length;i++)if(JSON.stringify(t)==JSON.stringify(o[i]))return o.splice(i,1),void e.writeSlot("actions"+e.getBookId(),o,(function(){return n&&n(o),o}));n&&n(o)}))},e.getActions=function(t){e.readSlot("actions"+e.getBookId(),t)},e.readSlot=function(e,t){var n;if(chromeApp)chrome.storage.local.get(e,(function(n){n=n?isEmpty(n)?[]:n[e]:[],t&&t(n)}));else if(isNative)try{NativeStorage.getItem(e,(function(e){e||t([]);var n=JSON.parse(e);t&&t(n)}),(function(e){t&&t([])}))}catch(e){o()}else o();function o(){if(!(n=localStorage[e])||"undefined"==n)return t&&t([]),[];var o=JSON.parse(n);return t&&t(o),o}},e.writeSlot=function(e,t,n){if(chromeApp){var o={};o[e]=t,chrome.storage.local.set(o,(function(){n&&n()}))}else if(isNative)try{NativeStorage.setItem(e,JSON.stringify(t),(function(){n&&n()}),(function(e){i()}))}catch(e){i()}else i();function i(){localStorage[e]=JSON.stringify(t),n&&n()}},e.clearSlot=function(e,t){if(chromeApp)chrome.storage.local.remove(e,(function(){t&&t()}));else if(isNative)try{NativeStorage.remove(e,(function(){t&&t()}),(function(){n()}))}catch(e){}else n();function n(){delete localStorage[e],t&&t()}},e.clearSlots=function(t){if(chromeApp)chrome.storage.local.clear(t);else if(isNative)try{NativeStorage.clear(t,(function(){n()}))}catch(e){}else n();function n(){var n=[];for(var o in localStorage)n.push(o);var i=-1;!function o(){if(++i>=n.length)return void(t&&t());var r=n[i];(0==r.indexOf("note_")||0==r.indexOf("bookmark_")||0==r.indexOf("hlight_")||0==r.indexOf("settings_"))&&e.clearSlot(r,o)}()}},e.copyLocalToNativeStorage=function(){if(isNative)try{for(var e in localStorage)NativeStorage.setItem(e,localStorage[e]),delete localStorage[e]}catch(e){}},e.uniqueId=function(t,n,o){var i=0;n||(n="id");for(var r=0;r<t.length;r++)Number(t[r][n])>i&&(i=Number(t[r][n]));e.readSlot("actions"+e.getBookId(),(function(e){for(var t=0;t<e.length;t++)Number(e[t].data[n])>i&&(i=Number(e[t].data[n]));return o&&o(i+1),i+1}))},e.getPublicRoot=function(t){var n="";return e.data.paths&&("book"==config.kotobee.mode||"book"==t?n=e.data.paths.books:"library"!=config.kotobee.mode&&"library"!=t||(n=e.data.paths.libraries)),n||(n=""),n},e})),createService("sync",(function(){var e,t,n,o,i,r,a,s,c={},l={transformRequest:angular.identity,headers:{"Content-Type":void 0}};function d(){t.data.syncing||(Vue.set(t.data,"syncing",!0),$rootScope.$$phase||$rootScope.$apply())}function u(){t.data.syncing&&(Vue.set(t.data,"syncing",!1),$rootScope.$$phase||$rootScope.$apply())}return c.initialize=function(){config.kotobee.cloudid&&(t||(t=$injector.get("stg")),n||(n=$injector.get("bookmarks")),o||(o=$injector.get("notes")),i||(i=$injector.get("hlights")),a||(a=$injector.get("chapters")),r||(r=$injector.get("freehand")),t.getActions((function(t){e=t,window.addEventListener?(window.addEventListener("offline",c.onOffline,!1),window.addEventListener("online",c.onOnline,!1)):(document.addEventListener("offline",c.onOffline,!1),document.addEventListener("online",c.onOnline,!1))})))},c.trigger=function(){c.offline()&&!backend.cloudParam("sync")?c.onOffline():c.onOnline()},c.offline=function(){try{return!navigator.onLine}catch(e){return!1}},c.onOffline=function(){$injector.get("backend").cloudParam("sync")},c.onOnline=function(e){$injector.get("backend").cloudParam("sync")&&(s||c.applyChanges((function(){d(),$injector.get("annotations").sync({},(function(){u(),e&&"function"==typeof e&&e()}))})))},c.queue=function(n,o){if(t&&config.kotobee.cloudid&&!config.kotobee.public){var i={type:n,data:clone(o)};e.push(i),t.addAction(i,(function(){c.offline()&&!backend.cloudParam("sync")||s||c.applyChanges()}))}},c.applyChanges=function(n){if(u(),$injector.get("backend").cloudParam("sync")&&t&&t.data.user&&(t.data.user.email||t.data.user.code))try{var o={func:arguments.callee,args:arguments};if(0==e.length)return s=!1,n?n():null;d(),s=!0;var i=e[0],r=getFormData($injector.get("backend").getAuthVars());for(var a in i.data)r.append(a,i.data[a]);$http.post(config.kotobee.liburl+"library/"+i.type,r,l).success((function(n){n&&n.success&&"note/add"==i.type&&t.readSlot("note"+t.getBookId(),(function(e){for(var o=0;o<e.length;o++)if(e[o].nid==n.success.nid){Object.assign(e[o],n.success),t.writeSlot("note"+t.getBookId(),e);break}})),e.splice(0,1),t.deleteAction(i,(function(){c.applyChanges()}))})).error((function(e){s=!1,setTimeout(u,300),kError.update({error:"syncOnConnectionMsg",ref:o})}))}catch(e){}},c})),createService("tinCan",(function(){var e={};return e.initialize=function(){},e.send=function(e){!function(e){try{if(config.gAnalyticsID){if(!ga)return}else{if(!config.gAnalyticsMeasurementId)return;if(!gtag)return}}catch(e){return}config.gAnalyticsID&&ga("send","event",e.activity,e.verb,stg.data.book.meta.dc.title);config.gAnalyticsMeasurementId&&gtag("event",e.verb,{category:e.activity,action:e.verb,label:stg.data.book.meta.dc.title})}(e),backend.cloudParam("tincan")&&(e.name=stg.data.user.name?stg.data.user.name:"User",stg.data.user.email?e.email=stg.data.user.email:stg.data.user.code&&(e.email=stg.data.user.code+"@promocode"),backend.tincan(e))},e})),createService("tooltip",(function(){var e,t={};return t.show=function(t,n){e&&clearTimeout(e);var o=document.getElementsByClassName("kTooltip")[0];o||(o=document.createElement("div"),document.body.appendChild(o));var i=Number(t.getAttribute("data-tooltipOffset")),r=t.getAttribute("data-tooltipFlow"),a=t.getBoundingClientRect();o.className="kTooltip",r&&addClass(o,r),o.style.left=a.left+a.width/2+"px",o.style.top=o.style.bottom=null,o.style.top="bottom"==r?a.bottom+i+"px":a.top-i+"px",o.textContent=translit.get(n)},t.hide=function(){e&&clearTimeout(e),e=setTimeout((function(){for(var e=document.getElementsByClassName("kTooltip");e.length;)e[0].parentNode.removeChild(e[0])}),300)},t})),createService("translit",(function(){var e,t,n={},o={},i=[];return n.addListener=function(e){i.push(e)},n.setLangOld=function(t){e=t},n.setDirection=function(e){if("rtl"==e||"ltr"==e){var t=$injector.get("stg");if(t.data.settings){var n=t.data.settings.rtl;"rtl"==e?(Vue.set(t.data.settings,"rtl",!0),cache.getOb("body")&&addClass(cache.getOb("body"),"rtl"),cache.getOb("body")&&cache.getOb("body").setAttribute("dir","rtl")):(Vue.set(t.data.settings,"rtl",!1),cache.getOb("body")&&removeClass(cache.getOb("body"),"rtl"),cache.getOb("body")&&cache.getOb("body").setAttribute("dir","ltr"));var o=document.getElementById("spreadR");if(o&&"double"==t.data.currentView){var i=document.getElementById("spreadL");if(n&&"rtl"!=e||!n&&"rtl"==e){var r=i.style.cssText;i.style.cssText=o.style.cssText,o.style.cssText=r}}$rootScope.$$phase||$rootScope.$apply(),setTimeout((function(){"audiobook"!=config.kotobee.type&&(chapters.displayTOC(),chapters.highlightCurrentTocChapter(),kotobee.dispatchEvent&&kotobee.dispatchEvent("directionChanged",t.data.settings.rtl))}),200)}}},n.setLangArray=function(e){t=e},n.setLang=function(o,r){$injector.get("backend").getServerLang({lang:o}).success((function(a){t=a;var s=e||"en";e=o,stg.data&&(stg.data.lc||Vue.set(stg.data,"lc",0),stg.data.lc=Number(stg.data.lc)+1),n.setDirection("ar"==o?"rtl":"ltr"),kotobee.dispatchEvent&&kotobee.dispatchEvent("languageChanged",{from:s,to:e}),function(){for(var t=0;t<i.length;t++)i[t](e)}(),r&&r()})).error((function(e,t){r&&r()}))},n.getLang=function(){return e},n.get=function(n,o){if(!t)return n;if(!e)return n;if(t[n]&&(n=t[n]),o)for(var i=0;i<o.length;i++)n=$interpolate(n)(o[i]);return n},n.replaceString=function(e,n){t&&(t[e]=n,stg.data&&(stg.data.lc||Vue.set(stg.data,"lc",0),stg.data.lc=Number(stg.data.lc)+1))},n.getOld=function(t,n){if(o[e][t]&&(t=o[e][t]),n)for(var i=0;i<n.length;i++)t=$interpolate(t)(n[i]);return t},n})),createService("traverser",(function(){var e={};function t(t,i){i||(i={});var r=i.root;r||(r=cache.getOb("epubContent"));var a=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,n,!1),s=[],c=o(t.from,{root:r,skipLevels:1}),l=o(t.to,{root:r,skipLevels:1});if(c||(c=a.firstChild()),l||(l=a.lastChild()),!function(t,o){var i=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,n,!1);var r=i.firstChild();var a=e.getAbsoluteIndex(r,o);a.index="0."+a.index,i.currentNode=o;var s=i.lastChild();var c=e.getAbsoluteIndex(s,o);if(c.index="0."+c.index,l(t.from,a.index)&&l(t.to,a.index))return;if(d(t.from,c.index)&&d(t.to,c.index))return;return!0;function l(e,t){for(var n=e.split("."),o=t.split("."),i=0;i<n.length;i++){if(Number(n[i])>Number(o[i]))return!1;if(Number(n[i])<Number(o[i]))return!0;if(null==o[i])return!1}return!0}function d(e,t){for(var n=e.split("."),o=t.split("."),i=0;i<n.length;i++){if(Number(n[i])<Number(o[i]))return!1;if(Number(n[i])>Number(o[i]))return!0;if(null==o[i])return!0}return!0}}(t,r))return s;for(var d=a.currentNode=c;d&&(s.push(d),d!=l);)d=a.nextNode();return s}function n(e){return e.children&&e.children.length?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}function o(e,t){t||(t={});var n=t.root;t.skipLevels&&(e=e.substr(2*t.skipLevels));var o=e.split("."),i=n,r=1;t.skipLevels&&(r-=t.skipLevels);for(var a=0;a<o.length;a++)if(i){var s=Number(o[a]),c=0;i.hasAttribute("kb-offset")&&(c=Number(i.getAttribute("kb-offset")));var l=i.children[s-c];if(a==r&&l&&virt.checkIfRequiresParseAndAnnotations(l),i.parentNode&&-1!=i.parentNode.className.indexOf("kInteractive questions")&&o.length-a==2&&(i=i.children[0]),!l&&!i.children.length)break;i=l}return i}function i(e,t){var n=e.split("."),o=t.split(".");if(e==t)return 0;for(var i=0;i<n.length;i++){if(Number(n[i])>Number(o[i]))return 1;if(Number(n[i])<Number(o[i]))return-1}return n.length>o.length?1:-1}function r(e){var t=0;for(e&&e.parentNode&&e.parentNode.hasAttribute("kb-offset")&&(t=Number(e.parentNode.getAttribute("kb-offset")));e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}return e.getElemsByLocation=function(e,n){n||(n={});var i=[],r=e.split("-");if(r.length>1){var a={from:r[0],to:r[1]};i=t(a,{root:n.root?n.root:document.getElementById("spreadL")}),"double"==stg.data.currentView&&(i=i.concat(t(a,{root:document.getElementById("spreadR")})))}else i=function(e,t){var n=new Array,i=t.root;i||(i=cache.getOb("epubContent"));if("double"==stg.data.currentView){for(var r=[],a=0;a<e.length;a++){var s=e[a];s="1"+s.substr(1),r.push(s)}e=e.concat(r)}for(a=0;a<e.length;a++)if(e[a]){var c=o(e[a],{root:i});c&&n.push(c)}return n}(r=e.split(","),n);return i},e.getPageByLocation=function(e,t){var n=e.pages;if(n&&n.length){for(var o=0;o<n.length-1;o++){if(i(t,n[o].lastLocation)<=0)return o}return n.length-1}},e.getAbsoluteIndex=function(e,t){t||(t=cache.getOb("epubContent"));for(var n="";e!=t;){n=r(e)+"."+n,e=e.parentNode}var o="left";return""==n?{index:"",side:o}:("1"==n[0]&&(n="0"+n.substr(1),o="right"),{index:n.substr(0,n.length-1),side:o})},e.convertElemsToLocation=function(t,n){n||(n=cache.getOb("epubContent"));for(var o="",i="",r="",a="",s=0;s<t.length;s++){var c=e.getAbsoluteIndex(t[s],n);"left"==c.side?(o+=(o?",":"")+c.index,0==s&&(r=c.index),s==t.length-1&&(r+="-"+c.index)):(i+=(i?",":"")+c.index,0==s&&(a=c.index),s==t.length-1&&(a+="-"+c.index))}return r&&-1==r.indexOf("-")&&a&&0==a.indexOf("-")&&(a=r+=a),{left:o,right:i,leftRange:r,rightRange:a}},e.getTopCornerLocation=function(){return e.convertElemsToLocation([e.getTopCornerElement()]).left},e.getTopCornerElement=function(){for(var e=cache.getOb("epubContent"),t=cache.getOb("epubContainer"),n=e.children[0],o=$ionicScrollDelegate.$getByHandle("content").getScrollPosition().top+25,i=new Array,r=n.getElementsByClassName("k-section"),a=0;a<r.length;a++)hasClass(r[a],"cNone")||i.push(r[a]);var s,c=document.getElementById("readerHeader").offsetHeight+10;for(a=0;a<i.length;a++)for(var l=i[a].getElementsByTagName("*"),d=0;d<l.length;d++)if(!l[d].children.length){var u=l[d].getBoundingClientRect();if(u.bottom>c){if(u.top>c&&u.top<c+10)return l[d];var p=u.top-c;if(!s){s={elem:l[d],bounds:u,distance:p};continue}if(p>0&&p<50)return l[d];p<s.distance&&u.bottom<c+t.offsetHeight&&(s={elem:l[d],bounds:u,distance:p})}}if(s)return s.elem;for(a=0;a<i.length;a++)if(i[a].offsetTop-o>0)return i[a];return i[0]},e.analyzeNodes=function(e,t){var n,o,i,r,a,s;n=new Array,o=new Array;for(var c=cache.getOb("epubContent").parentNode,l=e;n.push(l),(l=l.parentNode)!=c;);for(l=t;o.push(l),(l=l.parentNode)!=c;);var d=function(){for(var e=0;e<n.length;e++)for(var t=0;t<o.length;t++)if(o[t]==n[e])return[o[t],e,t]}();a=d[0],i=d[1],r=d[2];for(var u=0;u<a.childNodes.length;u++){if(a.childNodes[u]==n[i-1]){s=!1;break}if(a.childNodes[u]==o[r-1]){s=!0;break}}var p={};return p.parents1=n,p.parents2=o,p.index1=i,p.index2=r,p.commonParent=a,p.reversed=s,p},e.nextTextNode=function(t,n){for(n||(n=t);!t.nextSibling;)if((t=t.parentNode)==n)return;for(t=t.nextSibling;t.childNodes[0];)t=t.childNodes[0];return"#text"==t.nodeName&&t.textContent.trim()?t:e.nextTextNode(t,n)},e.prevTextNode=function(t,n){for(n||(n=t);!t.previousSibling;)if((t=t.parentNode)==n)return;for(t=t.previousSibling;t.childNodes.length;)t=t.childNodes[t.childNodes.length-1];return"#text"==t.nodeName&&t.textContent.trim()?t:e.prevTextNode(t,n)},e})),createService("view",(function(){var e={};return e.generate=function(){var e=stg.data.currentLibrary,t=stg.data.currentLibrary.cloud,n=stg.view;n.registration={},n.registration.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.inregistration,n.registration.promocode&&(n.registration.promocodeMandatory=e.promocodesettings.inregistrationmandatory),n.topmenu={},n.topmenu.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.intopmenu,n.topmenu={},n.topmenu.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.intopmenu,n.bookinfo={},n.bookinfo.promocode=t&&!t.public&&e&&!e.cloud.promocodesdisabled&&e.promocodesettings.inbookinfo},e})),createService("virt",(function(){var e,t,n,o,i={};i.lock=function(){t=!0},i.unlock=function(){t=!1},i.enable=function(){e||t||(e=!0,o&&clearInterval(o),n=setInterval(r,60),r())},i.disableAfter=function(e){o&&clearInterval(o),o=setInterval((function(){i.disable(),clearInterval(o)}),e)},i.disable=function(){e&&(t||(e=!1,clearInterval(n)))};var r=function(){t||$filter("contentVirt")()};return i.reset=function(e,n){t||(i.reveal(!0),$filter("contentVirt")("reset"),$filter("contentVirt")(null,e,(function(){i.reveal(!1),n&&n()})))},i.checkIfRequiresParse=function(e){hasClass(e,"parsed")||$filter("contentVirt")("parse",e)},i.checkIfRequiresParseAndAnnotations=function(e){hasClass(e,"parsed")||$filter("contentVirt")("parseAndAnnotations",e)},i.reveal=function(e){t||$filter("contentVirt")(e?"reveal":"undoReveal")},i.safeAnchorScroll=function(e,n,o){if(!t){var r=$q.defer();i.reveal(!0);var a=document.getElementById(n);return i.safeScrollToElem(e,a,o),timeOut((function(){i.reset(),r.resolve()}),1300),r.promise}},i.safeScroll=function(e,n,o,r){if(!t){var a=$q.defer();return r||(r=!0),i.reveal(!0),$ionicScrollDelegate.$getByHandle(e).scrollTo(Math.round(n),Math.round(o),r),timeOut((function(){i.reset(),a.resolve()}),1300),a.promise}},i.safeScrollToElem=function(e,n,o){if(n&&!t){i.reveal(!0);var r=cache.getOb("epubContainer"),a=0,s=getComputedStyle(r).paddingTop;s&&(a=Number(s.split("px")[0]));var c=$ionicScrollDelegate.$getByHandle(e).getScrollPosition().top;if(mobile){if(mobile||isNative)if("auto"==getComputedStyle(r).overflowY)c=r.scrollTop;else{var l=getComputedStyle(r).overflowY;r.style.overflowY="auto",c=r.scrollTop,r.style.overflowY=l}}else"auto"==getComputedStyle(r).overflowY&&(c=r.scrollTop);var d=c-(r.getBoundingClientRect().top+a)-25;return i.safeScroll(e,0,n.getBoundingClientRect().top+d,o)}},i.forceRepaint=function(){try{var e=document.createTextNode(" ");document.body.appendChild(e),setTimeout((function(){}),0)}catch(e){}},i})),createService("visualizer",(function(){var e,t,n,o,i={};return i.initialize=function(i){i&&(this.audio=i),window.removeEventListener("resize",a),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),e=document.getElementById("visualizer"),t=e.getContext("2d"),window.addEventListener("resize",a),a(),this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),n=this.audioContext.createAnalyser(),this.audio.connectedToSource||(o=this.audioContext.createMediaElementSource(this.audio),this.audio.connectedToSource=!0),o.disconnect(),o.connect(n),n.connect(this.audioContext.destination);var r={lines:this.setupLinesVisualizer,bars:this.setupBarsVisualizer,waves:this.setupWavesVisualizer,dots:this.setupDotsVisualizer}[stg.data.settings.visualizerStyle||"lines"];function a(){e&&e.parentElement&&(e.width=e.parentElement.offsetWidth||window.innerWidth,e.height=Math.max(200,e.parentElement.offsetHeight||200))}"function"==typeof r&&r.call(this)},i.setupLinesVisualizer=function(){i.animationFrameId&&(cancelAnimationFrame(i.animationFrameId),i.animationFrameId=null),n.fftSize=256;var o=n.frequencyBinCount,r=new Uint8Array(o),a=new Float32Array(o).fill(0);!function i(){requestAnimationFrame(i),n.getByteFrequencyData(r),t.clearRect(0,0,e.width,e.height);var s=e.width/2,c=e.height/2,l=.8*e.height,d=o,u=2*d,p=e.width/u*.8,f=.2*p,h=t.createLinearGradient(0,0,0,e.height);h.addColorStop(1,"#bbb"),h.addColorStop(0,"#ddd"),t.fillStyle=h;for(var g=0;g<d;g++){a[g]+=.3*(r[g]-a[g]);var m=a[g]/255*l*1.8,v=(p+f)*g,b=s-v-p,k=s+v,y=c-m/2,w=.2*Math.min(p,m);t.beginPath(),t.moveTo(b+w,y),t.lineTo(b+p-w,y),t.quadraticCurveTo(b+p,y,b+p,y+w),t.lineTo(b+p,y+m-w),t.quadraticCurveTo(b+p,y+m,b+p-w,y+m),t.lineTo(b+w,y+m),t.quadraticCurveTo(b,y+m,b,y+m-w),t.lineTo(b,y+w),t.quadraticCurveTo(b,y,b+w,y),t.closePath(),t.fill(),t.beginPath(),t.moveTo(k+w,y),t.lineTo(k+p-w,y),t.quadraticCurveTo(k+p,y,k+p,y+w),t.lineTo(k+p,y+m-w),t.quadraticCurveTo(k+p,y+m,k+p-w,y+m),t.lineTo(k+w,y+m),t.quadraticCurveTo(k,y+m,k,y+m-w),t.lineTo(k,y+w),t.quadraticCurveTo(k,y,k+w,y),t.closePath(),t.fill()}}()},i.setupBarsVisualizer=function(){i.animationFrameId&&(cancelAnimationFrame(i.animationFrameId),i.animationFrameId=null);var o="#cfcfcf";n.fftSize=256;var r=n.frequencyBinCount,a=new Uint8Array(r);!function i(){requestAnimationFrame(i),function(){n.getByteFrequencyData(a),t.clearRect(0,0,e.width,e.height);for(var i=e.width/64,r=e.height/2+100,s=0;s<64;s++)if(!(s<8||s>=56)){var c=.5*a[s],l=s*i,d=void 0;d=o,t.fillStyle=d,t.fillRect(l,r-c,.6*i,c),t.fillStyle="rgba(255,255,255,0.1)",t.shadowBlur=0,t.fillRect(l,r,.6*i,.3*c)}}()}()},i.setupWavesVisualizer=function(){i.animationFrameId&&(cancelAnimationFrame(i.animationFrameId),i.animationFrameId=null);var o={smoothing:.8,fft:8,minDecibels:-70,scale:.2,glow:4,color1:[200,200,200],color2:[240,240,240],color3:[200,200,200],fillOpacity:.6,lineWidth:1,blend:"screen",shift:50,width:60,amp:.3},r=e.width,a=e.height,s=t,c=(new Float32Array(n.frequencyBinCount).fill(0),1);function l(e){return Array.from(Array(e).keys())}var d=[1,3,0,4,2];function u(e,t){var n=o["color".concat(e+1)].map(Math.floor);s.fillStyle="rgba(".concat(n,", ").concat(o.fillOpacity*c,")"),s.strokeStyle="rgba(".concat(n,", ").concat(c,")"),s.shadowColor="rgba(".concat(n,", ").concat(c,")"),s.lineWidth=o.lineWidth,s.shadowBlur=o.glow,s.globalCompositeOperation=o.blend;var i=a/2,u=(r-15*o.width)/2,p=l(15).map((function(t){return u+e*o.shift+t*o.width})),f=l(5).map((function(n){return Math.max(0,i-function(e){return(3-Math.abs(2-e))/3*o.amp}(n)*function(e,t,n){return n[2*e+6*d[t]]}(e,n,t))})),h=2*i;s.beginPath(),s.moveTo(0,i),s.lineTo(p[0],i+1),s.bezierCurveTo(p[1],i+1,p[2],f[0],p[3],f[0]),s.bezierCurveTo(p[4],f[0],p[4],f[1],p[5],f[1]),s.bezierCurveTo(p[6],f[1],p[6],f[2],p[7],f[2]),s.bezierCurveTo(p[8],f[2],p[8],f[3],p[9],f[3]),s.bezierCurveTo(p[10],f[3],p[10],f[4],p[11],f[4]),s.bezierCurveTo(p[12],f[4],p[12],i,p[13],i),s.lineTo(r,i+1),s.lineTo(p[13],i-1),s.bezierCurveTo(p[12],i,p[12],h-f[4],p[11],h-f[4]),s.bezierCurveTo(p[10],h-f[4],p[10],h-f[3],p[9],h-f[3]),s.bezierCurveTo(p[8],h-f[3],p[8],h-f[2],p[7],h-f[2]),s.bezierCurveTo(p[6],h-f[2],p[6],h-f[1],p[5],h-f[1]),s.bezierCurveTo(p[4],h-f[1],p[4],h-f[0],p[3],h-f[0]),s.bezierCurveTo(p[2],h-f[0],p[1],i,p[0],i),s.lineTo(0,i),s.fill(),s.stroke()}!function e(){i.animationFrameId=requestAnimationFrame(e),n.smoothingTimeConstant=o.smoothing,n.fftSize=Math.pow(2,o.fft),n.minDecibels=o.minDecibels;var t=new Uint8Array(n.frequencyBinCount);n.getByteFrequencyData(t);var l=t.some((function(e){return e>15}));c=l?Math.min(c+.05,1):Math.max(c-.05,0),s.clearRect(0,0,r,a),c>0&&(u(0,t),u(1,t),u(2,t))}()},i.setupDotsVisualizer=function(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),n.fftSize=256,n.smoothingTimeConstant=.7;var o=n.frequencyBinCount,r=new Uint8Array(o),a=this.audio&&!this.audio.paused;this.audio.addEventListener("playing",(function(){return a=!0})),this.audio.addEventListener("pause",(function(){return a=!1})),this.audio.addEventListener("ended",(function(){return a=!1}));var s=1;function c(e,n,o,i){t.fillStyle=i,t.beginPath(),t.arc(e,n,o,0,2*Math.PI),t.fill()}!function l(){if(i.animationFrameId=requestAnimationFrame(l),a?(n.getByteFrequencyData(r),s=Math.min(s+.05,1)):s=Math.max(s-.05,0),t.clearRect(0,0,e.width,e.height),s>0)for(var d=0;d<o;d++){var u=15*d;if(!(u<.1*e.width)){if(u>.9*e.width)return;var p=e.height-.5*r[d]-90;c(u,p-20,4,"rgba(207, 207, 207, ".concat(s,")")),c(u,p,4,"rgba(207, 207, 207, ".concat(s,")")),c(u,p+20,4,"rgba(220, 220, 220, ".concat(s,")"))}}}()},i})),createService("workers",(function(e){var t,n,o,i,r={},a=[],s=[],c=[];function l(e){i=!0}r.initialize=function(){if(h()){try{var e=function(){t.addEventListener("error",l,!1),n.addEventListener("error",l,!1),o.addEventListener("error",l,!1),t.addEventListener("message",p,!1),n.addEventListener("message",p,!1),o.addEventListener("message",p,!1)};if(isNative)return void(i=!0);0,t=new Worker(rootDir+"js/workers/cssParser.js"),n=new Worker(rootDir+"js/workers/htmlParser.js"),o=new Worker(rootDir+"js/workers/search.js"),e()}catch(e){i=!0}navigator.serviceWorker&&navigator.serviceWorker.register("service-worker.js")}};var d=0;function u(e){if(e.length){var t=e[0].args,n=e[0].id;f(t[0]).postMessage({func:t[1],params:t[2],id:n})}}function p(e){var i=function(e){if(e==t)return a;if(e==n)return s;if(e==o)return c}(e.target),r=i[0].args[3];r&&r(e.data.data),i.shift(),u.apply(this,[i])}function f(e){return"cssParser"==e?t:"htmlParser"==e?n:"search"==e?o:void 0}function h(){return!i&&"undefined"!=typeof Worker}return r.call=function(e,t,n,o){if(++d,f(e)){var i=function(e){if("cssParser"==e)return a;if("htmlParser"==e)return s;if("search"==e)return c}(e),r=[e,t,n,o];i.push({args:r,id:d}),1==i.length&&u(i)}},r.supported=function(){return h()},r})),createService("$ionicScrollDelegate",(function(){var e={};return e.$getByHandle=function(e){var t=document.getElementsByClassName("delegate-"+e);if(t.length)return t[0].__vue__.getScrollProxy()},e})),createService("$ionicSideMenuDelegate",(function(){var e={},t=[];function n(e){var t=o();t&&t.applyTransform(e)}function o(){var e=document.getElementsByClassName("menu-content");if(e.length)return e[0].__vue__}return e.menuWidth=330,e.add=function(n,o){var i=e.$getByHandle(n);i&&e.remove(i),t.push({id:n,instance:o})},e.remove=function(e){for(var n=0;n<t.length;n++)if(t[n]==e)return t.splice(n,1)},e.$getByHandle=function(e){for(var n=[],o=0;o<t.length;o++)t[o].id==e&&n.push(t[o].instance);return{_instances:n}},e.toggleLeft=function(){var t=o();if(t){var i=t.$parent.left.width;n.bind(this)((e.isOpenLeft()?0:1)*i)}},e.toggleRight=function(){var t=o();if(t){var i=t.$parent.right.width;n.bind(this)((e.isOpenRight()?0:-1)*i)}},e.isOpen=function(){return e.isOpenLeft()||e.isOpenRight()},e.close=function(){n.bind(this)(0)},e.isOpenLeft=function(){var e=o();if(e){var t=e.$parent.left.width;return e.getTransform()=="translate3d("+t+"px, 0px, 0px)"}},e.isOpenRight=function(){var e=o();if(e){var t=e.$parent.right.width;return e.getTransform()=="translate3d("+-t+"px, 0px, 0px)"}},e.openBy=function(e){n.bind(this)(e)},e.enableDrag=function(){var t,n,o,i,r,a,s,c=stg.data.settings.rtl,l=e.menuWidth/2,d=0,u=!0;function p(){t=!1,u=!0;var n=d<l,o="left"===r;function i(t){e.openBy(t*e.menuWidth)}c?a&&!o&&n?i(-1):s&&o&&n&&i(1):a&&o&&n?i(1):s&&!o&&n&&i(-1),document.body.removeEventListener("touchmove",f),document.body.removeEventListener("touchend",p),setTimeout((function(){kotobee&&kotobee.view&&kotobee.view.hasOwnProperty("swipe")&&(kotobee.view.swipe=!0),kotobee&&kotobee.view&&kotobee.view.hasOwnProperty("scroll")&&(kotobee.view.scroll=!0)}),200)}function f(e){if(e=e||window.event,t){o=Math.round(e.touches[0].clientX);var l="left"===(r=(i=o-n)>0?"right":"left");if(d=i<0?-1*i:i,u)if(c){if(a&&!l)return h(d,-1);if(s&&l)return h(d,1)}else{if(a&&l)return h(d,1);if(s&&!l)return h(d,-1)}}}function h(t,n){var o=e.menuWidth;o-=t,e.openBy(n*o),t>l&&(e.openBy(0),u=!1)}null!=c&&(document.body.ontouchstart=function(e){c=stg.data.settings.rtl;var o=$ionicSideMenuDelegate.isOpenLeft(),i=$ionicSideMenuDelegate.isOpenRight();s=!c&&i||c&&o,((a=!c&&o||c&&i)||s)&&(!function(){kotobee&&kotobee.view&&kotobee.view.hasOwnProperty("swipe")&&(kotobee.view.swipe=!1);kotobee&&kotobee.view&&kotobee.view.hasOwnProperty("scroll")&&(kotobee.view.scroll=!1)}(),e.stopPropagation(),t=!0,e=e||window.event,n=Math.round(e.touches[0].clientX),document.body.addEventListener("touchmove",f),document.body.addEventListener("touchend",p))})},e})),createService("bookmarks",(function(){var e,t={};return t.addBookmarksFromOffline=function(e){for(var n=cache.getOb("epubContent"),o=0;null!=(n=n.previousSibling);)o++;var i=[];i.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&i.push(stg.data.currentRPageOb.index);for(var r=0;r<i.length;r++)for(var a=0;a<e.length;a++)e[a].chapter==i[r]&&String(e[a].location).split(".")[1]==o&&t.addIcon(e[a])},t.addBookmark=function(){var e={};e.chapter=currentIndex,e.chaptername||(e.chaptername=stg.data.currentPageOb.title),e.file||(e.file=stg.getChapterFilename()),e.location=traverser.getTopCornerLocation(),kotobee.dispatchEvent("preBookmark",e),stg.addBookmark(e,(function(){t.addIcon(e),crdv.toast(translit.get("bookmarked"))}))},t.addBookmarksFromSync=function(e,n){t.deleteAll(!0,(function(){var o=-1;!function i(){++o>=e.length?n&&n():function(e,n){stg.readSlot("bookmark"+stg.getBookId(),(function(o){o||(o=[]),ph.removeExtension(e.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(o,"bmid",e.bmid)||t.addIcon(e)),o.push(e),stg.writeSlot("bookmark"+stg.getBookId(),o,(function(){var o;stg.isManipulated(e)&&stg.addBookmark(o=Object.assign(e,{chapter:null,chaptername:null,file:null}),(function(){t.addIcon(o)})),n&&n()}))}))}(e[o],(function(){o%100==0?setTimeout(i,10):i()}))}()}))},t.addIconIfNotShown=function(e){t.addIcon(e)},t.addIcon=function(e){var n=traverser.getElemsByLocation(e.location);if(n[0]){var o=selection.createBookMarker(e,n[0]);if(o.className="contentBookMarker",o.setAttribute("bmid",e.bmid),o.setAttribute("bloc",n[0].offsetTop),o.addEventListener("tap",(function(e){e.stopImmediatePropagation()})),o.addEventListener("click",(function(e){virt.safeScrollToElem("content",o,!0);var t={};t.bmid=this.getAttribute("bmid"),t.location=this.getAttribute("bloc")})),o.addEventListener("click",(function(n){var o=[{name:translit.get("delete"),func:function(){t.delete(e.bmid),popovers.hide()}},{name:translit.get("cancel"),func:function(){popovers.hide()}}];popovers.show({mode:"popoverList",listOb:o,backdropClickToClose:!1})})),!mobile){var i=document.createElement("span");i.className="editIcon icon kb-close",i.addEventListener("click",(function(n){n.stopPropagation(),t.confirmDeletion((function(){t.delete(e.bmid),modals.hide()}))})),i.addEventListener("tap",(function(e){e.stopImmediatePropagation()})),o.appendChild(i),o.addEventListener("mouseover",(function(e){addClass(o,"edit"),o.addEventListener("mouseout",(function(e){removeClass(o,"edit")}))}))}}},t.confirmDeletion=function(t){if(e)return t();modals.hide();var n={title:"confirmation",msg:"bookmarkDeleteConfirm",barStyle:"bar-dark"},o={label:"delete",style:"button-assertive",func:function(){n.dontAskChecked&&(e=!0),t&&t(),modals.hide()}},i={label:"cancel",func:function(){n.dontAskChecked&&(e=!0),modals.hide()}};n.dontAsk=!0,n.btns=[o,i],modals.show({mode:"confirm",confirmOptions:n})},t.delete=function(e,t,n){selection.deleteBookMarker(e),stg.deleteBookmark(e,t,n),kotobee.dispatchEvent("bookmarkDeleted",e)},t.deleteAll=function(e,n){stg.getBookmarks((function(o){var i=-1;!function r(){if(++i>=o.length)return void(n&&n());t.delete(o[i].bmid,e,(function(){i%100==0?setTimeout(r,30):r()}))}()}))},t})),createService("freehand",(function(){var e,t,n,o,i={},r=[],a=[],s={},c={brushes:[2,4,6,8,10,12],colors:["yellow","red","blue","green","black"],smoothing:[1,2,3,4,5]};function l(){var n,i=cache.getOb("epubContainer");i&&(e||(e=document.getElementById("freehandCanvasLeft")),e||((e=document.createElement("canvas")).className="freehandCanvas",e.id="freehandCanvasLeft",e.width=i.offsetWidth,e.height=i.offsetHeight,e.addEventListener("mousedown",h),e.addEventListener("touchstart",h),o=e.getContext("2d")),(n=d(document.getElementById("spreadL")))&&n.appendChild(e),"double"==stg.data.currentView&&(t||(t=document.getElementById("freehandCanvasRight")),t||((t=document.createElement("canvas")).className="freehandCanvas",t.id="freehandCanvasRight",t.width=i.offsetWidth,t.height=i.offsetHeight,t.addEventListener("mousedown",h),t.addEventListener("touchstart",h),o=t.getContext("2d")),(n=d(document.getElementById("spreadR")))&&n.appendChild(t)))}function d(e){if(e)return getElementsByAttribute(e,"div","id","fxlChapter")[0]}function u(e){if(e||(e={}),(!e.checkLayout||!stg.data.book||"fxl"==stg.data.book.chapter.layout)&&(config.freehand||preview))return!0}function p(n){if(o=d(document.getElementById("spreadL"))){if(e.width=removePx(o.style.width),e.height=removePx(o.style.height),"double"==stg.data.currentView&&t){var o=d(document.getElementById("spreadR"));t.width=removePx(o.style.width),t.height=removePx(o.style.height)}!function(){for(var e=0;e<r.length;e++){var t=b(r[e].chapter);t.beginPath();var n=r[e].points[0];"pen"==r[e].type?t.globalCompositeOperation="source-over":"eraser"==r[e].type&&(t.globalCompositeOperation="destination-out"),t.moveTo(n[0],n[1]),t.strokeStyle="orange",t.lineWidth=5,r[e].style&&r[e].style.color&&(t.strokeStyle=r[e].style.color),r[e].style&&r[e].style.brush&&(t.lineWidth=r[e].style.brush),t.lineCap="round",t.lineJoin="round";for(var o=1;o<r[e].points.length;o++)v(t,r[e].points[o-1],r[e].points[o],r[e].points[o+1]);t.stroke()}}()}}function f(e){if(e.touches){var t=e.touches[0],o=getBoundingBox(n),i=Number(n.getAttribute("width")),r=Number(n.getAttribute("height"));return{offsetX:(t.pageX-o.left)*i/o.width,offsetY:(t.pageY-o.top)*r/o.height}}return{offsetX:e.offsetX,offsetY:e.offsetY}}function h(e){e.stopPropagation(),(n=e.currentTarget).addEventListener("mousemove",g),n.addEventListener("mouseup",m),n.addEventListener("touchmove",g),n.addEventListener("touchend",m);var t=f(e);(o=n.getContext("2d")).beginPath(),o.moveTo(t.offsetX,t.offsetY),o.strokeStyle=i.currentStyle.color,o.lineWidth=i.currentStyle.brush,o.lineCap="round",o.lineJoin="round",(s={type:i.mode,points:[],style:clone(i.currentStyle)}).points.push([t.offsetX,t.offsetY])}function g(e){e.stopPropagation(),"pen"==i.mode?o.globalCompositeOperation="source-over":"eraser"==i.mode&&(o.globalCompositeOperation="destination-out");var t=f(e);o.lineTo(t.offsetX,t.offsetY),o.stroke(),s.points.push([t.offsetX,t.offsetY])}function m(c){c.stopPropagation(),n.removeEventListener("mousemove",g),n.removeEventListener("mouseup",m),o.closePath(),function(e,t){for(var n=[],o=0;o<e.points.length;o+=t)n.push(e.points[o]);e.points=n}(s,i.smoothing),s.chapter=function(n){if(e==n)return stg.data.currentPageOb.index;if("double"==stg.data.currentView&&t==n)return stg.data.currentRPageOb.index}(n),s.chaptername=function(n){if(e==n)return stg.data.currentPageOb.title;if("double"==stg.data.currentView&&t==n)return stg.data.currentRPageOb.title}(n),s.file=function(n){if(e==n)return ph.relative(ph.join(bookPath,stg.data.packageURL),stg.data.currentPageOb.url);if("double"==stg.data.currentView&&t==n)return ph.relative(ph.join(bookPath,stg.data.packageURL),stg.data.currentRPageOb.url)}(n),r.push(s),a=clone(r),k(),p()}function v(e,t,n,o,i,r){void 0===i&&(i=.3),void 0===r&&(r=.6);var a,s,c,l,d,u=0,p=t,f=n;(c=o)?(l=p,u=((d=c)[1]-l[1])/(d[0]-l[0]),s=(a=(c[0]-f[0])*-i)*u*r):(a=0,s=0),e.bezierCurveTo(p[0]-0,p[1]-0,f[0]+a,f[1]+s,f[0],f[1])}function b(n){return"double"==stg.data.currentView&&stg.data.currentRPageOb&&stg.data.currentRPageOb.index==n?t.getContext("2d"):e.getContext("2d")}function k(e,t){e||(e={});for(var n={},o=0;o<r.length;o++)n[r[o].chapter]=r[o];for(var i in n){var a={},s=clone(n[i]);delete s.chapter,delete s.chaptername,delete s.file,a.data=LZString.compressToUTF16(JSON.stringify(s)),a.chapter=i,a.chaptername=n[i].chaptername,a.file=n[i].file,stg.addSketch(a)}}return i.initialize=function(){u()&&(!function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++)if(e[t].getAttribute("src")&&e[t].getAttribute("src").indexOf("lz-string/lz-string.min.js")>=0)return;var n=document.getElementsByTagName("head")[0],o=document.createElement("script");o.src=rootDir+"lib/lz-string/lz-string.min.js",n.appendChild(o)}(),i.defs=c,i.currentStyle={color:"blue",brush:3},i.smoothing=2,window.addEventListener("resize",(function(){u({checkLayout:!0})&&(function(){if($location.path()&&$location.path().indexOf("/reader")>=0)return!1;return!0}()||(l(),p(),i.deactivate(),$rootScope.$$phase||$rootScope.$apply()))})))},i.addSketchesFromOffline=function(e){if(config.freehand||preview){i.initNewChapter();for(var t=cache.getOb("epubContent");null!=(t=t.previousSibling);)0;var n=[];n.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&n.push(stg.data.currentRPageOb.index);for(var o=0;o<n.length;o++)for(var r=0;r<e.length;r++)e[r].chapter==n[o]&&i.loadAndDisplay(e[r])}},i.activate=function(){l(),i.mode="pen",addClass(e,"active"),e.addEventListener("mousedown",h),e.addEventListener("touchstart",h),"double"==stg.data.currentView&&t&&(addClass(t,"active"),t.addEventListener("mousedown",h),t.addEventListener("touchstart",h)),$rootScope.renderScope.applyHeader("freehand")},i.deactivate=function(){removeClass(e,"active"),e.removeEventListener("mousedown",h),e.removeEventListener("touchstart",h),"double"==stg.data.currentView&&t&&(removeClass(t,"active"),t.removeEventListener("mousedown",h),t.removeEventListener("touchstart",h)),$rootScope.renderScope.applyHeader("default")},i.initNewChapter=function(){u({checkLayout:!0})&&(l(),r=[],p())},i.loadAndDisplay=function(e){l();var t=e.data;if(t&&t.length){var n=JSON.parse(LZString.decompressFromUTF16(t));n.chapter=e.chapter,n.chaptername=e.chaptername,n.file=e.file,n.id=e.id,r.push(n)}p()},i.clear=function(){for(var n=0;n<r.length;n++)stg.deleteSketch(r[n].id);r=[],function(){var n;n=e.getContext("2d"),n.clearRect(0,0,e.width,e.height),"double"==stg.data.currentView&&t&&(n=t.getContext("2d")).clearRect(0,0,t.width,t.height)}()},i.undo=function(){0!=r.length&&(r=a.slice(0,r.length-1),k(),p())},i.redo=function(){a.length<=r.length||(r.push(a[r.length]),k(),p())},i.addSketchesFromSync=function(e,t){if(!u({checkLayout:!0}))return t?t():t;i.deleteAll(!0,(function(){try{i.initNewChapter()}catch(e){}var n=-1;!function o(){if(++n>=e.length)return t?t():t;!function(e,t){stg.readSlot("sketch"+stg.getBookId(),(function(n){n||(n=[]),ph.removeExtension(e.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(n,"id",e.id)||i.loadAndDisplay(e)),n.push(e),stg.writeSlot("sketch"+stg.getBookId(),n,(function(){var n;stg.isManipulated(e)&&stg.addSketch(n=Object.assign(e,{chapter:null,chaptername:null,file:null}),(function(){i.loadAndDisplay(n)})),t&&t()}))}))}(e[n],(function(){n%100==0?setTimeout(o,10):o()}))}()}))},i.deleteAll=function(e,t){stg.getSketches((function(n){var o=-1;!function r(){if(++o>=n.length)return void(t&&t());i.delete(n[o].id,e,(function(){o%100==0?setTimeout(r,30):r()}))}()}))},i.delete=function(e,t,n){stg.deleteSketch(e,t,n)},i})),createService("hlights",(function(){var e,t={};return t.addHlightsFromOffline=function(e){for(var n=cache.getOb("epubContent"),o=0;null!=(n=n.previousSibling);)o++;var i=[];i.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&i.push(stg.data.currentRPageOb.index);for(var r=0;r<i.length;r++)for(var a=0;a<e.length;a++)e[a].chapter==i[r]&&String(e[a].location).split(".")[1]==o&&t.addHlight(e[a])},t.addHlightsFromSync=function(e,n){t.deleteAll(!0,(function(){var o=-1;!function i(){++o>=e.length?n&&n():function(e,n){stg.readSlot("hlight"+stg.getBookId(),(function(o){o||(o=[]),ph.removeExtension(e.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(o,"hid",e.hid)||t.addHlight(e)),o.push(e),stg.writeSlot("hlight"+stg.getBookId(),o,(function(){var o;stg.isManipulated(e)&&stg.addHlight(o=Object.assign(e,{chapter:null,chaptername:null,file:null}),(function(){t.addHlight(o)})),n&&n()}))}))}(e[o],(function(){o%100==0?setTimeout(i,10):i()}))}()}))},t.addHlight=function(e){for(var n=document.getElementsByClassName("hlight"+e.hid),o=n.length;o--;)n[o].style.backgroundColor=null,removeClass(n[o],"contentHlightBG"),removeClass(n[o],"hlight"+e.hid);for(o=(n=$injector.get("annotations").getMatchingElements(e)).length;o--;)n[o]&&("double"!=stg.data.currentView||chapters.elemInChapterElem(n[o],e.chapter))&&(addClass(n[o],"contentHlightBG"),addClass(n[o],"hlight"+e.hid),n[o].style.backgroundColor=e.color);return t},t.showPopup=function(e,n){e||(e=[]);var o={save:function(o){for(var i=0;i<e.length;i++){var r=e[i];null==r.chapter&&(r.chapter=chapters.getElemChapterIndex(selection.getSelectedNodes()[0])),r.chaptername||(r.chaptername=chapters.getElemChapterTitle(selection.getSelectedNodes()[0])),r.file||(r.file=stg.getChapterFilename()),r.color=o,null==r.src&&(r.src=selection.getSelectedText());var a=i==e.length-1;kotobee.dispatchEvent("preHighlight",r),stg.addHlight(r,(function(){t.addHlight(r),a&&timeOut((function(){modals.hide(),n&&n(!0),$rootScope.$$phase||$rootScope.$apply()}),300)}))}}};o.color=e[0].color?e[0].color:"#fffb85",e[0].hid&&(o.remove=function(){for(var o=0;o<e.length;o++)t.delete(e[0].hid,null,(function(){o==e.length-1&&timeOut((function(){modals.hide(),n&&n()}),300)}))}),modals.show({mode:"hlight",hlightOptions:o})},t.confirmDeletion=function(t){if(e)return t();modals.hide();var n={title:"confirmation",msg:"hlightDeleteConfirm",barStyle:"bar-dark"},o={label:"delete",style:"button-assertive",func:function(){n.dontAskChecked&&(e=!0),t&&t(),modals.hide()}},i={label:"cancel",func:function(){n.dontAskChecked&&(e=!0),modals.hide()}};n.dontAsk=!0,n.btns=[o,i],modals.show({mode:"confirm",confirmOptions:n})},t.delete=function(e,t,n){for(var o=document.getElementsByClassName("hlight"+e),i=o.length;i--;)i==o.length-1&&removeClass(o[i],"last"),removeClass(o[i],"contentHlightBG"),o[i].style.backgroundColor=null,removeClass(o[i],"hlight"+e);stg.deleteHlight(e,t,n),kotobee.dispatchEvent("highlightDeleted",e)},t.deleteAll=function(e,n){stg.getHlights((function(o){var i=-1;!function r(){if(++i>=o.length)return void(n&&n());t.delete(o[i].hid,e,(function(){i%100==0?setTimeout(r,30):r()}))}()}))},t})),createService("notes",(function(){var e,t,n={};function o(e){for(var t=e.split(" "),n=0;n<t.length;n++)if(t[n]&&0==t[n].trim().indexOf("knote"))return t[n].trim().split("knote")[1]}function i(e,t){n.getCurrentNotes((function(n){for(var o=0;o<n.length;o++)if(n[o].nid==e)return t(n[o]);return t()}))}function r(e,t){n.confirmDeletion((function(){n.delete(e,null,(function(){$timeout((function(){modals.hide(),t&&t()}),300)}))}))}function a(e){var t=this.obs,o=this.cb,i=this.public;asyncCheck(!i,n.confirmPublic,[],(function(){for(var r=0;r<t.length;r++){var a=t[r];a.chapter||(a.chapter=chapters.getElemChapterIndex(selection.getSelectedNodes()[0],{ignoreAnchors:!0})),a.chaptername||(a.chaptername=chapters.getElemChapterTitle(selection.getSelectedNodes()[0])),a.file||(a.file=stg.getChapterFilename()),a.location||(a.location=traverser.getTopCornerLocation()),a.type||(a.type="page"),a.src||(a.src="content"==a.type?selection.getSelectedText():""),a.nid=e.nid,e.date?a.date=e.date:delete a.date,a.dateLocal=e.dateLocal;var l=null==a.nid;l&&(a.dateLocal=new Date,delete a.date),a.note=s(e.note),i?a.public=!0:delete a.public;kotobee.dispatchEvent("preNote",a),stg.addNote(a,(function(){if(l)n.addIcon(a);else{c(selection.getNoteMarker(a.nid).elem,a);var e=traverser.getElemsByLocation(a.location),t=e[e.length-1];t&&c(t,a)}$timeout((function(){modals.hide(),o&&o(!0)}),300)}))}}))}function s(e){var t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("script, button, embed, iframe, object, applet, form, input, link, meta, style, audio, base, frameset, noscript").forEach((function(e){e.remove()})),t.querySelectorAll("*").forEach((function(e){Array.from(e.attributes).forEach((function(t){t.name.startsWith("on")&&e.removeAttribute(t.name)}))})),t.innerHTML}function c(e,t){}return n.addNotesFromOffline=function(e){for(var t=cache.getOb("epubContent"),o=0;null!=(t=t.previousSibling);)o++;var i=[];i.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&i.push(stg.data.currentRPageOb.index);for(var r=0;r<i.length;r++)for(var a=0;a<e.length;a++)e[a].chapter==i[r]&&String(e[a].location).split(".")[1]==o&&n.addIcon(e[a])},n.addNotesFromSync=function(e,t){n.deleteAll(!0,(function(){var o=-1;!function i(){++o>=e.length?t&&t():function(e,t){stg.readSlot("note"+stg.getBookId(),(function(o){o||(o=[]),ph.removeExtension(e.file)==ph.removeExtension(stg.getChapterFilename())&&(chapters.busy||arrayContainsProperty(o,"nid",e.nid)||n.addIcon(e)),o.push(e),stg.writeSlot("note"+stg.getBookId(),o,(function(){var o;stg.isManipulated(e)&&stg.addNote(o=Object.assign(e,{chapter:null,chaptername:null,file:null}),(function(){n.addIcon(o)})),t&&t()}))}))}(e[o],(function(){o%100==0?setTimeout(i,10):i()}))}()}))},n.getCurrentNotes=function(e){for(var t=[],n=cache.getOb("epubContent"),o=0;null!=(n=n.previousSibling);)o++;var i=[];i.push($injector.get("chapters").getUnanchoredIndex(currentIndex)),stg.data.currentRPageOb&&i.push(stg.data.currentRPageOb.index),stg.readSlot("note"+stg.getBookId(),(function(n){for(var r=0;r<i.length;r++)for(var a=0;a<n.length;a++)n[a].chapter==i[r]&&String(n[a].location).split(".")[1]==o&&t.push(n[a]);e(t)}))},n.getCurrentNotesByLocation=function(e,t){var o=[];if(!e)return t([]);n.getCurrentNotes((function(n){for(var i=0;i<n.length;i++)n[i].location==e&&o.push(n[i]);o.sort((function(e,t){return phpDateToJS(e.date?e.date:e.dateLocal)>phpDateToJS(t.date?t.date:t.dateLocal)?1:-1})),t(o)}))},n.addNotesFromQuestions=function(e,t){for(var n=e.elem.getElementsByClassName("ques"),i=[],r=[],a=0;a<n.length;a++){var s=n[a],c=s.getElementsByClassName("questionTxt");c.length||(c=s.getElementsByTagName("p"));for(var l=c[0].textContent,d=s.getElementsByClassName("ans"),u=0;u<d.length;u++){var p,f=d[u],h=f.className;h=h.split(" "),"radio"==f.type?p="mcq":"checkbox"==f.type?p="mmcq":("text"==f.type||"textarea"==f.type)&&(p="sa");var g=o(f.className),m="";if("mcq"==p||"mmcq"==p){if(!f.checked){g&&r.push({nid:g,elem:f});continue}m=f.nextElementSibling.textContent}if("sa"==p){if(""==f.value){g&&r.push({nid:g,elem:f});continue}m=f.value}var v={};if(v.chapter||(v.chapter=chapters.getElemChapterIndex(f,{ignoreAnchors:!0})),v.chaptername||(v.chaptername=chapters.getElemChapterTitle(f)),v.file||(v.file=chapters.getElemChapterFilename()),!v.location)try{v.location=traverser.convertElemsToLocation([f],e.root).left,e.rootIndex&&(v.location=e.rootIndex+"."+v.location)}catch(e){v.location||(v.location="0")}v.type||(v.type="content"),v.src||(v.src=l),v.note=m,g&&(v.nid=g),i.push({ob:v,elem:f})}}function b(e){e>=r.length?t&&t():stg.deleteNote(r[e].nid,null,(function(){removeClass(r[e].elem,"knote"+r[e].nid),b(++e)}))}!function e(t){if(t>=i.length)return void b(0);stg.addNote(i[t].ob,(function(){addClass(i[t].elem,"knote"+i[t].ob.nid),e(++t)}))}(0)},n.addIcon=function(e,t){if("page"==e.type){if(!(s=traverser.getElemsByLocation(e.location))[0])return;var o=selection.createNoteMarker(e,s[0],{class:"contentSideNoteMarker"});if(c(o,e),o.addEventListener("click",(function(e){virt.safeScrollToElem("content",o,!0),i(this.id.split("knote")[1],(function(t){n.noteClicked([t]),e.stopImmediatePropagation()}))})),o.addEventListener("tap",(function(e){e.stopImmediatePropagation()})),o.addEventListener("hold",(function(t){var o=[{name:translit.get("edit"),func:function(){popovers.hide(),n.noteClicked([e])}},{name:translit.get("delete"),func:function(){stg.deleteNote(e.nid,null,(function(){selection.deleteNoteMarker(e.nid),popovers.hide()}))}},{name:translit.get("cancel"),func:function(){popovers.hide()}}];popovers.show({mode:"popoverList",listOb:o,backdropClickToClose:!1})})),!mobile){var r=document.createElement("span");r.className="editIcon icon kb-close",r.addEventListener("click",(function(t){n.confirmDeletion((function(){stg.deleteNote(e.nid,null,(function(){selection.deleteNoteMarker(e.nid),kotobee.dispatchEvent("noteDeleted",e)}))})),t.stopImmediatePropagation()})),r.addEventListener("tap",(function(e){e.stopImmediatePropagation()})),o.appendChild(r),o.addEventListener("mouseover",(function(e){addClass(o,"edit"),o.addEventListener("mouseout",(function(e){removeClass(o,"edit")}))}))}}if("content"==e.type){for(var a,s=$injector.get("annotations").getMatchingElements(e,{root:t}),l=0;l<s.length;l++)s[l]&&addClass(s[l],"knote"+e.nid);if(1==s.length&&s[0]){var d=s[0].type;if("radio"==d||"checkbox"==d)return void(s[0].checked=!0);if("text"==d||"textarea"==d)return void(s[0].value=e.note)}for(l=0;l<s.length;l++)s[l]&&("double"!=stg.data.currentView||chapters.elemInChapterElem(s[l],e.chapter))&&addClass(a=s[l],"contentNoteBG");if(!a)return;c(a,e),addClass(a,"last"),$timeout((function(){try{var t=selection.createNoteMarker(e,a);t&&(t.onclick=function(e){var t=this.getAttribute("id");i(t.split("knote")[1],(function(t){n.noteClicked([t]),e.stopImmediatePropagation(),e.preventDefault()}))},t.addEventListener("tap",(function(e){e.stopImmediatePropagation()})))}catch(e){}}))}},n.confirmDeletion=function(t){if(e)return t();modals.hide();var n={title:"confirmation",msg:"noteDeleteConfirm",barStyle:"bar-dark"},o={label:"delete",style:"button-assertive",func:function(){n.dontAskChecked&&(e=!0),t&&t(),modals.hide()}},i={label:"cancel",func:function(){n.dontAskChecked&&(e=!0),modals.hide()}};n.dontAsk=!0,n.btns=[o,i],modals.show({mode:"confirm",confirmOptions:n})},n.confirmPublic=function(e){if(t)return e();modals.hide();var n={title:"confirmation",msg:"notePublicConfirm",barStyle:"bar-dark"},o={label:"ok",style:"button-positive",func:function(){n.dontAskChecked&&(t=!0),e&&e(),modals.hide()}},i={label:"cancel",func:function(){n.dontAskChecked&&(t=!0),modals.hide()}};n.dontAsk=!0,n.btns=[o,i],modals.show({mode:"confirm",confirmOptions:n})},n.noteClicked=function(e,t){try{e||(e=[{}]),n.getCurrentNotesByLocation(e[0]?e[0].location:null,(function(n){var o={};o.cb=t,o.obs=e,o.save=a,o.note={},o.delete=r,o.allNotes=n,modals.show({mode:"note",dynamic:!0,animation:"slide-in-up",noteOptions:o,event:e[0].event})}))}catch(e){}},n.noteClickedOld=function(e,t){try{e||(e=[{}]);var o={};o.cb=t,o.obs=e,o.save=a,e[0]&&e[0].note&&(Object.assign(o,e[0]),o.delete=function(){n.confirmDeletion((function(){for(var o=0;o<e.length;o++)n.delete(e[0],null,(function(){o==e.length-1&&$timeout((function(){modals.hide(),t&&t()}),300)}))}))}),modals.show({mode:"note",dynamic:!0,animation:"slide-in-up",noteOptions:o,event:e[0].event})}catch(e){}},n.delete=function(e,t,o){var i=e.nid;selection.deleteNoteMarker(i);for(var r=document.getElementsByClassName("knote"+i),a=r.length;a--;){var s=r[a];a==r.length-1&&(removeClass(r[a],"last"),n.deleteNoteAttribute(r[a])),removeClass(r[a],"knote"+i),-1==s.className.indexOf("knote")&&removeClass(s,"contentNoteBG")}stg.deleteNote(i,t,o),annotations.updateNotebookArray(),kotobee.dispatchEvent("noteDeleted",i)},n.deleteAll=function(e,t){stg.getNotes((function(o){var i=-1;!function r(){if(++i>=o.length)return void(t&&t());n.delete(o[i],e,(function(){i%100==0?setTimeout(r,30):r()}))}()}))},n.deleteNoteAttribute=function(e){},n.notebookClicked=function(e){isNative&&crdv.vibrate(),overflowScroll||nav.resize(),modals.show({mode:"notebook",dynamic:!0,scope:e,animation:"slide-in-up",cb:function(){}})},n})),createService("tts",(function(){var e,t,n,o={};function i(e,t){if(t||(t=0),!window.speechSynthesis)return e([]);var n=window.speechSynthesis.getVoices();if(!n.length){if(t>20)return;return setTimeout((function(){i(e,++t)}),50)}e(n)}function r(e){var t=[],n=0,o=20,i=e.split(" ");return function e(){var r=i.map((function(e,t){if(t>=n&&t<o)return e.trim()})).join(" ");t.push(r.trim()),n<=i.length&&o<=i.length?(n=o,o+=20,e()):t=t.filter((function(e){return""!=e}))}(),t}return o.initialize=function(){chapters.addListener((function(e){isNative||"newChapter"==e&&($rootScope.renderScope.applyHeader("default"),o.reset())}))},o.pause=function(){o.paused?(window.speechSynthesis.resume(),o.paused=!1,Vue.set(stg.data,"ttsPaused",!1)):(window.speechSynthesis.pause(),o.paused=!0,Vue.set(stg.data,"ttsPaused",!0))},o.nextParagraph=function(){n&&(t>=n.length-1||o.readFromHere(t+1))},o.prevParagraph=function(){n&&0!=t&&o.readFromHere(t-1)},o.reset=function(){window.speechSynthesis.cancel(),selection.reset(),mobile&&n&&n.length&&$rootScope.renderScope.applyHeader("tts");for(var t=cache.getOb("epubContent").getElementsByClassName("ttsBG");t.length;)removeClass(t[0],"ttsBG");e&&clearInterval(e)},o.start=function(t,n){o.reset(),setTimeout((function(){window.speechSynthesis.speak(t),Vue.set(stg.data,"ttsPaused",!1),o.paused=!1,n&&addClass(n,"ttsBG"),e=setInterval((function(){window.speechSynthesis.speaking||(o.paused=!1,clearInterval(e),stg.data.settings.ttsAuto&&o.nextParagraph())}),500)}),50)},o.readFromHere=function(e){if(config.ttsFromHere){if(desktop)return kError.update({error:"speechUnsupportedInDesktop"});if(preview)return kError.update({error:"speechUnsupportedInPreview"});$rootScope.renderScope.applyHeader("tts"),n=selection.getBlocksArray({hasText:!0});var a=selection.getSelectedText();if(null==(t=e))for(var s=0;s<n.length;s++)if(n[s].current){t=s;break}if(null==t&&(t=0),t<0&&(t=0),t>n.length-1&&(t=n.length-1),a=selection.getSelectedText([n[t].elem]))if(isNative&&"undefined"!=typeof TTS)crdv.tts(a,(function(e){}));else try{if("speechSynthesis"in window&&SpeechSynthesisUtterance){kStatus.showAndHide(translit.get("preparingVoice"),600,{dots:!0}),window.speechSynthesis.cancel(),window.ttsProcessedText=[];var c=new SpeechSynthesisUtterance;i((function(e){c.rate=(config.ttsRate?config.ttsRate:100)/100;var i=config.defaultTtsLanguage?config.defaultTtsLanguage:"en-US";"id-ID"===i&&(mobile&&!isNative?i="in_ID":!mobile&&!desktop&&e[0]&&e[0].voiceURI&&-1!==e[0].voiceURI.indexOf("moz-tts")&&(i="id"));var s=e.filter((function(e){return e.lang==i}));function l(e){if(c.lang=e.lang,c.voice=e,window.ttsProcessedText=r(a),window.ttsProcessedText.length){var i=0;s(i),c.onend=function(){i<window.ttsProcessedText.length-1&&s(++i)}}function s(e){window.ttsProcessedText.length&&(c.text=window.ttsProcessedText[e],o.start(c,n[t].elem))}}stg.readSlot("ttsLang",(function(t){if("string"==typeof t&&(s=e.filter((function(e){return e.lang==t}))).length)return l(s[0]);tts.ttsChangeUserLang(null,l)}))}))}else kError.update({error:"speechUnsupported"})}catch(e){kError.update({error:"speechUnsupported"})}}},o.read=function(){if(config.tts){if(desktop)return kError.update({error:"speechUnsupportedInDesktop"});if(preview)return kError.update({error:"speechUnsupportedInPreview"});n=null;var e=selection.getSelectedText();if(e)if(isNative&&"undefined"!=typeof TTS)crdv.tts(e,(function(e){}));else try{if("speechSynthesis"in window&&SpeechSynthesisUtterance){kStatus.showAndHide(translit.get("preparingVoice"),600,{dots:!0}),window.speechSynthesis.cancel(),window.ttsProcessedText=[];var t=new SpeechSynthesisUtterance;i((function(n){t.rate=(config.ttsRate?config.ttsRate:100)/100;var i=config.defaultTtsLanguage?config.defaultTtsLanguage:"en-US";"id-ID"===i&&(mobile&&!isNative?i="in_ID":!mobile&&!desktop&&n[0]&&n[0].voiceURI&&-1!==n[0].voiceURI.indexOf("moz-tts")&&(i="id"));var a=n.filter((function(e){return e.lang==i}));function s(n){if(t.lang=n.lang,t.voice=n,window.ttsProcessedText=r(e),window.ttsProcessedText.length){var i=0;a(i),t.onend=function(){i<window.ttsProcessedText.length-1&&a(++i)}}function a(e){window.ttsProcessedText.length&&(t.text=window.ttsProcessedText[e],o.start(t))}}stg.readSlot("ttsLang",(function(e){if("string"==typeof e&&(a=n.filter((function(t){return t.lang==e}))).length)return s(a[0]);tts.ttsChangeUserLang(null,s)}))}))}else kError.update({error:"speechUnsupported"})}catch(e){kError.update({error:"speechUnsupported"})}}},o.ttsChangeUserLang=function(e,t){i((function(n){e||(e={});var i={};i.voices=n,i.error=null,i.lang=e.lang?e.lang:"en-US",i.save=function(){if(n&&n.length){i.error=null;var e=n.filter((function(e){return e.lang===i.lang}));if(e.length){var r=e[0];t&&t(r),stg.writeSlot("ttsLang",i.lang),o.langSelected=!0,setTimeout(modals.hide,50)}else i.error=!0}},modals.show({mode:"ttsVoices",ttsOptions:i})}))},o.showOptions=function(e,t){e||(e={}),stg.readSlot("ttsLang",(function(n){e.lang=n,i((function(n){var i={};i.voices=n,i.error=null,i.lang=e.lang?e.lang:"en-US",i.save=function(){settings.saveSettings(),i.error=null;var e=n.filter((function(e){return e.lang===i.lang}));if(e.length){var r=e[0];t&&t(r),stg.writeSlot("ttsLang",i.lang),o.langSelected=!0,setTimeout(modals.hide,50)}else i.error=!0},modals.show({mode:"ttsOptions",ttsOptions:i})}))}))},o}));var compInstances={},compClasses={};!function(){var e;compClasses.bookItem=Vue.component("bookItem",{data:function(){return{imgLoading:!0,loaded:null}},template:getTemplate("components/bookItem.html"),mounted:function(){compInstances.bookItem=this,this.init()},props:["book"],methods:(e={init:function(){},bookClicked:function(e){var t;e&&e.url&&(t=e.url),this.$emit("bookClicked",this.book,t)}},e)})}(),function(){var e;compClasses.bookmarkItem=Vue.component("bookmarkItem",{data:function(){return{imgLoading:!0}},template:getTemplate("components/bookmarkItem.html"),mounted:function(){compInstances.bookmarkItem=this,this.init()},props:["item","showDelete"],computed:{},methods:(e={init:function(){},deleteBookmark:function(e,t){inherited(this.$parent,"deleteBookmark",[e,t])},noteItemClicked:function(e){inherited(this.$parent,"noteItemClicked",[e])}},e)})}(),compClasses.bookSection=Vue.component("bookSection",{data:function(){return{loading:null,scrollAtStart:null,scrollAtEnd:null}},template:getTemplate("components/bookSection.html"),mounted:function(){compInstances.bookSection=this,this.init(),window.addEventListener("resize",this.resize)},destroyed:function(){window.removeEventListener("resize",this.resize)},computed:{contentComp:function(){return this.$parent.$parent},sectionBooks:function(){return this.section?this.section.books.structured?this.section.books.books:this.section.books:[]}},props:["section"],methods:function(){var e,t,n,o={};function i(e,t){var n=e.scrollLeft,o=performance.now();requestAnimationFrame((function i(r){var a,s=r-o,c=Math.min(s/300,1);e.scrollLeft=n+t*((a=c)<.5?2*a*a:(4-2*a)*a-1),c<1&&requestAnimationFrame(i)}))}return o.init=function(){this.scrollend()},o.resize=function(e){this.scrolled(),this.scrollend()},o.hasMore=function(){if(this.section.books.structured)return this.section.books.books.length<this.section.books.total},o.catClicked=function(e){$location.path("/library/tab/"+e)},o.bookClicked=function(e){this.$emit("bookClicked",e)},o.touchstart=function(o){e=o.touches[0].clientX,t=o.touches[0].clientY,n=null},o.touchmoved=function(o){var i=o.touches[0].clientX-e,r=o.touches[0].clientY-t;null===n&&(n=Math.abs(i)>Math.abs(r)),n&&o.stopPropagation()},o.scrolled=function(e){},o.scrollstart=function(){},o.scrollend=function(){var e,t=this.$el.getElementsByClassName("bookList")[0];this.scrollAtStart=0==t.scrollLeft,this.scrollAtEnd=0==(e=t).scrollWidth-e.clientWidth-(stg.data.settings.rtl?-1:1)*e.scrollLeft},o.next=function(){i(this.$el.getElementsByClassName("bookList")[0],stg.data.settings.rtl?-300:300)},o.prev=function(){i(this.$el.getElementsByClassName("bookList")[0],stg.data.settings.rtl?300:-300)},o}()}),compClasses.bookThumb=Vue.component("bookThumb",{data:function(){return{imgLoading:!0}},template:getTemplate("components/bookThumb.html"),mounted:function(){compInstances.bookThumb=this,this.init()},props:["book"],updated:function(){this.updated()},methods:function(){var e={};function t(){var e=this;$timeout((function(){if(!e.book.coverImg&&(Vue.set(e.book,"coverImg",book.getCoverImgPath(e.book)),chromeApp))if(stg.data.chromeAssets[e.book.coverImg])e.book.coverImg=stg.data.chromeAssets[e.book.coverImg];else{var t=e.book.coverImg;delete e.book.coverImg,getImgDataSrc(t,(function(n){e.book.coverImg=n,stg.data.chromeAssets[t]=n,e.$apply()}))}}))}return e.init=function(){t.bind(this)()},e.updated=function(){t.bind(this)()},e.coverLoaded=function(e){this.imgLoading=!1;var t=this.$el;if(this.$parent.loaded=!0,config.bookThumbShadow){var n=t.getElementsByClassName("bookShadow");n.length&&(n[0].style.transform="scale("+t.width/t.parentNode.offsetWidth+")")}},e}()}),function(){var e;compClasses.categoryList=Vue.component("categoryList",{data:function(){return{}},template:getTemplate("components/categoryList.html"),mounted:function(){compInstances.categoryList=this,this.init()},props:["rtl","list","odd","level"],methods:(e={init:function(){},isVisible:function(e){return e.children&&!e.hide&&(!e.submode||"visible"==e.submode||"expand"==e.submode&&e.expand)},itemClicked:function(e){if("expand"==e.submode)return Vue.set(e,"expand",!e.expand);$location.path("/library/cat/"+e.id)},categoryClicked:function(e){}},e)})}(),window.closableModal={methods:{hideModal:function(){modals.hide()}}},function(){var e;compClasses.hlightItem=Vue.component("hlightItem",{data:function(){return{imgLoading:!0}},template:getTemplate("components/hlightItem.html"),mounted:function(){compInstances.hlightItem=this,this.init()},props:["item","showDelete"],computed:{},methods:(e={init:function(){},deleteHlight:function(e,t){inherited(this.$parent,"deleteHlight",[e,t])},noteItemClicked:function(e){inherited(this.$parent,"noteItemClicked",[e])}},e)})}(),compClasses.infiniteList=Vue.component("infiniteList",{data:function(){return{header:null,footer:null,freeze:null}},template:getTemplate("components/infiniteList.html"),props:["scroll","autoscroll","overflowScroll","padding","pullToRefresh","infiniteLoading","pullText","pullIcon","noDataText","hasHeader","hasFooter","delegateHandle"],mounted:function(){compInstances.infiniteList=this,this.init()},computed:{classArray:function(){var e=[];return e.push("scroll-content"),e.push(this.overflowScroll?"overflow-scroll":""),e.push(this.header?"has-header":""),e.push(this.footer?"has-footer":""),e}},watch:{freeze:function(){this.$refs.vueScroller&&(this.$refs.vueScroller.scroller.options.scrollingY=!this.freeze,this.$refs.vueScroller.scroller.__enableScrollY=!this.freeze)}},methods:function(){var e={};function t(){for(var e=this.$el.parentNode,t=0;t<e.children.length;t++)null==this.header&&hasClass(e.children[t],"bar-header")&&(this.header=!0),null==this.footer&&hasClass(e.children[t],"bar-footer")&&(this.footer=!0)}return e.init=function(){var e=this;if(this.header=this.hasHeader,this.footer=this.hasFooter,t.bind(this)(),this.$refs.vueScroller&&MutationObserver){var n=this.$refs.vueScroller.$el.children[0];new MutationObserver((function(t){ob=window.transform.parse(n.style.transform);var o={target:{scrollTop:-ob.translate3d[1]}};e.$emit("scroll",o)})).observe(n,{attributes:!0,attributeFilter:["style"]})}},e.refresh=function(e){this.$emit("refresh",e)},e.infinite=function(e){this.$emit("infinite",e)},e}()}),function(){var e;compClasses.libraryRow=Vue.component("libraryRow",{data:function(){return{}},props:["row"],template:getTemplate("components/libraryRow.html"),mounted:function(){compInstances.libraryRow=this,this.init()},computed:{library:function(){return document.getElementById("library").__vue__}},methods:(e={init:function(){},getStyle:function(e){if("nothing"==JSON.parse(e.config).actionType)return{pointerEvents:"none"}},getBg:function(e){var t=JSON.parse(e.config);if(t.bgColor)return{backgroundColor:t.bgColor}}},e)})}(),function(){var e;Vue.component("noPayments",{data:function(){return{}},template:getTemplate("components/noPayments.html"),mounted:function(){this.init()},props:["bookInfoOptions"],methods:(e={init:function(){},goBack:function(){if(this.bookInfoOptions)return this.bookInfoOptions.stage="info"}},e)})}(),function(){var e;compClasses.noteItem=Vue.component("noteItem",{data:function(){return{imgLoading:!0}},template:getTemplate("components/noteItem.html"),mounted:function(){compInstances.noteItem=this,this.init()},props:["item","showDelete"],computed:{},methods:(e={init:function(){},deleteNote:function(e,t){inherited(this.$parent,"deleteNote",[e,t])},noteItemClicked:function(e){inherited(this.$parent,"noteItemClicked",[e])},noteEntryStyle:function(e,t){var n=[];return t==e&&n.push("editing"),e.public?(n.push("public"),(e.uid==stg.data.user.id||stg.data.user.perms&&stg.data.user.perms.globaldata)&&n.push("mine"),n.push("hasAvatar")):n.push("mine"),n.join(" ")}},e)})}(),compClasses.pan=Vue.component("pan",{data:function(){return{showScrollbarY:null,showScrollbarX:null,enabled:!0}},template:getTemplate("components/pan.html"),mounted:function(){compInstances.pan=this,this.init()},destroyed:function(){this.destroyed()},computed:{$child:function(){return this.scrollPane.children[0]},scrollPane:function(){return this.$el.getElementsByClassName("scrollPane")[0]},scrollHeadX:function(){if(this.showScrollbarX&&this.scrollbarX){var e=this.$el.getElementsByClassName("kotobeeScrollbarX");return e.length?e[0].children[0]:void 0}},scrollHeadY:function(){if(this.showScrollbarY&&this.scrollbarY){var e=this.$el.getElementsByClassName("kotobeeScrollbarY");return e.length?e[0].children[0]:void 0}},container:function(){return this.containerId?document.getElementById(this.containerId):null}},props:["scrollbarX","scrollbarY","minZoom","maxZoom","rtl","padding","containerId","resetVariable","wheelMode"],watch:{},methods:function(){var e,t,n,o,i,r,a,s,c,l,d,u,p,f,h,g,m,v,b,k,y,w,C,x={};function I(){F.bind(this)(D.bind(this)())}function E(){var e=this,t=this.$el;t.addEventListener("mousedown",L.bind(this)),t.addEventListener("touchstart",L.bind(this)),t.addEventListener("mousewheel",A.bind(this)),mobile||t.addEventListener("dblclick",N.bind(this)),document.addEventListener("keydown",r=S.bind(this)),document.addEventListener("keyup",a=T.bind(this)),window.addEventListener("resize",i=I.bind(this)),this.resetVariable&&(u=this.$watch(this.resetVariable,(function(t,n){e.reset()})))}function S(e){p=e.shiftKey}function T(e){p=null}function O(e,t){if(e.className==t||e.parentNode.className==t)return!0}function N(e){if(this.enabled&&!(mobile&&"dblclick"==e.type||O(e.target,"kotobeeScrollbarY")||O(e.target,"kotobeeScrollbarX"))){e=R(e);var t,n,o,i,r=X.bind(this)(),a=(r.getBoundingClientRect(),$.bind(this)()),s=D.bind(this)();r.offsetWidth/r.offsetHeight>a.width/a.height?(t=this.fitToWidth,n=Z.bind(this)()):(t=this.fitToHeight,n=G.bind(this)()),o=s.scale,i=n,U(o)==U(i)?(this.scaleTo(this.maxZoom*n,!0,e),kotobee.dispatchEvent("transformationChanged",this.maxZoom*n)):t(!0)}}function A(e){if(this.enabled)if("zoom"==this.wheelMode){var t=D.bind(this)(),n=e.deltaY>0?-.1:.1;this.scaleTo.bind(this)(t.scale+n,!0,e),kotobee.dispatchEvent("transformationChanged",t.scale+n)}else{var o=e.deltaY>0?-25:25;t=D.bind(this)(),p?this.panTo(t.translate3d[0]+o,null):this.panTo(null,t.translate3d[1]+o)}}function L(i){var r=this;if(this.enabled&&!B.bind(this)(i)){if("touchstart"==i.type&&!h)return h=!0,void setTimeout((function(){h&&i.touches&&i.touches.length&&(f=null,L.bind(r)(i))}),200);i=R(i),P.bind(this)(i),document.body.addEventListener("touchmove",n=M.bind(this)),document.body.addEventListener("mousemove",e=M.bind(this)),document.body.addEventListener("mouseup",t=P.bind(this)),document.body.addEventListener("touchend",o=P.bind(this));var a=X.bind(this)(),d=a.getBoundingClientRect(),u=(this.container?this.container:this.$el).getBoundingClientRect();if(s=i.clientX-d.x+u.x,c=i.clientY-d.y+u.y,i.touches&&i.touches.length>1)return s=i.touches[0].clientX+(i.touches[1].clientX-i.touches[0].clientX)/2,c=i.touches[0].clientY+(i.touches[1].clientY-i.touches[0].clientY)/2,l=Math.hypot(i.touches[0].clientX-i.touches[1].clientX,i.touches[0].clientY-i.touches[1].clientY),l=null,d=a.getBoundingClientRect(),g=((i.touches[1].clientX+i.touches[0].clientX)/2-d.left)/d.width,m=((i.touches[1].clientY+i.touches[0].clientY)/2-d.top)/d.height,void(stg.data.pinching=!0)}}function B(e){if(e.touches&&!(e.touches.length>1)){if(f&&Math.abs(e.touches[0].clientX-f.clientX)<25&&Math.abs(e.touches[0].clientY-f.clientY)<25)return N.bind(this)(e),!0;f=e.touches[0],setTimeout((function(){f=null}),300)}}function P(i){document.body.removeEventListener("touchmove",n),document.body.removeEventListener("mousemove",e),document.body.removeEventListener("mouseup",t),document.body.removeEventListener("touchend",o),l=null,h=null,stg.data.pinching=!1}function M(e){if((e=R(e)).touches&&e.touches.length>1){var t=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);if(l){var n=(t-l)/l;e.clientX=(e.touches[0].clientX+e.touches[1].clientX)/2,e.clientY=(e.touches[0].clientY+e.touches[1].clientY)/2;var o=D.bind(this)();e.cursorRatioX=g,e.cursorRatioY=m,this.scaleTo.bind(this)(o.scale+n,!1,e),kotobee.dispatchEvent("transformationChanged",o.scale+n)}l=t}else this.panTo(e.clientX-s,e.clientY-c)}function R(e){if(e.touches&&e.touches.length){var t=e.touches;(e={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY,screenX:e.touches[0].screenX,screenY:e.touches[0].screenY}).touches=[];for(var n=0;n<t.length;n++)e.touches.push(t[n])}return e}function D(){var e={};return this.scrollPane.style.transform&&(e=window.transform.parse(this.scrollPane.style.transform)),e.translate3d||(e.translate3d=[0,0,0]),e.scale||(e.scale=1),e}function $(){return{left:0,top:0,right:V.bind(this)(),bottom:H.bind(this)(),width:V.bind(this)(),height:H.bind(this)(),padding:this.padding}}function V(){return(this.containerId?document.getElementById(this.containerId):this.$el).offsetWidth}function H(){return(this.containerId?document.getElementById(this.containerId):this.$el).offsetHeight}function F(e,t){t||(t={});var n=X.bind(this)(),o={width:n.offsetWidth,height:n.offsetHeight};t.dontCap||q.bind(this)(e,o),j.bind(this)(e,t),kotobee.dispatchEvent("pageTransformed",e)}function q(e,t){var n=$.bind(this)(),o=e.scale*t.width,i=e.scale*t.height;o>n.width-2*n.padding?(e.translate3d[0]>n.padding&&(e.translate3d[0]=n.padding),e.translate3d[0]+o<n.width-n.padding&&(e.translate3d[0]=n.width-n.padding-o)):e.translate3d[0]=(n.width-o)/2,i>n.height-2*n.padding?(e.translate3d[1]>n.padding&&(e.translate3d[1]=n.padding),e.translate3d[1]+i<n.height-n.padding&&(e.translate3d[1]=n.height-n.padding-i)):e.translate3d[1]=(n.height-i)/2,o<n.width-2*n.padding&&(e.translate3d[0]=(n.width-o)/2),i<n.height-2*n.padding&&(e.translate3d[1]=(n.height-i)/2)}function j(e,t){var n=this;if(t||(t={}),t.pid||(t.pid=d=Math.round(9999*Math.random())),d==t.pid)if(t.ease){var o=D.bind(this)(),i={},r=!0;for(var a in e)if(i[a]=clone(o[a]),Array.isArray(e[a]))for(var s=0;s<e[a].length;s++)i[a][s]=o[a][s]+(e[a][s]-o[a][s])/3,U(i[a][s])==U(e[a][s])?i[a][s]=e[a][s]:r=!1;else a&&(i[a]=o[a]+(e[a]-o[a])/3,U(i[a])==U(e[a])?i[a]=e[a]:r=!1);this.scrollPane.style.transform=window.transform.stringify(i),z.bind(this)(),r||window.requestAnimationFrame((function(){j.bind(n)(e,t),n.$emit("scrolled")}))}else this.scrollPane.style.transform=window.transform.stringify(e),z.bind(this)(),n.$emit("scroll")}function z(){var e=this;C||setTimeout((function(){K.bind(e)()}),100)}function U(e){return Math.round(1e3*e)/1e3}function _(e){var t,n,o=J.bind(this)();if("y"==w&&this.scrollHeadY){var i=e.clientY-y;i<o.headMinY&&(i=o.headMinY),i>o.headMaxY&&(i=o.headMaxY),this.scrollHeadY.style.top=i+"px",n=o.minY+(o.maxY-o.minY)*(i/o.headMaxY)}if("x"==w&&this.scrollHeadX){var r=e.clientX-k;r<o.headMinX&&(r=o.headMinX),r>o.headMaxX&&(r=o.headMaxX),this.scrollHeadX.style.left=r+"px",t=o.minX+(o.maxX-o.minX)*(r/o.headMaxX)}this.panTo(t,n)}function W(e){this.scrollHeadX&&this.scrollHeadX.classList.remove("active"),this.scrollHeadY&&this.scrollHeadY.classList.remove("active"),document.body.removeEventListener("mousemove",v),document.body.removeEventListener("mouseup",b),C=!1}function K(){var e=this;Y.bind(this)();var t=J.bind(this)(),n=t.bounds,o=t.rect;this.showScrollbarY=o.height>n.height-2*n.padding+1,this.showScrollbarX=o.width>n.width-2*n.padding+1,Vue.nextTick((function(){if(e.showScrollbarY&&e.scrollbarY){var n=(o.top-t.parentRect.top-t.minY)/(t.maxY-t.minY);n<0&&(n=0),n>1&&(n=1);var i=t.headMinY+(t.headMaxY-t.headMinY)*n;e.scrollHeadY.style.top=i+"px"}if(e.showScrollbarX&&e.scrollbarX){var r=(o.left-t.minX)/(t.maxX-t.minX);r<0&&(r=0),r>1&&(r=1);var a=t.headMinX+(t.headMaxX-t.headMinX)*r;e.scrollHeadX.style.left=a+"px"}}))}function Y(){var e=this,t=$.bind(this)(),n=X.bind(this)().getBoundingClientRect();if(e.scrollHeadY){var o=t.height/(n.height+2*t.padding);e.scrollHeadY.style.height=o*this.scrollHeadY.parentNode.offsetHeight+"px"}if(e.scrollHeadX){var i=t.width/(n.width+2*t.padding);e.scrollHeadX.style.width=i*this.scrollHeadX.parentNode.offsetWidth+"px"}}function J(){var e=$.bind(this)(),t=X.bind(this)().getBoundingClientRect(),n={minY:e.padding,maxY:e.height-t.height-e.padding,minX:e.padding,maxX:e.width-t.width-e.padding,headMinX:0,headMinY:0,bounds:e,rect:t},o=this.container?this.container:this.$el;return o&&(n.parentRect=o.getBoundingClientRect()),this.scrollHeadY&&(n.headMaxY=this.scrollHeadY.parentNode.offsetHeight-this.scrollHeadY.offsetHeight),this.scrollHeadX&&(n.headMaxX=this.scrollHeadX.parentNode.offsetWidth-this.scrollHeadX.offsetWidth),n}function X(){return this.scrollPane.children[0]}function G(){var e=$.bind(this)(),t=X.bind(this)();return(e.height-2*e.padding)/t.offsetHeight}function Z(){var e=$.bind(this)(),t=X.bind(this)();return(e.width-2*e.padding)/t.offsetWidth}function Q(){var e=$.bind(this)(),t=X.bind(this)(),n=(e.height-2*e.padding)/t.offsetHeight,o=(e.width-2*e.padding)/t.offsetWidth,i=this.minZoom;return n<i&&(i=n),o<i&&(i=o),i}function ee(){var e=this.maxZoom;return e<1&&(e=1),e}return x.init=function(){null==this.scrollbarX&&(this.scrollbarX=!1),null==this.scrollbarY&&(this.scrollbarY=!1),null==this.minZoom&&(this.minZoom=.5),null==this.maxZoom&&(this.maxZoom=2),null==this.padding&&(this.padding=100),this.minZoom=Number(this.minZoom),this.maxZoom=Number(this.maxZoom),E.bind(this)(),F.bind(this)(D.bind(this)())},x.destroyed=function(){window.removeEventListener("resize",i),document.removeEventListener("keydown",r),document.removeEventListener("keyup",a),u&&u()},x.reset=function(){this.scrollPane.style.transform=null},x.panTo=function(e,t,n){var o=D.bind(this)();null!=e&&(o.translate3d[0]=e),null!=t&&(o.translate3d[1]=t),o.translate3d[2]=0,F.bind(this)(o,{ease:n})},x.scrollMousedown=function(e,t){if(t.stopPropagation(),W.bind(this)(t),document.body.addEventListener("mousemove",v=_.bind(this)),document.body.addEventListener("mouseup",b=W.bind(this)),"y"==(w=e)&&this.scrollHeadY){this.scrollHeadY.classList.add("active");var n=this.scrollHeadY.getBoundingClientRect(),o=this.scrollHeadY.parentNode.getBoundingClientRect();y=t.clientY-n.y+o.y}"x"==w&&this.scrollHeadX&&(this.scrollHeadX.classList.add("active"),n=this.scrollHeadX.getBoundingClientRect(),o=this.scrollHeadX.parentNode.getBoundingClientRect(),k=t.clientX-n.x+o.x),C=!0},x.updateScrollbar=K,x.scrollClicked=function(e,t){if("head"!=t.target.className){var n=J.bind(this)(),o=D.bind(this)();if("y"==e&&this.scrollHeadY){var i=this.scrollHeadY.getBoundingClientRect(),r=t.clientY<i.top;o.translate3d[1]=o.translate3d[1]+((r?n.minY:n.maxY)-o.translate3d[1])/2}if("x"==e&&this.scrollHeadX){i=this.scrollHeadX.getBoundingClientRect();var a=t.clientX<i.left;o.translate3d[0]=o.translate3d[0]+((a?n.minX:n.maxX)-o.translate3d[0])/2}F.bind(this)(o)}},x.scrollTo=function(e,t,n){var o,i,r=J.bind(this)();if(null!=t&&this.scrollHeadY){var a=t;a<r.headMinY&&(a=r.headMinY),a>r.headMaxY&&(a=r.headMaxY),i=r.minY+(r.maxY-r.minY)*(a/r.headMaxY)}if(null!=e&&this.scrollHeadX){var s=e;s<r.headMinX&&(s=r.headMinX),s>r.headMaxX&&(s=r.headMaxX),o=r.minX+(r.maxX-r.minX)*(s/r.headMaxX)}this.panTo(o,i,n)},x.scrollTop=function(e){this.scrollTo(null,0,e)},x.resize=function(){I.bind(this)()},x.getScrollPosition=function(){var e=D.bind(this)(),t=J.bind(this)(),n={};return n.zoom=e.scale,n.left=t.minX-e.translate3d[0],n.top=t.minY-e.translate3d[1],n},x.getPosition=x.getScrollPosition,x.fitToHeight=function(e,t){t||(t={});var n=$.bind(this)(),o=X.bind(this)(),i=(n.height-2*n.padding)/o.offsetHeight;this.scaleTo(i,e),t.disableEvents||kotobee.dispatchEvent("transformationChanged",i)},x.fitToWidth=function(e,t){t||(t={});var n=$.bind(this)(),o=X.bind(this)(),i=(n.width-2*n.padding)/o.offsetWidth,r=null;t.top&&(r={clientX:0,clientY:0}),this.scaleTo(i,e,r),t.disableEvents||kotobee.dispatchEvent("transformationChanged",i)},x.bestFit=function(e,t){t||(t={});var n=$.bind(this)(),o=X.bind(this)(),i=(n.height-2*n.padding)/o.offsetHeight,r=(n.width-2*n.padding)/o.offsetWidth,a=r<i?r:i;this.scaleTo(a,e),kotobee.dispatchEvent("transformationChanged",a)},x.scaleTo=function(e,t,n){var o=D.bind(this)(),i=X.bind(this)(),r=$.bind(this)(),a=Q.bind(this)(),s=ee.bind(this)();e<a&&(e=a),e>s&&(e=s);var c=e*i.offsetHeight,l=e*i.offsetWidth,d=.5,u=.5;if(n)if(n.cursorRatioX)d=n.cursorRatioX,u=n.cursorRatioY;else{var p=i.getBoundingClientRect();if(0==p.width||0==p.height)throw new Error("Kotobee: Scroll content width or height is zero. Perhaps they are absolutely positioned?");d=(n.clientX-p.left)/p.width,u=(n.clientY-p.top)/p.height}o.translate3d[0]=(r.width-l)*d,o.translate3d[1]=(r.height-c)*u,o.scale=e,F.bind(this)(o,{ease:t})},x.zoomTo=function(e,t){var n=D.bind(this)(),o=X.bind(this)(),i=o.getBoundingClientRect();n.scale=e;var r=Q.bind(this)(),a=ee.bind(this)();if(n.scale<r&&(n.scale=r),n.scale>a&&(n.scale=a),0==i.width||0==i.height)throw new Error("Kotobee: Scroll content width or height is zero. Perhaps they are absolutely positioned?");n.translate3d[0]-=.5*(o.offsetWidth*n.scale-i.width),n.translate3d[1]-=.5*(o.offsetHeight*n.scale-i.height),F.bind(this)(n,{ease:t}),kotobee.dispatchEvent("transformationChanged",n)},x.zoomToRegion=function(e,t){if(e){e.scale||(e.scale=1),e.x||(e.x=0),e.y||(e.y=0);var n=$.bind(this)(),o=1,i=1;e.width&&(o=(n.width-2*n.padding)/e.width),e.height&&(i=(n.height-2*n.padding)/e.height);var r=D.bind(this)();o<i?(r.scale=o,r.translate3d[0]=-e.x*r.scale,r.translate3d[1]=(n.height-e.height*r.scale)/2-e.y*r.scale):(r.scale=i,r.translate3d[0]=(n.width-1*e.width*r.scale)/2-1*e.x*r.scale,r.translate3d[1]=-e.y*r.scale),kotobee.dispatchEvent("transformationChanged",r),F.bind(this)(r,{ease:t,dontCap:!0})}},x.getBestFit=function(e,t){var n=clone(t),o={translate3d:[]},i=$.bind(this)();n.double&&(n.width*=2),o.scale="width"==e?(i.width-2*this.padding)/n.width:(i.height-2*this.padding)/n.height;var r=o.scale*n.width,a=o.scale*n.height;return o.translate3d[0]=.5*(i.width-r),o.translate3d[1]=.5*(i.height-a),q.bind(this)(o,n),o},x}()}),compClasses.selectionOptions=Vue.component("selectionOptions",{data:function(){return{langSelected:null,optionMode:null}},template:getTemplate("components/selectionOptions.html"),mounted:function(){compInstances.selectionOptions=this,this.init()},computed:{speechSynthesisSupported:function(){return window.speechSynthesis},translated:function(){return stg.data.currentPageOb&&stg.data.currentPageOb.translationLang}},methods:function(){var e={};function t(e){return e.replace(/^[!?., {}()]*(.*?)[!?.,{} ()]*$/g,"$1")}return e.init=function(){kotobee.addEventListener("textSelected",{unique:!0},this.textSelected)},e.textSelected=function(){stg.readSlot("ttsLang",(function(e){tts.langSelected=!(!e||!e.length)})),this.optionMode=null},e.ttsChangeLangClicked=function(){stg.readSlot("ttsLang",(function(e){tts.showOptions()}))},e.ttsOptions=function(){this.optionMode="tts"},e.tts=function(){tts.read()},e.ttsReadFromHere=function(){tts.readFromHere()},e.copy=function(){selection.copyToClipboard()},e.share=function(){if(config.share){var e=selection.getSelectedText();e&&crdv.share(e)}},e.note=function(e){if(config.annotations){var t,n,o=selection.getLocation(),i=[];o.left?((t={}).type="content",t.location=o.leftRange,t.chapter=stg.data.currentPageOb.index,t.src=selection.getSelectedText(n),t.event=e,i.push(t)):o.right&&((t={}).type="content",t.location=o.rightRange,t.chapter=stg.data.currentRPageOb.index,t.src=selection.getSelectedText(n),t.event=e,i.push(t)),notes.noteClicked(i,(function(e){selection.reset()}))}},e.highlight=function(){if(config.annotations){var e,t=selection.getSelectedNodes(),n=selection.getLocation(),o=[];n.left&&((e={}).location=n.leftRange,e.chapter=stg.data.currentPageOb.index,e.src=selection.getSelectedText(t),o.push(e)),n.right&&((e={}).location=n.rightRange,e.chapter=stg.data.currentRPageOb.index,e.src=selection.getSelectedText(t),o.push(e));for(var i=0;i<t.length;i++)if(hasClass(t[i],"contentHlightBG")){for(var r=getClassThatStartsWith(t[i],"hlight"),a=0;a<o.length;a++)o[a].hid=r.substr(6);return void stg.getHlightById(o[0].hid,(function(e){for(var t=0;t<o.length;t++)o[t].color=e.color;s()}))}s()}function s(){hlights.showPopup(o,(function(e){selection.reset()}))}},e.google=function(){if(config.googleLookup){var e=t(selection.getSelectedText());if(e)try{var n="http://www.google.com/custom?q="+e;return void backend.externalLink(n,{secure:!0})}catch(e){}}},e.wikipedia=function(){if(config.wikipediaLookup){var e=t(selection.getSelectedText());if(e)try{var n="https://"+(config.wikipediaLang?config.wikipediaLang:"en")+".wikipedia.org/wiki/"+e;backend.externalLink(n,{secure:!0})}catch(e){}}},e.backClicked=function(){selection.reset()},e.smartExplain=function(e){var t={keyword:selection.getSelectedText()},n=modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait"),timeLimit:1e4});backend.smartExplain(t,(function(e){if(modals.hide(n),e&&e.success){var t=e.success;t=(t=t.replace("```html","")).replace("```",""),kotobee.popup(t,{okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,class:"smartExplain"})}else e.error&&kotobee.popup(translit.get(e.error))}))},e}()}),function(){var e;compClasses.stars=Vue.component("stars",{data:function(){return{rating:null,selectedRating:null}},template:getTemplate("components/stars.html"),mounted:function(){compInstances.stars=this,this.init()},props:["defaultRating","type"],methods:(e={init:function(){var e=this;e.rating=e.defaultRating,e.rating||(e.rating=0),"input"==e.type&&(e.rating=e.selectedRating=0)},over:function(e){"input"==this.type&&(this.rating=e)},select:function(e){var t=this;"input"==t.type&&(t.rating=t.selectedRating=e,t.$emit("selected",e))},leave:function(){var e=this;"input"==e.type&&null!=e.selectedRating&&(e.rating=e.selectedRating)}},e)})}(),function(){var e;compClasses.textSelectControls=Vue.component("textSelectControls",{data:function(){return{}},template:getTemplate("components/textSelectControls.html"),mounted:function(){compInstances.textSelectControls=this,this.init()},props:[""],methods:(e={init:function(){},extendLeft:function(){selection.extendLeft()},expand:function(){selection.expand()},extendRight:function(){selection.extendRight()}},e)})}(),function(){var e;compClasses.zoomControls=Vue.component("zoomControls",{data:function(){return{}},template:getTemplate("components/zoomControls.html"),mounted:function(){compInstances.zoomControls=this,this.init()},props:[""],methods:(e={init:function(){},fxlZoomIn:function(e){nav.fxlZoomIn(e)},fxlZoomOut:function(e){nav.fxlZoomOut(e)},fxlZoomFit:function(e){nav.fxlZoomFit(e)}},e)})}(),function(){var e;compClasses.headerAudiobook=Vue.component("headerAudiobook",{data:function(){return{}},template:getTemplate("headers/headerAudiobook.html"),mounted:function(){compInstances.headerAudiobook=this,this.init()},methods:(e={init:function(){},backClicked:function(){inherited(this.$parent,"backClicked")},exitBook:function(){app.exitBook()},chapterClicked:function(){audiobook.displayChapters()},settingsClicked:function(){audiobook.displaySettings()}},e),computed:{appWithLocalBook:function(){return"book"==config.kotobee.mode&&isReaderApp}}})}(),function(){var e;compClasses.headerDefault=Vue.component("headerDefault",{data:function(){return{}},template:getTemplate("headers/headerDefault.html"),mounted:function(){compInstances.headerDefault=this,this.init()},methods:(e={init:function(){},backClicked:function(){inherited(this.$parent,"backClicked")},exitBook:function(){app.exitBook()},chapterClicked:function(){inherited(this.$parent,"chapterClicked")},freehandClicked:function(e){inherited(this.$parent,"freehandClicked",[e])},noteClicked:function(){inherited(this.$parent,"noteClicked")},bookmarkClicked:function(){inherited(this.$parent,"bookmarkClicked")},miniappsClicked:function(){inherited(this.$parent,"miniappsClicked")}},e),computed:{header:function(){return inherited(this.$parent,"header")},appWithLocalBook:function(){return"book"==config.kotobee.mode&&isReaderApp}}})}(),function(){var e;compClasses.headerFreehand=Vue.component("headerFreehand",{data:function(){return{mode:freehand.mode,currentStyle:freehand.currentStyle,smoothingValue:freehand.smoothing,currentOptions:null,smoothing:null,brushes:null,colors:null}},template:getTemplate("headers/headerFreehand.html"),mounted:function(){compInstances.headerFreehand=this,this.init()},methods:(e={init:function(){},backClicked:function(){freehand.deactivate()},smoothingClicked:function(){var e=this;if("smoothing"==e.currentOptions)return e.closeOptions();e.currentOptions="smoothing",e.smoothing=freehand.defs.smoothing,e.smoothingValue=freehand.smoothing},brushesClicked:function(){var e=this;if("brushes"==e.currentOptions)return e.closeOptions();e.currentOptions="brushes",e.brushes=freehand.defs.brushes},colorsClicked:function(){var e=this;if("colors"==e.currentOptions)return e.closeOptions();e.currentOptions="colors",e.colors=freehand.defs.colors,e.currentStyle=freehand.currentStyle},eraserClicked:function(){this.mode="eraser",freehand.mode="eraser"},penClicked:function(){this.mode="pen",freehand.mode="pen"},clearClicked:function(){freehand.clear()},undoClicked:function(){freehand.undo()},redoClicked:function(){freehand.redo()},closeOptions:function(){this.currentOptions=null},selectColor:function(e){freehand.currentStyle.color=e,this.closeOptions()},selectBrush:function(e){freehand.currentStyle.brush=e,this.closeOptions()},selectSmoothing:function(e){freehand.smoothing=e,this.closeOptions()}},e),computed:{}})}(),function(){var e;compClasses.headerLibrary=Vue.component("headerLibrary",{data:function(){return{langDropdownExpanded:null,userDropdownExpanded:null}},template:getTemplate("headers/headerLibrary.html"),mounted:function(){compInstances.headerLibrary=this,this.init()},methods:(e={init:function(){},back:function(){return inherited(this.$parent,"back")},exitLib:function(){app.exitLib()},langSelected:function(e){this.langDropdownExpanded=!1,stg.data.settings.language=e,settings.langChanged()},enableSearch:function(){return inherited(this.$parent,"enableSearch")},redeemCodeClicked:function(){return inherited(this.$parent,"redeemCodeClicked")},showLibraryMenu:function(){return inherited(this.$parent,"showLibraryMenu")},showCart:function(){cart.show()},userLogin:function(){backend.userLoggedIn()?backend.logout():kError.update({error:"s_authError"})},menuItemClicked:function(e){return inherited(this.$parent,"menuItemClicked",[e])}},e),computed:{header:function(){return inherited(this.$parent,"header")},subMode:function(){return inherited(this.$parent,"subMode")},searchOb:function(){return inherited(this.$parent,"searchOb")},title:function(){return inherited(this.$parent,"title")},shouldShowLogin:function(){return!(!this.cloudParam("allowlogin")||!this.cloudParam("public"))||!this.cloudParam("public")},shouldShowSearch:function(){var e=this.$parent.tab;if("local"!=e&&"downloaded"!=e)return config.searchLibrary||config.searchLibContent}},watch:{"data.user.loggedIn":function(){this.userDropdownExpanded=!1}}})}(),function(){var e;compClasses.headerLibraryCategories=Vue.component("headerLibraryCategories",{data:function(){return{}},props:["autohideEase"],template:getTemplate("headers/headerLibraryCategories.html"),mounted:function(){compInstances.headerLibraryCategories=this,this.init()},methods:(e={init:function(){},shouldShowBreadcrumbs:function(e){if(e&&!e.tab)return!0},shouldShowSort:function(){var e=this.$parent.tab;if("categories"!=e&&"downloads"!=e&&"local"!=e)return!0}},e),computed:{hasCategories:function(){if(!isReaderApp)return config.showCategories&&stg.data.currentLibrary&&stg.data.currentLibrary.categories&&stg.data.currentLibrary.categories.length},currentCat:function(){return inherited(this.$parent,"currentCat")},subMode:function(){return inherited(this.$parent,"subMode")},shouldShowFavBtn:function(){if(this.config&&this.config.showFavorites)return this.data.user.loggedIn?this.cloudParam("allowlogin")||!this.cloudParam("public"):void 0}}})}(),function(){var e;compClasses.headerSearch=Vue.component("headerSearch",{data:function(){return{key:""}},template:getTemplate("headers/headerSearch.html"),mounted:function(){compInstances.headerSearch=this,this.init()},methods:(e={init:function(){this.searchKeyOb&&(this.key=this.searchKeyOb.key)},search:function(e){this.$emit("search",e),this.hide()},hide:function(){this.obj[this.prop]=this.offValue}},e),props:["obj","prop","kotobeeGradient","onValue","offValue","noCancel","searchKeyOb","placeholder"],watch:{},computed:{}})}(),function(){var e;compClasses.headerSearchItems=Vue.component("headerSearchItems",{data:function(){return{index:0,titleMode:3,results:[]}},template:getTemplate("headers/headerSearchItems.html"),mounted:function(){compInstances.headerSearchItems=this,this.init()},destroyed:function(){this.destroyed()},computed:{searchContent:function(){return compInstances.search.searchContent},countLabel:function(){return translit.get("countWithLimit").replace("[count]",this.index+1).replace("[limit]",this.results.length)}},methods:(e={init:function(){var e=this,t=e.searchContent.results[currentIndex];t&&(e.results=t.matches),e.results.index&&(e.index=e.results.index),0==e.results.length?e.titleMode="empty":e.highlightCurrentItem({initial:!0})},destroyed:function(){search.removeHighlights()},applyHeader:function(e){compInstances.reader.applyHeader(e)},backClicked:function(){this.applyHeader("default")},up:function(){var e=this;0==e.index&&(e.index=e.results.length),e.index--,e.highlightCurrentItem()},down:function(){var e=this;e.index==e.results.length-1&&(e.index=-1),e.index++,e.highlightCurrentItem()},highlightCurrentItem:function(e){var t,n=this;function o(e){kotobee.clearListeners("processedRoute"),chapters.hideLoader();var t=chapters.getCurrentHash()||e,o=traverser.getElemsByLocation(t);o[0]&&(o[0].offsetParent?(n.titleMode="title",addClass(o[0],"searchItemHighlight"),virt.safeScrollToElem("content",o[0],!0)):n.titleMode="hidden")}e||(e={}),n.results&&n.results.length&&chapters.getPageOb({page:currentIndex},(function(i){if(search.removeHighlights(),n.results[n.index]&&n.results[n.index].location&&(t=n.results[n.index].location),e.initial)return o(t);kotobee.addEventListener("processedRoute",o),chapters.redirect(currentIndex,{hash:t})}))}},e)})}(),function(){var e;compClasses.headerSelection=Vue.component("headerSelection",{data:function(){return{index:0,titleMode:3,results:[]}},extends:compClasses.selectionOptions,template:getTemplate("headers/headerSelection.html"),mounted:function(){compInstances.headerSelection=this,this.init()},computed:{speechSynthesisSupported:function(){return window.speechSynthesis},translated:function(){return stg.data.currentPageOb&&stg.data.currentPageOb.translationLang}},methods:(e={init:function(){},back:function(){this.optionsMode?this.optionsMode=null:this.backClicked()}},e)})}(),compClasses.headerTextsize=Vue.component("headerTextsize",{data:function(){return{}},template:getTemplate("headers/headerTextSize.html"),mounted:function(){compInstances.headerTextsize=this,this.init()},computed:{},methods:function(){var e={};function t(){"rfl"==stg.data.book.chapter.layout&&("double"!=stg.data.book.chapter.view&&stg.data.settings.pageScroll||$injector.get("chapters").regenerateSpreads(null,(function(){})))}return e.init=function(){},e.backClicked=function(){inherited(this,"applyHeader",["default"])},e.plus=function(){var e=settings.getTextSize();e>30||(e=Math.round(10*(e+.1))/10,this.data.settings.textSize=e+"em",settings.updateTextSize(),settings.writeTextSize(),t.bind(this)())},e.minus=function(){var e=settings.getTextSize();e<=.2||(e=Math.round(10*(e-.1))/10,this.data.settings.textSize=e+"em",settings.updateTextSize(),settings.writeTextSize(),t.bind(this)())},e}()}),function(){var e;compClasses.headerTts=Vue.component("headerTts",{data:function(){return{isPlaying:!1}},template:getTemplate("headers/headerTts.html"),mounted:function(){compInstances.headerTts=this,this.init()},methods:(e={init:function(){},backClicked:function(){this.stopClicked()},nextClicked:function(){tts.nextParagraph()},prevClicked:function(){tts.prevParagraph()},pauseClicked:function(){tts.pause()},stopClicked:function(){tts.reset(),$rootScope.renderScope.applyHeader("default")},optionsClicked:function(){tts.showOptions()}},e),computed:{}})}(),function(){var e;compClasses.readerHeader=Vue.component("readerHeader",{data:function(){return{}},template:getTemplate("headers/readerHeader.html"),mounted:function(){compInstances.readerHeader=this,this.init()},methods:(e={init:function(){}},e),computed:{header:function(){return inherited(this.$parent,"header")}}})}(),function(){var e;compClasses.ionCheckbox=Vue.component("ionCheckbox",{data:function(){return{}},template:getTemplate("ionic/ionCheckbox.html"),props:["value"],mounted:function(){compInstances.ionCheckbox=this,this.init()},methods:(e={init:function(){},valChanged:function(e){this.$emit("input",e.target.checked),this.$emit("change",e.target.checked)}},e)})}(),compClasses.ionContent=Vue.component("ionContent",{data:function(){return{header:null,footer:null}},template:getTemplate("ionic/ionContent.html"),props:["scroll","autoscroll","overflowScroll","padding","hasHeader","hasFooter","panzoom","panContainerId","panResetVariable","delegateHandle"],mounted:function(){compInstances.ionContent=this,this.init()},computed:{classArray:function(){var e=[];return e.push("scroll-content"),e.push(this.delegateHandle?"delegate-"+this.delegateHandle:null),e.push("overflow-scroll"),e.push(this.header?"has-header":""),e.push(this.footer?"has-footer":""),e},rtl:function(){return stg.data.settings.rtl}},watch:{},methods:function(){var e,t,n,o,i,r={};function a(){var e=this;this.$el.addEventListener("scroll",(function(t){e.$emit("scroll",t)}))}function s(){this.$el.addEventListener("touchstart",c.bind(this))}function c(r){document.addEventListener("touchend",t=l.bind(this)),n=r.touches[0].clientX,o=r.touches[0].clientY,i=(new Date).getTime(),e&&Math.abs(r.touches[0].clientX-e.clientX)<25&&Math.abs(r.touches[0].clientY-e.clientY)<25&&this.$emit("doubleTap"),e=r.touches[0],setTimeout((function(){e=null}),300)}function l(e){if(document.removeEventListener("touchend",t),!(e.touches.length>1)&&null!=n){var r=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY,s=n-r,c=o-a,l=(new Date).getTime()-i,d=s/l,u=function(){var e=1,t=document.getElementById("epubInner");if(!t)return e;var n=t.getBoundingClientRect().width;if(t.parentNode.style.transform){var o=window.transform.parse(t.parentNode.style.transform);o.scale&&(n*=o.scale)}var i=window.innerWidth/n,r=.1;return(e=r+(1-r)*i)>1&&(e=1),e||(e=1),e}();Math.abs(d)*u>.35&&l<500&&Math.abs(s)*u>50&&Math.abs(s)>Math.abs(c)&&this.$emit(s>0?"swipeLeft":"swipeRight"),n=null}}function d(){for(var e=this.$el.parentNode,t=0;t<e.children.length;t++)null==this.header&&hasClass(e.children[t],"bar-header")&&(this.header=!0),null==this.footer&&hasClass(e.children[t],"bar-footer")&&(this.footer=!0)}return r.init=function(){this.header=this.hasHeader,this.footer=this.hasFooter,d.bind(this)(),s.bind(this)(),a.bind(this)()},r.getScrollProxy=function(){if(this.panzoom)return this.$children[0];var e=this.$el,t={getScrollPosition:function(){return{top:e.scrollTop,left:e.scrollLeft,width:e.scrollWidth,height:e.scrollHeight}}};return t.getPosition=t.getScrollPosition,t.scrollTop=function(t){e.scrollTo(0,null)},t.scrollTo=function(t,n,o){e.scrollTo(t,n)},t.scrollBy=function(t,n,o){e.scrollBy(n,t,o)},t.resize=function(){},t.fitToWidth=function(){},t.fitToHeight=function(){},t.getElem=function(){return e},t},r}()}),function(){var e;compClasses.ionDeleteButton=Vue.component("ionDeleteButton",{data:function(){return{}},template:getTemplate("ionic/ionDeleteButton.html"),mounted:function(){compInstances.ionDeleteButton=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionFooterBar=Vue.component("ionFooterBar",{data:function(){return{}},template:getTemplate("ionic/ionFooterBar.html"),mounted:function(){compInstances.ionFooterBar=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionHeaderBar=Vue.component("ionHeaderBar",{data:function(){return{}},template:getTemplate("ionic/ionHeaderBar.html"),props:["customizable"],mounted:function(){compInstances.ionHeaderBar=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionicLoading=Vue.component("ionicLoading",{data:function(){return{template:"",active:null}},template:getTemplate("ionic/ionicLoading.html"),mounted:function(){compInstances.ionicLoading=this,this.init()},methods:(e={init:function(){},show:function(e){this.template=e.template,this.active=!0},hide:function(){this.active=!1}},e)})}(),function(){var e;compClasses.ionItem=Vue.component("ionItem",{data:function(){return{}},template:getTemplate("ionic/ionItem.html"),mounted:function(){compInstances.ionItem=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionList=Vue.component("ionList",{data:function(){return{}},template:getTemplate("ionic/ionList.html"),props:["scroll","overflowScroll"],mounted:function(){compInstances.ionList=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionPane=Vue.component("ionPane",{data:function(){return{}},template:getTemplate("ionic/ionPane.html"),mounted:function(){compInstances.ionPane=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionRefresher=Vue.component("ionRefresher",{data:function(){return{}},template:getTemplate("ionic/ionRefresher.html"),mounted:function(){compInstances.ionRefresher=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionSideMenu=Vue.component("ionSideMenu",{data:function(){return{width:null}},template:getTemplate("ionic/ionSideMenu.html"),mounted:function(){compInstances.ionSideMenu=this,this.init(),this.enableDrag()},props:["side","canSwipe"],computed:{directionClass:function(){return"menu-"+this.side},el:function(){return this.$el},menuWidth:function(){return this.width?this.width:$ionicSideMenuDelegate.menuWidth}},methods:(e={init:function(){this.width=$ionicSideMenuDelegate.menuWidth,mobile&&this.hide()},show:function(){this.$el.style.display=null},hide:function(){this.$el.style.display="none"},enableDrag:function(){mobile&&this.canSwipe&&$ionicSideMenuDelegate.enableDrag()}},e)})}(),function(){var e;compClasses.ionSideMenuContent=Vue.component("ionSideMenuContent",{data:function(){return{}},template:getTemplate("ionic/ionSideMenuContent.html"),mounted:function(){compInstances.ionSideMenuContent=this,this.init()},methods:(e={init:function(){var e=this;mobile&&this.$el.addEventListener("transitionend",(function(){e.$parent.sideMenuOpened||(e.$parent.left.hide(),e.$parent.right.hide())}))},clicked:function(){$ionicSideMenuDelegate.isOpen()&&$ionicSideMenuDelegate.close()},getTransform:function(){return this.$el.style.transform},applyTransform:function(e){var t=this;t.$el.style.transform="translate3d("+e+"px, 0px, 0px)",mobile&&(t.$parent.left.show(),t.$parent.right.show()),0!=e&&(t.$parent.left.$el.style.zIndex=t.$parent.right.$el.style.zIndex=-1,e>0?t.$parent.left.$el.style.zIndex=0:t.$parent.right.$el.style.zIndex=0),setTimeout((function(){t.$parent.sideMenuOpened=!!e}))}},e)})}(),function(){var e;compClasses.ionSideMenus=Vue.component("ionSideMenus",{data:function(){return{sideMenuOpened:null}},template:getTemplate("ionic/ionSideMenus.html"),mounted:function(){compInstances.ionSideMenus=this,this.init()},destroyed:function(){this.destroyed()},computed:{left:function(){for(var e=0;e<this.$children.length;e++)if("left"==this.$children[e].side)return this.$children[e]},right:function(){for(var e=0;e<this.$children.length;e++)if("right"==this.$children[e].side)return this.$children[e]}},props:["delegateHandle"],methods:(e={init:function(){$ionicSideMenuDelegate.add(this.delegateHandle,this)},destroyed:function(){$ionicSideMenuDelegate.remove(this)}},e)})}(),function(){var e;compClasses.ionSpinner=Vue.component("ionSpinner",{data:function(){return{}},props:["icon"],template:getTemplate("ionic/ionSpinner.html"),mounted:function(){compInstances.ionSpinner=this,this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.ionToggle=Vue.component("ionToggle",{data:function(){return{}},template:getTemplate("ionic/ionToggle.html"),props:["value","inline","transparent","small"],mounted:function(){compInstances.ionToggle=this,this.init()},methods:(e={init:function(){},valChanged:function(e){this.$emit("input",e.target.checked),this.$emit("change",e.target.checked)}},e)})}(),function(){var e;compClasses.audiobookSettings=Vue.component("audiobookSettings",{data:function(){return{webWatermarkPlaceholder2:"",audiobookAutoplay:!stg.data.settings.audiobookNoAutoplay}},template:getTemplate("panels/audiobookSettings.html"),mounted:function(){compInstances.audiobookSettings=this,this.init()},watch:{audiobookAutoplay:function(e){stg.data.settings.audiobookNoAutoplay=!e}},methods:(e={init:function(){},closePanel:function(){audiobook.closePanel()},settingsChanged:function(){stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings)},fullscreen:function(){$ionicSideMenuDelegate.close(),nav.fullscreen()},langChanged:function(){$ionicSideMenuDelegate.close(),$timeout(settings.langChanged,500)},logout:function(){$ionicSideMenuDelegate.close(),backend.logout()},share:function(){modals.show({mode:"share",dynamic:!0,animation:"slide-in-up"})},profileClicked:function(e){modals.show({mode:"profile",dynamic:!0,scope:this,animation:"slide-in-up"})}},e)})}(),function(){var e;compClasses.audiobookToc=Vue.component("audiobookToc",{data:function(){return{header:{mode:"default"}}},template:getTemplate("panels/audiobookToc.html"),computed:{bookThumb:function(){if(stg.data.epub.bookThumb){var e=stg.data.epub.bookThumb;return desktop&&"mac"==os&&(e="file://"+e),cleanURL(e)}return cleanURL((config.kotobee.liburl?config.kotobee.liburl:"")+"img/ui/defaultCover.png")},currentChapter:function(){return this.$parent.$parent.currentChapter}},mounted:function(){compInstances.audiobookToc=this,this.init()},methods:(e={init:function(){},closePanel:function(){audiobook.closePanel()},showBookInfo:function(){inherited(this.$parent,"showBookInfo")},metaExists:function(e){return this.$options.filters.metaExists(e)},assetPath:function(e){return inherited(this.$parent,"assetPath",[e])},formatDuration:function(e){return formatDuration(e)},pad:function(e){return pad(e)}},e)})}(),function(){var e;compClasses.audiobookTocItem=Vue.component("audiobookTocItem",{data:function(){return{expanded:null}},template:getTemplate("panels/audiobookTocItem.html"),props:["chapter"],mounted:function(){compInstances.audiobookTocItem=this,this.init()},methods:(e={init:function(){},selectChapter:function(e){e.sub&&(this.expanded=!this.expanded),audiobook.selectChapter(e),e.sub||audiobook.closePanel()},formatDuration:function(e){return formatDuration(e)},pad:function(e){return pad(e)},isValidDuration:function(e){return isValidDuration(e)}},e)})}(),compClasses.bookInfo=Vue.component("bookInfo",{data:function(){return{busy:null,loadingReviews:null,totalReviews:null,reviews:[],rating:null,totalRating:null,entryRating:null,reviewSubmitted:null,bookInfoOptions:{}}},template:getTemplate("panels/bookInfo.html"),mounted:function(){compInstances.bookInfo=this,this.init()},mixins:[closableModal],props:["pageview","book"],computed:{modal:function(){return stg.data.modal},views:function(){if(this.bookInfoOptions.book.stats)return this.bookInfoOptions.book.stats.views},downloads:function(){if(this.bookInfoOptions.book.stats)return this.bookInfoOptions.book.stats.downloads},deletable:function(){var e=this.bookInfoOptions.book.downloaded;return(desktop||isNative)&&(e=e&&!this.bookInfoOptions.book.prepackage),e}},methods:function(){var e={};function t(e){var t=this;e||(e={}),e.bid=this.bookInfoOptions.book.id,t.loadingReviews=!0,backend.getReviews(e,(function(e){t.loadingReviews=!1,e&&!e.error&&(t.totalReviews=e.total,t.reviews=e.reviews,t.rating=e.rating,t.totalRating=e.totalRating?e.totalRating:0,$rootScope.$$phase||$rootScope.$apply())}))}return e.init=function(){var e=this;e.pageview&&(e.data=stg.data,e.book.coverImg=stg.data.epub.bookThumb,e.book.coverStyle={"background-image":"url('"+e.book.coverImg+"')"},e.book.name=e.book.meta.dc.title,bookinfo.show({book:e.book,categoryClicked:e.categoryClicked},{noModal:!0}),$rootScope.$$phase||$rootScope.$apply()),this.bookInfoOptions=stg.data.modal.bookInfoOptions,config.kotobee.cloudid&&config.kotobee.reviews&&(e.loadingReviews=!0,setTimeout((function(){t.bind(e)({max:10})}),2e3))},e.metaExists=function(e){return this.$options.filters.metaExists(e)},e.addBook=function(e){cart.add(e)},e.extractIsbn=function(e){var t="";return e.meta.dc["isbn-id"]?t=e.meta.dc["isbn-id"]:e.meta.dc.isbn&&(t=e.meta.dc.isbn),t&&(t=t.replace("urn:isbn:","")),t},e.getAllReviews=function(){t.bind(this)({})},e.openRemotely=function(e){book.open(e,{openRemotely:!0})},e.open=function(e){book.open(e)},e.download=function(e){bookinfo.download(e)},e.filterDescription=function(e){var t=this.$options.filters;return"<"==(e=t.decodeHtmlEntities(e))[0]&&(e=e.replace(/\n/g,"")),t.nl2br(e),e=t.unsafe(e),mobile&&(e=t.nativeLinks(e)),e},e.actionBtnClicked=function(e,t){e.redirect?desktop?np.openLink(e.redirect):isNative&&crdv.openInNativeBrowser(e.redirect,!0):bookinfo.action(e,t)},e.deleteBook=function(e){bookinfo.delete(e)},e.update=function(e){bookinfo.update(e)},e.addToFav=function(e){bookinfo.addToFav(e)},e.copyURL=function(e){bookinfo.copyURL(e)},e.toggleFav=function(e){bookinfo.toggleFav(e)},e.removeFav=function(e){bookinfo.removeFav(e)},e.categoryClicked=function(e){modals.hide(),this.bookInfoOptions.categoryClicked(e)},e.redeemCodeClicked=function(){bookinfo.redeemCode()},e.backBtnClicked=function(e){bookinfo.prevStage()},e.toLoginScreen=function(){modals.hide(),$location.path("/login")},e.selectRating=function(e){this.entryRating=e},e.submitReview=function(e){var n=this;if(config.kotobee.cloudid&&config.kotobee.reviews){var o=e.target,i=o.parentNode.getElementsByTagName("textarea")[0],r=o.parentNode.getElementsByClassName("nameTxt")[0],a={};a.content=i.value,a.content&&(r&&(a.name=r.value),config.kotobee.reviewsrating&&(a.rating=n.entryRating),"library"===config.kotobee.mode&&(a.bid=this.bookInfoOptions.book.id),backend.addReview(a,(function(e){if(e.error)return modals.hide(),void setTimeout((function(){modals.show({mode:"generalError",errorOptions:{msg:translit.get("s_reviewExists")}})}),500);i.value="",r&&(r.value=""),n.reviewSubmitted=!0,t.bind(n)({max:10})})))}},e}()}),function(){var e;Vue.component("bookInfoActionBtns",{data:function(){return{}},template:getTemplate("panels/bookInfoActionBtns.html"),mounted:function(){this.init()},computed:{bookInfoOptions:function(){return this.$parent.$parent.$parent.bookInfoOptions}},methods:(e={init:function(){},actionBtnClicked:function(){return this.$parent.$parent.$parent.actionBtnClicked.apply(this,arguments)},openRemotely:function(){return this.$parent.$parent.$parent.openRemotely.apply(this,arguments)},redeemCodeClicked:function(){return this.$parent.$parent.$parent.redeemCodeClicked.apply(this,arguments)}},e)})}(),function(){var e;Vue.component("bookInfoAuthor",{data:function(){return{}},computed:{book:function(){return this.$parent.bookInfoOptions.book}},template:getTemplate("panels/bookInfoAuthor.html"),mounted:function(){this.init()},methods:(e={init:function(){}},e)})}(),function(){var e;Vue.component("bookInfoBanner",{data:function(){return{bgOpacity:.9,overlay:!0,bookContentExists:!1,interactiveExists:!1,coverHeight:null,coverLoaded:null,matchMedia:!1}},template:getTemplate("panels/bookInfoBanner.html"),mounted:function(){this.init()},computed:{getUrl:function(){return this.bookInfoOptions.book.coverStyle["background-image"].replace(/^url\('|"/,"").replace(/"|'\)$/,"")},bookInfoOptions:function(){return this.$parent.$parent.bookInfoOptions},busy:function(){return this.$parent.$parent.busy},views:function(){return this.$parent.$parent.views},loadingReviews:function(){return this.$parent.$parent.loadingReviews},rating:function(){return this.$parent.$parent.rating},totalRating:function(){return this.$parent.$parent.totalRating},downloads:function(){return this.$parent.$parent.downloads},bgImg:function(){if(this.overlay){if(this.bookInfoOptions.book.bannerStyle)return this.bookInfoOptions.book.bannerStyle;var e="linear-gradient(to bottom, rgba(67, 47, 71, "+this.bgOpacity+") 0%, rgba(52, 80, 97, "+(this.bgOpacity-.2)+") 100%)";return style="background-image:"+e,style+=",url('"+this.bookInfoOptions.book.coverImg+"');",style}return"background: #4e3359;"},shouldShowFavBtn:function(){if(this.config&&this.config.showFavorites)return this.data.user.loggedIn&&!this.bookInfoOptions.noAction?this.cloudParam("allowlogin")||!this.cloudParam("public"):void 0},showLang:function(){return config.bookInfoLang||null==config.bookInfoLang},duration:function(){if(this.bookInfoOptions.book.meta)return this.bookInfoOptions.book.meta.duration},formattedAudioDuration:function(){var e=this.duration;if(!e)return"0:00:00";var t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60);return t+":"+(n<10?"0":"")+n+":"+(o<10?"0":"")+o}},methods:(e={init:function(){this.handleCover()},handleCover:function(){this.matchMedia=window.innerWidth>=600;var e=this.$refs.section,t=e.getBoundingClientRect();this.coverHeight=e&&t?t.height+20+20:null,this.coverHeight<180&&(this.coverHeight=180)},metaExists:function(){return this.$parent.$parent.metaExists.apply(this,arguments)},toggleFav:function(){return this.$parent.$parent.toggleFav.apply(this,arguments)},copyURL:function(){return this.$parent.$parent.copyURL.apply(this,arguments)}},e)})}(),function(){var e,t;Vue.component("bookInfoMeta",{data:function(){return{}},template:getTemplate("panels/bookInfoMeta.html"),mounted:function(){this.init()},computed:{bookInfoOptions:function(){return this.$parent.$parent.bookInfoOptions},pageview:function(){return this.$parent.$parent.pageview},deletable:function(){return this.$parent.$parent.deletable},reviews:function(){return this.$parent.$parent.reviews},showDescription:function(){return config.bookInfoDesc||null==config.bookInfoDesc},showPublisher:function(){return config.bookInfoPublisher||null==config.bookInfoPublisher},showIsbn:function(){return config.bookInfoIsbn||null==config.bookInfoIsbn},showPublishDate:function(){return config.bookInfoPublishDate||null==config.bookInfoPublishDate},showUpdateDate:function(){return config.bookInfoUpdateDate||null==config.bookInfoUpdateDate},showRights:function(){return config.bookInfoRights||null==config.bookInfoRights}},methods:(t={},t.init=function(){},t.toLoginScreen=function(){return this.$parent.$parent.toLoginScreen.apply(this,arguments)},t.update=function(){return this.$parent.$parent.update.apply(this,arguments)},t.deleteBook=function(){var t=arguments,n=this;if(modals.hide(),e)return n.$parent.$parent.deleteBook.apply(n,t);setTimeout((function(){var o={title:translit.get("confirmation"),msg:translit.get("bookDeleteConfirm"),barStyle:"bar-dark",dontAskChecked:e},i={label:"delete",style:"button-assertive",func:function(){o.dontAskChecked&&(e=!0),modals.hide(),n.$parent.$parent.deleteBook.apply(n,t)}},r={label:"cancel",func:function(){o.dontAskChecked&&(e=!0),modals.hide()}};o.dontAsk=!0,o.btns=[i,r],modals.show({mode:"confirm",confirmOptions:o})}))},t.filterDescription=function(){return this.$parent.$parent.filterDescription.apply(this,arguments)},t.categoryClicked=function(){return this.$parent.$parent.categoryClicked.apply(this,arguments)},t.metaExists=function(){return this.$parent.$parent.metaExists.apply(this,arguments)},t.extractIsbn=function(){return this.$parent.$parent.extractIsbn.apply(this,arguments)},t.getDate=function(e){return e.replace(/t.*/gi,"")},t)})}(),function(){var e;Vue.component("bookInfoReviews",{data:function(){return{reviewsNum:0,finalRate:0,canShowReviewForm:!1}},template:getTemplate("panels/bookInfoReviews.html"),mounted:function(){this.init()},computed:{bookInfoOptions:function(){return this.$parent.$parent.bookInfoOptions},totalRating:function(){return this.$parent.$parent.totalRating},reviews:function(){return this.$parent.$parent.reviews},totalReviews:function(){return this.$parent.$parent.totalReviews},loadingReviews:function(){return this.$parent.$parent.loadingReviews},rating:function(){return this.$parent.$parent.rating},reviewsLabel:function(){return translit.get(1==this.reviewsNum?"review":"reviews")},ratingsLabel:function(){return translit.get(1==this.totalRating?"rating":"ratings")},reviewSubmitted:function(){return this.$parent.$parent.reviewSubmitted}},watch:{loadingReviews:function(e,t){return config.kotobee.reviewslocked?this.canShowReviewForm=!1:stg.data.user&&stg.data.user.loggedIn||config.kotobee.reviewspublic?void(this.canShowReviewForm=!0):this.canShowReviewForm=!1},totalRating:function(){this.reviewsNum=this.reviews.filter((function(e){var t=e.content.trim();return""!==t||null!==t})).length;var e={star1:[],star2:[],star3:[],star4:[],star5:[]};this.reviews.forEach((function(t){1===t.rating?e.star1.push(!0):2===t.rating?e.star2.push(!0):3===t.rating?e.star3.push(!0):4===t.rating?e.star4.push(!0):5===t.rating&&e.star5.push(!0)}));var t=(5*e.star5.length+4*e.star4.length+3*e.star3.length+2*e.star2.length+1*e.star1.length)/(e.star5.length+e.star4.length+e.star3.length+e.star2.length+e.star1.length);this.finalRate=t?t.toFixed(1):""}},methods:(e={init:function(){},selectRating:function(){return this.$parent.$parent.selectRating.apply(this,arguments)},submitReview:function(){return this.$parent.$parent.submitReview.apply(this,arguments)},getAllReviews:function(){return this.$parent.$parent.getAllReviews.apply(this,arguments)}},e)})}(),function(){var e;compClasses.bookSettings=Vue.component("bookSettings",{data:function(){return{webWatermarkPlaceholder2:"",navAnims:[{label:"flip",val:"navBookBlock"},{label:"card",val:"navFlip"},{label:"slide",val:"navSlide"},{label:"stack",val:"navStack"},{label:"fade",val:"navFade"}],navModes:[{label:"vertical",val:"vertical"},{label:"horizontal",val:"horizontal"}],viewModes:[{label:"auto",val:"auto"},{label:"singlePage",val:"single"},{label:"doublePage",val:"double"}]}},template:getTemplate("panels/bookSettings.html"),mounted:function(){compInstances.bookSettings=this,this.init()},methods:(e={init:function(){},stylingChanged:function(){$timeout(settings.stylingChanged,300)},navAnimChanged:function(){settings.saveSettings()},viewModeChanged:function(){$timeout(settings.viewModeChanged,300),stg.writeSlot("settings"+stg.getBookId(!0),stg.data.settings)},navModeChanged:function(){settings.saveSettings()},lineAdjustChanged:function(){$timeout(settings.lineAdjustChanged,300)},singlePageScrollChanged:function(){$timeout(settings.viewModeChanged,300)},editFontSize:function(){inherited(this,"applyHeader",["textSize"]),$ionicSideMenuDelegate.close()},langChanged:function(){$ionicSideMenuDelegate.close(),$timeout(settings.langChanged,500)},sync:function(){$ionicSideMenuDelegate.close(),settings.sync()},fullscreen:function(){$ionicSideMenuDelegate.close(),nav.fullscreen()},share:function(){modals.show({mode:"share",dynamic:!0,animation:"slide-in-up"})},logout:function(){$ionicSideMenuDelegate.close(),backend.logout()},about:function(){this.openAuthorWebsite()},exit:function(){modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})},profileClicked:function(e){modals.show({mode:"profile",dynamic:!0,scope:this,animation:"slide-in-up"})}},e.settingsClose=function(){modals.hide(),stg.writeSlot("settings"+stg.getBookId(!0),e.data.settings)},e.closePanel=function(){$ionicSideMenuDelegate.close()},e)})}(),function(){var e;compClasses.cart=Vue.component("cart",{data:function(){return{paying:null}},template:getTemplate("panels/cart.html"),mixins:[closableModal],mounted:function(){compInstances.cart=this,this.init()},computed:{currency:function(){return cart.currency},paymentOptions:function(){return payment.initialize(config.kotobee.payment)}},methods:(e={init:function(){},addBook:function(e){cart.add(e)},removeBook:function(e){cart.remove(e)},showCart:function(){cart.show()},showCheckout:function(){cart.checkout()},backToCart:function(){cart.back()},getTotalPrice:function(){return cart.getTotalPrice()},makePayment:function(e){"library"==config.kotobee.mode&&cart.pay(e)}},e)})}(),function(){var e;compClasses.chapters=Vue.component("chapters",{data:function(){return{header:{mode:"default"}}},template:getTemplate("panels/chapters.html"),computed:{bookThumb:function(){return stg.data.epub.bookThumb?stg.data.epub.bookThumb:(config.kotobee.liburl?config.kotobee.liburl:"")+"img/ui/defaultCover.png"}},mounted:function(){compInstances.chapters=this,this.init()},methods:(e={init:function(){},closePanel:function(){stg.data.widescreen=!1,$ionicSideMenuDelegate.close(),stg.data.widescreen&&Vue.nextTick(nav.fxlZoomFit)},showBookInfo:function(){inherited(this.$parent,"showBookInfo")},gotoPageClicked:function(e){inherited(this.$parent,"gotoPageClicked",[e])},metaExists:function(e){return this.$options.filters.metaExists(e)}},e)})}(),function(){var e;compClasses.checkout=Vue.component("checkout",{data:function(){return{}},template:getTemplate("panels/checkout.html"),extends:compClasses.cart,mounted:function(){compInstances.checkout=this,this.init()},methods:(e={init:function(){},getPaymentStyle:function(e){return{backgroundImage:"url("+(e.logo?e.logo:"")+")"}}},e)})}(),function(){var e;compClasses.closable=Vue.component("closable",{data:function(){return{}},mounted:function(){compInstances.closable=this},methods:(e={init:function(){},hideModal:function(){modals.hide()}},e)})}(),function(){var e;compClasses.hlight=Vue.component("hlight",{data:function(){return{}},template:getTemplate("panels/hlight.html"),mounted:function(){compInstances.hlight=this,this.init()},mixins:[closableModal],computed:{modal:function(){return stg.data.modal}},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.loginPanel=Vue.component("loginPanel",{data:function(){return{header:{mode:"default"}}},template:getTemplate("panels/loginPanel.html"),mounted:function(){compInstances.loginPanel=this,this.init()},mixins:[closableModal],computed:{modal:function(){return stg.data.modal},ssoBusy:function(){return stg.data.sso&&stg.data.sso.ssoBusy},isValidEmail:function(){return this.emailValidation(stg.data.user.email)}},methods:(e={init:function(){},emit:function(e,t){vueApp.$emit(e,t)},ssoSupported:function(e){var t=config.kotobee.sso[e];return!(!t||!t.enabled)&&(!(t.andr||t.ios||t.web)||(isNative?ios?t.ios:t.andr:t.web))},emailValidation:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}},e)})}(),function(){var e;compClasses.media=Vue.component("media",{data:function(){return{}},template:getTemplate("panels/media.html"),mounted:function(){compInstances.media=this,this.init()},methods:(e={init:function(){},mediaClicked:function(e){media.show(e)},hide:function(){media.hide()}},e)})}(),function(){var e;compClasses.miniapps=Vue.component("miniapps",{data:function(){return{editing:null}},template:getTemplate("panels/miniapps.html"),mounted:function(){compInstances.miniapps=this,this.init()},methods:(e={init:function(){},miniappClicked:function(e){kMiniapps.openFromMenu(e)}},e)})}(),compClasses.note=Vue.component("note",{data:function(){return{editing:null}},template:getTemplate("panels/note.html"),mounted:function(){compInstances.note=this,this.init()},extends:compClasses.closable,computed:{modal:function(){return stg.data.modal}},methods:function(){var e,t,n={};function o(){if(config.htmlInNotes){var n=document.getElementById("noteTextArea");if(!n)return setTimeout((function(){o()}),30);(t=new Quill(n,{theme:"snow"})).clipboard.dangerouslyPasteHTML(0,e.note?e.note.note:"")}}return n.init=function(){var t=this;if(e=stg.data.modal.noteOptions,config.htmlInNotes){var n=document.getElementById("noteTextArea");if(!n||n.children.length)return;setTimeout(o)}setTimeout((function(){if(t.$el.length){var e=t.$el.getElementsByClassName("previousNotes");e.length&&(e[0].scrollTop=e[0].scrollHeight)}}),100)},n.save=function(n){config.htmlInNotes&&(n.note=t.container.children[0].innerHTML),e.save(n)},n.remove=function(t){e.delete(t)},n.edit=function(n){this.editing==n&&(n=null),this.editing=n,e.note=n,config.htmlInNotes&&(e.note?t.clipboard.dangerouslyPasteHTML(0,e.note.note):t.setText(""))},n.noteEntryStyle=function(e,t){var n=[];return t==e&&n.push("editing"),e.public?(n.push("public"),(e.uid==stg.data.user.id||stg.data.user.perms&&stg.data.user.perms.globaldata)&&n.push("mine"),n.push("hasAvatar")):n.push("mine"),n.join(" ")},n}()}),function(){var e;compClasses.notebook=Vue.component("notebook",{data:function(){return{loadingMoreNotes:null,bookmarkContent:null,noteContent:null,hlightContent:null,notebook:null,noteBtns:{notes:!0,bookmarks:!0,hlights:!0}}},computed:{hasResults:function(){return stg.data.notebookContent&&stg.data.notebookContent.results&&stg.data.notebookContent.results.length}},template:getTemplate("panels/notebook.html"),mounted:function(){compInstances.notebook=this,this.init()},methods:(e={init:function(){this.update()},arrayEmpty:function(e){return this.$options.filters.arrayEmpty(e)},update:function(){annotations.updateNotebookArray({},(function(){Vue.nextTick((function(){}))}))},notebookClose:function(){var e=this;modals.hide(),e.bookmarkContent=null,e.noteContent=null,e.hlightContent=null,e.notebook={}},noteBtnClicked:function(e,t,n){n&&n.stopPropagation(),"all"==e?t.notes=t.bookmarks=t.hlights=!(t.notes&&t.bookmarks&&t.hlights):(t.notes=t.bookmarks=t.hlights=!1,t[e]=!0),overflowScroll?document.getElementById("notebookContent").scrollTop=0:$ionicScrollDelegate.$getByHandle("notebookScroll").scrollTop()},pdfExport:function(e,t){e&&e.stopPropagation&&e.stopPropagation();var n=this.serializeNotebookHtml(),o=(stg.data.book.meta.dc.title?stg.data.book.meta.dc.title:translit.get("book"))+".pdf";$timeout((function(){crdv.createPDF(n,o,(function(n){n.error?t&&t({error:!0,event:e}):n.success&&t&&t({success:!0})}))}),500)}},e.exportPdfOptimized=function(t){var n=document.getElementsByClassName("perspectiveContainer")[0],o=document.getElementById("nextPage"),i=document.getElementById("prevPage");t&&t.error&&n&&o&&i&&(o.remove(),i.remove(),e.pdfExport(t.event,(function(t){n.append(o),n.append(i),t&&(t.success||t.error&&function(t){var n=document.getElementById("spreadL");if(n){var o=n.querySelector("section.k-section.parsed");o&&(o.remove(),e.pdfExport(t.event,(function(e){n.append(o),e&&e.success})))}}(t))})))},e.loadAllNotebook=function(e){var t=this;e&&e.stopPropagation(),t.loadingMoreNotes=!0,annotations.sync({all:!0},(function(e){annotations.updateNotebookArray({},(function(){t.loadingMoreNotes=!1,$rootScope.$$phase||$rootScope.$apply()}))}))},e.serializeNotebookHtml=function(){var e="<br/>",t='<html><head><meta charset="UTF-8" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head><body>';t+='<div id="container">',t+=p([translit.get("notebookFor"),' "'+stg.data.book.meta.dc.title+'"'],"h1","style='font-size:22px'"),t+="<hr/>";for(var n,o,i,r,a,s,c=stg.data.notebookContent.results,l=function(){if(c[d]){var l=function(e){if("ar"==stg.data.settings.language)return!0;var t=e.match(/[\u0600-\u06FF\u0750-\u077F]+/g);return Array.isArray(t)&&t.length};for(n="",o=book.getTitleByIndex(d),c[d][0]&&c[d][0].chaptername&&(o=c[d][0].chaptername),i=p(o,"h2",'style="font-size:18px;margin: 16px 0 3px;"'),n+=i+e,r=0;r<c[d].length;r++)a=c[d][r],s="",null!=a.nid?"page"==a.type?l(a.note)?(s+=p([translit.get("pageNote")],"div","style='font-weight:bold'")+e,s+="<hr/>",s+=p([u(a.note)],"div","style='font-weight:bold'")+e):s+=p([translit.get("pageNote")+": ",u(a.note)],"div","style='font-weight:bold'")+e:"content"==a.type&&(l(a.src)?(s+=p([translit.get("noteFor")],"p","style='font-weight:bold;margin: 8px 0;'"),s+="<hr/>",s+=p(['"'+a.src+'"'],"p","style='font-weight:bold;margin: 8px 0;'")):s+=p([translit.get("noteFor"),' "'+a.src+'"'],"p","style='font-weight:bold;margin: 8px 0;'"),a.note.includes("<img ")&&(a.note=a.note.replace(/\sstyle="(.*?)"/,""),a.note=a.note.replace(/\sclass="(.*?)"/,""),a.note=a.note.replace("<img ",'<img height="100"')),s+=p([a.note],"div","style='border: solid 1px #ddd;;border-radius: 5px;padding: 10px;'")+e):null!=a.hid?l(a.src)?(s+=p([translit.get("highlight")],"div",'style="background-color:'+a.color+'"')+e,s+="<hr/>",s+=p(['"'+a.src+'"'],"div",'style="background-color:'+a.color+'"')+e):s+=p([translit.get("highlight"),': "'+a.src+'"'],"div",'style="background-color:'+a.color+'"')+e:null!=a.bmid&&(s+=p([translit.get("contentBookmark")],"div")+e),n+=p([s],"div");t+=p([n],"div",'style=""')}},d=0;d<c.length;d++)l();function u(e){return e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}function p(e,t,n){for(var o="",i=0;i<e.length;i++)o+=e[i];return"<"+t+(n?" "+n:"")+">"+o+"</"+t+">"}return t+="</div>",t+="</body></html>"},e.shareNotebook=function(){var e=this.serializeNotebookTxt();crdv.share(e)},e.serializeNotebookTxt=function(){for(var e="\n",t=translit.get("notebookFor")+' "'+stg.data.book.meta.dc.title+'"'+e,n=t.length;n--;)t+="#";t+=e+e;for(var o=stg.data.notebookContent.results,i=0;i<o.length;i++)if(o[i]){var r=translit.get("chapter")+" "+(i+1);for(t+=r+e,n=r.length;n--;)t+="_";t+=e+e;for(var a=0;a<o[i].length;a++){var s=o[i][a];null!=s.nid?"page"==s.type?t+=translit.get("pageNote")+": "+s.note+e:"content"==s.type&&(s.src?t+=translit.get("noteFor")+' "'+s.src+'"'+e:t+=translit.get("note")+e,t+=translit.get("note")+": "+s.note+e):null!=s.hid?(t+=translit.get("highlightFor")+' "'+s.src+'"'+e,t+=translit.get("highlightColor")+" "+s.color+e):null!=s.bmid&&(t+=translit.get("contentBookmark")+e),t+="........................\n\n"}}return t},e.deleteFromNotebookContent=function(e,t){for(var n=stg.data.notebookContent.results,o=0;o<n.length;o++)if(n[o])for(var i=0;i<n[o].length;i++)if(n[o][i][e]==t)return n[o].splice(i,1),void(n[o].length||n.splice(o,1))},e.noteItemClicked=function(e){var t=e.chapter,n=e.location;n=String(n).split(",")[0],n=String(n).split("-")[0],modals.hide(),$timeout((function(){chapters.redirect(t,{hash:n})}),100)},e.deleteNote=function(e,t){var n=this;notes.confirmDeletion((function(){notes.delete(e,null,(function(e){n.noteContent=e,$rootScope.$$phase||$rootScope.$apply()}))})),t.stopPropagation()},e.deleteBookmark=function(e,t){var n=this;bookmarks.confirmDeletion((function(){bookmarks.delete(e,null,(function(t){n.bookmarkContent=t,selection.deleteBookMarker(e),n.deleteFromNotebookContent("bmid",e),$rootScope.$$phase||$rootScope.$apply()}))})),t&&t.stopPropagation()},e.deleteHlight=function(e,t){var n=this;hlights.confirmDeletion((function(){hlights.delete(e,null,(function(t){n.hlightContent=t,n.deleteFromNotebookContent("hid",e),$rootScope.$$phase||$rootScope.$apply()}))})),t.stopPropagation()},e.chaptersHaveSomething=function(){for(var e=0;e<stg.data.notebookContent.results.length;e++)if(this.chapterHasSomething(stg.data.notebookContent.results[e]))return!0},e.chapterHasSomething=function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];if(n.bmid&&this.noteBtns.bookmarks)return!0;if(n.nid&&this.noteBtns.notes)return!0;if(n.hid&&this.noteBtns.hlights)return!0}},e)})}(),function(){var e;compClasses.popoverCornerList=Vue.component("popoverCornerList",{data:function(){return{test:"ok"}},template:getTemplate("panels/popoverCornerList.html"),mounted:function(){compInstances.popoverCornerList=this,this.init()},computed:{},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.popoverLibraryMenu=Vue.component("popoverLibraryMenu",{data:function(){return{test:"ok"}},template:getTemplate("panels/popoverLibraryMenu.html"),mounted:function(){compInstances.popoverLibraryMenu=this,this.init()},computed:{},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.popoverList=Vue.component("popoverList",{data:function(){return{test:"ok"}},template:getTemplate("panels/popoverList.html"),mounted:function(){compInstances.popoverList=this,this.init()},computed:{},methods:(e={init:function(){}},e)})}(),function(){var e,t;compClasses.profile=Vue.component("profile",{data:function(){return{model:{},ui:{},tab:"info",saving:null,user:null,fields:null,activity:null,payments:null,resetPwd:null,passwordObj:{isLoading:!1,current:{valid:!0,password:null},new:{valid:!0,password:null},confirm:{valid:!0,password:null}}}},template:getTemplate("panels/profile.html"),mounted:function(){compInstances.profile=this,this.init()},mixins:[closableModal],methods:(t={},t.init=function(){var t=this;if(!e){for(var n in e=!0,t.user=stg.data.user,t.fields=0,config.kotobee.registrationsettings)t.fields++;backend.getUserProfile({},(function(e){e&&e.info&&(t.user=e.info,t.user.dob&&(t.user.dob=phpDateToJS(t.user.dob)),t.activity=e.activity,t.payments=e.payments)})),setTimeout((function(){e=!1}),2e3)}},t.setTab=function(e){this.tab=e},t.updateInfo=function(){var e=this;e.saving=!0;var t=Object.assign({},e.user);backend.updateProfile(t,(function(t){e.saving=!1,t&&!t.error||inherited(e.$parent,"hideModal")}))},t.resetPassword=function(){var e=this;if(this.passwordObj.current.password?this.passwordObj.current.valid=!0:this.passwordObj.current.valid=!1,this.passwordObj.new.password?this.passwordObj.new.valid=!0:this.passwordObj.new.valid=!1,this.passwordObj.new.password!==this.passwordObj.confirm.password?this.passwordObj.confirm.valid=!1:this.passwordObj.confirm.valid=!0,this.passwordObj.current.valid&&this.passwordObj.new.valid&&this.passwordObj.confirm.valid){this.passwordObj.isLoading=!0;var t={oldpwd:this.passwordObj.current.password,newpwd:this.passwordObj.new.password,newpwdconfirm:this.passwordObj.confirm.password};backend.sendRawPost(config.kotobee.liburl+"user/changepwd",t,{responseType:"json"},(function(t){e.passwordObj.isLoading=!1,kotobee.popup(translit.get(t.error?t.error:"pwdChanged"),{okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){t.error||(e.hideModal(),setTimeout((function(){if("book"==config.kotobee.mode)return backend.logout()}),500))}})}))}},t)})}(),function(){var e;compClasses.readerApp=Vue.component("readerApp",{data:function(){return{}},template:getTemplate("panels/readerApp.html"),mounted:function(){compInstances.readerApp=this,this.init()},computed:{},methods:(e={init:function(){app.init(this.$el)},kbooksLabel:function(e){return translit.get("kbooksIntro")},initNotUsed:function(){stg.readSlot("recent",(function(e){Vue.set(stg.data,"recent",e),stg.data.recent||(stg.data.recent=[]),stg.data.recent=function(e){for(var t=[],n=0;n<e.length;n++){for(var o=!1,i=0;i<t.length;i++)if(e[n].path==t[i].path){o=!0,t[i].name||(t[i].name=e[n].name);break}o||t.push(e[n])}return t}(stg.data.recent)}))},openEpubFile:function(){app.openEpubFile()},openEpub:function(e,t){isNative?(crdv.vibrate(),kStatus.update(translit.get("pleaseWait"),null,{timeoutDuration:3e4,dots:!0}),setTimeout((function(){app.openRecent(t,e)}),1e3)):desktop&&app.openEpub(e,t)},clearRecentItems:function(){app.clearRecentItems()},exploreKbooks:function(){$location.path("/library/tab/all")}},e)})}(),function(){var e;compClasses.rightPanel=Vue.component("rightPanel",{data:function(){return{editing:null}},template:getTemplate("panels/rightPanel.html"),computed:{sideMenuMode:function(){return inherited(this.$parent,"sideMenuMode")}},mounted:function(){compInstances.rightPanel=this,this.init()},methods:(e={init:function(){},close:function(){$ionicSideMenuDelegate.close()}},e)})}(),compClasses.sdk=Vue.component("sdk",{data:function(){return{expanded:null,profiles:[],useProfiles:null,newProfile:null,addingProfile:null}},template:getTemplate("panels/sdk.html"),mounted:function(){compInstances.sdk=this,this.init()},computed:{},methods:function(){var e,t={},n={name:"Local book",mode:"book",locked:!0,liburl:"http://dev.kotobee.com/"};function o(e){e||(e=this.profiles);for(var t=[],n=0;n<e.length;n++){var o={};o.name=e[n].name,o.mode=e[n].mode,o.liburl=e[n].liburl,o.cloudid=e[n].cloudid,o.hostPath=e[n].hostPath,o.locked=e[n].locked,t.push(o)}stg.writeSlot("sdkProfiles",t,(function(){}))}function i(e){hasParentWithId(e.target,"sdkProfiler",50)||hasParent(e.target,"modal",50)||this.close()}return t.init=function(){debug||this.$el.parentNode.removeChild(this.$el)},t.profilerClicked=function(){var e=this;e.expanded?e.close():e.open(),function(){var e=this;stg.readSlot("sdkProfiles",(function(t){t&&t.length||(t=[clone(n)]),e.profiles=t})),stg.readSlot("sdkProfilesEnabled",(function(t){e.useProfiles=t}))}()},t.toProfiles=function(){this.$el.getElementsByClassName("profiles")[0].scrollIntoViewIfNeeded()},t.open=function(){this.expanded=!0,document.addEventListener("click",i)},t.close=function(){this.expanded=!1,document.removeEventListener("click",i)},t.lockedProfileClicked=function(e){modals.show({mode:"generalError",errorOptions:{msg:"The default profile is always locked. You can never delete it."}})},t.delProfile=function(t){var n=this;if(!e){modals.hide();var i={title:"Confirmation",msg:"Are you sure you want to delete this profile?",barStyle:"bar-dark"},r={label:"delete",style:"button-assertive",func:function(){i.dontAskChecked&&(e=!0),modals.hide();for(var r=0;r<n.profiles.length;r++)if(t==n.profiles[r])return n.profiles.splice(r,1),void o()}},a={label:"cancel",func:function(){i.dontAskChecked&&(e=!0),modals.hide()}};i.dontAsk=!0,i.btns=[r,a],modals.show({mode:"confirm",confirmOptions:i})}},t.editProfile=function(e){Vue.set(e,"editing",!0)},t.saveEditedProfile=function(e){o(),Vue.set(e,"editing",!1)},t.cancelEditingProfile=function(e){Vue.set(e,"editing",!1)},t.cancelNewProfileForm=function(){this.addingProfile=!1},t.showNewProfileForm=function(){this.newProfile={mode:"book",liburl:"http://dev.kotobee.com/",cloudid:null},this.addingProfile=!0},t.addProfile=function(e){e.hostType=e.hostPath?"kotobee":null,e.name||(e.name="Untitled profile"),this.profiles.push(e),o(),this.addingProfile=!1},t.useProfilesChanged=function(){stg.writeSlot("sdkProfilesEnabled",this.useProfiles,(function(){}))},t.connect=function(e){modals.hide();var t={title:"Confirmation",msg:"Restart the reader?",barStyle:"bar-dark"},n={label:"Restart",style:"button-balanced",func:function(){modals.hide(),stg.writeSlot("sdkProfile",e,(function(){setTimeout((function(){location.reload()}),300)}))}},o={label:"cancel",func:function(){modals.hide()}};t.btns=[n,o],modals.show({mode:"confirm",confirmOptions:t})},t}()}),function(){var e;compClasses.sdkProfileForm=Vue.component("sdkProfileForm",{data:function(){return{}},template:getTemplate("panels/sdkProfileForm.html"),mounted:function(){compInstances.sdkProfileForm=this,this.init()},props:["profile","cancel","save"],computed:{},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.search=Vue.component("search",{data:function(){return{srchOb:{enabled:!1},modal:{scope:compInstances.reader},key:null,searchStack:[],searchContent:{results:null,more:null,key:null,notEmpty:null},isExactWord:!1,isMatchCase:!1}},mixins:[closableModal],template:getTemplate("panels/search.html"),mounted:function(){compInstances.search=this,this.init()},computed:{},methods:(e={init:function(){},search:function(e,t,n,o){var i=this;if(e&&e.length&&0!=e.length){if(e.length<3)return kError.update({error:"lessThan3Characters"}),void modals.hide();compInstances.reader.applyHeader("default"),null==n&&(i.searchStack=[0]),kStatus.update(translit.get("searching"),null,{dots:!0,timeoutDuration:6e4}),t||(t="all",n||(n=0));var r={key:e,mode:t,limit:40,start:n,array:o,isExactWord:i.isExactWord,isMatchCase:i.isMatchCase};$timeout((function(){search.start(r,(function(e){kStatus.update(null),i.searchContent=e;for(var n=0;n<i.searchContent.results.length;n++)if(i.searchContent.results[n]&&i.searchContent.results[n].matches.length){i.searchContent.notEmpty=!0;break}"all"==t?(i.$broadcast("scroll.infiniteScrollComplete"),overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop()):"chapter"==t&&$timeout((function(){compInstances.reader.applyHeader("searchItems")}),500)}))}),500)}},searchMore:function(){for(var e,t=this,n=t.searchContent.results.length;n--;)if(t.searchContent.results[n]&&t.searchContent.results[n].matches[0]){e=t.searchContent.results[n].matches[0];break}e?(t.searchStack.push(e.chapter+1),overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop(),t.search(t.searchContent.key,"all",e.chapter+1)):t.searchContent.more=!1},searchBack:function(){var e=this;if(!(e.searchStack.length<=1)){e.searchStack.pop();var t=e.searchStack.pop();overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop(),e.search(e.searchContent.key,"all",t)}},locateInChapter:function(e){modals.hide(),this.search(e,"chapter")},clearResults:function(){this.searchContent={},compInstances.reader.applyHeader("default"),overflowScroll?document.getElementById("searchScroll").scrollTop=0:$ionicScrollDelegate.$getByHandle("searchScroll").scrollTop()},searchItemClicked:function(e){search.searchItemClicked(e,{timer:!0},(function(){compInstances.reader.applyHeader(""),$timeout((function(){compInstances.reader.applyHeader("searchItems"),$rootScope.$$phase||$rootScope.$apply()}))}))}},e)})}(),compClasses.share=Vue.component("share",{data:function(){return{options:{bookTitle:!0},currentTab:"embed",shareLink:null,embedCode:null,twitterLink:null,fbLink:null,whatsappLink:null}},template:getTemplate("panels/share.html"),mounted:function(){compInstances.share=this,this.init()},computed:{},methods:function(){var e={};function t(){var e=this,t={};stg.data.book.meta&&(e.options.bookAuthor&&(t.creator=stg.data.book.meta.dc.creator),t.language=stg.data.book.meta.dc.language,e.options.bookPublisher&&(t.publisher=stg.data.book.meta.dc.publisher),e.options.bookTitle&&(t.title=stg.data.book.meta.dc.title)),t.iconUrl=stg.data.epub.bookThumb,isAbsoluteURLPath(t.iconUrl)||(t.iconUrl=window.location.origin+"/"+t.iconUrl),t.url=e.shareLink,e.options.bookDescription&&(t.description=stg.data.book.meta.dc.description),t.lang=stg.data.settings.language;var n=encodeURI(JSON.stringify(t)),o=config.kotobee.liburl;o||(o="https://www.kotobee.com/");var i="";return i+="\x3c!-- Kotobee Embed Code --\x3e\n",i+="<script data-props='"+n+'\' type="text/javascript" src="'+o+'js/kembed.js?v=1"><\/script>\n',i+="\x3c!-- --\x3e\n"}return e.init=function(){var e=this;e.options={bookTitle:!0},e.currentTab="embed",e.shareLink=window.location.href.split("/reader/")[0],e.shareLink.endsWith("/")||(e.shareLink+="/"),e.embedCode=t.bind(this)(),e.twitterLink="https://twitter.com/share?url="+e.shareLink,e.fbLink="https://www.facebook.com/sharer.php?u="+e.shareLink,e.whatsappLink="whatsapp://send?text="+e.shareLink},e.embedCodeClicked=function(){var e=this.$el.getElementsByClassName("embedCode");e.length&&e[0].select()},e.shareLinkClicked=function(){var e=this.$el.getElementsByClassName("shareLink");e.length&&e[0].select()},e.optionChanged=function(){this.updateEmbedCode()},e.copyEmbedCode=function(){selection.copyToClipboard(this.embedCode,!0)},e.copyLink=function(){selection.copyToClipboard(this.shareLink,!0)},e.openTab=function(e){this.currentTab=e},e.shareClose=function(){modals.hide()},e.updateEmbedCode=function(){this.embedCode=t.bind(this)()},e}()}),compClasses.tabMenu=Vue.component("tabMenu",{data:function(){return{}},template:getTemplate("panels/tabMenu.html"),mounted:function(){compInstances.tabMenu=this,this.init()},computed:{currentChapter:function(){return stg.data.book?stg.data.book.chapter:{}},contentRtl:function(){return book.isRtl()}},methods:function(){var e={};function t(e){inherited(this,"setSideMenuMode",[e])}e.init=function(){var e=this;e.$watch((function(){return $ionicSideMenuDelegate.isOpenRight()}),(function(n){n||$timeout((function(){t.apply(e,["bookSettings"])}),100)}))},e.chaptersClicked=function(){chapters.displayChapters()},e.mediaClicked=function(){var e=this;if(stg.data.settings.rtl){if($ionicSideMenuDelegate.isOpenLeft()&&"media"!=inherited(e,"sideMenuMode"))return $ionicSideMenuDelegate.toggleLeft(),void $timeout(e.mediaClicked,300)}else if($ionicSideMenuDelegate.isOpenRight()&&"media"!=inherited(e,"sideMenuMode"))return $ionicSideMenuDelegate.toggleRight(),void $timeout(e.mediaClicked,300);isNative&&crdv.vibrate(),t.apply(e,["media"]),mobile&&nav.resize(),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},e.notebookClicked=function(e){if(e||(e={}),!e.popupOnly&&stg.data.widescreen)return compInstances.notebook.update(),chapters.togglePanel();notes.notebookClicked(this)},e.pdfClicked=function(){chapters.convertPDF()},e.printClicked=function(){chapters.print()},e.shareClicked=function(){modals.show({mode:"share",dynamic:!0,animation:"slide-in-up"})},e.settingsClicked=function(){var e=this;if(stg.data.settings.rtl){if($ionicSideMenuDelegate.isOpenLeft()&&"bookSettings"!=inherited(e,"sideMenuMode"))return $ionicSideMenuDelegate.toggleLeft(),void $timeout(e.settingsClicked,300)}else if($ionicSideMenuDelegate.isOpenRight()&&"bookSettings"!=inherited(e,"sideMenuMode"))return $ionicSideMenuDelegate.toggleRight(),void $timeout(e.settingsClicked,300);isNative&&crdv.vibrate(),t.apply(e,["bookSettings"]),mobile&&nav.resize(),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},e.searchClicked=function(e){var t=this;isNative&&crdv.vibrate(),mobile&&nav.resize(),modals.show({mode:"search",dynamic:!0,animation:"slide-in-up",scope:t,cb:function(){t.searchContent.notEmpty||$timeout((function(){crdv.showKeyboard()}),200),e&&e()}})};var n=[];return e.customTabClicked=function(e,t){var o=document.createElement("div");if(e.relToRoot=!0,"audio"==e.type){var i,r=ph.join(bookPath,e.audio);r=cleanURL(r),e.id||(e.id=Math.round(1e4*Math.random()));for(var a=0;a<n.length;a++){if(n[a].getAttribute("id")=="audio-"+e.id&&!(i=n[a]).paused)return i.pause(),void(i.src="");n[a].paused||(n[a].pause(),n[a].src="")}if(!i){(i=document.createElement("audio")).setAttribute("data-dontclose",!0),i.setAttribute("id","audio-"+e.id),i.setAttribute("controls","true"),i.setAttribute("autoplay","true"),i.setAttribute("data-tap-disabled","false");var s=document.createElement("source");s.src=r,i.appendChild(s),i.appendChild(document.createTextNode("Your browser does not support the audio element")),i.className="ki-noHighlight",i.oncanplay=function(){kInteractive.tinCan({verb:"played",activity:"Audio: "+r})}}if(i.setAttribute("src",r),i.play(),n.push(i),kInteractive.scorm){var c={};c.id=kInteractive.getScormId(e.title,r),c.description="Played audio link: "+r,c.type="other",c.learnerResponses="Played",c.objective=e.options?e.options.objective:null,c.timestamp=new Date,kInteractive.scorm.setInteractions([c])}kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:r,elem:i})}else{kInteractive.writeData(o,e);var l=e.url;if(e.hash&&(l+=e.hash),o.className="kInteractive link",!l)return kInteractive.action(o,t),void t.stopPropagation();l&&o.setAttribute("href",l),e.target&&"_blank"==e.target.toLowerCase()&&o.setAttribute("target","_BLANK"),l.match(/http[s]?:/g)?$rootScope.renderScope.externalLink(o):0==l.indexOf("/")?window.open(l):0==l.indexOf("mailto:")?window.location.href=l:(0!=l.indexOf("#")&&(l=ph.join(stg.data.book.chapter.url,l)),chapters.applyChapterStateFromURL(l))}},e.nextChapter=function(){inherited(this.$parent,"nextChapter")},e.prevChapter=function(){inherited(this.$parent,"prevChapter")},e.translateChapterClicked=function(){isNative&&crdv.vibrate(),mobile&&nav.resize(),modals.show({mode:"translation",dynamic:!0,animation:"slide-in-up",scope:this,cb:function(){}})},e}()}),function(){var e;compClasses.translation=Vue.component("translation",{data:function(){return{filterTxt:"",selectedLanguage:{},translating:!1,languagesArray:[{name:"English",code:"en"},{name:"Français",code:"fr"},{name:"Español",code:"es"},{name:"Deutsch",code:"de"},{name:"简体中文",code:"zh-CN"},{name:"繁體中文",code:"zh-TW"},{name:"العربية",code:"ar"},{name:"हिन्दी",code:"hi"},{name:"Русский",code:"ru"},{name:"Português",code:"pt"},{name:"日本語",code:"ja"},{name:"한국어",code:"ko"},{name:"Italiano",code:"it"},{name:"Türkçe",code:"tr"},{name:"Nederlands",code:"nl"},{name:"Polski",code:"pl"},{name:"Українська",code:"uk"},{name:"Tiếng Việt",code:"vi"},{name:"Bahasa Indonesia",code:"id"},{name:"ไทย",code:"th"},{name:"עברית",code:"he"},{name:"Svenska",code:"sv"},{name:"Čeština",code:"cs"},{name:"Ελληνικά",code:"el"},{name:"Magyar",code:"hu"},{name:"Suomi",code:"fi"},{name:"Română",code:"ro"},{name:"Bahasa Melayu",code:"ms"},{name:"Dansk",code:"da"},{name:"Norsk",code:"no"},{name:"বাংলা",code:"bn"},{name:"Filipino",code:"tl"},{name:"Slovenčina",code:"sk"},{name:"Hrvatski",code:"hr"},{name:"Български",code:"bg"},{name:"Lietuvių",code:"lt"},{name:"Slovenščina",code:"sl"},{name:"Српски",code:"sr"},{name:"Eesti",code:"et"},{name:"فارسی",code:"fa"},{name:"Kiswahili",code:"sw"},{name:"தமிழ்",code:"ta"},{name:"తెలుగు",code:"te"},{name:"मराठी",code:"mr"},{name:"ಕನ್ನಡ",code:"kn"},{name:"ગુજરાતી",code:"gu"},{name:"اردو",code:"ur"},{name:"Latviešu",code:"lv"},{name:"Íslenska",code:"is"}]}},computed:{filteredLanguages:function(){for(var e=[],t=0;t<this.languagesArray.length;t++)this.matchesFilter(this.languagesArray[t])&&e.push(this.languagesArray[t]);return e},translateLabel:function(){return this.selectedLanguage.code?translit.get("translateToX").replace("{{x}}",this.selectedLanguage.name):translit.get("translate")}},template:getTemplate("panels/translation.html"),mounted:function(){compInstances.translation=this,this.init()},methods:(e={init:function(){},translateChapterClicked:function(){this.translating=!0;var e={absurl:stg.data.book.chapter.absoluteURL,targetlang:this.selectedLanguage.code};try{backend.getChapterTranslation(e,this.showTranslatedFile)}catch(e){stg.data.modal.mode=null}},showTranslatedFile:function(e){if(this.translating=!1,e&&!e.error){var t=this,n=e.success.content;n=n.replace(/<!\[CDATA\[([^]*?)\]\]>/g,"$1");var o=e.success.url;this.preprocessChapterContent(n,o,{},(function(){var e=stg.data.book.chapter.absoluteURL;void 0===stg.data.currentPageOb.originalContent&&Vue.set(stg.data.currentPageOb,"originalContent",stg.data.currentPageOb.content),e=e.replace(/\.([a-zA-Z0-9]+)$/,".".concat(t.selectedLanguage.code,".$1")),stg.data.currentPageOb.content=chapters.cacheLookup(e).content,Vue.set(stg.data.currentPageOb,"translationLang",t.selectedLanguage),chapters.loadChapterByURL({leftOb:stg.data.currentPageOb,reload:!0})}))}},closeTranslationPanel:function(){modals.hide()},selectLanguage:function(e){this.selectedLanguage=e},preprocessChapterContent:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,i=parseHtml(e),r="",a=i.getElementsByTagName("body");a.length&&(r=a[0].className);for(var s=$filter("contentHtml")(i,t),c=i.getElementsByTagName("meta"),l=null,d=0;d<c.length;d++){var u=c[d].getAttribute("name");if(u&&"viewport"==u.toLowerCase()){l={};var p=c[d].getAttribute("content");if(!p)break;for(var f=p.split(","),h=0;h<f.length;h++){var g=f[h].split("=");g[1]&&(g[1]=g[1].replace("px",""),l[g[0].trim()]=Number(g[1].trim()))}l.width||l.height||(l=null)}}var m=l?"fxl":"rfl";$filter("js")(i).then((function(e){$filter("styles")(i,{path:t,id:n.id}).then((function(a){var c,d=i.getElementsByTagName("title");if(d.length)c=d[0].textContent.trim();else{var u=i.getElementsByTagName("h1");u.length&&(c=u[0].textContent.trim())}c||(c=stg.data.book.meta.dc.title);var p={url:t,title:c,bodyClass:r,viewport:l,layout:m,content:s.outerHTML,styles:a,script:e};n.dontCache||chapters.addToCache(p,n),o&&o(p)}))}))},matchesFilter:function(e){return-1!=translit.get(e.name).toLowerCase().indexOf(this.filterTxt.toLowerCase())},restoreDefaultTranslation:function(){stg.data.currentPageOb.content=stg.data.currentPageOb.originalContent,chapters.loadChapterByURLRaw({leftOb:stg.data.currentPageOb}),Vue.set(stg.data.currentPageOb,"translationLang",!1),modals.hide()}},e)})}(),function(){var e;compClasses.modals=Vue.component("modals",{data:function(){return{test:"ok"}},template:getTemplate("system/modals.html"),mounted:function(){compInstances.modals=this,this.init()},computed:{modalName:function(){if(stg.data.modal.mode)return this.getComponentName()+"Modal"},modalTemplate:function(){if(stg.data.modal.mode)return getTemplate("panels/"+stg.data.modal.mode+".html")},componentDef:function(){var e=this.getComponentName();return compClasses[e]?compClasses[e]:{name:this.modalName,template:this.modalTemplate,mounted:this.modalMounted,mixins:[closableModal],computed:{modal:function(){return stg.data.modal}},methods:{}}}},filters:{firstLetterSmall:function(e){if(e)return e[0].toLowerCase()+e.substr(1)}},methods:(e={init:function(){},modalMounted:function(){},getComponentName:function(){return stg.data.modal.mode.replace(/(.*?)\//g,"")},backdropClicked:function(e){e.target&&hasClass(e.target,"modal-backdrop")&&modals.hide()},mounted:function(){if(stg.data.modal._cb)return stg.data.modal._cb()},destroyed:function(){if(stg.data.modal._hiddenCb)return stg.data.modal._hiddenCb()}},e)})}(),function(){var e;compClasses.popovers=Vue.component("popovers",{data:function(){return{}},template:getTemplate("system/popovers.html"),mounted:function(){compInstances.popovers=this,this.init()},computed:{popoverName:function(){if(stg.data.popover.mode)return this.getComponentName()+"Popover"},popoverTemplate:function(){if(stg.data.popover.mode)return getTemplate("panels/"+stg.data.popover.mode+".html")},componentDef:function(){var e=this.getComponentName();return compClasses[e]?compClasses[e]:{name:this.popoverName,template:this.popoverTemplate,mounted:this.popoverMounted,computed:{popover:function(){return stg.data.popover}},methods:{}}}},filters:{firstLetterSmall:function(e){if(e)return e[0].toLowerCase()+e.substr(1)}},methods:(e={init:function(){},popoverMounted:function(){},getComponentName:function(){return stg.data.popover.mode.replace(/(.*?)\//g,"")},backdropClicked:function(e){e.target&&hasClass(e.target,"popover-backdrop")&&popovers.hide()}},e)})}(),function(){var e;compClasses.app=Vue.component("app",{data:function(){return{}},template:getTemplate("views/app.html"),mounted:function(){compInstances.app=this,this.init()},methods:(e={init:function(){}},e)})}(),compClasses.audiobook=Vue.component("audiobook",{data:function(){return{audio:null,isPlaying:!1,timeElapsed:"0:00",timeRemaining:"0:00",speedButtonText:"1x",rates:[1,1.25,1.5,1.75,2,.75],isDragging:!1,progressWidth:0,audioLoaded:!1,audioDuration:"",showVolumeBar:!1,volume:80,isVolumeDragging:!1}},template:getTemplate("views/audiobook.html"),destroyed:function(){this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null)},mounted:function(){compInstances.audiobook=this,this.init();var e=document.querySelector(".barWrapper");e&&(this.barWrapperWidth=e.offsetWidth)},watch:{"data.settings.visualizerStyle":function(e,t){visualizer.initialize()},volume:function(e){this.audio&&(this.audio.volume=e/100)},$route:function(e,t){if(!e||!t||r(e)!=r(t)){var n=e.params.ch?e.params.ch:0,o=e.params.hash?e.params.hash:null,i=audiobook.loadChapterByHref(n,{hash:o});i&&i.then((function(){kotobee.dispatchEvent("processedRoute")}))}function r(e){return e.fullPath.replace(/[?&]popup/g,"")}}},computed:{contentRtl:function(){return book.isRtl()}},methods:function(){var e,t,n={init:function(){audiobook.initialize(this)},assetPath:function(e){var t=bookPath+"assets/"+e;return desktop&&"mac"==os&&(t="file://"+t),cleanURL(t)},loadAudio:function(){var e=this;if(e.audio&&e.isPlaying&&e.audio&&e.audio.pause(),stg.data.currentChapter&&stg.data.currentChapter.audio){var t=this.assetPath("chapters/"+stg.data.currentChapter.href+"/"+stg.data.currentChapter.audio);e.audio||(e.audio=new Audio,e.audio.crossOrigin="anonymous",e.audio.addEventListener("loadedmetadata",(function(){e.audioLoaded=!0,e.timeElapsed=e.formatTime(0),e.timeRemaining=e.formatTime(e.audio.duration),e.audioDuration=e.formatDuration(e.audio.duration),e.updateProgress(),e.isPlaying&&e.audio.play()})),e.audio.addEventListener("ended",(function(){stg.data.settings.audiobookNoAutoplay||e.nextChapter()})),e.audio.addEventListener("timeupdate",(function(){e.updateProgress()}))),e.audio.src=t,e.audio.load()}else e.audioDuration=""},togglePlay:function(e){var t=this;t.audioLoaded&&(this.isPlaying=!this.isPlaying,this.isPlaying?(visualizer.initialize(t.audio),t.audio.play().then((function(){})).catch((function(e){}))):t.audio.pause())},updateProgress:function(){var e=this;if(e.audio&&e.audio.duration){var t=e.audio.currentTime,n=e.audio.duration,o=t/n*100,i=document.querySelector(".progress");i&&(i.style.width=o+"%"),this.timeElapsed=e.formatTime(t),this.timeRemaining=e.formatTime(n-t)}},onProgressBarClick:function(e){var t=this;if(e&&e.touches&&e.touches.length&&(e=e.touches[0]),t.audio&&t.audio.duration){var n=document.querySelector(".barWrapper"),o=e.offsetX/n.offsetWidth*t.audio.duration;t.audio.currentTime=o,t.updateProgress()}},onDragStart:function(n){var o=this;o.isDragging=!0,o.isPlaying&&o.audio.pause(),o.onDragMove(n),e=o.onDragMove.bind(o),t=o.onDragEnd.bind(o),document.addEventListener(mobile?"touchmove":"mousemove",e),document.addEventListener(mobile?"touchend":"mouseup",t)},onDragMove:function(e){var t=this;if(e&&e.touches&&e.touches.length&&(e=e.touches[0]),t.isDragging&&t.audio&&t.audio.duration){var n=document.querySelector(".barWrapper"),o=e.clientX-n.getBoundingClientRect().left;o<0&&(o=0),o>n.offsetWidth&&(o=n.offsetWidth);var i=o/n.offsetWidth*t.audio.duration;i=Math.max(0,Math.min(i,t.audio.duration)),t.audio.currentTime=i,t.updateProgress(),this.timeElapsed=t.formatTime(i)}},onDragEnd:function(){var n=this;n.isDragging=!1,n.isPlaying&&n.audio.play(),document.removeEventListener(mobile?"touchmove":"mousemove",e),document.removeEventListener(mobile?"touchend":"mouseup",t),e=t=null},skipForward:function(){this.audio&&(this.audio.currentTime+=10)},skipBackward:function(){var e=this;if(e.audio){var t=Math.max(e.audio.currentTime-10,0);void 0!==e.audio.currentTime&&(e.audio.currentTime=t)}},speedUp:function(){var e=this;if(!e.audio){var t=this.assetPath("chapters/"+stg.data.currentChapter.href+"/"+stg.data.currentChapter.audio);e.audio=new Audio(t)}var n=this.rates.indexOf(e.audio.playbackRate);-1===n&&(n=0);var o=(n+1)%this.rates.length;e.audio.playbackRate=this.rates[o],this.speedButtonText=this.rates[o]+"x"},nextChapter:function(){audiobook.nextChapter()},prevChapter:function(){audiobook.prevChapter()},displayChapters:function(){audiobook.displayChapters()},formatTime:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return t+":"+(n<10?"0":"")+n},formatDuration:function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.ceil(e%60),i="";return t>0&&(i+=t+" "+(1===t?"hr ":"hrs ")),(n>0||t>0)&&(i+=n+" "+(1===n?"min ":"mins ")),(o>0||""===i)&&(i+=o+" "+(1===o?"sec":"secs")),""===i&&(i="0 mins"),i},volumeBarOver:function(){this.showVolumeBar=!0,clearTimeout(this.hideVolumeBarTimer)},volumeMouseOut:function(){this.hideVolumeBarTimer=setTimeout(this.hideVolumeBar,400)},hideVolumeBar:function(){this.showVolumeBar=!1,this.isVolumeDragging=!1},volumeClick:function(e){this.isVolumeDragging=!0,this.onVolumeDrag(e),this.isVolumeDragging=!1},startVolumeDragging:function(e){this.isVolumeDragging=!0,document.addEventListener(mobile?"touchmove":"mousemove",this.onVolumeDrag),document.addEventListener(mobile?"touchend":"mouseup",this.stopVolumeDragging)},stopVolumeDragging:function(){this.isVolumeDragging=!1,document.removeEventListener(mobile?"touchmove":"mousemove",this.onVolumeDrag),document.removeEventListener(mobile?"touchend":"mouseup",this.stopVolumeDragging)},onVolumeDrag:function(e){if(this.isVolumeDragging){e&&e.touches&&e.touches.length&&(e=e.touches[0]);var t=this.$el.querySelector(".volume-bar .inner").getBoundingClientRect(),n=100-(e.clientY-t.top)/t.height*100;n=Math.min(100,Math.max(0,n)),this.volume=n}}},o=80;return n.toggleMute=function(){if(mobile)return this.volumeBarOver();this.volume?(o=this.volume,this.volume=0):this.volume=o},n.androidBackBtnClicked=function(){$ionicSideMenuDelegate.isOpen()?$ionicSideMenuDelegate.close():"library"==config.kotobee.mode&&0==$location.path().indexOf("/audiobook")?this.backClicked():isReaderApp?app.exitBook():modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})},n.backClicked=function(e){if($ionicSideMenuDelegate.isOpen())return $ionicSideMenuDelegate.close();modals.show({mode:"backToLib",backdropClickToClose:!1,backToLibOptions:{back:function(){modals.hide(),$location.path("/library")}}})},n}()}),function(){var e;compClasses.authRedirect=Vue.component("authRedirect",{data:function(){return{}},template:getTemplate("views/authRedirect.html"),mounted:function(){compInstances.authRedirect=this,this.init()},computed:{},methods:(e={init:function(){var e=this;design.stylize("oauth",design.getBgStyle()),backend.getFingerprint((function(t){var n=!0;e.$route.params.state&&e.$route.params.state!=t&&(n=!1),n&&sso.setTokens(e.$route.params.provider,decodeURIComponent(e.$route.params.idToken),decodeURIComponent(e.$route.params.accessToken)),initializer.initialize()}))}},e)})}(),function(){var e;compClasses.blank=Vue.component("blank",{data:function(){return{}},template:getTemplate("views/blank.html"),mounted:function(){compInstances.blank=this,this.init()},beforeRouteEnter:function(e,t,n){if("blank"==e.name&&t.name&&"authredirect"!=t.name)return window.history.back();n()},methods:(e={init:function(){}},e)})}(),function(){var e;compClasses.forgotPwd=Vue.component("forgotPwd",{data:function(){return{user:{email:""}}},template:getTemplate("views/forgotPwd.html"),mounted:function(){compInstances.forgotPwd=this,this.init()},computed:{rtl:function(){return stg.data.settings?stg.data.settings.rtl:null}},methods:(e={init:function(){var e=this;mobile||(design.stylize("forgotPwd",design.getBgStyle()),backend.addListener("pathsChanged",(function(){design.stylize("forgotPwd",design.getBgStyle())}))),e.$on("$ionicView.afterEnter",(function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("forgotPwd")))})),e.native||e.desktop||e.$on("$ionicView.beforeEnter",(function(){if(!initializer.initialized||backend.cloudParam("public")||stg.data.user&&backend.userLoggedIn()){var e="loading";$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e)}}))},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},androidBackBtnClicked:function(){window.history.back()},submit:function(){var e=this;e.user&&e.user.email&&backend.forgotPwd(e.user,(function(e){e.error?kError.update({error:"s_authError"==e.error?"accessDenied":e.error}):(modals.show({mode:"success",successOptions:{msg:translit.get("pwdEmailSent")}}),window.history.back())}))},backClicked:function(){window.history.back()}},e)})}(),function(){var e;compClasses.global=Vue.component("global",{data:function(){return{transitionName:"",tick:!0,classes:[]}},template:getTemplate("views/global.html"),mounted:function(){compInstances.global=this,this.init()},methods:(e={},e.init=function(){var e,t=this;t.getClasses(),t.started=!0,modals.setScope(t),popovers.setScope(t),document.addEventListener("mousedown",(function(t){var n=t.target;n.classList.contains("button")&&(n.classList.add("activated"),e=n)})),document.addEventListener("mouseup",(function(t){e&&e.classList.remove("activated"),e=null}))},e.getClasses=function(){this.classes=[],stg.data.settings&&(this.classes.push(stg.data.settings.language),this.classes.push("en"==stg.data.settings.language?"en":"notEn")),stg.data.widescreen&&this.classes.push("widescreen")},e.refresh=function(){var e=this;e.tick=!1,Vue.nextTick((function(){e.tick=!0}))},e.tinCanShortcut=function(e){tinCan.send(e)},e.questionsAddToNotebookShortcut=function(e,t){notes.addNotesFromQuestions(e,t||angular.noop)},e.getNotebookShortcut=function(e,t){stg.getNotes((function(n){var o=[currentIndex];stg.data.currentRPageOb&&o.push(stg.data.currentRPageOb.index);for(var i=0;i<o.length;i++)for(var r=0;r<n.length;r++)n[r].chapter==o[i]&&0==n[r].location.indexOf(e.rootIndex)&&(n[r].location=n[r].location.split(e.rootIndex)[1],notes.addIcon(n[r],e.root));t&&t()}))},e.location1=function(e){$location.path(e)},e.kTemplate=function(e){return kTemplate(e)},e.translit=function(e){return translit.get(e)},e.htmlSafe=function(e){return $sce.trustAsHtml(e)},e.openAuthorWebsite=function(){var e=stg.data.settings.language;"en"!=e&&"es"!=e&&"ar"!=e&&"fr"!=e&&(e="en"),window.open("https://www.kotobee.com/"+e+"/products/author#ref=readerwatermark","_system")},e.applyNativeScroll=function(t){var n,o=t.getElementsByClassName("kbContent");if(o.length&&!(o[0].scrollHeight<=t.offsetHeight)){t.children.length&&"ion-scroll"==t.children[0].nodeName.toLowerCase()&&(n=t.children[0],t.appendChild(o[0]),t.removeChild(n),t.scrollTop=0),(n=document.createElement("ion-scroll")).setAttribute("scrollY","true"),n.setAttribute("overflow-scroll","false"),n.setAttribute("style","width:100%;height:100%"),n.setAttribute("container-scroll","true");for(var i=0;i<t.children.length;i++)n.appendChild(t.children[i]);setTimeout((function(){var o=$compile(n.outerHTML)(e);angular.element(t).append&&angular.element(t).append(o)}),0)}},e.globalClick=function(){},e.globalTouch=function(){},e.refreshSignatures=function(){backend.refreshSignatures()},e.getService=function(e){return $injector.get(e)},e.testModals=function(){modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait")}),modals.show({mode:"loginPanel",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"update",dynamic:!0,animation:"slide-in-up",backdropClickToClose:!0}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"generalError"}),modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait"),backdropClickToClose:!0}),modals.show({mode:"note",dynamic:!0,animation:"slide-in-up",backdropClickToClose:!0}),modals.show({mode:"hlight"}),modals.show({mode:"externalSite",dynamic:!0,animation:"slide-in-up",backdropClickToClose:!0}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"flashUnsupported",flashOb:{text:"Text for flash unsupported site"}}),modals.show({mode:"success",successOptions:{msg:"SUCCESS MSG"}}),modals.show({mode:"localOnlyError"}),modals.show({mode:"xFrameError"}),modals.show({mode:"networkError"}),modals.show({mode:"exit"}),modals.show({mode:"waitTimeout"}),modals.show({mode:"backToLib"}),modals.show({mode:"notebook",dynamic:!0,animation:"slide-in-up",scope:{notebookClose:modals.hide}}),modals.show({mode:"search",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"image",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"libraryInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up"}),modals.show({mode:"encryptionKey",backdropClickToClose:!0}),modals.show({mode:"loading",loadingMsg:translit.get("pleaseWait"),timeLimit:3e3})},e.injectUserCSS=function(e){design.injectUserCSS(e)},e.langSelected=function(e){stg.data.settings.language=e,settings.langChanged()},e),watch:{"data.widescreen":function(){this.getClasses()},"data.settings":function(){this.getClasses()},"data.settings.language":function(){this.getClasses()},$route:function(e,t){this.transitionName="slide","/"==e.path&&(this.transitionName=""),config.noLoadingScreen&&"/"==t.path&&(this.transitionName="")}}})}(),compClasses.invoice=Vue.component("invoice",{data:function(){return{loading:null,order:null,user:null,paymentOptions:null}},template:getTemplate("views/invoice.html"),mounted:function(){compInstances.invoice=this,this.init()},computed:{},methods:function(){var e={};function t(){this.paymentOptions=payment.initialize(this.paymentOptions)}return e.init=function(){var e,n=this;mobile||(design.stylize("invoice",design.getBgStyle()),backend.addListener("pathsChanged",(function(){design.stylize("register",design.getBgStyle())}))),n.loading=!0,e=function(){var e=new URLSearchParams(window.location.hash.split("?")[1]),o={uid:e.get("uid")||"",orderid:e.get("orderid")||""};backend.getOrder(o,(function(e){if(n.loading=!1,e.error)return modals.show({mode:"generalError",errorOptions:{msg:translit.get(e.error)}});n.order=e.order,n.user=e.user,stg.data.user=e.user,n.paymentOptions=e.paymentoptions,t.bind(n)(),setTimeout((function(){payment.renderPaypalButton({order:n.order})}),1e3),$rootScope.$$phase||$rootScope.$apply()}))},stg.initialize(),stg.initializeSettings((function(){chapterAPI.initialize(),settings.langChanged(e)}))},e.pay=function(e){var t=this,n=t.order,o=t.user;if("moyasar"===e){var i={orderid:n.id,redirecturl:isNative?nativeRedirectBaseURI:window.location.protocol+"//"+window.location.host+window.location.pathname,price:100*n.amount,name:payment.getOrderName(n)};payment.moyasarSettings.payment(i)}else"stripe"===e&&payment.stripeMakePayment(t.paymentOptions,{order:n},{paymentEmail:o.email},{id:""})},e}()}),function(){var e;compClasses.landing=Vue.component("landing",{data:function(){return{}},template:getTemplate("views/landing.html"),mounted:function(){compInstances.landing=this,this.init()},methods:(e={init:function(){}},e)})}(),compClasses.library=Vue.component("library",{data:function(){return{bookSource:null,catList:null,tab:null,paneMsg:null,supportsAccountView:null,searchOb:{enabled:!1},sortOb:{options:[],method:null},autohideEase:null,subMode:null,title:null,moreData:null,currentCustomCat:null,currentCat:null,currentKey:null,currentContentKey:null,horizontalScrolling:null}},template:getTemplate("views/library.html"),mounted:function(){compInstances.library=this,library.initialize(this.init)},created:function(){},beforeRouteEnter:function(e,t,n){return book.removeBookConfigElem(),chapters.clearContent(),n()},methods:function(){var e,t,n={};function o(e){for(var t=0;t<stg.data.sortOb.options.length;t++)if(stg.data.sortOb.options[t].val==e)return stg.data.sortOb.options[t]}function i(){var e=this;if(mobile&&autohide.setup(e,"library"),library.initialized=!0,stg.data.currentLibrary){if(e.catList=stg.data.currentLibrary.categories,backend.userLoggedIn()&&("account"!=stg.data.currentLibrary.authbookview||backend.cloudParam("public")||(e.supportsAccountView=!0)),"categories"==stg.data.currentLibrary.startingpage)l(),s.bind(e)("categories");else{if(stg.data.currentLibrary.startingpage&&0==stg.data.currentLibrary.startingpage.indexOf("book")){var t=stg.data.currentLibrary.startingpage.split("/");t[1]&&(l(),library.startBook=t[1])}var n=isReaderApp&&(1==library.run||"/library/tab/local"==$location.path());if(isReaderApp&&n)$location.path("/library/tab/local"),s.bind(e)("local");else if(0==$location.path().indexOf("/library/tab/downloads"))e.downloadedClicked();else if(e.supportsAccountView)s.bind(e)("account"),$timeout((function(){e.getEbooks({account:!0})}));else if((isNative||desktop)&&!backend.userLoggedIn()&&!config.kotobee.public&&config.kotobee.offline&&sync.offline())s.bind(e)("downloaded"),e.paneMsg=null,0==u().length&&(e.paneMsg="noEbooksDownloaded"),l();else{if(s.bind(e)("all"),!backend.libraryHasPublicBooks()&&!backend.cloudParam("public")&&"hide"==stg.data.currentLibrary.authbookview&&!backend.userLoggedIn())return e.paneMsg="noEbooksAvailable",void l();$timeout(e.getEbooks)}}if(1==library.run){if(library.startBookDetails)return $location.path("/library"),a(library.startBookDetails),library.startBookDetails=null,void(stg.data.initPath=null);if(stg.readSlot("lastBook",(function(e){Array.isArray(e)&&(e=e[0]),e&&stg.data.currentLibrary.openlastbook&&(library.startBook=e),library.startBook&&($location.path("/library"),a(library.startBook))})),library.startBook)return library.startBook=null,void(stg.data.initPath=null)}"/"==stg.data.initPath&&(stg.data.initPath=null),"/login"==stg.data.initPath&&(stg.data.initPath=null),stg.data.initPath&&($location.path(stg.data.initPath),stg.data.initPath=null)}}function r(){var e,n=arguments[0];if(t=n,"preload"==n&&(arguments[1].accumulated||(e=!0,(o=document.getElementById("libraryThumbs"))&&addClass(o,"dim")),mobile||(e=!0),this.paneMsg=null,e&&function(){for(var e=document.getElementsByClassName("libLoaderAnim"),t=0;t<e.length;t++)addClass(e[t],"show");var n=document.getElementById("libraryThumbs");n&&removeClass(n,"dim")}()),"postload"==n){var o,i=arguments[2];(o=document.getElementById("libraryThumbs"))&&removeClass(o,"dim");var r=function(e){var t=this;if(t.currentContentKey){for(var n=0,o=0;o<e.length;o++)if(e[o].searchresults)for(var i=0;i<e[o].searchresults.length;i++)e[o].searchresults[i].results&&(n+=e[o].searchresults[i].results.length);return n}return e.length}(i);library.moreData=r>=library.maxResults,library.moreData&&library.setMax(r)}}function a(e){backend.hasAccessTo({testagainst:e,xid:stg.data.currentLibrary.cloud.xid,open:!0},(function(t){if((config.kotobee.public||backend.userLoggedIn())&&stg.data.currentLibrary&&stg.data.currentLibrary.books)for(var n=0;n<stg.data.currentLibrary.books.length;n++)if(stg.data.currentLibrary.books[n].id==e){modals.hide();var o=stg.data.currentLibrary.books[n];return t.success?book.open(o):bookinfo.show({book:o})}backend.getEbook({bid:e},(function(e){if(e&&!e.error)return(config.kotobee.public||backend.userLoggedIn())&&t.success?void book.open(e,{noDelay:!0}):(modals.hide(),bookinfo.show({book:e}))}))}))}function s(e){var t=this;if(t.tab=e,t.currentCustomCat=null,"category"==t.subMode){var n=t.getCategoryById(t.currentCat.id);n&&n.tab&&(t.currentCustomCat=n,t.tab="customCat")}try{mobile?"undefined"!=typeof $ionicScrollDelegate&&$ionicScrollDelegate.$getByHandle&&"function"==typeof $ionicScrollDelegate.$getByHandle&&$ionicScrollDelegate.$getByHandle("thumbs")&&$ionicScrollDelegate.$getByHandle("thumbs").scrollTop&&$ionicScrollDelegate.$getByHandle("thumbs").scrollTop(!1):document.getElementById("libraryThumbs").scrollTop=0}catch(e){}}function c(){var e=this;"downloaded"==e.tab?$filter("orderBy")(e.data.downloaded,stg.data.sortOb.method.data):"account"==e.tab?e.getEbooks({account:!0}):"favorites"==e.tab?e.loadFavorites():e.getEbooks()}function l(){for(var e=document.getElementsByClassName("libLoaderAnim"),t=0;t<e.length;t++)removeClass(e[t],"show");var n=document.getElementById("libraryThumbs");n&&removeClass(n,"dim")}function d(){var t=this;e&&e(),e=$ionicPlatform.registerBackButtonAction((function(e){kInteractive.frameIsOpen?kInteractive.closeFrame():kInteractive.alertIsOpen?kInteractive.closeAlert():kInteractive.videoIsFullscreen?kInteractive.closeFullscreenVideo():t.searchOb.enabled?t.disableSearch():"categories"==t.tab&&t.catList!=stg.data.currentLibrary.categories?t.categoryBackClicked():(t.currentCat||t.currentKey||t.currentContentKey)&&t.back(),t.$apply()}),102)}function u(){var e=[];return library.applyExistingBooks(e),e}return n.init=function(){var e=this;document.getElementsByClassName("libraryView"),stg.data.book=null,library.addListener(r.bind(e)),backend.setLibraryLoginCallback((function(){i.bind(e)()})),backend.setLibraryLogoutCallback((function(){e.supportsAccountView&&"all"!=e.tab&&(s.bind(e)("all"),$timeout(e.getEbooks)),e.supportsAccountView=!1,l()}));try{window.speechSynthesis.cancel()}catch(e){}if(stg.data.currentLibrary&&stg.data.currentLibrary.defaultsort&&(stg.data.sortOb.method=o.bind(e)(stg.data.currentLibrary.defaultsort)),stg.data.sortOb.method&&(stg.data.sortOb.model=stg.data.sortOb.method.val),e.$on("$ionicView.beforeEnter",(function(t,n){if(book.removeBookConfigElem(),chapters.clearContent(),!(e.native||e.desktop||auth.authenticated&&"library"==config.kotobee.mode)){var o="loading";$ionicHistory.forwardView()?o=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(o=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+o)}$ionicHistory.forwardView()&&$ionicHistory.forwardView().stateId,$ionicHistory.backView()&&$ionicHistory.backView().stateId,"forward"==n.direction&&(stg.data.currentLibrary.books=[],stg.data.favorites=[])})),vueExclude&&"back"==f.direction)return l(),library.setBrowserTitle(),void stg.resetBook();backend.cloudParam("public")?i.bind(e)():backend.cloudParam("entry")?backend.login({dontShowErrorDialog:backend.cloudParam("entry")}).then((function(t){t.error&&i.bind(e)()})):i.bind(e)()},n.langSelected=function(e){stg.data.settings.language=e,settings.langChanged()},n.showLibraryMenu=function(){popovers.show({mode:"popoverLibraryMenu",menuItem:this.menuItemClicked,backdropClickToClose:!1})},n.closeCategoriesPanel=function(){$location.path("/library/tab/all")},n.spaceAvailable=function(e,t){var n=this;if(n.sectionView)return!1;var o=n.currentContentKey?.95:.8;if(e||(e=document.getElementById("libraryThumbs")),e){var i=e.scrollTop,r=document.getElementById("libraryThumbsContent");if(mobile){var a=e.__vue__;a&&(i=a.$children[0].getPosition().top)}var s=90,c=r.getElementsByClassName("bookItem")[0];if(c&&(s=Math.max(s,c.offsetHeight)),i/(r.offsetHeight-e.offsetHeight)>o||e.offsetHeight+s>r.offsetHeight){if(!n.moreDataExists())return;return n.loadMore(t),!0}}},n.scroll=function(e){if("preload"!=t)return this.spaceAvailable()},n.bookClicked=function(e,t){var n={book:e,chapterUrl:t,categoryClicked:this.categoryClicked};config.skipLibBookInfo||t?bookinfo.immediateEnter(n):bookinfo.show(n)},n.refresherExists=function(){var e=this;try{if(!stg.data.currentLibrary)return!1;if("categories"==e.tab)return!1;if("downloaded"==e.tab)return!1;if("favorites"==e.tab)return!0;if("account"==e.tab)return!0;if("all"==e.tab)return!0}catch(e){return!1}return!0},n.doRefresh=function(e){var t=this,n={accumulated:!0};"all"==t.tab?t.getEbooks(n,e):"account"==t.tab?(n.account=!0,t.getEbooks(n,e)):"favorites"==t.tab?t.loadFavorites(n,e):e&&e()},n.sortChanged=function(){for(var e=0;e<stg.data.sortOb.options.length;e++)if(stg.data.sortOb.options[e].val==stg.data.sortOb.model){stg.data.sortOb.method=stg.data.sortOb.options[e];break}c.bind(this)()},n.menuItemClicked=function(e){var t=this;"language"==e&&settings.langChanged(),"sort"==e&&t.sortChanged(),"redeemCode"==e&&(popovers.hide(),t.redeemCodeClicked()),"info"==e&&(popovers.hide(),modals.show({mode:"libraryInfo",dynamic:!0,animation:"slide-in-up",libraryInfo:stg.data.currentLibrary.libraryinfo})),"login"==e&&(popovers.hide(),t.data.user.pwd||t.data.user.code||kError.update({error:"s_authError"})),"logout"==e&&(popovers.hide(),(t.data.user.pwd||t.data.user.code)&&backend.logout()),"requestDelete"==e&&(popovers.hide(),modals.show({mode:"success",successOptions:{msg:translit.get("requestDeleteEmailSent")}}),backend.sendDeletionRequest((function(e){}))),"exit"==e&&(popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})),"rateApp"==e&&void 0!==app&&app.rateApp()},n.getEbooks=function(e,t){var n=this;e||(e={}),n.paneMsg=null,n.currentCat&&(e.catid=n.currentCat.id,e.listmode=n.currentCat.listmode),n.currentKey&&(e.key=n.currentKey),n.currentContentKey&&(e.contentkey=n.currentContentKey),n.sectionView&&(e.sections=!0),library.getEbooks(e,(function(o){if(n.bookSource=o,"all"!=n.tab&&"customCat"!=n.tab&&"account"!=n.tab)return l();o.empty&&(n.paneMsg="noEbooksAvailable"),n.$$phase||n.$apply(),setTimeout((function(){n.spaceAvailable(null,t)||l()}),100),t&&t(!0),e.sections&&Vue.nextTick(n.triggerBookSections)}),(function(e){t&&t(!0)}))},n.triggerBookSections=function(){var e=this.$el.getElementsByClassName("bookThumbsContainer");if(e.length)for(var t=e[0].getElementsByClassName("bookSection"),n=0;n<t.length;n++)t[n].__vue__.scrolled()},n.loadFavorites=function(e,t){var n=this;e||(e={}),n.paneMsg=null,n.currentCat&&(e.catid=n.currentCat.id),n.currentKey&&(e.key=n.currentKey),n.currentContentKey&&(e.contentkey=n.currentContentKey),e.favs=!0,library.getEbooks(e,(function(e){n.bookSource=e,"favorites"==n.tab&&(e.error&&(n.paneMsg="failedToGetFavs"),0==e.length&&(n.paneMsg="noFavsAvailable"),setTimeout((function(){n.spaceAvailable(null,t)||l()}),100),t&&t(!0))}))},n.searchEbooks=function(e){var t=this;if(e&&e.length&&0!=e.length){if(e.length<3)return kError.update({error:"lessThan3Characters"}),void modals.hide();t.subMode="search",t.title="searchResults",config.searchLibContent?t.currentContentKey=e:t.currentKey=e,t.currentCat=null,$location.path("/library/search"),t.supportsAccountView&&"all"!=t.tab?(s.bind(t)("account"),$timeout((function(){t.getEbooks({account:!0})}))):(s.bind(t)("all"),$timeout(t.getEbooks)),d.bind(t)()}},n.enableSearch=function(){this.searchOb.enabled=!0,d.bind(this)()},n.disableSearch=function(){this.searchOb.enabled=!1,e&&e()},n.androidBackBtnClicked=function(){var e=this;isReaderApp?$location.path("/app"):e.searchOb.enabled?e.disableSearch():"categories"==e.tab&&e.catList!=stg.data.currentLibrary.categories?e.categoryBackClicked():e.currentCat||e.currentKey||e.currentContentKey?e.back():modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})},n.loadMore=function(e){var t=this,n={more:!0,accumulated:!0};"all"==t.tab||"customCat"==t.tab?t.getEbooks(n,e):"account"==t.tab?(n.account=!0,t.getEbooks(n,e)):"favorites"==t.tab?t.loadFavorites(n,e):e&&e(!0)},n.stopRefresher=function(){$rootScope.$broadcast("scroll.refreshComplete")},n.moreDataExists=function(){var e=this;try{if(!stg.data.currentLibrary)return!1;if("categories"==e.tab)return!1;if("downloaded"==e.tab)return!1;var t;if("favorites"==e.tab&&(t=e.data.favorites),"all"==e.tab&&(t=stg.data.currentLibrary.books),"customCat"==e.tab&&(t=stg.data.currentLibrary.books),"account"==e.tab&&(t=stg.data.currentLibrary.books),!t||0==t.length)return!1}catch(e){return!1}return library.moreData},n.back=function(){var t=this;t.subMode=!1,t.title=null,t.currentKey=null,t.currentContentKey=null,t.currentCat=null,t.supportsAccountView&&"all"!=t.tab?($location.path("library/tab/account"),s.bind(t)("account"),$timeout((function(){t.getEbooks({account:!0})}))):($location.path("library/tab/all"),s.bind(t)("all"),$timeout(t.getEbooks)),e&&e()},n.categoryBackClicked=function(){var e=this;if(e.catList&&e.catList.length){var t=e.catList[0].parent;for(t=e.getCategoryById(t.id);;){if(!(t=t.parent))return void(e.catList=stg.data.currentLibrary.categories);if("separate"==(t=e.getCategoryById(t.id)).submode)return void(e.catList=t.children)}}},n.getCategoryById=function(e,t){t||(t=stg.data.currentLibrary.categories);for(var o=0;o<t.length;o++){if(t[o].id==e)return t[o];if(t[o].children){var i=n.getCategoryById(e,t[o].children);if(i)return i}}},n.categoryClicked=function(e){var t=this;isNative&&crdv.vibrate();var n=t.getCategoryById(e.id);return n&&(e=n),"separate"==e.submode?(t.catList=e.children,void(t.tab="categories")):"expand"==e.submode?(t.catList=stg.data.currentLibrary.categories,Vue.set(e,"expand",!0),void(t.tab="categories")):(t.currentCat=e,t.currentKey=null,t.currentContentKey=null,t.subMode="category",t.title=t.currentCat.name,s.bind(t)("all"),$timeout(t.getEbooks),void d.bind(t)())},n.categoriesClicked=function(){var e=this;isNative&&crdv.vibrate(),e.catList=stg.data.currentLibrary.categories,e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,s.bind(e)("categories"),e.paneMsg=null,l()},n.accountClicked=function(){var e=this;isNative&&crdv.vibrate(),e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,s.bind(e)("account"),l(),$timeout((function(){e.getEbooks({account:!0})}))},n.allClicked=function(){var e=this;isNative&&crdv.vibrate(),e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,s.bind(e)("all"),$timeout(e.getEbooks)},n.downloadedClicked=function(){var e=this;isNative&&crdv.vibrate(),e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,s.bind(e)("downloaded"),e.bookSource=u(),e.paneMsg=null,0==e.bookSource.length&&(e.paneMsg="noEbooksDownloaded"),l()},n.localClicked=function(){var e=this;isNative&&crdv.vibrate(),e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,s.bind(e)("local"),e.bookSource=function(){var e=[];return e}(),e.paneMsg=null,l()},n.favoritesClicked=function(){var e=this;isNative&&crdv.vibrate(),e.currentCat=e.currentKey=null,e.currentContentKey=null,e.title=e.subMode=null,s.bind(e)("favorites"),e.loadFavorites()},n.redeemCodeClicked=function(){var e=this;auth.redeemCode({source:"topmenu"},(function(){"all"==this.$route.params.tab?e.allClicked():$location.path("/library/tab/all")}))},n.bannerClass=function(e){try{return[JSON.parse(e.config).scale]}catch(e){}},n.bannerPath=function(e){return config.kotobee.liburl+"libraries/"+stg.data.currentLibrary.path+"/public/"+e.img},n.bannerUrl=function(e){try{var t=JSON.parse(e.config);return"url"!=t.actionType?"":t.actionUrl?("www"==t.actionUrl.substr(0,3)&&(t.actionUrl="https://"+t.actionUrl),t.actionUrl):""}catch(e){}},n.bannerClicked=function(e,t){var n=JSON.parse(e.config);if("url"!=n.actionType){if("book"==n.actionType)backend.getEbook({bid:n.actionResource.id},(function(e){e&&!e.error&&bookinfo.show({book:e})}));else if("category"==n.actionType){var o=this.getCategoryById(n.actionResource.id);o&&this.categoryClicked(o)}t.preventDefault()}},n.vScroll=function(e){mobile&&autohide.scrolled(e)},n}(),watch:{$route:function(e,t){if("libraryBookDetails"==t.name&&modals.hide(),e.params.cat&&!isNaN(e.params.cat)){if(!stg.data.currentLibrary.categories||!stg.data.currentLibrary.categories.length)return;if(n=this.getCategoryById(e.params.cat))return this.categoryClicked(n)}if(e.params.tab)if("categories"==e.params.tab)this.categoriesClicked();else if("all"==e.params.tab)this.allClicked();else if("account"==e.params.tab)this.accountClicked();else if("favorites"==e.params.tab)this.favoritesClicked();else if("downloads"==e.params.tab)this.downloadedClicked();else if("local"==e.params.tab)this.localClicked();else if(!isNaN(e.params.tab)){if(!stg.data.currentLibrary.categories||!stg.data.currentLibrary.categories.length)return;var n;if(n=this.getCategoryById(e.params.tab))return this.categoryClicked(n)}if("libraryBookDetails"==e.name&&e.params.book){modals.hide();var o={id:e.params.book};bookinfo.showInternal(o)}}},computed:{loggedIn:function(){if(stg.data.user)return stg.data.user.loggedIn},rows:function(){var e=stg.data.currentLibrary.sections,t=stg.data.currentLibrary.banners;e||(e=[]),t||(t=[]);for(var n=[],o=0;o<t.length;o++)n.push(t[o].bindex?t[o].bindex:0);var i=[];for(o=0;o<e.length;o++)i.push(Object.assign(e[o],{isSection:!0}));var r=0;for(o=0;o<i.length;o++)if(i[o].books&&(!i[o].books.structured||i[o].books.books.length)&&(i[o].books.structured||i[o].books.length)){var a=existsInArray(r,n,{index:!0});null!=a&&i.splice(o,0,t[a]),r++}return i},sectionView:function(){var e=this;return!(!stg.data.currentLibrary.sectionsMode||e.currentKey||e.currentContentKey||e.currentCat||"all"!=this.tab&&"categories"!=this.tab)}}}),function(){var e;compClasses.login=Vue.component("login",{data:function(){return{langDropdownExpanded:null,canLoginByEmail:null,canLoginByCode:null,mode:null,model:{}}},template:getTemplate("views/login.html"),mounted:function(){compInstances.login=this,this.init()},computed:{ssoBusy:function(){if(stg.data.sso)return stg.data.sso.ssoBusy}},methods:(e={init:function(){var e=this;mobile||(design.stylize("login",design.getBgStyle()),backend.addListener("pathsChanged",(function(){design.stylize("login",design.getBgStyle())}))),"email"==config.kotobee.loginmode||config.kotobee.promocodesdisabled?e.canLoginByEmail=!0:"code"==config.kotobee.loginmode?e.canLoginByCode=!0:e.canLoginByEmail=e.canLoginByCode=!0,e.mode=e.canLoginByEmail?"email":"code",e.$on("$ionicView.afterEnter",(function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("login")))})),isNative||desktop||e.$on("$ionicView.beforeEnter",(function(){if(!initializer.initialized||config.kotobee.public||backend.userLoggedIn()){var e="loading";$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e)}}))},ssoSupported:function(e){var t=config.kotobee.sso[e];return!(!t||!t.enabled)&&(!(t.andr||t.ios||t.web)||(isNative?ios?t.ios:t.andr:t.web))},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},login:function(){var e=this;if(e.model){if("code"==e.mode){if(!e.model.code)return void kError.update({error:"enterYourCode"});stg.data.user.code=e.model.code,stg.data.user.email=stg.data.user.pwd=null}else{if(!stg.data.user.email)return void kError.update({error:"enterYourEmail"});if(!e.model.pwd)return void kError.update({error:"enterYourPwd"});stg.data.user.pwd=e.model.pwd,stg.data.user.code=null}config.kotobee.permsLoaded?t():auth.getPermissions(t)}function t(){backend.login({dontShowErrorDialog:!0,userInput:!0}).then((function(t){if(t.error)return kError.update({error:"s_authError"==t.error?"accessDenied":t.error});e.model.pwd=null,e.model.code=null,auth.startup()}))}},register:function(){modals.hide(),$location.path("/register")},forgotPassword:function(){$location.path("/forgotpwd")},signInByEmail:function(){this.mode="email"},redeemCode:function(){this.mode="code"},langSelected:function(e){this.langDropdownExpanded=!1,stg.data.settings.language=e,settings.langChanged()},emit:function(e,t){vueApp.$emit(e,t)}},e)})}(),function(){var e;compClasses.payment=Vue.component("payment",{data:function(){return{}},template:getTemplate("views/payment.html"),mounted:function(){compInstances.payment=this,this.init()},computed:{state:function(){return this.$route.params.state},bookID:function(){return this.$route.params.bookID},userID:function(){return this.$route.params.userID}},methods:(e={},e.init=function(){var e,t=this;mobile||(design.stylize("payment",design.getBgStyle()),backend.addListener("pathsChanged",(function(){design.stylize("payment",design.getBgStyle())}))),e=function(){var e;e=function(){config.kotobee.payment&&(stg.data.payment||Vue.set(stg.data,"payment",{}),"success"==t.$route.params.state?Vue.set(stg.data.payment,"success",!0):Vue.set(stg.data.payment,"success",!1))},("library"==config.kotobee.mode?backend.getUnauthLibrary:backend.getPermissions)((function(t){var n="library"==config.kotobee.mode?t.cloud:t;config.kotobee.payment=n.payment,e()}))},stg.initialize(),stg.initializeSettings((function(){chapterAPI.initialize(),settings.langChanged(e)}))},e.openBook=function(){library.startBook=this.bookID,initializer.initialize()},e.backToLib=function(){initializer.initialize()},e.backToLibOld=function(){$location.path("/library")},e)})}(),compClasses.reader=Vue.component("reader",{data:function(){return{webWatermarkPlaceholder1:"",header:{mode:"default"},searchOb:{enabled:!1},sideMenuMode:"bookSettings",autohideEase:null}},template:getTemplate("views/reader.html"),destroyed:function(){this.destroyed()},mounted:function(){compInstances.reader=this,this.init()},computed:{contentDir:function(){return book.getContentDir()}},watch:{$route:function(e,t){if(!e||!t||a(e)!=a(t)){var n=e.params.ch?e.params.ch:0,o=e.params.hash?e.params.hash:null,i=getQueryStringValue("vi"),r=chapters.loadChapterByIndex(Number(n),{hash:o,vIndex:i});r&&r.then((function(){kotobee.dispatchEvent("processedRoute")}))}function a(e){return e.fullPath.replace(/[?&]popup/g,"")}}},methods:function(){var t,n,o,i={};function r(e){"c"==e.key&&(e.ctrlKey||e.metaKey)&&selection.copyToClipboard(),e.shiftKey&&("ArrowRight"==e.key?selection.extendRight():"ArrowLeft"==e.key&&selection.extendLeft())}function a(e,t){if(n&&clearTimeout(),currentIndex==t.currentChapterIndex)return n=setTimeout((function(){a(e,t)}),1e3);var o={neighbor:t.currentChapterIndex+("next"==e?1:-1),ch:t.currentChapterTitle,chIndex:t.currentChapterIndex,dir:e,targetIndex:currentIndex,targetCh:stg.data.book.chapter.title};events.add({action:"navBtnClicked",param:JSON.stringify(o)})}return i.init=function(){var e=this;e.mode="reading",e.native||e.desktop||e.$on("$ionicView.beforeEnter",(function(){if(!initializer.initialized||!config.kotobee.public&&!backend.userLoggedIn()){var e="loading";$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e)}})),$rootScope.renderScope=e,selection.listener=e.selection,t=$ionicPlatform.registerBackButtonAction((function(t){var n=$location.path();kInteractive.frameIsOpen?kInteractive.closeFrame():kInteractive.alertIsOpen?kInteractive.closeAlert():kInteractive.videoIsFullscreen?kInteractive.closeFullscreenVideo():"default"!=e.header.mode?"selection"==e.header.mode?selection.reset():e.applyHeader("default"):stg.data.book.chapter.viewport&&nav.getFxlScale()!=nav.getFxlFit().bestFit?nav.fxlZoomFit():"library"==config.kotobee.mode&&0==n.indexOf("/book")?$location.path("/library"):isReaderApp&&"/app"!=n?$location.path("/app"):modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}}),e.$apply()}),103),e.native||e.desktop||e.$on("$ionicView.beforeEnter",(function(){if(!auth.authenticated){var e="loading";$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e)}})),mobile&&autohide.setup(this,"reader")},i.vScroll=function(e){mobile&&autohide.scrolled(e)},i.destroyed=function(){t&&t.bind(this)(this)},i.chapterClicked=function(e){chapters.displayChapters()},i.backClicked=function(e){if($ionicSideMenuDelegate.isOpen())return $ionicSideMenuDelegate.close();modals.show({mode:"backToLib",backdropClickToClose:!1,backToLibOptions:{back:function(){modals.hide(),$location.path("/library")}}})},i.searchClicked=function(e){this.applyHeader("search")},i.androidBackBtnClicked=function(){var e=this;$ionicSideMenuDelegate.isOpen()?$ionicSideMenuDelegate.close():"default"!=e.header.mode?"selection"==e.header.mode?selection.reset():e.applyHeader("default"):stg.data.book.chapter.viewport&&!function(){if(stg.data.book.chapter.viewport){var e=nav.getFxlFit(),t=Math.round(1e3*e.heightFit)/1e3,n=Math.round(1e3*e.widthFit)/1e3,o=Math.round(1e3*nav.getFxlScale())/1e3;return o==t||o==n}}()?nav.fxlZoomFit():"library"==config.kotobee.mode&&0==$location.path().indexOf("/book")?e.backClicked():isReaderApp?app.exitBook():modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})},i.setSideMenuMode=function(e){this.sideMenuMode=e},i.applyHeader=function(e){try{this.header.mode=e}catch(e){}},i.selection=function(e){if(mobile)"activated"==e||"selectionFixed"==e?(this.applyHeader("selection"),kotobee.dispatchEvent("textSelected",{text:selection.getSelectedText()})):"deactivated"==e&&(this.applyHeader("default"),kotobee.dispatchEvent("textDeselected"));else if("selectionFixed"==e)(t=document.getElementById("selectionOptions"))&&addClass(t,"showBar"),document.getElementById("copyBtn").setAttribute("data-clipboard-text",selection.getSelectedText()),window.addEventListener("keydown",r),kotobee.dispatchEvent("textSelected",{text:selection.getSelectedText()});else if("deactivated"==e){var t;(t=document.getElementById("selectionOptions"))&&removeClass(t,"showBar"),window.removeEventListener("keydown",r),kotobee.dispatchEvent("textDeselected")}},i.contentLink=function(e){chapters.applyChapterStateFromURL(e.getAttribute("href"))},i.chapterLink=function(e){var t=this;if(e.parentElement.getElementsByTagName("ol").length>0){var n=e.offsetHeight+20;if(overflowScroll||$ionicScrollDelegate.$getByHandle("chapters").scrollBy(0,n,!0),!e.getAttribute("href")||e.getAttribute("data-dontshow"))return void(hasClass(e.parentElement,"expanded")?removeClass(e.parentElement,"expanded"):addClass(e.parentElement,"expanded"));addClass(e.parentElement,"expanded")}$ionicSideMenuDelegate.close(),$location.search("vi");var o=chapters.getIndexFromTocElem(e);chapters.applyChapterStateFromURL(e.getAttribute("href"),{vIndex:0,index:o}),t.$$phase||t.$apply()},i.targetCurrentChapter=function(e){chapters.highlightCurrentTocChapter()},i.externalLink=function(e){var t=e.getAttribute("href"),n=e.getAttribute("target");backend.externalLink(t,{target:n}),kInteractive.events&&kInteractive.events.add({action:"linkClicked",param:t,elem:e})},i.bookmarkClicked=function(e){bookmarks.addBookmark()},i.freehandClicked=function(e,t){var n=e.target;n.classList.contains("active")?freehand.deactivate():freehand.activate(),n.classList.toggle("active")},i.noteClicked=function(e,t){notes.noteClicked(e?[e]:null,t)},i.miniappsClicked=function(){var e=this;if(stg.data.settings.rtl){if($ionicSideMenuDelegate.isOpenLeft()&&"miniapps"!=e.sideMenuMode)return $ionicSideMenuDelegate.toggleLeft(),void $timeout(e.settingsClicked,300)}else if($ionicSideMenuDelegate.isOpenRight()&&"miniapps"!=e.sideMenuMode)return $ionicSideMenuDelegate.toggleRight(),void $timeout(e.settingsClicked,300);isNative&&crdv.vibrate(),e.setSideMenuMode("miniapps"),mobile&&nav.resize(),stg.data.settings.rtl?$ionicSideMenuDelegate.toggleLeft():$ionicSideMenuDelegate.toggleRight()},i.nextChapter=function(){var e={};return e.currentChapterTitle=stg.data.book.chapter.title,e.currentChapterIndex=currentIndex,chapters.nextChapter({},(function(t){a("next",e)}))},i.prevChapter=function(){var e={};return e.currentChapterTitle=stg.data.book.chapter.title,e.currentChapterIndex=currentIndex,chapters.prevChapter({},(function(t){a("previous",e)}))},i.pinched=function(e){},i.showBookInfo=function(){isNative&&crdv.vibrate();var e=stg.data.book;e.meta||(e.meta={}),e.meta.dc||(e.meta.dc={}),e.meta.kotobee||(e.meta.kotobee={}),e.coverImg=stg.data.epub.bookThumb,e.coverImg||(e.coverImg=(config.kotobee.liburl?config.kotobee.liburl:"")+"img/ui/defaultCover.png"),e.coverStyle={"background-image":"url('"+e.coverImg+"')"},e.name=e.meta.dc.title,e.meta.publisherurl=e.meta.kotobee.publisherurl;var t={ui:{}};t.book=e,t.stage="info",config.kotobee.cloudid&&"book"==config.kotobee.mode&&(t.book.stats=config.kotobee.stats),t.noAction=!0,modals.show({mode:"bookInfo",dynamic:!0,animation:"slide-in-up",bookInfoOptions:t})},i.gotoPageClicked=function(e){e.stopPropagation();var t={};t.page=stg.data.currentPageOb.index+1,config.gotoPageOffset&&(t.page-=config.gotoPageOffset),t.submit=function(){if(!isNaN(t.page)){var e=Number(t.page)-1;config.gotoPageOffset&&(e+=config.gotoPageOffset),chapters.loadChapterByIndex(e),modals.hide()}},modals.show({mode:"gotoPage",gotoPageOptions:t})},i.mouseDown=function(){mobile&&nav.resize(),virt.enable()},i.mouseUp=function(){virt.disableAfter(2e3)},i.scroll=function(){if(stg.data.book){try{var t=$ionicScrollDelegate.$getByHandle("content"),n=new Event("kotobeeScrolled");if(t){var i=t.getScrollPosition();n.left=i.left,n.top=i.top,n.zoom=i.zoom}document.dispatchEvent(n)}catch(e){}kotobee&&kotobee.dispatchEvent("scrolled",i),config.preserveLoc&&"app"!=config.kotobee.mode&&(o&&clearTimeout(o),o=setTimeout((function(){if("app"!=config.kotobee.mode){var e=$ionicScrollDelegate.$getByHandle("content");if(e){var t=e.getScrollPosition();t&&stg.writeSlot("lastLocY"+stg.getBookId(),t.top)}}}),2e3)),mobile&&autohide.scrolled(e),mobile||(virt.enable(),virt.disableAfter(2e3))}},i.doubleTap=function(){},i.swipeLeft=function(){nav.options.swipeDisabled||(isNative&&crdv.vibrate(),book.isRtl()?chapters.prevChapter():chapters.nextChapter(),config.autohideHeader&&("showOnTap"!=config.autohideReaderMode&&"hideOnTap"!=config.autohideReaderMode||autohide.hideBtns()))},i.swipeRight=function(){nav.options.swipeDisabled||(isNative&&crdv.vibrate(),book.isRtl()?chapters.nextChapter():chapters.prevChapter(),config.autohideHeader&&("showOnTap"!=config.autohideReaderMode&&"hideOnTap"!=config.autohideReaderMode||autohide.hideBtns()))},i.openAuthorWebsite=function(){inherited(this.$parent,"openAuthorWebsite")},i}()}),function(){var e;compClasses.redeemCode=Vue.component("redeemCode",{data:function(){return{user:{code:""}}},template:getTemplate("views/redeemCode.html"),mounted:function(){compInstances.redeemCode=this,this.init()},computed:{rtl:function(){return stg.data.settings?stg.data.settings.rtl:null}},methods:(e={init:function(){var e=this;mobile||(design.stylize("redeemCode",design.getBgStyle()),backend.addListener("pathsChanged",(function(){design.stylize("redeemCode",design.getBgStyle())}))),stg.data.user||Vue.set(stg.data,"user",{}),e.$on("$ionicView.afterEnter",(function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("redeemCode")))})),e.native||e.desktop||e.$on("$ionicView.beforeEnter",(function(){if(!initializer.initialized||backend.cloudParam("public")||stg.data.user&&backend.userLoggedIn()){var e="loading";$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e)}}))},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},submit:function(){var e=this;function t(){backend.cloudParam("entry")?(window.history.back(),backend.login()):backend.login().then((function(e){e.error?kError.update({error:"s_authError"==e.error?"accessDenied":e.error}):auth.startup()}))}e.user&&e.user.code&&(stg.data.user.code=e.user.code,stg.data.user.email=stg.data.user.pwd=null,config.kotobee.permsLoaded?t():auth.getPermissions(t))},backClicked:function(){window.history.back()}},e)})}(),function(){var e;compClasses.register=Vue.component("register",{data:function(){return{user:{email1:"",email2:""},creating:null}},template:getTemplate("views/register.html"),mounted:function(){compInstances.register=this,this.init()},computed:{rtl:function(){return stg.data.settings?stg.data.settings.rtl:null}},methods:(e={init:function(){var e=this;mobile||(design.stylize("register",design.getBgStyle()),backend.addListener("pathsChanged",(function(){design.stylize("register",design.getBgStyle())}))),e.$on("$ionicView.afterEnter",(function(){cache.setOb("title",replaceHTML(cache.getOb("title"),translit.get("register")))})),e.native||e.desktop||e.$on("$ionicView.beforeEnter",(function(){if(!initializer.initialized||config.kotobee.public||backend.userLoggedIn()){var e="loading";$ionicHistory.forwardView()?e=$ionicHistory.forwardView().stateId:$ionicHistory.backView()&&(e=$ionicHistory.backView().stateId),$ionicHistory.nextViewOptions({disableAnimate:!0}),$location.path("/"+e)}}))},showMenu:function(){var e=[{name:translit.get("exit"),func:function(){popovers.hide(),modals.show({mode:"exit",backdropClickToClose:!1,exitOptions:{exit:function(){crdv.exit()}}})}}];popovers.show({mode:"popoverCornerList",listOb:e,backdropClickToClose:!1})},create:function(){var e=this;this.verify()&&(e.creating||(e.creating=!0,backend.register(e.user,(function(t){if(e.creating=!1,t&&!t.error){var n="d_accountCreated";t.success&&t.success.approvalRequired&&(n="d_accountCreatedApprovalRequired"),window.history.back(),modals.hideAll(),modals.show({mode:"success",successOptions:{msg:translit.get(n)}})}}))))},androidBackBtnClicked:function(){window.history.back()},verify:function(){var e=this.user;if(-1==e.email1.indexOf("@"))return kError.update({error:"emailFormatError"}),!1;if(!/^([\w.-]+)@([\w-]+\.)+([a-z]{2,})$/i.test(e.email1))return kError.update({error:"emailFormatError"}),!1;if(e.email1!=e.email2)return kError.update({error:"emailsDontMatch"}),!1;if(stg.view.registration.promocodeMandatory&&!e.promocode)return kError.update({error:"fillInAllFields"}),!1;var t=config.kotobee.registrationsettings;if(t||(t={}),t.name&&t.namerequired&&!e.name)return kError.update({error:"fillInAllFields"}),!1;if(t.dob&&t.dobrequired&&!e.dob)return kError.update({error:"fillInAllFields"}),!1;if(t.organization&&t.organizationrequired&&!e.organization)return kError.update({error:"fillInAllFields"}),!1;if(t.dept&&t.deptrequired&&!e.dept)return kError.update({error:"fillInAllFields"}),!1;if(t.univ&&t.univrequired&&!e.univ)return kError.update({error:"fillInAllFields"}),!1;if(t.faculty&&t.facultyrequired&&!e.faculty)return kError.update({error:"fillInAllFields"}),!1;if(t.class&&t.classrequired&&!e.class)return kError.update({error:"fillInAllFields"}),!1;if(t.division&&t.divisionrequired&&!e.division)return kError.update({error:"fillInAllFields"}),!1;if(t.customid&&t.customidrequired&&!e.customid)return kError.update({error:"fillInAllFields"}),!1;if(t.gender&&t.genderrequired&&!e.gender)return kError.update({error:"fillInAllFields"}),!1;if(t.country&&t.countryrequired&&!e.country)return kError.update({error:"fillInAllFields"}),!1;if(t.city&&t.cityrequired&&!e.city)return kError.update({error:"fillInAllFields"}),!1;if(t.phone&&t.phonerequired&&!e.phone)return kError.update({error:"fillInAllFields"}),!1;if(t.info&&t.inforequired&&!e.info)return kError.update({error:"fillInAllFields"}),!1;for(var n=config.kotobee.registrationsettings.customfields,o=0;o<n.length;o++){var i=n[o];if(i.required&&!e[i.name])return kError.update({error:"fillInAllFields"}),!1}return!0},backClicked:function(){vueApp.$router.back()}},e)})}(),function(){var e;compClasses.test=Vue.component("test",{data:function(){return{}},template:getTemplate("views/test.html"),mounted:function(){compInstances.test=this,this.init()},computed:{},methods:(e={init:function(){}},e)})}();var kInteractive={preRender:function(e,t){t||(t={});var n,o=t.singleElem,i=e||document;o?(n=[e],i=document):n=i.getElementsByClassName("kInteractive"),void 0!==isKotobee&&(kInteractive.absoluteURL=kInteractive.getAbsoluteUrl(t));for(var r=n.length;r--;){var a=n[r];this.hasClass(a,"gallery")&&kInteractive.gallery.preRender(a,i,r),this.hasClass(a,"questions")&&kInteractive.questions.preRender(a,i,r),(this.hasClass(a,"image")||"img"==a.nodeName.toLowerCase())&&kInteractive.image.preRender(a,i,r),this.hasClass(a,"link")&&kInteractive.link.preRender(a,i,r),this.hasClass(a,"container")&&kInteractive.container.preRender(a,i,r),this.hasClass(a,"equation")&&kInteractive.equation.preRender(a,i,r),this.hasClass(a,"lipsync")&&kInteractive.lipsync.preRender(a,i,r)}},postRender:function(e,t){t||(t={});var n=t.singleElem;if(kInteractive.absoluteURL=kInteractive.getAbsoluteUrl(t),kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.clocks&&(kInteractive.clocks=[]),kInteractive.observers){for(var o=kInteractive.observers.length;o--;)kInteractive.observers[o].disconnect();kInteractive.observers=null}kInteractive.clearAudioVideo(e),kInteractive.currentVideo=kInteractive.currentAudio=null;var i,r=e||document;n?(i=[e],r=document):i=r.getElementsByClassName("kInteractive");for(var a=i.length;a--;){var s=i[a],c=a;null!=t.forcedIndex&&(c=t.forcedIndex),this.hasClass(s,"container")?kInteractive.container.postRender(r,s,c,t):this.hasClass(s,"questions")?kInteractive.questions.postRender(r,s,c,t):this.hasClass(s,"widget")?kInteractive.widget.postRender(r,s,c,t):this.hasClass(s,"video")?kInteractive.video.postRender(r,s,c):this.hasClass(s,"audio")?kInteractive.audio.postRender(r,s,c):this.hasClass(s,"threed")?kInteractive.threed.postRender(r,s,c,t):this.hasClass(s,"gallery")?kInteractive.gallery.postRender(r,s,c):this.hasClass(s,"image")?kInteractive.image.postRender(r,s,c):this.hasClass(s,"equation")?kInteractive.equation.postRender(r,s,c):this.hasClass(s,"lipsync")&&kInteractive.lipsync.postRender(r,s,c)}this.firstRun&&(window.addEventListener("resize",(function(t){kInteractive.resizeEvent(e,n)})),this.firstRun=!1),kInteractive.resizeEvent(e,n)},getAbsoluteUrl:function(e){e||(e={});var t="";return void 0!==isKotobee&&(t=e.chapterUrl?e.chapterUrl:stg.data.book.chapter.absoluteURL),"/"==t[0]&&(t=window.location.origin+t),t},actionEvent:function(e){return kInteractive.action(e.target,e)},action:function(e,t){if(!kInteractive.isEditorMode()){for(kInteractive.absoluteURL=kInteractive.getAbsoluteUrl();!e.className.trim;)e=e.parentNode;for(var n=e;!this.hasClass(n,"kInteractive");){if(!n.parentNode)return;if((n=n.parentNode)==document.body)return}return this.hasClass(n,"questions")?kInteractive.questions.action(n,e,t):this.hasClass(n,"widget")?kInteractive.widget.action(n):this.hasClass(e,"link")?kInteractive.link.action(n,e,t):this.hasClass(e,"image")?kInteractive.image.action(n,e,t):this.hasClass(n,"gallery")?kInteractive.gallery.action(n,e,t):this.hasClass(n,"audio")?kInteractive.audio.action(n,e,t):this.hasClass(n,"video")?kInteractive.video.action(n,e,t):this.hasClass(n,"threed")?kInteractive.threed.action(n,e,t):this.hasClass(n,"equation")?kInteractive.equation.action(n,e,t):this.hasClass(n,"lipsync")?kInteractive.lipsync.action(n,e,t):void 0}},trigger:function(e,t){this.action(t,e)},resize:function(e,t){kInteractive.resizeEvent(e,t)},resizeEvent:function(e,t){var n=e||document;t&&(n=document);for(var o=n.getElementsByClassName("kInteractive"),i=o.length;i--;){var r=o[i];this.hasClass(r,"image")?kInteractive.image.resize(r):this.hasClass(r,"gallery")?kInteractive.gallery.resize(r):this.hasClass(r,"container")?kInteractive.container.resize(r):this.hasClass(r,"video")?kInteractive.video.resize(r):this.hasClass(r,"widget")?kInteractive.widget.resize(r):this.hasClass(r,"equation")?kInteractive.equation.resize(r):this.hasClass(r,"questions")&&kInteractive.questions.resize(r)}},helpers:{},vQueue:[],youTubeReady:!1,firstRun:!0,scorm:"undefined"!=typeof scorm?scorm:null,events:"undefined"!=typeof events?events:null},_kInteractiveCommon;if(void 0===isKotobee){var getKotobeeListener=function(e){if(e)for(var t=kotobeeListeners.length;t--;)if(kotobeeListeners[t].event==e)return kotobeeListeners[t]},clearKotobeeListeners=function(e){for(var t=kotobeeListeners.length;t--;)e&&kotobeeListeners[t].event!=e||kotobeeListeners.splice(t,1)},dispatchKotobeeEvent=function(){},kInteractionStart=function(){window.log||(window.log=function(e){}),kInteractive.setDOMParser(),renderMiniapps(),kInteractive.preRender(),kInteractive.postRender()},kInteractionStartSingleElem=function(e,t){kInteractive.setDOMParser(),kInteractive.preRender(e,{singleElem:!0}),kInteractive.postRender(e,{singleElem:!0,forcedIndex:t})},renderMathJax=function(){MathJax&&MathJax.typeset&&MathJax.typeset()},renderMiniapps=function renderMiniapps(){try{if(window.top&&window.top.document&&window.top.document.body&&"kAuthor"==window.top.document.body.id)return}catch(e){}var chapterBody=document.body.textContent;window.miniapps={test:2},window.miniappsConfig={};var kmetaRoot=getRelativeRoot()+"_kmeta/",appids=[],scriptElem=document.createElement("script");function getRelativeRoot(){var e=window.location.href.split("/");e=e.reverse();for(var t="",n=0;n<e.length&&"EPUB"!=e[n];n++)t+="../";return t}function validate(e,t){for(var n,o=document.getElementsByTagName("meta"),i=0;i<o.length;i++)if(o[i].getAttribute("name")=="m-"+window.atob("Y2hlY2tzdW0=")){n=o[i];break}if(kInteractive.isSDK())return!0;if(!n)return!1;var r=e.join(";"),a=t.replace(/\s+/g,"");return kInteractive.simpleHash(a+r)==n.getAttribute("content")}scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=function(result){var json=miniappJson.apps,arr=[];for(var item in json)arr.push({folder:item,code:json[item]});if(arr.length){var miniappContainer=document.createElement("div");miniappContainer.id="kiMiniappContainer",miniappContainer.innerHTML="<a href='' class='closeBtn'>X</a>",miniappContainer.getElementsByClassName("closeBtn")[0].addEventListener("click",toggleMiniappsContainer);var miniappsBtn=document.createElement("a");miniappsBtn.id="kiMiniappsBtn",miniappsBtn.setAttribute("href",""),miniappsBtn.innerHTML="Apps",miniappsBtn.addEventListener("click",toggleMiniappsContainer),next(0)}function toggleMiniappsContainer(e){e&&e.preventDefault(),miniappContainer.classList.contains("open")?miniappContainer.classList.remove("open"):miniappContainer.classList.add("open")}function next(index){if(index>=1&&miniappJson.sdk)return finalize();if(index>=arr.length)return finalize();var folder=arr[index].folder,pageLang=document.documentElement.lang;pageLang=-1!=pageLang.indexOf("es")?"es":-1!=pageLang.indexOf("fr")?"fr":-1!=pageLang.indexOf("ar")?"ar":"en";var scriptElem=document.createElement("script");scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=function(){scriptElem.parentNode.removeChild(scriptElem);var configJson=window.miniappConfig;"string"==typeof configJson&&(configJson=JSON.parse(configJson));var appid=configJson.appid,code=arr[index].code,regex=new RegExp("{{"+appid+"Root}}","g");code=code.replace(regex,kmetaRoot+"miniapps/"+folder),code=code.replace(/{{www}}/g,kmetaRoot+"../.."),eval(code),appids.push(appid);var miniappObj={};if(miniappObj.config=miniappsConfig[folder],miniappObj.locale=configJson.locale,miniappObj.appid=appid,miniappObj.appClass=window.miniappOutput,miniappObj.name=configJson.locale[pageLang].name,miniappObj.icon=configJson.icon,!miniappObj.appClass.open)return next(++index);function finishedGettingDataJson(){scriptElem.parentNode.removeChild(scriptElem);var e=document.createElement("a");e.className="app";var t=miniappObj.name,n=kmetaRoot+"miniapps/"+folder+"/icon.png";window.miniappData&&(window.miniappData._listingName&&(t=window.miniappData._listingName),window.miniappData._listingIcon&&(n=kInteractive.isAbsolutePath(window.miniappData._listingIcon)?window.miniappData._listingIcon:kmetaRoot+"miniapps/"+folder+"/userdata/"+window.miniappData._listingIcon)),e.innerHTML='<p class="name">'+t+'</p><img class="icon" src="'+n+'"/>',miniappObj.appClass.externalLink&&(e.setAttribute("href",miniappObj.appClass.externalLink),e.setAttribute("target","_blank")),miniappContainer.appendChild(e),e.addEventListener("click",(function(){toggleMiniappsContainer(),miniappObj.appClass.externalLink||miniappObj.appClass.open()})),next(++index)}scriptElem=document.createElement("script"),scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=finishedGettingDataJson,scriptElem.onerror=finishedGettingDataJson,scriptElem.src=kmetaRoot+"miniapps/"+folder+"/userdata/data.js"},scriptElem.src=kmetaRoot+"miniapps/"+folder+"/config.js"}function finalize(){(miniappJson.sdk||validate(appids,chapterBody))&&(document.body.appendChild(miniappsBtn),document.body.appendChild(miniappContainer))}},scriptElem.src=kInteractive.c.join(kmetaRoot,"miniapps.js")};window.kotobee={};var kotobeeListeners=[];document.addEventListener("DOMContentLoaded",(function(e){"undefined"!=typeof kotobeeReady&&kotobeeReady(e),document.dispatchEvent(new Event("kotobeeReady")),document.dispatchEvent(new Event("kotobeeChapterLoaded")),kotobee.dispatchEvent("ready"),kotobee.dispatchEvent("chapterLoaded"),document.addEventListener("scroll",(function(e){kotobee.dispatchEvent("scrolled",e)}))})),kotobee.addEventListener=function(){if(!(arguments.length<2)){var e,t=arguments[0],n={};2==arguments.length?e=arguments[1]:(n=arguments[1],e=arguments[2]),n.unique&&clearKotobeeListeners(t);var o={event:t,cb:e};kotobeeListeners.push(o)}},kotobee.dispatchEvent=function(e,t){if(e){var n=getKotobeeListener(e);n&&n.cb&&n.cb.apply(this,[t])}};try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(e){window.addEventListener("load",kInteractionStart,!1)}}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}kInteractive.audio={preRender:function(e,t){},postRender:function(e,t,n){var o=e.createDocumentFragment(),i=kInteractive.readData(t);t.setAttribute("id","ki-audio-"+n),t.innerHTML="";var r=document.createElement("div");r.setAttribute("id","ki-audio-"+n+"-container"),r.className="container";var a=document.createElement("a");a.className="playBtn ki-btn",a.appendChild(document.createElement("span")),void 0===isKotobee&&a.addEventListener("click",kInteractive.actionEvent);var s=document.createElement("div");if(i.style&&kInteractive.c.addClass(s,i.style),o.appendChild(a),o.appendChild(r),s.appendChild(o),t.appendChild(s),i.autoplay)kInteractive.action(t)},action:function(e){kInteractive.stopCurrentMedia();var t=kInteractive.readData(e);if(t){t.audioType||(t.audioType=t.type);e.getAttribute("id");e.getElementsByClassName("playBtn")[0].className="playBtn ki-btn hide";var n=t.src;if("file"==t.audioType&&(n=void 0===isKotobee?t.audio:t.relToRoot?ph.join(bookPath,t.audio):ph.join(kInteractive.absoluteURL,t.audio)),kInteractive.scorm){var o={};o.id=kInteractive.getScormId(e.getAttribute("id"),n),o.description="Played audio: "+n,o.type="other",o.learnerResponses="Played",o.objective=t.options?t.options.objective:null,o.timestamp=new Date,kInteractive.scorm.setInteractions([o])}kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:n,elem:e,data:t});var i=document.createElement("audio");i.setAttribute("controls","true"),i.setAttribute("autoplay","true"),i.setAttribute("data-tap-disabled","false");var r=document.createElement("source");r.src=kInteractive.cleanURL(n),i.appendChild(r),i.appendChild(document.createTextNode("Your browser does not support the audio element")),i.className="ki-noHighlight",t.options&&t.options.hideDownloadBtn&&(i.className+=" hideDownloadBtn",i.setAttribute("controlsList","nodownload")),i.oncanplay=function(){kInteractive.currentAudio==e&&kInteractive.tinCan({verb:"played",activity:"Audio: "+n})},e.getElementsByClassName("container")[0].appendChild(i),i.play(),kInteractive.currentAudio=e,kInteractive.c.addClass(kInteractive.currentAudio,"playing")}}};var kInteractiveCommon=(_kInteractiveCommon={checkResponsiveFloat:function(e,t){if(e&&e.disableWrapForMobile&&"none"!=e.float){var n=t.parentNode;t.offsetWidth>.6*n.offsetWidth&&.4*(n.offsetWidth-t.offsetWidth)<100?kInteractive.c.addClass(t,"fullRow"):kInteractive.c.removeClass(t,"fullRow")}},openLink:function(e){var t={cb:function(t){var n=document.createElement("iframe");n.src=e,t.appendChild(n)},closed:function(){}};kInteractive.openFrame(t)},openFrame:function(e){var t=document.getElementById("kInteractiveFrame"),n=document.getElementById("kiDarkOverlay"),o="";if(e.dict||(e.dict={}),e.width&&(o+="width:"+e.width+"px;max-width:"+e.width+"px;"),e.height&&(o+="height:"+e.height+"px;max-height:"+e.height+"px;"),t||((n=document.createElement("div")).id="kiDarkOverlay",document.body.appendChild(n),n.style.display="none",n.style.position="fixed",n.addEventListener("click",kInteractive.closeFrame),(t=document.createElement("div")).id="kInteractiveFrame"),e.pos||(e.pos="top"),"none"!=e.pos){var i=document.createElement("a"),r="closeBtn";e.pos&&(r+=" "+e.pos),i.className=r;var a="Close";try{"undefined"!=typeof translit&&(a=translit.get("close"))}catch(e){}e.dict&&e.dict.close&&(a=e.dict.close),"side"!=e.pos&&(i.innerHTML=a),i.addEventListener("click",kInteractive.closeFrame),t.appendChild(i)}var s=e.class?e.class:"";(e.width||e.height)&&(s+=" fixed"),e.aspectRatio&&(s+=" aspectRatio"),t.style.display="block",t.className=s,document.body.appendChild(t),kInteractive.frameIsOpen=!0,kInteractive.frameOb=e;try{if(void 0!==isKotobee&&!isNative){var c=window.location.hash.split("#");c.length>1&&(window.location.hash+=(-1==c[1].indexOf("?")?"?":"&")+"popup",window.addEventListener("hashchange",this.backBtnPressed))}}catch(e){}function l(){n.style.display="block",n.className="show";var i=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,r=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;i-=20,r-=20;var a=1;if(e.width&&e.height){var c=r/e.width,l=i/e.height;(a=c<l?c:l)>1&&(a=1)}var d="display:block;";d+=o;var u=!1;try{void 0!==isKotobee&&(u=stg.data.settings.rtl)}catch(e){}var p=e.width||e.height?(u?"50%":"-50%")+",-50%":"0%,0%";d+="-webkit-transform:translate("+p+") scale("+a+");-moz-transform:translate("+p+") scale("+a+");transform:translate("+p+") scale("+a+");",d+="position:fixed;",void 0===isKotobee&&"-50%,-50%"==p&&(d+="top:"+Math.round(window.innerHeight/2)+"px;",d+="left:"+Math.round(window.innerWidth/2)+"px;"),-1!=s.indexOf("aspectRatio")&&window.innerWidth/window.innerHeight>16/9&&(d+="padding-bottom: "+95*window.innerHeight/Math.round(window.innerWidth)+"%"),t.style.cssText=d,t.className=s+" ready";var f=t.getElementsByClassName("closeBtn");if(f.length){var h=f[0],g=1/a,m="-50%";kInteractive.hasClass(h,"side")&&(m="0%"),h.style.cssText="-webkit-transform: translate("+m+",0%) scale("+g+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+m+",0%) scale("+g+");-moz-transform-origin: 50% 50%;transform: translate("+m+",0%) scale("+g+");transform-origin: 50% 50%;"}}kInteractive.openFrame.resized=l,window.addEventListener("resize",l),setTimeout((function(){l(),e.cb&&e.cb(t)}),100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t&&t.parentNode.removeChild(t),n&&n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1,window.removeEventListener("resize",kInteractive.alert.resized),kInteractive.alert&&(kInteractive.alert.resized=null)},backBtnPressed:function(e){e.oldURL&&e.oldURL.match(/[?&]popup/g)&&(window.removeEventListener("hashchange",kInteractive.backBtnPressed),kInteractive.closeFrame())},getParentInteractiveElem:function(e,t){for(t||(t="kInteractive");e&&e.parentNode;){if(t&&e.classList.contains(t))return e;e=e.parentNode}return e&&e.parentNode&&e.classList.contains(t)?e:null},closeFrame:function(){document.getElementById("kFullscreenGallery")&&kInteractive.gallery.exitFullscreen();var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,o="";n.width&&(o+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(o+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=o,t.className="",setTimeout((function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null}),300),window.removeEventListener("hashchange",kInteractive.closeFrame),window.location.hash=window.location.hash.replace(/[?&]popup/g,"")},stopCurrentMedia:function(){if(kInteractive.currentVideo){var e=kInteractive.currentVideo.getAttribute("id")+"-container";if(n=document.getElementById(e)){var t=n.parentNode;n.parentNode.removeChild(n),(o=document.createElement("div")).setAttribute("id",e),o.className="container",(i=kInteractive.currentVideo.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),t.appendChild(o)}}var n;if(kInteractive.currentAudio)if(e=kInteractive.currentAudio.getAttribute("id")){if(e+="-container",n=document.getElementById(e)){var o,i;t=n.parentNode;n.parentNode.removeChild(n),(o=document.createElement("div")).setAttribute("id",e),o.className="container playerContainer",(i=kInteractive.currentAudio.getElementsByClassName("playBtn")[0])&&(i.className="playBtn ki-btn"),kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),t.appendChild(o)}}else try{var r=kInteractive.currentAudio.getElementsByTagName("audio");r.length&&(r[0].pause(),r[0].src=""),kInteractive.currentAudio.pause&&(kInteractive.currentAudio.pause(),kInteractive.currentAudio.src="");for(var a=document.getElementsByClassName("kiAudioLoader"),s=a.length;s--;)a[s].parentNode.removeChild(a[s])}catch(e){}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),o=0;o<n.length;o++)if(n[o]&&n[o].trim()==t)return!0},appendAfterDelay:function(e,t){setTimeout((function(){e.appendChild(t)}),30)},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,o=n.cloneNode(!1);
/*@cc_on // Pure innerHTML is slightly faster in IE
     oldEl.innerHTML = html;
     return oldEl;
     @*/return o.innerHTML=t,n.parentNode.replaceChild(o,n),o},tinCan:function(e){if(void 0!==isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(e){}},setDOMParser:function(){!function(e){var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var o,i=document.implementation.createHTMLDocument(""),r=i.documentElement;return r.innerHTML=e,o=r.firstElementChild,1===r.childElementCount&&"html"===o.localName.toLowerCase()&&i.replaceChild(o,r),i}return n.apply(this,arguments)}}(DOMParser)},compareVersions:function(e,t){if(e==t)return 0;if(null==e)return 1;if(null==t)return-1;var n=e.split("."),o=t.split(".");return o.length?n.length?Number(n[0])>Number(o[0])?1:Number(o[0])>Number(n[0])?-1:(n.shift(1),o.shift(1),kInteractive.compareVersions(n.join("."),o.join("."))):-1:1},readData:function(e){var t=e.getAttribute("data-kotobee");return t||(t=e.getAttribute("data")),this.readRawData(t)},readRawData:function(e){try{var t=1;if(!e)return;return JSON.parse(decodeURI(kInteractive.XORCipher(t).decode("kotobee%%author",e)))}catch(n){try{return JSON.parse(kInteractive.XORCipher(t).decode("kotobee%%author",e))}catch(e){}}},writeData:function(e,t,n){n||(n=1);var o=encodeURI(JSON.stringify(t)),i=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(i,kInteractive.XORCipher(n).encode("kotobee%%author",o))},XORCipher:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n={encode:function(e,n){return n=function(e,t){return i(t,(function(t,n){return t.charCodeAt(0)^o(e,n)}))}(e,n),function(e){var n,o,i,r,a,s=0,c="";if(!e)return e;do{n=(r=e[s++]<<16|e[s++]<<8|e[s++])>>12&63,o=r>>6&63,i=63&r,c+=t.charAt(r>>18&63)+t.charAt(n)+t.charAt(o)+t.charAt(i)}while(s<e.length);return a=e.length%3,(a?c.slice(0,a-3):c)+"===".slice(a||3)}(n)},decode:function(e,n){return n=function(e){var n,o,i,r,a,s,c=0,l=[];if(!e)return e;e+="";do{n=(s=t.indexOf(e.charAt(c++))<<18|t.indexOf(e.charAt(c++))<<12|(r=t.indexOf(e.charAt(c++)))<<6|(a=t.indexOf(e.charAt(c++))))>>16&255,o=s>>8&255,i=255&s,l.push(n),64!==r&&(l.push(o),64!==a&&l.push(i))}while(c<e.length);return l}(n),function(e,t){return i(t,(function(t,n){return String.fromCharCode(t^o(e,n))})).join("")}(e,n)}};return n;function o(e,t){return e.charCodeAt(Math.floor(t%e.length))}function i(e,t){for(var n=[],o=0;o<e.length;o++)n[o]=t(e[o],o);return n}},getScormId:function(e,t){return e+(t=t?"-"+t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80):"")},confirm:function(e){kInteractive.alert(e)},alert:function(e){if(e){this.closeAlert();var t=document.createElement("div");if(t.setAttribute("id","kiSystemAlertBox"),e.raw&&(t.className="raw"),t.style.position="fixed",void 0===isKotobee&&(t.style.top=Math.round(window.innerHeight/2)+"px",t.style.left=Math.round(window.innerWidth/2)+"px"),e.rtl&&t.setAttribute("direction","rtl"),e.fullHeight&&(t.className+=" fullHeight"),e.class&&(t.className+=" "+e.class),e.raw)t.innerHTML=e.content.replace("&nbsp;","&#160;");else{var n=document.createElement("div");n.innerHTML=e.content.replace("&nbsp;","&#160;"),n.className="content",t.appendChild(n)}if(e.title){var o=document.createElement("div");o.innerHTML=e.title.replace("&nbsp;","&#160;"),o.className="header",t.insertBefore(o,t.firstChild)}kInteractive.alertIsOpen=!0;var i=document.createElement("a");if(!e.raw){var r=document.createElement("div");r.className="footer";var a="OK";try{"undefined"!=typeof translit&&(a=translit.get("ok"))}catch(e){}if(e.okBtn&&(a=e.okBtn),i.innerHTML=a.replace("&nbsp;","&#160;"),i.className="okBtn",i.addEventListener("click",kInteractive.closeAlert),e.cb&&i.addEventListener("click",e.cb),r.appendChild(i),e.noBtn){var s=document.createElement("a");s.innerHTML=e.noBtn,s.className="cancelBtn",s.addEventListener("click",kInteractive.closeAlert),r.appendChild(s)}t.appendChild(r)}var c=document.createElement("div");e.noBackdrop||(c.setAttribute("id","kiSystemAlertBackdrop"),c.addEventListener("click",kInteractive.closeAlert),c.style.position="fixed",document.body.appendChild(c)),document.body.appendChild(t),i.focus(),kInteractive.alert.resized=l,window.addEventListener("resize",l),setTimeout((function(){kInteractive.c.addClass(t,"show"),kInteractive.c.addClass(c,"show")}),50)}function l(){void 0===isKotobee&&(t.style.top=Math.round(window.innerHeight/2)+"px",t.style.left=Math.round(window.innerWidth/2)+"px")}},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)-1==n.indexOf(t[i])&&(o=!1,n+=(""==n?"":" ")+t[i]);if(o)return}else{if(n.indexOf(t)>=0)return;n+=(""==n?"":" ")+t}e.className=n},toggleClass:function(e,t){this.strHasClass(e.className,t)?this.removeClass(e,t):this.addClass(e,t)},hasClass:function(e,t){var n=e.className;return e instanceof SVGElement&&(n=n.baseVal),this.strHasClass(n,t)},strHasClass:function(e,t){e||(e="");for(var n=e.trim().split(" "),o=0;o<n.length;o++)if(n[o]==t)return!0;return!1},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var o=!0,i=0;i<t.length;i++)n.indexOf(t[i])>=0&&(o=!1,n=n.replace(t[i],""));if(o)return}else{if(-1==n.indexOf(t))return;n=(n=n.replace(t,"")).replace(/ {2,}?/g," ")}""==(n=n.trim())?e.removeAttribute("class"):e.className=n},removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},removeFilename:function(e){var t=kInteractive.c.normalizedArray(e);if(-1==t[t.length-1].indexOf("."))return e;t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(n="/"+n),n},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&n>0&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/kotobee:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/chrome-extension:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t},normalize:function(e){var t=kInteractive.c.normalizedArray(e).join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(t="file:///"+t),t},join:function(){for(var e=new Array,t=0;t<arguments.length;t++){var n=kInteractive.c.normalizedArray(arguments[t]);t<arguments.length-1&&!kInteractive.isAbsolutePath(n[n.length-1])&&n[n.length-1].indexOf(".")>=0&&n.splice(n.length-1,1),e=e.concat(n)}var o=kInteractive.c.normalize(e.join("/"));return"/"==arguments[0].substr(0,1)&&(o=desktop?"file:////"+o:"/"+o),o}},shuffleArray:function(e){return e.sort((function(){return Math.random()-.5})),e},allowDrop:function(e){e.preventDefault()},drag:function(e){e.stopPropagation(),e.dataTransfer&&e.dataTransfer.setData("text",e.target.id),dragged=e.target},drop:function(e){e.preventDefault(),e.target.hasAttribute("ondragover")&&e.target.appendChild(e.view.dragged)},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))},getChildIndex:function(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t},isAbsolutePath:function(e){if(e)return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||(!!/.\:[\\\/].*/g.test(e.trim())||void 0))))},isMobile:function(e){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!0;try{if(window.location.href.indexOf("?preview")>0){var t=window.location.href.split("?");t=t[1].split("&");for(var n={},o=0;o<t.length;o++){var i=t[o].split("=");n[i[0]]=i[1]}if(n.mobile)return!0}}catch(e){}}},_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_kInteractiveCommon,"getChildIndex",(function(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t})),"closeFullscreenVideo",(function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen?kInteractive.currentVideo.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)})),"getWidgetHome",(function(e,t){return t||(t={}),e.path?void 0===isKotobee?e.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,e.path):void 0===isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/"})),"isKotobeeUser",(function(){return void 0!==kotobee&&kotobee.user&&kotobee.user.loggedIn})),"getWidgetUrl",(function(e,t){var n=kInteractive.getWidgetHome(e,t)+"/"+e.name+"/"+e.src;if(void 0!==isKotobee){var o=angular.element(document.body).scope().data.user;o&&o.email&&o.signatures&&o.signatures.bookwidgets&&e.id&&0==e.id.indexOf("com.kidimedia")&&(n+="?oauth_signature="+o.signatures.bookwidgets.signature,n+="&oauth_nonce="+o.signatures.bookwidgets.nonce,n+="&oauth_timestamp="+o.signatures.bookwidgets.timestamp,n+="&oauth_consumer_key="+o.signatures.bookwidgets.key,n+="&lti_version=LTI-1p0",n+="&oauth_signature_method=HMAC-SHA1",n+="&oauth_version=1.0",n+="&tool_consumer_info_product_family_code=kotobee",n+="&lis_person_contact_email_primary="+o.email,n+="&lis_person_name_full="+(o.name?o.name:""),n+="&user_id="+o.id,n+="&lti_message_type=basic-lti-launch-request",angular.element(document.body).scope().refreshSignatures&&angular.element(document.body).scope().refreshSignatures())}return n=kInteractive.cleanURL(n)})),"clearAudioVideo",(function(e){var t=e||document;kInteractive.stopCurrentMedia();for(var n=t.getElementsByTagName("audio"),o=n.length;o--;)try{if(n[o].hasAttribute("data-dontclose"))continue;n[o].pause()}catch(e){}var i=t.getElementsByTagName("video");for(o=i.length;o--;)i[o].pause(),i[o].children.length||(i[o].src="")})),"cleanURL",(function(e){try{isNative&&mobile&&(e=(e=window.Ionic.WebView.convertFileSrc(e)).replace(/([^:])\/\//g,"$1/"))}catch(e){}return e})),"listenForSwiping",(function(e){e.addEventListener("touchstart",(function(e){t=e.touches[0].clientX,n=e.touches[0].clientY}),!1),e.addEventListener("touchmove",(function(o){if(null===t)return;if(null===n)return;var i=o.touches[0].clientX,r=o.touches[0].clientY,a=t-i,s=n-r;a>5?(e.dispatchEvent(new Event("swipeleft")),c()):a<-5?(e.dispatchEvent(new Event("swiperight")),c()):s>5?(e.dispatchEvent(new Event("swipeup")),c()):s<-5&&(e.dispatchEvent(new Event("swipedown")),c());function c(){t=null,n=null}o.preventDefault()}),!1);var t=null,n=null})),"unique",(function(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))})),"getFile",(function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200===n.status&&t(n.responseText)},n.send()})),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_kInteractiveCommon,"getBookID",(function(){var e=document.head.querySelector('meta[name="kotobee-book"]');return void 0!==isKotobee&&kotobee.book?kotobee.book.meta.dc.identifier.replace("urn:uuid:","")+(kotobee.user&&kotobee.user.email?kotobee.user.email:""):e?e.content.replace("urn:uuid:",""):""})),"getChapterID",(function(){var e;if(void 0!==isKotobee)e=kotobee.currentChapter?kotobee.currentChapter.url:"/ch1.xhtml";else{var t=document.head.querySelector('meta[name="kotobee-chapter"]');e=t?t.content:""}return e.substring(e.lastIndexOf("/")+1).replace(".xhtml","")})),"setStorage",(function(e){kInteractive.storage=e||sessionStorage})),"getLocalData",(function(e,t){var n=e.label||e.category;if(e)if(t)if(n){var o=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";o=(o=JSON.parse(o)).filter((function(t){return e.label?e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label:e.subcategory?t.category==e.category&&t.subcategory==e.subcategory:t.category==e.category})),t(o)}else t({error:"invalid label or category!"});else;else;})),"getLocalDataArray",(function(e,t){if(Array.isArray(e))if(t){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";n=JSON.parse(n);var o=[];e.forEach((function(e){(e.label||e.category)&&o.push({results:n.filter((function(t){return e.label?e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label:e.subcategory?t.category==e.category&&t.subcategory==e.subcategory:t.category==e.category}))})})),t(o.length?o:n)}else;else t([{error:"invalid array!"}])})),"setLocalData",(function(e,t){if(e)if(t)if(e.label)if(e.data){var n={label:e.label,data:e.data,date:(new Date).toUTCString()};e.category&&(n.category=e.category),e.subcategory&&(n.subcategory=e.subcategory);var o=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";if(o=JSON.parse(o),e.overwrite){var i=o.findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=i?o.splice(i,1,n):o.push(n)}else o.push(n);kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(o)),t({success:"added"})}else t({error:"invalid data!"});else t({error:"invalid label!"});else;else;})),"setLocalDataArray",(function(e,t){if(Array.isArray(e))if(t){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";n=JSON.parse(n);var o={};e.forEach((function(e){if(e.label){if(!o.hasOwnProperty("error")){var t={label:e.label,data:e.data,date:(new Date).toUTCString()};if(e.category&&(t.category=e.category),e.subcategory&&(t.subcategory=e.subcategory),e.overwrite){var i=n.findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=i?n.splice(i,1,t):n.push(t)}else n.push(t)}}else o.error="invalid label!"})),o.hasOwnProperty("error")||(o.success="added"),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),t(o)}else;else t([{error:"invalid array!"}])})),"deleteLocalData",(function(e,t){if(e)if(t)if(e.label){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",o=(n=JSON.parse(n)).findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=o&&n.splice(o,1),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),t({success:!0})}else t({error:"invalid label!"});else;else;})),"deleteLocalDataArray",(function(e,t){if(Array.isArray(e))if(t){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";n=JSON.parse(n);var o={};e.forEach((function(e){if(e.label){if(!o.hasOwnProperty("error")){var t=n.findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=t&&n.splice(t,1)}}else o.error="invalid label!"})),o.hasOwnProperty("error")||(o.success=!0),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),t(o)}else;else t([{error:"invalid array!"}])})),"clearLocalData",(function(){kInteractive.storage?kInteractive.storage.removeItem("ebook-"+kInteractive.getBookID()):kInteractive.error("unable to find storage!")})),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_kInteractiveCommon,"isEditorMode",(function(){return"undefined"!=typeof editorMode&&editorMode})),"isPreview",(function(){return/\/Kotobee\s?Author\//.test(location.pathname)})),"isSDK",(function(){if(void 0!==isKotobee)return!isRelease;var e=-1!=location.host.indexOf("localhost")&&-1!=["http:","https:"].indexOf(location.protocol);return e||(e=-1!=location.href.indexOf("reader/www/epub/EPUB")),e})),"getBoundingBox",(function(e){if(3==e.nodeType){var t=document.createRange();t.selectNode(e);var n=t.getBoundingClientRect();return t.detach(),n}return e.getBoundingClientRect()})),"simpleHash",(function(e){var t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n})),"phpDateToJS",(function(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])})),"getClock",(function(e){if(kInteractive.clocks||(kInteractive.clocks=[],setInterval((function(){for(var e=0;e<kInteractive.clocks.length;e++){var t=kInteractive.clocks[e];t.paused||(t.time++,t.cb&&t.cb(t.time))}}),1e3)),kInteractive.clocks[e])return kInteractive.clocks[e];var t={id:e,time:0,pause:function(){this.paused=!0},resume:function(){this.paused=!1},destroy:function(){for(var e=0;e<kInteractive.clocks.length;e++)if(kInteractive.clocks[e]==this)return kInteractive.clocks.splice(e,1)}};return kInteractive.clocks.push(t),t})),"observe",(function(e,t,n){kInteractive.observers||(kInteractive.observers=[]);var o=new IntersectionObserver((function(e){for(var o=0;o<e.length;o++)0==e[o].intersectionRatio?(n&&n(),e[o].hidden&&e[o].hidden()):(t&&t(),e[o].shown&&e[o].shown())}),{threshold:[0,1],rootMargin:"0px"});kInteractive.observers.push(o),o.observe(e)})),"getTimezone",(function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return"GMT"}})));for(var item in kInteractiveCommon)kInteractive[item]=kInteractiveCommon[item];function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function kPersister(e){this.enabled=!0,this.delegateEvents=!0,this.storage="cloud",this.root=document.body,this.interval=200,this.maxDataSize=0,this.book="",this.chapter="",this.data=[],this.text=[],this.number=[],this.radio=[],this.checkbox=[],this.textarea=[],this.dragdrop=[],this.callback=null,this.silentMode=!1,this.appendDataMode=!1,this.forceNotification=!1,this.saveGlobal=!1,this.isSaveGlobal=!1,this.listener=null,this.testMode=!1,this.enableUncheckRadio=!1,this.setRadioGroup=!0,this.messages={save:"Save",unsaved:"You have unsaved changes",saving:"Saving your responses ..",saved:"Changes has been saved!",dismiss:"Dismiss",lastSaved:"Last saved on",longDataError:"Some answers not saved (marked in red)"},this.design={placement:"bottom-right",unsaved:{color:"#fff",background:"#de7a7a"},success:{color:"#fff",background:"#14c39a"}},this.enable=function(e){this.enabled=!0,this.silentMode=e,this.renderInlineBar(),this.renderFloatingBar()},this.disable=function(){this.enabled=!1,n(".unsaved-changes-"+t.root.id)&&n(".unsaved-changes-"+t.root.id).classList.remove("show")},this.setOptions=function(e){var t=this;for(var n in e)"messages"==n?t.setMessages(e.messages):"design"==n?t.setDesign(e.design):t.hasOwnProperty(n)&&(t[n]=e[n],"root"==n&&(t[n].id=e[n].id||"_"+Math.random().toString(36).substr(2,9)))},this.setDesign=function(e){for(var t in e)this.design.hasOwnProperty(t)?(-1!=["placement"].indexOf(t)||e[t].color||e[t].background)&&(this.design[t]=e[t]):o("error",["invalid design state:",t])},this.setMessages=function(e){var t=this;for(var i in e)if(t.messages.hasOwnProperty(i)){if(t.messages[i]=e[i],n(".unsaved-changes-"+t.root.id)&&!kInteractive.isEditorMode()&&n(".unsaved-changes-"+t.root.id+" ."+i))if("button"==n(".unsaved-changes-"+t.root.id+" ."+i).nodeName.toLowerCase())try{n(".unsaved-changes-"+t.root.id+" ."+i).innerText=e[i]}catch(e){}else try{n(".unsaved-changes-"+t.root.id+" ."+i+" span").innerText=e[i]}catch(e){}}else o("error",["invalid message key:",i])},this.waitFor=function(e,t,n){var i=this;n=n||0,window[e]||0==e.indexOf("#")&&"undefined"!=typeof document&&document.querySelector(e)||0==e.indexOf(".")&&"undefined"!=typeof document&&document.querySelector(e)||"document.body"==e&&"undefined"!=typeof document&&document.body?t():n<3e3?setTimeout((function(){i.waitFor(e,t,n+100)}),100):(o("error",["unable to find:",e]),t&&t())},this.renderInlineBar=function(){var e=this;if(n(".persist-log-"+e.root.id)&&n(".persist-log-"+e.root.id).parentNode.removeChild(n(".persist-log-"+e.root.id)),e.silentMode&&!kInteractive.isEditorMode()){var t=e.getRootSelector();if(n(t)){var i=n(t);i.length&&(i=i[0]),i.insertAdjacentHTML("beforeend",'<div class="persist-log persist-log-'+e.root.id+'"><span class="saving" style="display:none;color:'+e.design.unsaved.background+'">'+e.messages.saving+'</span><span class="success" style="display:none;color:'+e.design.success.background+'">'+e.messages.lastSaved.trim()+" "+(new Date).toLocaleDateString()+'</span><span class="error" style="display:none"></span></div>')}else o("warn",["unable to find root selector:",t])}},this.renderFloatingBar=function(){var e=this;if(n(".unsaved-changes-"+e.root.id)&&n(".unsaved-changes-"+e.root.id).parentNode.removeChild(n(".unsaved-changes-"+e.root.id)),!e.silentMode&&!kInteractive.isEditorMode()){var t="",i="",r="",a=e.design.placement.split("-");if(a.length&&(r+=a[0]+":70px;"),a.length>1)switch(r+=a[1]+":0px;",a[1]){case"left":t="-",i="";break;case"right":t="",i="-";break;default:o("error",["invalid horizontal placement:",a[1]])}var s="#fff",c="#333";if(void 0!==kotobee){var l=document.querySelectorAll("#kotobee .tabs");l.length&&(s=getComputedStyle(l[0]).backgroundColor,c=getComputedStyle(l[0]).color)}var d='<style id="'+e.root.id+'-persister-styles">.unsaved-changes-'+e.root.id+"{"+r+";display:none;transform:translateX("+t+"100%);background:"+s+";color:"+c+"}.unsaved-changes-"+e.root.id+".show{display:block;transform: translateX("+i+"20px)}.unsaved-changes-"+e.root.id+" button{background-color:"+e.design.unsaved.background+";color:"+e.design.unsaved.color+"}.unsaved-changes-"+e.root.id+".success button{background-color:"+e.design.success.background+";color:"+e.design.success.color+"</style>";document.head.querySelector("#"+e.root.id+"-persister-styles")||document.head.insertAdjacentHTML("beforeend",d);var u=n(".perspectiveContainer")?n(".perspectiveContainer"):document.body;if(u){var p='<div class="unsaved-changes unsaved-changes-'+e.root.id+'"><div class="unsaved"><span>'+e.messages.unsaved+'</span> <button class="dismiss">'+e.messages.dismiss+'</button> <button class="save-now">'+e.messages.save+'</button></div><div class="saving" style="display:none;"><svg width="20px" height="20px" style="background:none;float:left;margin-top:5px;margin-right:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-rolling"><circle cx="50" cy="50" fill="none" stroke="#ffffff" stroke-width="10" r="35" stroke-dasharray="164.93361431346415 56.97787143782138" transform="rotate(149.879 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></circle></svg><span>'+e.messages.saving+'</span></div><div class="saved" style="display:none;"><span>'+e.messages.saved+'</span> <button class="dismiss">'+e.messages.dismiss+'</button></div><div class="notsaved" style="display:none;"><span></span> <button class="dismiss">'+e.messages.dismiss+"</button></div></div>";try{u.insertAdjacentHTML("afterbegin",p),e.waitFor(".unsaved-changes-"+e.root.id,(function(){n(".unsaved-changes-"+e.root.id+" .dismiss",!0)?n(".unsaved-changes-"+e.root.id+" .dismiss",!0).forEach((function(e){e.addEventListener("click",(function(e){n(e.currentTarget).parents(".unsaved-changes").classList.remove("show")}))})):o("error",["unable to find dismiss button!"]),n(".unsaved-changes-"+e.root.id+" .save-now")?n(".unsaved-changes-"+e.root.id+" .save-now").addEventListener("click",(function(){e.save()})):o("error",["unable to find save button!"])}))}catch(e){o("error",[e,p])}}else o("error",["unable to find suitable container!"])}},this.getRootSelector=function(){return t.root.id?"#"+t.root.id:"."+t.root.className.splice(" ").join(".")},this.setNotify=function(e){var t=this;t.enabled&&n(".unsaved-changes-"+t.root.id)&&!kInteractive.isEditorMode()&&(e&&e.constructor===Object&&Object.keys(e).length>0&&t.setOptions(e),n(".unsaved-changes-"+t.root.id).classList.contains("show")&&!n(".unsaved-changes-"+t.root.id).classList.contains("success")||t.updateNotification("reset"))},this.save=function(e){var t=this;if(t.enabled){t.collectInputs(),t.updateNotification("saving");var n=[];t.text&&t.text.forEach((function(e){e.id&&n.push(e)})),t.number&&t.number.forEach((function(e){e.id&&n.push(e)})),t.radio&&t.radio.forEach((function(e){e.id&&n.push(e)})),t.checkbox&&t.checkbox.forEach((function(e){e.id&&n.push(e)})),t.textarea&&t.textarea.forEach((function(e){e.id&&n.push(e)})),t.dragdrop&&t.dragdrop.forEach((function(e){e.dataset.category=Array.prototype.slice.apply(e.parentNode.classList).find((function(e){return-1!=e.indexOf("ki-dd-category")}))||"",e.id&&n.push(e)}));var o=n.map((function(e){var t;return t=-1!=["radio","checkbox"].indexOf(e.type)?e.checked:"div"==e.nodeName.toLowerCase()?e.dataset.category||"":e.value,{id:e.id,type:e.type||e.nodeName.toLowerCase(),value:t}}));if(this.appendDataMode)for(var i=0;i<t.data.length;i++){var r=t.data[i],a=o.find((function(e){return e.id==r.id}));a?Object.assign(r,a):o.push(r)}t.setLocalData(o,(function(){"cloud"==t.storage&&kInteractive.isKotobeeUser()&&void 0!==isKotobee?t.push(e):(t.updateNotification("success"),e&&e())}))}},this.setLocalData=function(e,t){var n=this,o={label:kInteractive.getChapterID()+"-"+n.root.id,data:JSON.stringify(e),overwrite:!0};kInteractive.setLocalData(o,(function(e){window.unsaved="cloud"==n.storage,"cloud"!=n.storage&&n.updateNotification("success");var o={target:n};e.error?o.error=e.error:o.result=e,n.listener.emit("persister.saved",o),"function"==typeof t&&t()}))},this.getLocalData=function(){var e=this;return new Promise((function(t){if("cloud"==e.storage&&void 0!==isKotobee&&kInteractive.isKotobeeUser())try{kotobee.getData({label:kInteractive.getChapterID()+"-"+e.root.id},(function(n){n.length?(e.merge(n),o()):(e.data=[],t())}))}catch(n){e.listener.emit("persister.error",n.toString()),t()}else kInteractive.getLocalDataArray([{}],(function(t){t.length?kInteractive.setLocalDataArray(e.cleanupData(t).map((function(e){return Object.assign(e,{overwrite:!0})})),o):o()}));function o(){kInteractive.getLocalData({label:kInteractive.getChapterID()+"-"+e.root.id},(function(o){if(Array.isArray(o)){if(o.length)try{e.data=JSON.parse(o[0].data)}catch(t){e.data=[],n("body.cke_editable")||e.listener.emit("persister.error",{target:e,error:'invalid or empty slot for "'+kInteractive.getChapterID()+"-"+e.root.id+'": '+JSON.stringify(o)})}else e.data=[];t()}else n("body.cke_editable")||e.listener.emit("persister.error",{target:e,error:'invalid or empty slot for "'+kInteractive.getChapterID()+"-"+e.root.id+'": '+JSON.stringify(o)})}))}}))},this.cleanupData=function(e){if(!Array.isArray(e))return o("error",["invalid data:",e]),[];var t=e.slice(0).sort((function(e,t){return e.date>t.date?-1:e.date<t.date?1:0})).filter((function(e,t,n){return n.findIndex((function(t){return t.label==e.label}))==t}));return t},this.clear=function(e){var t=this;function n(n){o("warn",[n]),window.unsaved=!1;var i={target:t};n.error?i.error=n.error:i.result=n,t.listener.emit("persister.unsaved",i),"function"==typeof e&&e()}kInteractive.deleteLocalData({label:kInteractive.getChapterID()+"-"+t.root.id},(function(e){e.success&&("cloud"==t.storage&&kInteractive.isKotobeeUser()?kotobee.deleteData({label:kInteractive.getChapterID()+"-"+t.root.id},(function(e){e.success&&n(e)})):n(e))}))},this.merge=function(e){var t=this;if(e.length>1){var n=e.sort((function(e,t){return e.date>t.date?-1:e.date<t.date?1:0}));o("warn",["duplicate slots:",n]);var i=n[0];o("warn",["deleting all slots matching",i.label]),kotobee.deleteData({label:i.label,all:!0},(function(e){o("warn",[e]),o("warn",["insert only last slot for",i.label]),kotobee.setData(i,(function(e){o("warn",[e])}))}))}var r=t.storageAPI.getItem("ebook-"+kInteractive.getBookID())||"[]",a=(r=JSON.parse(r)).findIndex((function(e){return e.label==kInteractive.getChapterID()+"-"+t.root.id}));-1!=a&&r.splice(a,1),r=r.concat(e),r=t.cleanupData(r),t.storageAPI.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(r))},this.push=function(e){var t=this;if(t.enabled){var i=t.storageAPI.getItem("ebook-"+kInteractive.getBookID())||"[]";if(i=(i=JSON.parse(i)).map((function(e){var t=JSON.parse(JSON.stringify(e));return t.overwrite=!0,delete t.date,t})),"cloud"==t.storage&&kInteractive.isKotobeeUser())try{var r=t.cleanupData(i),a=r;a.forEach((function(e){JSON.parse(e.data).forEach((function(e){var t=n("#"+e.id);t&&t.classList.remove("inputError")}))}));r.filter((function(e){return e.data.length>t.maxDataSize}));var s=[];0,kotobee.setDataArray(a,(function(n){o("warn",[n]),c(e,n.error||(s.length?t.messages.longDataError:null))}))}catch(t){c(e,t.toString())}else c(e)}function c(e,n){window.unsaved=!1,n?(t.updateNotification("error",n),t.listener.emit("persister.error",{target:t,error:n})):(t.updateNotification("success"),t.listener.emit("persister.pushed",{target:t,result:{success:"pushed"}}),t.isSaveGlobal?("function"==typeof t.saveGlobal?t.saveGlobal():"object"==_typeof(t.saveGlobal)&&t.saveGlobal.hasOwnProperty("callback")&&t.saveGlobal.callback(),t.isSaveGlobal=!1):"function"==typeof e&&e())}},this.updateNotification=function(e,t){var o=this;try{if(o.enabled&&!kInteractive.isEditorMode())if(n(".persist-log-"+o.root.id)&&o.silentMode)switch(e){case"saving":n(".persist-log-"+o.root.id+" span.saving").style.display="block",n(".persist-log-"+o.root.id+" span.success").style.display="none",n(".persist-log-"+o.root.id+" span.error").style.display="none";break;case"success":n(".persist-log-"+o.root.id+" span.saving").style.display="none",n(".persist-log-"+o.root.id+" span.success").style.display="block",n(".persist-log-"+o.root.id+" span.error").style.display="none";break;case"error":n(".persist-log-"+o.root.id+" span.saving").style.display="none",n(".persist-log-"+o.root.id+" span.success").style.display="none",n(".persist-log-"+o.root.id+" span.error").style.display="block",n(".persist-log-"+o.root.id+" span.error").textContent=t||"Unexpected error!"}else if(n(".unsaved-changes-"+o.root.id))switch(e){case"saving":n(".unsaved-changes-"+o.root.id+" .saved").style.display="none",n(".unsaved-changes-"+o.root.id+" .saving").style.display="block",n(".unsaved-changes-"+o.root.id+" .unsaved").style.display="none",n(".unsaved-changes-"+o.root.id+" .notsaved").style.display="none",n(".unsaved-changes-"+o.root.id).classList.contains("success")&&n(".unsaved-changes-"+o.root.id).classList.remove("success"),o.silentMode||n(".unsaved-changes-"+o.root.id).classList.contains("show")||n(".unsaved-changes-"+o.root.id).classList.add("show");break;case"success":n(".unsaved-changes-"+o.root.id+" .saving").style.display="none",o.silentMode||o.isSaveGlobal?n(".unsaved-changes-"+o.root.id).classList.remove("show"):(n(".unsaved-changes-"+o.root.id).classList.add("success"),n(".unsaved-changes-"+o.root.id+" .saved").style.display="block");break;case"error":n(".unsaved-changes-"+o.root.id+" .saving").style.display="none",o.silentMode||o.isSaveGlobal?n(".unsaved-changes-"+o.root.id).classList.remove("show"):(n(".unsaved-changes-"+o.root.id).classList.add("error"),n(".unsaved-changes-"+o.root.id+" .notsaved span").textContent=t||"Unexpected error!",n(".unsaved-changes-"+o.root.id+" .notsaved").style.display="block");break;case"reset":n(".unsaved-changes-"+o.root.id+" .saved").style.display="none",n(".unsaved-changes-"+o.root.id+" .saving").style.display="none",n(".unsaved-changes-"+o.root.id+" .unsaved").style.display=o.silentMode?"none":"block",n(".unsaved-changes-"+o.root.id+" .notsaved").style.display="none",n(".unsaved-changes-"+o.root.id).classList.contains("success")&&n(".unsaved-changes-"+o.root.id).classList.remove("success"),o.silentMode||n(".unsaved-changes-"+o.root.id).classList.contains("show")||n(".unsaved-changes-"+o.root.id).classList.add("show")}}catch(e){}},this.collectInputs=function(){var e=this,t=this.getRootSelector();e.root=n(t),e.root?(e.text=n(e.root).find('input[type="text"]',!0),e.number=n(e.root).find('input[type="number"]',!0),e.radio=n(e.root).find('input[type="radio"]',!0),e.checkbox=n(e.root).find('input[type="checkbox"]:not([name="preserveAnswers"])',!0),e.textarea=n(e.root).find("textarea",!0),e.dragdrop=n(e.root).find(".ki-draggable",!0)):o("error",["unable to re-select root element by:",t])},this.handleChange=function(){var e=this;e.enabled&&(e.silentMode?e.save():e.saveGlobal&&!e.forceNotification||e.setNotify())},this.processInputs=function(){var e=this;function t(){o("warn",["persister change handler:",this.id,-1!=["radio","checkbox"].indexOf(this.type)?this.checked:this.value]),e.handleChange()}function n(n,o){document.body.addEventListener(n,(function(n){var i,r,a,s;n.target.id==o.id&&(-1!=["radio","checkbox"].indexOf(o.type)?o.checked=n.target.checked:o.value=n.target.value,(i=t.bind(o),r=(r=e.interval)||20,a=a||!0,function(){var e=this,t=arguments,n=a&&!s,o=function(){s=null,a||i.apply(e,t)};clearTimeout(s),s=setTimeout(o,r),n&&i.apply(e,t)})())}))}e.collectInputs();var i=0;if(e.text&&e.text.forEach((function(e){e.id||(e.id=(e.name?e.name:"tx")+"-"+i),i++,e.id&&!e.dataset.freeze&&(n("keyup",e),n("change",e))})),e.number&&e.number.forEach((function(e){e.id||(e.id=(e.name?e.name:"num")+"-"+i),i++,e.id&&!e.dataset.freeze&&(n("keyup",e),n("change",e))})),e.radio&&e.radio.forEach((function(o){o.id||(o.id=(o.name?o.name:"rb")+"-"+i),i++,o.id&&!o.dataset.freeze&&(e.enabledUncheckRadio?document.body.addEventListener("click",(function(e){if(e.target.id==o.id){var n=e.target.dataset.state||"";Boolean(n.toString())?(e.target.checked=!1,e.target.dataset.state=""):e.target.dataset.state=e.target.checked,t.call(o)}})):n("change",o))})),e.checkbox&&e.checkbox.forEach((function(e){e.id||(e.id=(e.name?e.name:"cb")+"-"+i),i++,e.id&&!e.dataset.freeze&&n("change",e)})),e.textarea&&e.textarea.forEach((function(e){e.id||(e.id=(e.name?e.name:"ta")+"-"+i),i++,e.id&&!e.dataset.freeze&&(n("keyup",e),n("change",e))})),e.setRadioGroup)try{e.radio&&e.radio.forEach((function(e){e.name=e.id?e.id.match(/(.*?)(\d+)/)[0].replace("-0-",""):e.name}))}catch(e){}},this.restore=function(e){var t=this;setTimeout((function(){t.getLocalData().then((function(){t.data.length&&t.data.forEach((function(e){var i=e.id;if(i)if(isNaN(i)){var r=n("#"+i);if(r)switch(e.type){case"text":case"number":case"textarea":r.value=e.value||"";break;case"radio":case"checkbox":r.checked=e.value;break;case"div":if(e.value){var a=r.cloneNode(!0);a.dataset.category=e.value;var s=t.getQContainer(r);if(s){var c=s.getElementsByClassName(e.value)[0];c&&(c.appendChild(a),r.parentNode.removeChild(r))}}break;default:o("warn",["invalid input type:",e.type])}else o("error",["unable to find input by id:",i])}else o("error",["invalid input selector:",i]);else o("error",["invalid input selector:",i])})),t.renderInlineBar(),"function"==typeof e?e():(window.unsaved=!1,t.listener.emit("persister.restored",{target:t}))}))}),0)},this.getQContainer=function(e){for(;!e.classList.contains("ques");)e=e.parentNode;return e},this.renderSaveTab=function(e){var t=this;if(e)e.addEventListener("click",(function(e){e.preventDefault(),t.isSaveGlobal=!0,t.push()}));else if(!n("#save-changes")){var o=n("#tabMenu");if(o){var i=o.querySelectorAll("a:not(.chapterBtn)");if(i.length){var r=(i=i[0]).parentNode,a=i.cloneNode(!0);a.id="save-changes",a.querySelector(".icon").className="icon ion-"+(t.saveGlobal.icon||"checkmark-circled"),a.querySelector(".tab-title").innerText=t.saveGlobal.label||t.messages.save,r.insertAdjacentHTML("beforeend",a.outerHTML)}n("#save-changes").addEventListener("click",(function(e){e.preventDefault(),t.isSaveGlobal=!0,t.push()}))}}},this.init=function(){var e=this;function t(){e.delegateEvents&&e.processInputs(),e.enabled&&(e.renderInlineBar(),e.renderFloatingBar()),window.addEventListener("beforeunload",(function(t){void 0!==kotobee&&(-1!=!location.hostname.indexOf("localhost")&&-1!=!location.hostname.indexOf("127.0.0.1")||"undefined"!=typeof config&&!config.kotobee.public||e.testMode)&&window.unsaved&&(e.setNotify(),t.preventDefault(),t.returnValue="",delete t.returnValue)}))}kInteractive.isEditorMode()||("cloud"==e.storage&&kInteractive.isKotobeeUser()?kotobee.getDataPerms((function(n){n&&n.maxDataSize&&(e.maxDataSize=n.maxDataSize,o("warn",["data size limit:",e.maxDataSize]),t())})):t()),window.unsaved=!1,e.listener.emit("persister.ready",{target:e})},this.listener=new function(){this.listeners={},this.on=function(e,t){return this.addListener(e,t)},this.once=function(e,t){this.listeners[e]=this.listeners[e]||[];var n=function(){t(),this.off(e,n)};return this.listeners[e].push(n),this},this.off=function(e,t){return this.removeListener(e,t)},this.die=function(e){return this.removeAllListeners(e)},this.addListener=function(e,t){return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t),this},this.removeListener=function(e,t){var n=this.listeners[e]||[];return this.listeners[e]=n.filter((function(e){return e!==t})),this},this.removeAllListeners=function(e){return delete this.listeners[e],this},this.emit=function(){if(arguments.length<1)return!1;var e=arguments[0],t=this.listeners[e];if(!t)return!1;var n=arguments.length>1?Array.prototype.slice.call(arguments).slice(1):[];return t.forEach((function(e){e.apply(this,n)})),!0},this.listListeners=function(e){return this.listeners[e]||[]}};var t=this;function n(){if(arguments.length<1)return null;var e=arguments[0],t=null;if("string"==typeof e){var o=!1,i=document;if(arguments.length>1)for(var r,a=Array.prototype.slice.call(arguments).slice(1),s=0;s<a.length;s++)"boolean"==typeof(r=a[s])?o=r:"object"==_typeof(r)&&(i=r);if(0==(t=Array.prototype.slice.call(i.querySelectorAll(e))).length)return null;t=o||1!=t.length?t:t[0]}else t=e;return Array.isArray(t)||(t.find=function(e,o){return n(e,t,o)},t.parents=function e(n){var o=null,i=-1!=n.indexOf(".")?n.split(".")[1]:"";t.parentNode.nodeName.toLowerCase()==n.toLowerCase()||""!=i&&t.parentNode.classList.contains(i)||t.parentNode.id==n.replace("#","")?o=t.parentNode:"body"==t.parentNode.nodeName.toLowerCase()||o||(t=t.parentNode,o=e(n));return o},t.closest=function(e){return function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}(t,e)},t.ascendants=function(e){return function(e){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});for(var t=[];e&&e!==document;e=e.parentNode)t.push(e);return t}(t)}),t}function o(e,t){"dev"==(window.debug||-1!=location.hostname.indexOf(".local")||-1!=location.hostname.indexOf("kotobee.com")||-1!=location.hostname.indexOf("localhost")||-1!=location.hostname.indexOf("localhost")||-1!=location.hostname.indexOf("192.168.")?"dev":"production")&&console[e].apply(null,t)}(function(e){return Object.getOwnPropertyNames(e).filter((function(t){return"function"==typeof e[t]}))})(this.listener).forEach((function(e){t[e]||(t[e]=t.listener[e].bind(t.listener))})),e&&this.setOptions(e),this.storageAPI=-1!=["session","cloud"].indexOf(this.storage)?sessionStorage:localStorage,kInteractive.setStorage(this.storageAPI)}function setConfigDefaults(){null==config.mediaTab&&(config.mediaTab=!0),null==config.settingsTab&&(config.settingsTab=!0),null==config.notebookTab&&(config.notebookTab=!0),null==config.textSizeControls&&(config.textSizeControls=!0),null==config.chaptersTab&&(config.chaptersTab=!0),null==config.showCategories&&(config.showCategories=!0),null==config.showFavorites&&(config.showFavorites=!0),null==config.styleControls&&(config.styleControls=!1),null==config.imagesInMediaTab&&(config.imagesInMediaTab=!0),null==config.copyBookURLBtn&&(config.copyBookURLBtn=!0),config.gotoPageOffset&&(config.gotoPageOffset=Number(config.gotoPageOffset)),null==config.mediaModalTitle&&(config.mediaModalTitle=!0)}if(kInteractive.setStorage(),kInteractive.container={preRender:function(e,t){var n=kInteractive.readData(e);if(n&&n.path){var o=e.getAttribute("style"),i=kInteractive.cleanURL(n.path);e.setAttribute("style",o+' background-image:url("'+i+'");')}},postRender:function(e,t,n){kInteractive.readData(t)},action:function(e){},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.equation={preRender:function(e,t){if(!kInteractive.isEditorMode()&&"undefined"==typeof MathJax){MathJax={loader:{load:["input/asciimath","input/mml","input/tex","output/chtml","ui/menu"]}};var n=document.createElement("script"),o="";o=void 0===isKotobee?"../../js/lib/mathjax/startup.js":kInteractive.c.join(bookPath,"EPUB/js/lib/mathjax/startup.js"),n.src=kInteractive.cleanURL(o),n.setAttribute("type","text/javascript"),document.head.appendChild(n)}},postRender:function postRender(root,item,index){var frag=root.createDocumentFragment(),eData=kInteractive.readData(item);if(eData){item.setAttribute("id","ki-equation-"+index),item.innerHTML="";var content=eData.content;if(!eData.img||"image"!=eData.rendermode&&supportsEs6())"mathml"==eData.type?content="<math>"+content+"</math>":"asciimath"==eData.type?content="`"+content+"`":"tex"==eData.type&&(content="\\("+content+"\\)");else{var img=document.createElement("img"),path=void 0===isKotobee?eData.img:ph.join(kInteractive.absoluteURL,eData.img);path=kInteractive.cleanURL(path),img.className="equationImg",img.src=path,eData.imgHeight?img.style.maxHeight=eData.imgHeight+"px":eData.imgWidth&&(img.style.maxWidth=eData.maxWidth+"px"),content=img.outerHTML}var tagName="inline"==eData.placement?"span":"div",container=document.createElement(tagName);container.setAttribute("id","ki-equation-"+index+"-container"),container.className="parsed container";try{container.innerHTML=content}catch(e){container.textContent=content}var styleContainer=document.createElement(tagName);eData.style&&kInteractive.c.addClass(styleContainer,eData.style),frag.appendChild(container),styleContainer.appendChild(frag),item.appendChild(styleContainer),kInteractive.isEditorMode()||MathJax&&MathJax.typeset&&MathJax.typeset()}function supportsEs6(){try{return eval('"use strict"; class foo {}'),!0}catch(e){}}},action:function(e){kInteractive.readData(e)},resize:function(e){kInteractive.readData(e)}},kInteractive.gallery={preRender:function(e,t){var n=t.createDocumentFragment(),o=kInteractive.readData(e);if(o){e.innerHTML="";var i=e.getAttribute("data-index");i||(i=0),o.rtl&&kInteractive.c.addClass(e,"dirRtl");var r=document.createElement("div");r.className="imgMask";var a=document.createElement("div");a.className="images "+o.scale;var s=o.rtl?"right":"left";a.style[s]="0",r.appendChild(a);for(var c=0;c<o.imgs.length;c++){var l,d=document.createElement("div");d.className="imgContainer ki-btn",l="url"==o.imgs[c].type?o.imgs[c].url:void 0===isKotobee?o.imgs[c].path:ph.join(kInteractive.absoluteURL,o.imgs[c].path),l=kInteractive.cleanURL(l),d.setAttribute("style","background-color:"+o.bgColor+";background-image:url('"+l+"')"),o.imgs[c].caption&&d.setAttribute("data-caption",o.imgs[c].caption),void 0!==isKotobee||kInteractive.c.hasClass(e,"fullscreen")||d.addEventListener("click",kInteractive.actionEvent),a.appendChild(d)}var u=document.createElement("div");u.className="navBtns";var p=document.createElement("a");p.className="next btn ki-btn",u.appendChild(p);var f=document.createElement("a");if(f.className="prev btn ki-btn",u.appendChild(f),n.appendChild(u),o.zoomBtns){var h=document.createElement("div");h.className="zoomBtns";var g=document.createElement("a");g.className="zoomIn btn ki-btn",g.textContent="+",g.innerHTML='<svg width="15" height="15" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="square" stroke-linejoin="square"><line x1="10" y1="4" x2="10" y2="16"/><line x1="4" y1="10" x2="16" y2="10"/></svg>',h.appendChild(g);var m=document.createElement("a");m.className="zoomFit btn ki-btn",m.innerHTML='<svg width="15" height="15" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="16" height="16" stroke="currentColor" fill="none"/><line x1="5" y1="5" x2="2" y2="2"/><line x1="5" y1="2" x2="2" y2="5"/><line x1="15" y1="5" x2="18" y2="2"/><line x1="15" y1="2" x2="18" y2="5"/><line x1="5" y1="15" x2="2" y2="18"/><line x1="5" y1="18" x2="2" y2="15"/><line x1="15" y1="15" x2="18" y2="18"/><line x1="15" y1="18" x2="18" y2="15"/></svg>',h.appendChild(m);var v=document.createElement("a");v.className="zoomOut btn ki-btn",v.innerHTML='<svg width="15" height="15" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="square" stroke-linejoin="square"><line x1="6" y1="10" x2="14" y2="10"/></svg>',h.appendChild(v),n.appendChild(h)}(void 0===isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&(p.addEventListener("click",kInteractive.actionEvent),f.addEventListener("click",kInteractive.actionEvent),o.zoomBtns&&(g.addEventListener("click",kInteractive.actionEvent),m.addEventListener("click",kInteractive.actionEvent),v.addEventListener("click",kInteractive.actionEvent))),n.appendChild(r);var b=document.createElement("div");b.className="kFooter",o.footerShadow&&(b.className+=" shadow"),n.appendChild(b);var k=document.createElement("div");k.className="imgCaption";var y=document.createElement("div");if(y.className="inner",y.style.display="none",o.imgs[0]&&o.imgs[0].caption&&(y.innerHTML=o.imgs[0].caption,y.style.display=null),k.appendChild(y),b.appendChild(k),o.thumbnails){var w=document.createElement("div");w.className="kThumbs",o.thumbShowOnHover&&(w.className+=" showOnHover"),"small"==o.thumbSize?kInteractive.c.addClass(w,"small"):"large"==o.thumbSize?kInteractive.c.addClass(w,"large"):kInteractive.c.addClass(w,"medium"),b.appendChild(w)}if(kInteractive.c.hasClass(e,"fullscreen")){var C=document.createElement("div");C.className="fullscreenControls",C.innerHTML="<a class='closeBtn ki-btn'></a>",e.appendChild(C),C.children[0].addEventListener("click",kInteractive.actionEvent),document.addEventListener("keydown",kInteractive.gallery.detectKey)}var x=document.createElement("div");o.style&&kInteractive.c.addClass(x,o.style),x.appendChild(n),e.appendChild(x),kInteractive.gallery.dimBtns(e),kInteractive.gallery.resize(e),this.showImage(e,{index:i,dontGoFullscreen:!0}),setTimeout((function(){kInteractive.gallery.showImage(e,{index:i,dontGoFullscreen:!0})}),80)}},postRender:function(e,t,n){kInteractive.gallery.resize(t);var o=this.getState(t);this.dimBtns(t),this.showImage(t,{index:o.selectedIndex,dontGoFullscreen:!0})},action:function(e,t,n){kInteractive.readData(e),e.getElementsByClassName("images")[0].getElementsByClassName("selected")[0];if(kInteractive.hasClass(t,"btn")){if(kInteractive.hasClass(t,"disable"))return n.stopPropagation();kInteractive.hasClass(t,"next")?kInteractive.gallery.showImage(e,{dir:"next"}):kInteractive.hasClass(t,"prev")?kInteractive.gallery.showImage(e,{dir:"prev"}):kInteractive.hasClass(t,"zoomIn")?kInteractive.gallery.zoomImage(e,"in"):kInteractive.hasClass(t,"zoomOut")?kInteractive.gallery.zoomImage(e,"out"):kInteractive.hasClass(t,"zoomFit")&&kInteractive.gallery.zoomImage(e,"fit")}else if(kInteractive.hasClass(t,"closeBtn"))kInteractive.gallery.exitFullscreen();else if(kInteractive.hasClass(t,"imgContainer")){if(kInteractive.readData(e).fullscreenMode)return kInteractive.gallery.goToFullscreen(e)}else if(kInteractive.hasClass(t,"kMapItem")){var o=kInteractive.getChildIndex(t);kInteractive.gallery.goToThumb(e,{windowIndex:o,highlightThumb:!1})}else if(kInteractive.hasClass(t,"kThumb")){o=t.getAttribute("data-index");kInteractive.gallery.showImage(e,{index:t.getAttribute("data-index")})}else if(kInteractive.hasClass(t,"thumbNavBtn")){kInteractive.hasClass(t,"next")?kInteractive.gallery.goToThumb(e,{dir:"nextWindow",highlightThumb:!1}):kInteractive.hasClass(t,"prev")&&kInteractive.gallery.goToThumb(e,{dir:"prevWindow",highlightThumb:!1})}kInteractive.gallery.dimBtns(e)},goToThumb:function(e,t){var n=kInteractive.readData(e);t||(t={});var o,i,r=this.getState(e),a=r.thumbWindows,s=r.activeWindow,c=r.currentIndex,l=r.selectedIndex,d=r.currentThumb,u=t.index;if(null==u&&(null!=t.windowIndex?u=t.windowIndex*a[0].children[0].children.length:("nextThumb"==t.dir&&(u=l+1),"prevThumb"==t.dir&&(u=l-1),"nextWindow"==t.dir&&(u=c+a[0].children[0].children.length),"prevWindow"==t.dir&&(u=c-a[0].children[0].children.length))),a.length)for(var p=a[0].getElementsByClassName("kThumb"),f=p.length;f--;)if(p[f].getAttribute("data-index")==u){o=p[f],i=o.parentNode;break}if(i){var h=n.rtl?"right":"left";if(s!=i){u>c?(s.style[h]=-e.offsetWidth+"px",i.style[h]=e.offsetWidth/2+"px"):(s.style[h]=e.offsetWidth+"px",i.style[h]=-e.offsetWidth/2+"px"),i.style.display="none",setTimeout((function(){i.style.display="block",setTimeout((function(){i.style[h]=0}),20)}),20);var g=e.getElementsByClassName("kMapItem");g.length&&(s&&kInteractive.c.removeClass(g[kInteractive.getChildIndex(s)],"active"),kInteractive.c.addClass(g[kInteractive.getChildIndex(i)],"active")),kInteractive.c.addClass(i,"active"),kInteractive.c.removeClass(s,"active")}t.highlightThumb&&(kInteractive.c.removeClass(d,"active"),kInteractive.c.addClass(o,"active"))}},dimBtns:function(e){for(var t,n=e.getElementsByClassName("kThumbWindow"),o=n.length;o--;)if(kInteractive.c.hasClass(n[o],"active")){t=n[o];break}if(t){var i=e.getElementsByClassName("thumbNavBtn");for(o=0;o<i.length;o++)kInteractive.c.hasClass(i[o],"next")?t.nextElementSibling?kInteractive.c.removeClass(i[o],"disable"):kInteractive.c.addClass(i[o],"disable"):kInteractive.c.hasClass(i[o],"prev")&&(t.previousElementSibling?kInteractive.c.removeClass(i[o],"disable"):kInteractive.c.addClass(i[o],"disable"))}var r=e.getElementsByClassName("imgContainer");if(r.length){var a=kInteractive.c.hasClass(r[0],"selected"),s=kInteractive.c.hasClass(r[r.length-1],"selected"),c=e.getElementsByClassName("btn");for(o=0;o<c.length;o++)kInteractive.c.hasClass(c[o],"next")?s?kInteractive.c.addClass(c[o],"disable"):kInteractive.c.removeClass(c[o],"disable"):kInteractive.c.hasClass(c[o],"prev")&&(a?kInteractive.c.addClass(c[o],"disable"):kInteractive.c.removeClass(c[o],"disable"))}},getState:function(e){var t={};t.images=e.getElementsByClassName("images")[0],t.selectedImg=t.images.getElementsByClassName("selected"),t.imgContainer=e.getElementsByClassName("imgContainer"),t.thumbWindows=e.getElementsByClassName("kThumbWindows");for(var n=0;n<t.imgContainer.length;n++)if(kInteractive.c.hasClass(t.imgContainer[n],"selected")){t.selectedIndex=n;break}if(t.thumbWindows.length){var o=t.thumbWindows[0].getElementsByClassName("active");for(n=0;n<o.length;n++)kInteractive.c.hasClass(o[n],"kThumbWindow")?(t.activeWindow=o[n],t.currentIndex=Number(t.activeWindow.children[0].getAttribute("data-index"))):t.currentThumb=o[n]}return t},goToFullscreen:function(e){if(kInteractive.frameIsOpen=!0,!kInteractive.c.hasClass(e,"fullscreen")){var t=document.createElement("div");t.innerHTML=e.outerHTML;var n=t.children[0];document.body.appendChild(n);var o=this.getState(e),i=e.getBoundingClientRect();n.setAttribute("data-index",o.selectedIndex),n.setAttribute("id","kFullscreenGallery"),n.style.top=i.top+"px",n.style.left=i.left+"px",n.style.width=i.width+"px",n.style.height=i.height+"px",kInteractive.listenForSwiping(n),n.addEventListener("swipeleft",(function(){kInteractive.gallery.showImage(n,{dir:"next"})})),n.addEventListener("swiperight",(function(){kInteractive.gallery.showImage(n,{dir:"prev"})}),!1),void 0===isKotobee&&(n.style.position="fixed"),kInteractive.c.addClass(n,"fullscreen"),kInteractive.preRender(n,{singleElem:!0}),kInteractive.postRender(n,{singleElem:!0}),setTimeout((function(){kInteractive.c.addClass(n,"in")}),20)}},showImage:function(e,t){t||(t={});var n=kInteractive.readData(e),o=this.getState(e),i=o.images,r=o.selectedImg,a=o.imgContainer,s=t.index;null==s&&r.length&&(s=kInteractive.getChildIndex(r[0])+("next"==t.dir?1:-1)),s<0&&(s=0),null==s&&(s=0),r.length&&kInteractive.c.removeClass(r[0],"selected"),kInteractive.c.addClass(a[s],"selected");var c=n.rtl?"right":"left";a[s].style[c]=i.offsetWidth*s+"px",a[s].style.display="block",i.style[c]=-i.offsetWidth*s+"px",this.goToThumb(e,{index:s,highlightThumb:!0});var l=e.getElementsByClassName("imgCaption");if(l.length){var d=(l=l[0]).getElementsByClassName("inner");if(d.length){if((d=d[0]).style.display="none",a[s].hasAttribute("data-caption")&&(d.innerHTML=a[s].getAttribute("data-caption"),n.captionFontSize&&(d.style.fontSize=n.captionFontSize+"em"),n.captionColor&&(d.style.color=n.captionColor),d.style.display=null),!n.footerOverlap){var u=e.getElementsByClassName("imgMask");if(!u.length)return;u=u[0];var p=e.getElementsByClassName("kFooter")[0];u.style.bottom=p.offsetHeight+"px"}if(n.slideshowMode){var f=function(){clearTimeout(kInteractive.gallery.timer);var t=e.getElementsByClassName("timerIcon")[0];t&&t.parentNode.removeChild(t)},h=function(){if(f(),n.slideshowTimer){var t=e.getElementsByClassName("timerIcon")[0];t||((t=document.createElement("div")).className="timerIcon",t.innerHTML='<svg><circle r="18" cx="20" cy="20"></circle></svg>',e.appendChild(t));var o=t.getElementsByTagName("circle")[0];o&&(o.style.animationDuration=g+"s")}kInteractive.gallery.timer=setTimeout((function(){var t=e.getElementsByClassName("next")[0];t&&(kInteractive.c.hasClass(t,"disable")?kInteractive.gallery.showImage(e,{index:0}):kInteractive.gallery.showImage(e,{dir:"next"}),kInteractive.gallery.dimBtns(e))}),1e3*g)};if(!document.body.contains(e))return;var g=n.transitionTime;g&&!isNaN(g)||(g=5),kInteractive.gallery.timer||(e.addEventListener("mouseover",f),e.addEventListener("mouseout",h)),h()}}}},zoomImage:function(e,t){var n=this.getState(e).selectedImg[0],o=function(e){var t=window.getComputedStyle(e).transform;if("none"===t)return 1;var n=t.match(/^matrix\((.+)\)$/);if(n){var o=n[1].split(", "),i=parseFloat(o[0]);parseFloat(o[3]);return i}var r=t.match(/^matrix3d\((.+)\)$/);if(r){o=r[1].split(", "),i=parseFloat(o[0]),parseFloat(o[5]);return i}return 1}(n)+.2*("in"==t?1:-1);"fit"==t&&(o=null);!function(e,t){if(!t)return e.style.transform=null;t<1&&(t=1);e.style.transform="scale("+t+")"}(n,o)},detectKey:function(e){27==e.keyCode&&kInteractive.gallery.exitFullscreen()},exitFullscreen:function(){var e=document.getElementById("kFullscreenGallery");e&&(kInteractive.c.removeClass(e,"in"),e.style.opacity=0,setTimeout((function(){e.parentNode.removeChild(e),document.removeEventListener("keydown",kInteractive.gallery.detectKey)}),1e3))},resize:function(e){var t=kInteractive.readData(e);if(t&&(kInteractive.checkResponsiveFloat(t,e),t.thumbnails)){var n=kInteractive.gallery.getState(e).selectedIndex;null==n&&(e.getAttribute("data-index"),n||(n=0));var o=e.getElementsByClassName("kThumbs")[0];o.innerHTML="";var i=50;"small"==t.thumbSize?i=40:"large"==t.thumbSize&&(i=60);var r,a=Math.floor((e.offsetWidth-80)/i),s=document.createElement("div");s.className="kThumbWindows";for(var c=0;c<t.imgs.length;c++)if(t.imgs[c].thumbPath){var l=document.createElement("a");l.className="ki-btn kThumb"+(c==n?" active":""),l.setAttribute("data-index",c);var d=void 0===isKotobee?t.imgs[c].thumbPath:ph.join(kInteractive.absoluteURL,t.imgs[c].thumbPath);d=kInteractive.cleanURL(d),l.setAttribute("style","background-image:url('"+d+"')"),(void 0===isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&l.addEventListener("click",kInteractive.actionEvent),c%a==0&&((r=document.createElement("div")).className="kThumbWindow",t.rtl&&r.setAttribute("dir","rtl"),s.appendChild(r)),c==n&&kInteractive.c.addClass(r,"active"),r.appendChild(l)}if(o.appendChild(s),t.thumbMap){var u=document.createElement("div");u.className="kThumbMap",t.rtl&&u.setAttribute("dir","rtl");for(c=0;c<t.imgs.length;c++)if(c%a==0){var p=document.createElement("a");p.className="ki-btn kMapItem"+(c==n?" active":""),u.appendChild(p),(void 0===isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&p.addEventListener("click",kInteractive.actionEvent)}o.appendChild(u)}if(s.children.length>1){var f=document.createElement("a");f.className="thumbNavBtn next",o.appendChild(f);var h=document.createElement("a");h.className="thumbNavBtn prev",o.appendChild(h),(void 0===isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&(f.addEventListener("click",kInteractive.actionEvent),h.addEventListener("click",kInteractive.actionEvent))}}}},kInteractive.image={preRender:function(e,t){var n=kInteractive.readData(e);n&&(n.style&&kInteractive.c.addClass(e,n.style),n.popup&&n.splash&&(e.src=n.splash),e.parentNode&&kInteractive.hasClass(e.parentNode,"link")||void 0===isKotobee&&e.addEventListener("click",kInteractive.actionEvent))},postRender:function(e,t,n){kInteractive.readData(t)},action:function(e,t,n){if(t.parentNode&&kInteractive.hasClass(t.parentNode,"kInteractive")&&kInteractive.hasClass(t.parentNode,"link"))kInteractive.action(t.parentNode,event);else{var o=kInteractive.readData(t);if(o){var i=o.behavior;if("none"!=i)r(t,"none"),a(t,"none"),s(t,"none"),setTimeout((function(){"wiggle"==i?(r(t,"wiggle"),a(t,"0.5s"),s(t,"1")):"jump"==i?(r(t,"jump"),a(t,"0.7s"),s(t,"1")):"scale"==i&&(r(t,"scale"),a(t,"0.5s"),s(t,"1"));var e=function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();e&&t.addEventListener(e,(function n(o){r(t,"none"),a(t,"none"),s(t,"none"),t.removeEventListener(e,n)}))})),kInteractive.tinCan({verb:"clicked",activity:i+"image: "+t.getAttribute("src")});else;}}function r(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function a(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function s(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.link={preRender:function(e,t){var n=kInteractive.readData(e);if(n&&!kInteractive.isEditorMode()){if("#"==e.getAttribute("href")&&e.setAttribute("href",""),"div"==e.nodeName.toLowerCase()){var o=document.createElement("a"),i=e.getAttribute("href")?e.getAttribute("href"):n.href;e.getAttribute("data-href")&&(i=e.getAttribute("data-href")),i||(i=""),o.setAttribute("href",i),o.setAttribute("target",n.target?n.target:""),o.setAttribute("style",e.getAttribute("style")),o.setAttribute("data-kotobee",e.getAttribute("data-kotobee")),o.setAttribute("data",e.getAttribute("data-kotobee")),o.className=e.className,e.id?o.id=e.id:n.id&&(o.id=n.id),kInteractive.c.addClass(o,"btn"),o.style.opacity=Number(n.transparency)/100,e.parentNode.replaceChild(o,e),e=o}void 0===isKotobee&&("popup"!=n.type&&"audio"!=n.type&&"action"!=n.type||e.setAttribute("onclick","return false;"),e.addEventListener("click",kInteractive.actionEvent))}},postRender:function(e,t,n){},action:function(e,t,n){var o=kInteractive.readData(t);if(o){if("popup"==o.type){var i="<div class='kbAlertScroll'>"+o.msg+"</div>";if(i=i.replace(/src="(.*?)"/g,(function(){var e=arguments[1];return void 0!==isKotobee&&(e=ph.join(kInteractive.absoluteURL,e)),'src="'+e+'"'})),"image"==o.popupMode){var r=o.popupImg;void 0!==isKotobee&&(r=o.relToRoot?ph.join(bookPath,r):ph.join(kInteractive.absoluteURL,r)),i="<img src='"+(r=kInteractive.cleanURL(r))+"'/>"}kInteractive.alert({content:i}),setTimeout((function(){if(kInteractive.scorm){var t={};t.id=kInteractive.getScormId("popup",o.msg),t.description="Shown popup message: "+o.msg,t.type="other",t.learnerResponses="Shown",t.timestamp=new Date,kInteractive.scorm.setInteractions([t])}kInteractive.events&&kInteractive.events.add({action:"popup",param:o.msg,elem:e,data:o})}))}else if("action"==o.type){var a=o.asset,s=o.action;if(a.remote){if("widget"==a.type){var c=document.createElement("div");c.className="kInteractive widget kbHidden",c.setAttribute("data-kotobee",a.data),c.setAttribute("data",a.data),document.body.appendChild(c),kInteractive.trigger("click",c)}return}for(var l=document.getElementsByClassName(a.classname),d=0;d<l.length;d++)if(kInteractive.hasClass(l[d],"kInteractive")&&kInteractive.hasClass(l[d],a.type))if("activate"==s)if("gallery"==a.type){var u=l[d].getElementsByClassName("next");kInteractive.trigger("click",u[0])}else if("questions"==a.type){for(var p=l[d].getElementsByClassName("ki-btn"),f=0;f<p.length;f++)if("submit"==p[f].type){kInteractive.trigger("click",p[f]);break}}else kInteractive.trigger("click",l[d]);else"visibility"==s&&kInteractive.c.toggleClass(l[d],"kbHidden")}else if("audio"==o.type){var h=function(){g||(kInteractive.c.addClass(k,"hide"),g=!0)};kInteractive.stopCurrentMedia();var g,m=document.createElement("audio"),v=o.src;"file"==o.audioType&&(v=void 0===isKotobee?o.audio:ph.join(kInteractive.absoluteURL,o.audio)),v=kInteractive.cleanURL(v),m.setAttribute("src",v);var b=document.createElement("div");b.className="kiAudioLoader",b.style.transform=b.style.webkitTransform=b.style.mozTransform="scale(1)";var k=document.createElement("div");if(k.className="kiAudioSpinner",b.appendChild(k),t.parentNode.insertBefore(b,t),m.onplaying=h,setTimeout(h,5e3),m.play(),kInteractive.currentAudio=m,kInteractive.tinCan({verb:"played",activity:"Audio: "+v}),kInteractive.scorm){var y={};y.id=kInteractive.getScormId(t.textContent,v),y.description="Played audio link: "+v,y.type="other",y.learnerResponses="Played",y.objective=o.options?o.options.objective:null,y.timestamp=new Date,kInteractive.scorm.setInteractions([y])}kInteractive.events&&kInteractive.events.add({action:"audioLinkClicked",param:v,elem:e,data:o})}else if("attachment"==o.type){var w=o.file;if(void 0!==isKotobee&&(w=o.relToRoot?ph.join(bookPath,o.file):ph.join(kInteractive.absoluteURL,o.file)),void 0!==kotobee&&isNative)return void angular.element(document.body).scope().getService("crdv").mobileDownload(w);var C=document.createElement("a");document.body.appendChild(C),C.setAttribute("style","display: none"),C.href=kInteractive.cleanURL(w),C.target="_blank",C.download=o.file.split("/")[o.file.split("/").length-1],C.setAttribute("onclick","");var x=document.createEvent("MouseEvents");x.initMouseEvent("click"),C.dispatchEvent(x),C.remove()}return!1}}},kInteractive.lipsync={preRender:function(e,t){},postRender:function(e,t,n){var o,i=e.createDocumentFragment(),r=kInteractive.readData(t);t.setAttribute("id",o="ki-lipsync-"+n),t.innerHTML="";var a=document.createElement("div");if(a.className="container",r.sync){var s=document.createElement("div");s.className="audioContainer";var c=document.createElement("a");c.className="playBtn ki-btn",c.appendChild(document.createElement("span")),void 0===isKotobee&&c.addEventListener("click",kInteractive.actionEvent),s.appendChild(c);var l=document.createElement("div");l.setAttribute("id",o+"-container"),l.className="playerContainer",s.appendChild(l),r.interaction.playBtn?r.interaction.btnAlignment&&kInteractive.c.addClass(s,r.interaction.btnAlignment):s.style.display="none",a.appendChild(s)}var d=document.createElement("div");d.className="contentContainer",d.innerHTML=function(e){document.createElement("div");var t=/(>)([^<\n]*?[^<]+?)(<[^\/])/g;e=e.replace(/([< \/][^>]*?>)((\s*[^<\s]+\s+?)+)([^<\s]+\s*)(<)/g,(function(e,t){if(arguments[1].indexOf('class="parsed"')>=0)return e;if(0==arguments[1].indexOf("<pre"))return e;if(0==arguments[1].indexOf("<code"))return e;if(0==arguments[1].indexOf("<script"))return e;var n=arguments[2].split(" ");""==n[n.length-1]&&n.splice(-1,1),n.push(arguments[4]);for(var o="",i=0;i<n.length;i++){var r=i==n.length-1?"":" ";o+="<span>"+n[i]+r+"</span>"}return arguments[1]+o+"<"})),t&&(e=e.replace(t,(function(e,t){return arguments[2].trim()?arguments[1]+("<span>"+arguments[2]+"</span>")+arguments[3]:e})));return e=e.replace(/(<a [\s\S]*?)(>)/g,'$1 onclick="return false;" $2'),e=e.replace(/&nbsp;/g,"&#160;"),e}(r.content),a.appendChild(d);var u=document.createElement("div");r.style&&kInteractive.c.addClass(u,r.style),i.appendChild(a),u.appendChild(i),t.appendChild(u);var p=document.createElement("style");p.className="system parsed";var f="";if(f+="#"+o+" .lipSyncCurrentWord {",f+="color:"+r.layout.color+";",r.layout.underline&&(f+="text-decoration:underline;"),r.layout.scale&&Number(r.layout.scale)>1&&(f+="transform:scale("+r.layout.scale+");",f+="padding:0 3px;",f+="display:inline-block;"),f+="}",p.innerHTML=f,t.appendChild(p),r.autoplay)kInteractive.action(t)},action:function(e,t){kInteractive.stopCurrentMedia();var n=kInteractive.readData(e);if(n){n.audioType||(n.audioType=n.type);e.getAttribute("id");e.getElementsByClassName("playBtn")[0].className="playBtn ki-btn hide";var o=n.src;if("file"==n.audioType&&(o=void 0===isKotobee?n.audio:n.relToRoot?ph.join(bookPath,n.audio):ph.join(kInteractive.absoluteURL,n.audio)),kInteractive.scorm){var i={};i.id=kInteractive.getScormId(e.getAttribute("id"),o),i.description="Played audio: "+o,i.type="other",i.learnerResponses="Played",i.objective=n.options?n.options.objective:null,i.timestamp=new Date,kInteractive.scorm.setInteractions([i])}kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:o,elem:e,data:n});var r=document.createElement("audio");r.setAttribute("controls","true"),r.setAttribute("autoplay","true"),r.setAttribute("data-tap-disabled","false");var a=document.createElement("source");a.src=kInteractive.cleanURL(o),r.appendChild(a),r.appendChild(document.createTextNode("Your browser does not support the audio element")),r.className="ki-noHighlight",r.oncanplay=function(){kInteractive.currentAudio==e&&kInteractive.tinCan({verb:"played",activity:"Audio: "+o})},r.ontimeupdate=function(e){!function(e){var t,o=n;for(var i=o.sync.length;i--;)if(e>=o.sync[i]){t=i;break}if(null==t)return;c!=t&&(null!=c&&s[c]&&kInteractive.c.removeClass(s[c],"lipSyncCurrentWord"),s[t]&&kInteractive.c.addClass(s[t],"lipSyncCurrentWord"),c=t)}(r.currentTime)},n.interaction.nextAuto&&(r.onended=function(t){var n=[].slice.call(document.getElementsByClassName("lipsync"));if(n.length){var o=n.indexOf(e),i=n[o+1];if(i){var r=i.getElementsByClassName("playBtn")[0];r&&r.click()}}}),e.getElementsByClassName("playerContainer")[0].appendChild(r),r.play(),kInteractive.currentAudio=e,kInteractive.c.addClass(kInteractive.currentAudio,"playing");var s=function(){for(var t=[],n=e.getElementsByClassName("contentContainer")[0],o=n.getElementsByClassName("lipSyncCurrentWord"),i=o.length;i--;)hasClass(o[i],"lipSyncCurrentWord")&&removeClass(o[i],"lipSyncCurrentWord");for(;n.children&&n.children.length;)n=n.children[0];t.push(n);for(;n;)if(n.nextSibling){for(n=n.nextSibling;n.children&&n.children.length;)n=n.children[0];if(3==n.nodeType)continue;if(""==n.textContent.trim())continue;t.push(n)}else if("contentContainer"==(n=n.parentNode).className)break;return t}(),c=0;kInteractive.c.addClass(s[c],"lipSyncCurrentWord")}}},kInteractive.questions={preRender:function(e,t,n,o){o||(o={});var i=t.createDocumentFragment(),r=kInteractive.readData(e);if(r){var a=r.dict,s=r.userDict;if(a||(a={}),s||(s=a),r.options||(r.options={}),e.id||(e.id="ki-qs-"+n+"-"+Math.ceil(1e3*Math.random())),e.innerHTML="",r.layout&&r.layout.popup&&!kInteractive.hasClass(e,"inpopup")){var c=document.createElement("img");c.className="clickable";var l=r.layout.popupImg;return l=kInteractive.cleanURL(l),c.src=l,i.appendChild(c),void 0===isKotobee&&c.addEventListener("click",kInteractive.actionEvent),void e.appendChild(i)}if(r.options.randomize){for(var d=0;d<r.q.length;d++)r.q[d].origin=d;for(var u,p,f=r.q.length;0!==f;)p=Math.floor(Math.random()*(r.q.length-1e-4)),f--,u=r.q[f],r.q[f]=r.q[p],r.q[p]=u;if("slides"==r.options.displayMode){var h="";for(d=0;d<r.q.length;d++)h+=(h?",":"")+r.q[d].origin;e.setAttribute("data-o",h)}}if(r.options.questionsDisplayed){var g=Number(r.options.questionsDisplayed);r.q=r.q.slice(0,g)}if(r.title){var m=document.createElement("span");m.innerHTML="<h4>"+kInteractive.escapeHtml(r.title)+"</h4>",kInteractive.c.hasClass(e,"parsed")&&kInteractive.c.addClass(m.children[0],"parsed"),i.appendChild(m)}var v=null;r.options&&r.options.emailForm&&(v=this.f.createEmailForm(s));var b=null;"none"!=r.action&&(b=this.f.createSubmitBtn(s,e));var k=null,y=null,w=null;r.options&&r.options.clearAnswers&&(k=this.f.createClearBtn(s)),r.options&&r.options.addToNotebook&&(w=this.f.createAddToNotebookBtn(s)),r.options&&r.options.preserveAnswers&&!r.options.preserveAnswers.auto&&(y=this.f.createPreserveBtn(s,e,r.layout.persist||{}));var C=this.f.createSeparator(),x=document.createElement("div");x.className="qContainer";var I=document.createElement("div");if(I.className="btnContainer","slides"==r.options.displayMode)e.qIndex=0,x.appendChild(kInteractive.questions.f.createQElem(r,{questionNo:1,index:0,elem:e,rendered:!1})),kInteractive.isEditorMode()||r.options.dateRangeEnabled&&!o.skipDateValidation&&(x.style.display="none",I.style.display="none"),i.appendChild(x),i.appendChild(I),kInteractive.questions.f.showNavBtns(0,i,{isFrag:!0,userDict:s,qsData:r});else{var E=0;for(d=0;d<r.q.length;d++)"sp"!=r.q[d].type&&E++,x.appendChild(kInteractive.questions.f.createQElem(r,{questionNo:E,index:d,elem:e,rendered:!1}));kInteractive.isEditorMode()||r.options.dateRangeEnabled&&!o.skipDateValidation&&(x.style.display="none",I.style.display="none"),i.appendChild(x),y&&I.appendChild(y),v&&I.appendChild(v),b&&I.appendChild(b),w&&I.appendChild(w),k&&I.appendChild(k),C&&i.appendChild(C),i.appendChild(I)}r.options.rtl?(e.setAttribute("dir","rtl"),kInteractive.c.addClass(e,"rtl")):e.setAttribute("dir","ltr");var S=document.createElement("div");r.style&&kInteractive.c.addClass(S,r.style),S.appendChild(i),void 0===isKotobee&&kInteractive.c.addClass(S,"parsed"),e.appendChild(S)}},postRender:function(e,t,n,o){var i=kInteractive.readData(t);if(i){o||(o={});var r=i.dict;r||(r={}),($=i.userDict)||($=r);for(var a=t.getElementsByClassName("ques"),s=t.getElementsByClassName("explanation"),c=s.length;c--;)s[c].parentNode.removeChild(s[c]);var l=t.getElementsByClassName("reference");for(c=l.length;c--;)l[c].parentNode.removeChild(l[c]);if(i.options.scoreHistory&&kInteractive.isKotobeeUser()){var d=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"admin/library/questions/get",u=angular.element(document.body).scope(),p={env:"library"==config.kotobee.mode?"library":"book",cloudid:config.kotobee.cloudid,email:u.data.user.email,code:u.data.user.code,pwd:u.data.user.pwd,qsxid:t.id,mode:"submissions"};"library"==config.kotobee.mode&&u.data.book&&(p.bid=u.data.book.id),kInteractive.questions.f.sendPost(d,p,(function(e){e.target;var n=e.target;if(4===n.readyState&&200===n.status){var o=JSON.parse(n.response);if(o&&o.scores&&o.scores.length){for(var i=t.getElementsByClassName("scoreHistory"),r=i.length;r--;)i[0].parentNode.removeChild(i[0]);var a=document.createElement("div");a.className="scoreHistory";var s=document.createElement("h5");s.textContent=$.scoreHistoryLabel?$.scoreHistoryLabel:"Score history",a.appendChild(s);for(r=0;r<o.scores.length;r++){var c=o.scores[r],l=kInteractive.questions.f.phpDateToJs(c.date),d=($.scoreLabel?$.scoreLabel:"Score")+": "+c.fullscore,u=document.createElement("div");u.className="scoreItem",u.innerHTML="<div><span class='date'>"+l.toLocaleString()+"</span> <span class='score'>"+d+"</span></div>",a.appendChild(u)}t.appendChild(a)}}}))}if(kInteractive.isEditorMode()||!i.options.dateRangeEnabled||o.skipDateValidation){if(!kInteractive.isEditorMode()){var f=kInteractive.getBookID()+"-"+t.id;t.clock=kInteractive.getClock(f),t.clock.pause(),t.clock.cb=function(e){if(i.options.visibilityDuration){var n=i.options.visibilityDuration-e;if(i.options.visibilityDurationTimer){var o=t.getElementsByClassName("qTimer")[0];o||((o=document.createElement("div")).className="qTimer",t.appendChild(o));var r=Math.floor(n/60),a=n-60*r;o.textContent=("0"+r).substr(-2)+":"+("0"+a).substr(-2)}if(n<0){if(i.options.visibilityDurationAutoSubmit){var s=t.getElementsByClassName("questions-submit")[0];s&&s.click()}kInteractive.questions.f.replaceWithError(t,{msg:$.questionsTimeUp?$.questionsTimeUp:$.questionsInactive,className:"qInactive"})}}};try{kInteractive.observe(t,(function(){t.clock&&t.clock.resume()}),(function(){t.clock&&t.clock.pause()}))}catch(e){}}kInteractive.isEditorMode()||i.options.disableAfterAttempts&&kInteractive.isKotobeeUser()&&kInteractive.questions.f.getAttempts(t,(function(e){e&&e>=i.options.disableAfterAttempts&&kInteractive.questions.f.replaceWithError(t,{msg:$.questionsInactive,className:"qInactive"})}));for(var h=0;h<a.length;h++){var g=a[h].getElementsByClassName("ans"),m=(g.length,h);i.options.randomize&&(m="slides"==i.options.displayMode&&t.originArray?t.originArray[h]:Number(a[h].getAttribute("data-o"))),document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[m]&&kInteractive.questions.f.showExp(i.userDict,a[h],i.q[m],i.options);for(c=0;c<g.length;c++)if(kInteractive.c.removeClass(g[c].parentNode,"correct"),g[c].getAttribute("id").indexOf("ki-tf-")>=0)document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[m]&&(document[t.id].q[m][c]?g[c].setAttribute("checked",!0):g[c].removeAttribute("checked"),i.options&&i.options.highlightCorrect&&(0==c&&i.q[m].a||1==c&&!i.q[m].a)&&kInteractive.c.addClass(g[c].parentNode,"correct"));else if(g[c].getAttribute("id").indexOf("ki-dd-")>=0){if(document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[m])for(var v=0;v<document[t.id].q[m].length;v++){var b=document[t.id].q[m][v];try{for(var k=document.getElementById(b.id),y=k;!kInteractive.c.hasClass(y,"ques");)y=y.parentNode;y.getElementsByClassName("categoryContainer")[0].children[b.category].appendChild(k)}catch(e){}}}else if(g[c].getAttribute("id").indexOf("ki-na-")>=0)document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[m]&&(g[c].removeAttribute("value"),document[t.id].q[m]&&g[c].setAttribute("value",document[t.id].q[m]));else if(g[c].getAttribute("id").indexOf("ki-sa-")>=0)document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[m]&&(g[c].removeAttribute("value"),document[t.id].q[m]&&g[c].setAttribute("value",document[t.id].q[m]));else if(g[c].getAttribute("id").indexOf("ki-mt-")>=0){var w=a[h].getElementsByClassName("mt-container")[0];if(!w)continue;if(document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[m]){var C=document[t.id].q[m];C&&C.length&&(w.mtSelection||(w.mtSelection={pairs:[]}),w.mtSelection.pairs=C,"function"==typeof kInteractive.questions.mt.redrawLines&&kInteractive.questions.mt.redrawLines(w))}if(i.options&&i.options.highlightCorrect){var x=i.q[m];if(x&&x.left&&x.right){for(var I={},E=0;E<x.left.length;E++)I[x.left[E]]=x.right[E];w.mtSelection&&w.mtSelection.pairs&&w.mtSelection.pairs.forEach((function(e){if(I[e.left]===e.right){var t=document.getElementById(e.leftId);t&&kInteractive.c.addClass(t,"correct");var n=document.getElementById(e.rightId);n&&kInteractive.c.addClass(n,"correct")}}))}}}else document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[m]&&(document[t.id].q[m][c]?g[c].setAttribute("checked",!0):g[c].removeAttribute("checked"),i.options&&i.options.highlightCorrect&&i.q[m].c[c].a&&kInteractive.c.addClass(g[c].parentNode,"correct"));if(document[t.id]){var S=t.getElementsByClassName("questions-preserve");S.length&&(document[t.id].preserve?S[0].setAttribute("checked",!0):S[0].removeAttribute("checked"))}}for(var T=t.getElementsByClassName("ih-container"),O=0;O<T.length;O++){var N=T[O],A=N.querySelector("svg.ih-overlay");if(A&&(document[t.id]&&document[t.id].q)){var L=N.dataset.qid,B=document[t.id].q[L];B&&Array.isArray(B)&&(N.answers=[],A.innerHTML="",B.forEach((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.x),t.setAttribute("cy",e.y),t.setAttribute("r",6),t.setAttribute("fill",e.correct?"rgba(0,255,0,0.6)":"rgba(255,0,0,0.6)"),A.appendChild(t),N.answers.push(e)})),N.clickCount=N.answers.length)}}if(!kInteractive.isEditorMode()&&!kInteractive.isPreview()){var P="persist-"+kInteractive.getBookID()+"-"+t.id,M="true"==sessionStorage.getItem(P)||i.options.preserveAnswers.auto,R=t.querySelector("input.questions-preserve");if(R&&(M?R.setAttribute("checked",!0):R.removeAttribute("checked")),kInteractive.helpers&&kInteractive.helpers.persister)if(kInteractive.helpers.persister.instances[t.id])kInteractive.helpers.persister.instances[t.id]instanceof kPersister&&kInteractive.helpers.persister.instances[t.id].restore();else{var D={storage:i.options.preserveAnswers.option,enabled:M,root:t,silentMode:i.options.preserveAnswers.auto,appendDataMode:"slides"==i.options.displayMode,delegateEvents:!1,messages:{save:$.save?$.save:"Save",unsaved:$.unsaved?$.unsaved:"You have unsaved changes",saving:$.saving?$.saving:"Saving ..",saved:$.saved?$.saved:"Changes has been saved!",dismiss:$.dismiss?$.dismiss:"Dismiss",lastSaved:$.lastSaved?$.lastSaved:"Last saved on",longDataError:$.longDataError?$.longDataError:"Some answers not saved (marked in red)"}};Object.keys(i.options.preserveAnswers).some((function(e){return-1!=e.indexOf("design")}))&&(D.design=function(e){var t={};e.designPlacement&&(t.placement=e.designPlacement);(e.designUnsavedColor||e.designUnsavedBackground)&&(t.unsaved={});e.designUnsavedColor&&(t.unsaved.color=e.designUnsavedColor);e.designUnsavedBackground&&(t.unsaved.background=e.designUnsavedBackground);(e.designSuccessColor||e.designSuccessBackground)&&(t.success={});e.designSuccessColor&&(t.success.color=e.designSuccessColor);e.designSuccessBackground&&(t.success.background=e.designSuccessBackground);return t}(i.options.preserveAnswers)),kInteractive.helpers.persister.addInstance(t.id,D),kInteractive.helpers.persister.instances[t.id].on("persister.ready",(function(e){e.target.enabled&&e.target.restore()})),kInteractive.helpers.persister.instances[t.id].on("persister.restored",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.error",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.saved",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.unsaved",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.pushed",(function(e){})),kInteractive.helpers.persister.instances[t.id].init()}}}else{var $=i.userDict,V="https://www.kotobee.com/";void 0!==isKotobee&&(V=config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/");d=V+"timestamp";kInteractive.questions.f.sendPost(d,{timezone:kInteractive.getTimezone()},(function(n){var r=n.target;if(4===r.readyState&&200===r.status){var a=r.responseText,s=kInteractive.questions.f.checkTimeValidity(a,i.options.dateRange);if(s.valid){var c=t.getElementsByClassName("qContainer")[0],l=t.getElementsByClassName("btnContainer")[0];c&&(c.style.display="block"),l&&(l.style.display="block");var d=Object.assign({},o,{skipDateValidation:!0});kInteractive.questions.postRender(e,t,v,d)}else s.expired?kInteractive.questions.f.replaceWithError(t,{msg:$.questionsExpired,className:"qExpired"}):s.early&&kInteractive.questions.f.replaceWithError(t,{msg:$.questionsNotStarted,className:"qEarly"})}}))}}},action:function(e,t){var n=kInteractive.readData(e);if(n){var o=n.dict,i=n.userDict;if(o||(o={}),i||(i=o),n.layout&&n.layout.popup&&!kInteractive.hasClass(e,"inpopup")&&"img"==t.nodeName.toLowerCase()){var r=function(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t},a=document.getElementById("epubContent");a&&e.setAttribute("data-loc",function(e,t){for(var n="";e!=t;){n=r(e)+"."+n,e=e.parentNode}return""==n?"":n.substr(0,n.length-1)}(e,a));var s=document.createElement("iframe");s.setAttribute("nwdisable","true"),s.setAttribute("scrolling","yes");var c=document.createElement("div");return c.className="scroller",c.appendChild(s),n.cb=function(t){var n,o=document.createElement("head");if(void 0===isKotobee){for(var i=document.getElementsByTagName("link"),r=0;r<i.length;r++){var a=i[r];if(a.getAttribute("href").indexOf("base.css")>=0){var l=a.getAttribute("href").split("/");delete l[l.length-1],n=l.join("/");break}}if(!n)return}var d=void 0===isKotobee?kInteractive.c.removeHash(window.location.href):kInteractive.absoluteURL;d=kInteractive.cleanURL(kInteractive.c.removeFilename(d)+"/"),void 0!==isKotobee&&(kInteractive.isAbsolutePath(d)||(d=kInteractive.cleanURL(kInteractive.c.removeFilename(kInteractive.c.removeHash(window.location.href))+"/"+d)));for(var u=d.split("EPUB/xhtml"),p=u[u.length-1].split("/").length-1,f="",h=0;h<p;h++)f+="../";o="<head>";if(o+='<base href="'+d+'"/>',o+='<link rel="stylesheet" type="text/css" href="'+(f+"css/base.css")+'" />',o+='<link rel="stylesheet" type="text/css" href="'+(f+"css/global.css")+'" />',o+='<link rel="stylesheet" type="text/css" href="'+(f+"css/kotobeeInteractive.css")+'" />',o+='<script type="text/javascript" src="'+(f+"js/kotobeeInteractive.js")+'"><\/script>',o+='<script type="text/javascript" src="'+(f+"js/global.js")+'"><\/script>',void 0!==isKotobee){var g=clone(config);g.kotobee.email=angular.element(document.body).scope().data.user.email,o+='<script type="text/javascript">var config='+JSON.stringify(g)+";<\/script>"}o+='<meta name="viewport" content="viewport-fit=cover,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,width=device-width">',o+='<meta charset="utf-8" />',o+="</head>";var m=e.outerHTML;m=(m=(m=(m=(m=(m=m.replace("<img",'<img style="display:none"')).replace(/([;\s]*?height:)(.*)?;/i,"$1auto")).replace(/([;\s]*?width:)(.*)?;/i,"$1auto")).replace(/([;\s]*?top:)(.*)?;/i,"$1auto")).replace(/([;\s]*?left:)(.*)?;/i,"$1auto")).replace('class="','class="inpopup ');var v="<html>"+o+"<body>"+(m+='<div class="vSpace20"></div>')+"</body></html>";s.setAttribute("srcdoc",v);var b="javascript: window.frameElement.getAttribute('srcdoc');";function k(){if(void 0!==isKotobee){var t={};t.root=s.contentDocument.documentElement.ownerDocument.body,t.rootIndex=e.getAttribute("data-loc"),angular.element(document.body).scope().getNotebookShortcut(t,(function(){}))}}s.setAttribute("src",b),s.contentWindow&&(s.contentWindow.location=b),t.appendChild(c),s.addEventListener?s.addEventListener("load",k,!0):s.attachEvent&&s.attachEvent("onload",k)},n.closed=function(){},n.pos=n.layout.pos,kInteractive.openFrame(n),kInteractive.tinCan({verb:"opened",activity:"Questions: "+n.title}),void setTimeout((function(){if(kInteractive.scorm){var t={};t.id=kInteractive.getScormId("question",n.title),t.description="Opened question popup: "+n.title,t.learnerResponses="Opened",t.type="other",t.timestamp=new Date,kInteractive.scorm.setInteractions([t])}kInteractive.events&&kInteractive.events.add({action:"questionPopup",param:n.title,elem:e,data:n})}),800)}if(kInteractive.hasClass(t,"ki-inputbox"))kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange();else if(!kInteractive.hasClass(t,"ki-textfield")||kInteractive.hasClass(t,"mt-mobile-select")){if(kInteractive.hasClass(t,"ki-draggable"))kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange();else if(!kInteractive.hasClass(t,"kInteractive")){if(kInteractive.hasClass(t,"questions-next")){var l=e.qIndex?e.qIndex:0;if(e.questions||(e.questions=[]),++l<0)return;if(l>=n.q.length)return;var d=(u=e.getElementsByClassName("qContainer")[0]).children[0];if(n.options.strictNav)if(!(he=kInteractive.questions.f.assess(d,n.q[l-1],n)).correct)return void kInteractive.questions.f.showExp(n.userDict,d,n.q[l-1],n.options);return e.questions[l-1]||(e.questions[l-1]=d),e.questions[l]||(e.questions[l]=kInteractive.questions.f.createQElem(n,{questionNo:l+1,index:l,elem:e,rendered:!0})),u.innerHTML="",u.appendChild(e.questions[l]),kInteractive.questions.f.showNavBtns(l,e,{userDict:i,qsData:n}),e.qIndex=l,void kInteractive.helpers.persister.instances[e.id].restore()}if(kInteractive.hasClass(t,"questions-prev")){if(!e.questions||!e.questions.length)return;var u;l=e.qIndex?e.qIndex:0;return l--,(u=e.getElementsByClassName("qContainer")[0]).innerHTML="",u.appendChild(e.questions[l]),kInteractive.questions.f.showNavBtns(l,e,{userDict:i,qsData:n}),e.qIndex=l,void kInteractive.helpers.persister.instances[e.id].restore()}if(kInteractive.hasClass(t,"mt-left-item")||kInteractive.hasClass(t,"mt-right-item")||kInteractive.hasClass(t,"mt-mobile-select")){var p=t.closest(".mt-container"),f=p.mtSelection||(p.mtSelection={first:null,pairs:[]});if(kInteractive.hasClass(t,"mt-mobile-select")&&t.nodeName&&"select"===t.nodeName.toLowerCase()){var h=t.getAttribute("data-left")||"",g=t.value||"";if(!h)return;if(f.pairs=f.pairs.filter((function(e){return e.left!==h})),g){var m=t.options[t.selectedIndex]?t.options[t.selectedIndex].id:null,v=(be=Array.from(p.querySelectorAll(".mt-left-item")).find((function(e){return e.textContent.trim()===h})))?be.id:null;f.pairs=f.pairs.filter((function(e){return e.right!==g})),p.querySelectorAll(".mt-mobile-select").forEach((function(e){e!==t&&e.value===g&&(e.value="default")})),f.pairs.push({left:h,right:g,leftId:v,rightId:m})}return void(kInteractive.helpers.persister.instances[p.id]&&kInteractive.helpers.persister.instances[p.id].handleChange())}if(!f.first)return f.first=t,void t.classList.add("selected");var b=f.first.classList.contains("mt-left-item");if(b===t.classList.contains("mt-left-item"))return f.first.classList.remove("selected"),f.first=t,void t.classList.add("selected");var k=b?f.first:t,y=b?t:f.first;h=k.textContent.trim(),g=y.textContent.trim(),v=k.id,m=y.id;f.pairs=f.pairs.filter((function(e){return e.left!==h&&e.right!==g})),f.pairs.push({left:h,right:g,leftId:v,rightId:m}),kInteractive.questions.mt.redrawLines(p),f.first.classList.remove("selected"),f.first=null,kInteractive.helpers.persister.instances[p.id]&&kInteractive.helpers.persister.instances[p.id].handleChange()}if(kInteractive.hasClass(t,"questions-tts")){var w=t.getAttribute("data-text");(fe=new SpeechSynthesisUtterance).text=w,window.speechSynthesis.speak(fe)}if(kInteractive.hasClass(t,"ih-container")||kInteractive.hasClass(t,"ih-image")){var C=(ve=t.closest(".ih-container")).querySelector("svg.ih-overlay"),x=ve.dataset.qid,I=n.q.find((function(e){return e.id===x}));if(!I||!I.hotspots)return;for(var E=ve.answers||[],S=ve.getBoundingClientRect(),T=(event.clientX-S.left)/S.width*100,O=(event.clientY-S.top)/S.height*100,N=0;N<E.length;N++)if(L=E[N],B={x:T,y:O},P=void 0,M=void 0,P=L.x-B.x,M=L.y-B.y,Math.sqrt(P*P+M*M)<3)return E.splice(N,1),ve.answers=E,ve.clickCount=E.length,C.querySelectorAll("circle").forEach((function(e){return e.remove()})),void E.forEach((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.x/100*S.width),t.setAttribute("cy",e.y/100*S.height),t.setAttribute("r",8),t.setAttribute("fill","rgba(0,0,255,0.5)"),t.style.cursor="pointer",C.appendChild(t)}));if(E.length>=I.hotspots.length)return;var A=document.createElementNS("http://www.w3.org/2000/svg","circle");if(A.setAttribute("cx",T/100*S.width),A.setAttribute("cy",O/100*S.height),A.setAttribute("r",8),A.setAttribute("fill","rgba(0,0,255,0.5)"),A.style.cursor="pointer",C.appendChild(A),E.push({x:T,y:O}),ve.answers=E,ve.clickCount=E.length,E.length>=I.hotspots.length)I.hotspots.every((function(e){return E.some((function(t){return kInteractive.questions.ih.pointInPolygon(t,e.points)}))}));kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange()}else{var L,B,P,M;if(kInteractive.hasClass(t,"ih-reset-btn")){for(var R=t;R&&(!R.className||-1===String(R.className).indexOf("ques"));)R=R.parentNode;if(!R)return;if(!(ve=R.querySelector(".ih-container")))return;if(!(C=ve.querySelector("svg.ih-overlay")))return;ve.answers=[],ve.clickCount=0;for(var D=(ke=C.querySelectorAll("circle")).length-1;D>=0;D--)ke[D].parentNode.removeChild(ke[D]);void 0!==e&&kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange()}else if(kInteractive.hasClass(t,"questions-clear")){E=e.getElementsByClassName("ans");for(var $=[],V=0;V<E.length;V++)E[V].checked=!1,E[V].value=null,kInteractive.c.removeClass(E[V].parentNode,"correct"),kInteractive.c.removeClass(E[V],"incorrect"),kInteractive.c.hasClass(E[V].parentNode,"dCategory")&&$.push(E[V]);for(V=0;V<$.length;V++)$[V].parentNode.parentNode.parentNode.getElementsByClassName("ki-dd-answers")[0].appendChild($[V]);var H=e.getElementsByClassName("explanation");for(V=H.length;V--;)H[V].parentNode.removeChild(H[V]);var F=e.getElementsByClassName("reference");for(V=F.length;V--;)F[V].parentNode.removeChild(F[V]);for(var q=e.getElementsByClassName("mt-container"),j=0;j<q.length;j++){var z=q[j];z.mtSelection={first:null,pairs:[]};for(var U=z.querySelectorAll(".mt-left-item, .mt-right-item"),_=0;_<U.length;_++)kInteractive.c.removeClass(U[_],"selected"),kInteractive.c.removeClass(U[_],"incorrect");if(C=z.querySelector("svg"))for(;C.firstChild;)C.removeChild(C.firstChild);for(var W=z.querySelectorAll(".mt-mobile-select"),K=0;K<W.length;K++)W[K].value="default"}document[e.id]=null,(ve=e.querySelector(".ih-container"))&&((C=ve.querySelector("svg.ih-overlay"))&&(C.querySelectorAll("circle").forEach((function(e){return e.remove()})),C.querySelectorAll(".ih-hotspot-feedback").forEach((function(e){return e.remove()}))),ve.answers=[],ve.clickCount=0,kInteractive.helpers.persister.instances[ve.id]&&kInteractive.helpers.persister.instances[ve.id].clear()),kInteractive.helpers.persister.instances&&kInteractive.helpers.persister.instances[e.id].clear()}else{if(kInteractive.hasClass(t,"questions-notebook")){var Y=n.layout&&n.layout.popup&&kInteractive.hasClass(e,"inpopup");if(void 0===isKotobee&&!Y)return void kInteractive.alert({content:o.kotobeeOnly,title:i.sorry?i.sorry:"Sorry"});var J,X={elem:e};if(void 0!==isKotobee)angular.element(document.body).scope();else{try{window.parent.getGlobal()}catch(t){var G=e.getElementsByClassName("ans");for(D=0;D<G.length;D++)G[D].checked?G[D].setAttribute("checked",""):G[D].removeAttribute("checked");kInteractive.c.addClass(e,"parsed"),X.elem=e.outerHTML;var Z={msg:i.savedToNotebook?i.savedToNotebook:"Saved to notebook!",nOb:X};return window.parent.postMessage("addtonotebook:"+encodeURIComponent(JSON.stringify(Z)),"*"),void kInteractive.alert({content:i.savedToNotebook?i.savedToNotebook:"Saved to notebook!"})}X.rootIndex=e.getAttribute("data-loc"),X.root=e}return window.compInstances&&window.compInstances.global&&(J=window.compInstances.global),kInteractive.hasClass(e,"inpopup")&&(J=window.top.compInstances.global),void(J&&(kInteractive.c.addClass(t,"busy"),J.questionsAddToNotebookShortcut(X,(function(){kInteractive.c.removeClass(t,"busy"),kInteractive.alert({content:i.savedToNotebook?i.savedToNotebook:"Saved to notebook!"})}))))}if(kInteractive.hasClass(t,"questions-preserve")){if(document[e.id]||(document[e.id]={}),document[e.id].preserve=t.checked,kInteractive.helpers.persister.instances){var Q="persist-"+kInteractive.getBookID()+"-"+e.id;t.checked?(sessionStorage.setItem(Q,"true"),kInteractive.helpers.persister.instances[e.id].enable(n.options.preserveAnswers.auto)):(sessionStorage.setItem(Q,"false"),kInteractive.helpers.persister.instances[e.id].disable())}}else if(kInteractive.hasClass(t,"questions-submit")){var ee=function(){var e="Questions: "+te+". Score: "+ie+" questions out of "+le;e+=". Action: "+Se,"selfAnswerReport"==Se&&(e+=". Details: "+re),kInteractive.tinCan({verb:"solved",activity:e})},te="Untitled questions",ne=e.getElementsByTagName("h4");ne.length&&(te=ne[0].textContent||ne[0].data);var oe,ie=0,re="",ae=0,se=0,ce=[];oe="slides"==n.options.displayMode?e.questions.slice(0):e.getElementsByClassName("ques");var le=0;for(V=0;V<oe.length;V++)if(!kInteractive.hasClass(oe[V],"sp")){le++;var de=(E=oe[V].getElementsByClassName("ans")).length,ue=n.q[V],pe=kInteractive.questions.f.getItemOrder(e);if(n.options.randomize&&(ue="slides"==n.options.displayMode&&pe?n.q[Number(pe[V])]:n.q[Number(oe[V].getAttribute("data-o"))]),ue.q||(ue.q=""),ue.q=ue.q.replace(/<html.*<body>([\s\S]*?)<\/body><\/html>/g,"$1"),kInteractive.scorm&&n.options&&n.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(e.id+"-"+le,ue.q))){var fe="<p style='text-align:center'>"+(i.alreadySubmitted?i.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:fe})}var he,ge={};if(E.length){var me=E[0].getAttribute("id");if(ce.push(ge),ge.id=kInteractive.getScormId(e.id+"-"+le,ue.q),ge.qid=e.id,me.indexOf("ki-tf-")>=0?ge.type="true-false":me.indexOf("ki-mcq-")>=0||me.indexOf("ki-mmcq-")?ge.type="choice":me.indexOf("ki-dd-")>=0?ge.type="drag-drop":me.indexOf("ki-sa-")>=0?ge.type="short-answer":me.indexOf("ki-na-")>=0?ge.type="numeric-answer":me.indexOf("ki-ih-")>=0?ge.type="image-hotspot":me.indexOf("ki-mt-")>=0&&(ge.type="matching"),kInteractive.hasClass(oe[V],"ih")){var ve=oe[V].querySelector(".ih-container"),be=[];if(ve&&ve.answers&&(be=ve.answers.map((function(e){return{x:e.x,y:e.y}}))),C=ve?ve.querySelector("svg.ih-overlay"):null){S=ve.getBoundingClientRect();if(C.querySelectorAll(".ih-hotspot-feedback").forEach((function(e){return e.remove()})),ue.hotspots&&ue.hotspots.length&&n.options.highlightCorrect&&ue.hotspots.forEach((function(e){var t=be.some((function(t){return kInteractive.questions.ih.pointInPolygon(t,e.points,ve)})),n=document.createElementNS("http://www.w3.org/2000/svg","polygon"),o=e.points.map((function(e){return e.x/100*S.width+","+e.y/100*S.height})).join(" ");n.setAttribute("points",o),n.setAttribute("class","ih-hotspot-feedback"),n.setAttribute("fill",t?"rgba(0,255,0,0.3)":"rgba(255,0,0,0.3)"),n.setAttribute("stroke",t?"green":"red"),n.setAttribute("stroke-width","2"),C.appendChild(n)})),ve.answers){var ke=C.querySelectorAll("circle");ve.answers.forEach((function(e,t){var n=ue.hotspots.some((function(t){return kInteractive.questions.ih.pointInPolygon(e,t.points,ve)}));ke[t]&&ke[t].setAttribute("fill",n?"rgba(0,255,0,0.6)":"rgba(255,0,0,0.6)")}))}}}}ge.objective=n.options?n.options.objective:null,ge.timestamp=kInteractive.timestamp,ge.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),ge.description=ue.q,(he=kInteractive.questions.f.assess(oe[V],ue,n)).correctResponses&&(ge.correctResponses=he.correctResponses),he.learnerResponses&&(ge.learnerResponses=he.learnerResponses);var ye=he.ddInteractionOb;ye||(ye=[]);de=he.correct;if(ye.length)for(var we=0;we<ye.length;we++)ge.correctResponses&&(ge.correctResponses+="; "),ge.learnerResponses&&(ge.learnerResponses+="; "),ge.correctResponses+=ye[we].correct,ge.learnerResponses+=ye[we].learner;ge.result=0,de&&ie++,null!=ue.weight&&(ae+=+ue.weight,de&&(se+=+ue.weight,ge.result=+ue.weight)),ge.scoreMax=n.options?Number(n.options.totalScore):null,kInteractive.questions.f.showExp(n.userDict,oe[V],ue,n.options);var Ce=document.createElement("div");Ce.innerHTML=ue.q.replace(/'/g,"&#39;");var xe=Ce.textContent,Ie=i.question?i.question.replace("[no]",le):"Question "+le;re+=de?"<span style='border-bottom: dotted 1px #aaa;' title='"+xe+"'>"+Ie+".</span>  <span style='color:#366c20'>"+i.correct+"</span><br/>":"<span style='border-bottom: dotted 1px #aaa;' title='"+xe+"'>"+Ie+".</span>  <span style='color:#7a1818'>"+i.incorrect+"</span><br/>"}n.options&&n.options.visibilityDurationStopAfterSubmit&&e.clock&&(e.clock.destroy&&e.clock.destroy(),e.clock=null),setTimeout((function(){void 0!==isKotobee&&"undefined"!=typeof markers&&markers.refreshMarkers()}),100);for(V=0;V<ce.length;V++)ce[V].weighting=Math.round(1e3*n.options.totalScore/ae)/1e3;var Ee,Se=n.action;n.options.totalScore&&ae&&(Ee=Math.round(10*n.options.totalScore*se/ae)/10);var Te="";"ar"==n.options.lang&&(Te=' direction="rtl"');var Oe="";if(i.scoreWeight){if(null!=Ee){var Ne="";n.options.passScore&&(Ee>=n.options.passScore||Ee==n.options.totalScore?Ne+=i.pass:Ne+=i.fail),Ne&&(Ne+=". "),Oe+="<h3"+Te+">"+(Ne||"")+i.scoreWeight.replace("[score]",Ee).replace("[total]",n.options.totalScore)+"</h3>"}Oe+="<p"+Te+">"+i.score.replace("[correct]",ie).replace("[total]",le)+"</p>"}else Oe="You scored "+ie+" question(s) out of "+le;"selfAnswerReport"==Se&&(Oe="<p"+Te+"><strong>"+Oe+"</strong></p><p><strong>"+(i.details?i.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+re+"</p>"),"selfAnswer"!=Se&&"selfAnswerReport"!=Se||(kInteractive.alert({content:Oe}),ee()),("email"==Se||n.options.reportEmail||n.options.emailForm||n.options.serverReports)&&function(){var r="email"==Se||n.options.reportEmail||n.options.emailForm,a="selfAnswer"!=Se&&"selfAnswerReport"!=Se&&"email"!=Se;try{if(!config.kotobee.cloudid)return void(a&&kInteractive.alert({content:o.cloudOnly,title:i.sorry?i.sorry:"Sorry"}))}catch(e){return void(a&&kInteractive.alert({content:o.cloudOnly,title:i.sorry?i.sorry:"Sorry"}))}var s={};s.ans=new Array;for(var c=0,l=0;l<oe.length;l++){var d=oe[l].getElementsByClassName("ans"),u=kInteractive.questions.f.getQClass(oe[l]),p=oe[l].getElementsByClassName("questionTxt"),f=p.length?p[0].textContent:"",h=oe[l].id,g=n.q[l];if("tf"==u||"mcq"==u||"mmcq"==u)for(var m=0;m<d.length;m++)d[m].checked&&s.ans.push({q:c,id:h,title:f,type:u,weight:g.weight,index:m,label:d[m].nextSibling.textContent||d[m].nextSibling.data});else if("na"==u)s.ans.push({q:c,id:h,title:f,type:u,weight:g.weight,label:d[0].value});else if("sa"==u)s.ans.push({q:c,id:h,title:f,type:u,weight:g.weight,label:d[0].value});else if("dd"==u)for(m=0;m<d.length;m++)s.ans.push({q:c,id:h,title:f,type:u,weight:g.weight,index:m,label:d[m].textContent,category:kInteractive.hasClass(d[m].parentNode,"dCategory")?d[m].parentNode.children[0].textContent:""});else if("ih"==u){var v=oe[l].querySelector(".ih-container"),b=[];v&&v.answers&&(b=v.answers.map((function(e){return{x:e.x,y:e.y}}))),s.ans.push({q:c,id:h,title:f,type:u,weight:g.weight,selected:b})}else if("mt"==u){var k=oe[l].getElementsByClassName("mt-container")[0];if(k&&k.mtSelection)for(var y=k.mtSelection.pairs||[],w=0;w<y.length;w++){var C=y[w];s.ans.push({q:c,id:h,title:f,type:u,weight:g.weight,left:C.left,right:C.right})}}"sp"!=u&&c++}s.id=e.id,s.title=te,n.options.reportLabel&&(s.title=n.options.reportLabel),s.fullScore=Ee,s.maxScore=n.options.totalScore,s.weightedScore=se,s.maxWeight=ae,s.score=ie,s.total=le,s.correctQuestions=ie,s.totalQuestions=le,s.rtl=n.options.rtl;var x={};if(x.recipient=n.address,n.options.reportEmail&&(x.recipient=n.options.reportEmail),n.options.emailForm){var I=e.getElementsByClassName("emailForm");if(I.length){var E=I[0].getElementsByClassName("txtfield");E.length&&(x.recipient=x.recipient?x.recipient+","+E[0].value:E[0].value)}}x.content=JSON.stringify(s),x.mode=config.kotobee.mode,x.cloudid=config.kotobee.cloudid;try{var S=angular.element(document.body).scope();void 0!==kotobee&&(x.env=config.kotobee.mode,"library"==config.kotobee.mode&&S.data.book&&(x.bid=S.data.book.id)),x.email=S.data.user.email,x.code=S.data.user.code,x.pwd=S.data.user.pwd}catch(e){}if(r&&x.recipient){var T=t.value;t.value=i.submitting?i.submitting:"Submitting ..",t.setAttribute("disabled","true");var O=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"library/report/questions";kInteractive.questions.f.sendPost(O,x,(function(e){try{var n=e.target;if(t.value=T,t.removeAttribute("disabled"),4===n.readyState&&200===n.status){if(!a)return;JSON.parse(n.responseText).success?kInteractive.alert({content:i.submitted?i.submitted:"Answers submitted!"}):kInteractive.alert({content:i.errorSubmitting?i.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(e){if(t.value=T,t.setAttribute("value",t.value),t.removeAttribute("disabled"),!a)return;kInteractive.alert({content:i.errorSubmitting?i.errorSubmitting:"An error has occurred while sending answers to the server"})}}))}if(n.options.dateRange&&n.options.dateRangeEnabled&&(x.drange=encodeURI(JSON.stringify(n.options.dateRange))),n.options.reportsubmission&&(x.reportsubmission=n.options.reportsubmission),e.clock&&(x.duration=e.clock.time),void 0!==isKotobee){if(n.options.serverReports){O=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"library/questions/add";kInteractive.questions.f.sendPost(O,x,(function(e){try{var t=e.target;if(4===t.readyState&&200===t.status){var n=JSON.parse(t.responseText);if(n.error)if("s_userAlreadySubmitted"==n.error)kInteractive.alert({content:i.errorAlreadySubmitted?i.errorAlreadySubmitted:"Answers have already been submitted previously"});else if("early"==n.error)kInteractive.alert({content:i.questionsExpired});else if("expired"==n.error)kInteractive.alert({content:i.questionsExpired});else{kotobee.popup("An error has occurred. Please contact support if you believe this is a mistake.",{title:"Error Code: "+n.error})}}}catch(e){}}))}if(config.kotobee.ltireporting&&"undefined"!=typeof launchid){x.launchid=launchid;O=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"lti/1.3/report";kInteractive.questions.f.sendPost(O,x)}ee()}}(),document[e.id]||(document[e.id]={}),document[e.id].q=[];var Ae=e.getElementsByClassName("ques");for(D=0;D<Ae.length;D++){var Le=D;pe=kInteractive.questions.f.getItemOrder(e);n.options.randomize&&(Le="slides"==n.options.displayMode&&pe?Number(pe[D]):Number(Ae[D].getAttribute("data-o"))),document[e.id].q[Le]=[];var Be=Ae[D].getElementsByClassName("ans");for(V=0;V<Be.length;V++)kInteractive.hasClass(Be[V],"txtfield")?document[e.id].q[Le][V]=Be[V].value:Be[V].type&&"checkbox"==Be[V].type.toLowerCase()||Be[V].type&&"radio"==Be[V].type.toLowerCase()?document[e.id].q[Le][V]=Be[V].checked:kInteractive.c.hasClass(Be[V].parentNode,"dCategory")?document[e.id].q[Le][V]={id:Be[V].id,category:kInteractive.getChildIndex(Be[V].parentNode)}:kInteractive.hasClass(Be[V],"ih-container")&&(document[e.id].q[D][V]=Be[V].answers||[])}setTimeout((function(){kInteractive.scorm&&kInteractive.scorm.setInteractions(ce),kInteractive.events&&kInteractive.events.add({action:"questionsSubmitted",param:te,elem:e,data:n}),kInteractive.isEditorMode()||n.options.disableAfterAttempts&&kInteractive.isKotobeeUser()&&kInteractive.questions.f.getAttempts(e,(function(t){t||(t=0),t++;var o={label:e.id+"-attempts"};if(n.options.serverReports&&kInteractive.isKotobeeUser()||kotobee.setData(Object.assign(o,{overwrite:1,data:t}),(function(){})),t>=n.options.disableAfterAttempts){kInteractive.c.addClass(e,"disabled");for(var i=e.getElementsByTagName("input"),r=0;r<i.length;r++)i[r].setAttribute("disabled","disabled")}}))}),500),n.options.hideAfterSubmit&&Oe&&kInteractive.questions.f.replaceWithError(e,{msg:Oe,className:"qSubmitted",tag:"div"})}}}}}else kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange()}},resize:function(e){var t=kInteractive.readData(e);if(t)for(var n=0;n<t.q.length;n++){var o=t.q[n];"mt"==o.type&&kInteractive.questions.mt.resize(o)}}},kInteractive.threed={preRender:function(e,t){},postRender:function(e,t,n,o){var i=e.createDocumentFragment(),r=kInteractive.readData(t);if(r){t.innerHTML="";var a=t.getAttribute("style");if(r.inter.placeholderPath){var s=void 0===isKotobee?r.inter.placeholderPath:ph.join(kInteractive.absoluteURL,r.inter.placeholderPath);a+="background-image:url('"+(s=kInteractive.cleanURL(s))+"');"}t.setAttribute("style",a);var c=document.createElement("a");r.inter.includeMsg?(c.innerHTML=kInteractive.escapeHtml(r.inter.msg),c.className="msgBtn ki-btn"):c.className="invisibleBtn ki-btn",i.appendChild(c),void 0===isKotobee&&c&&c.addEventListener("click",kInteractive.actionEvent),t.appendChild(i)}},action:function(e,t,n){var o=kInteractive.readData(e);if(o){"inPanel"==o.inter.target?kInteractive.c.addClass(e,"running"):e.innerHTML="";var i=document.createElement("div");if(i.className="loading",e.appendChild(i),"undefined"==typeof THREE){var r,a=document.getElementsByTagName("head")[0],s=a.getElementsByTagName("script");if(void 0!==isKotobee)r=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for(var c=0;c<s.length;c++)if(s[c].src.indexOf("kotobeeinteractive.js")>=0){r=s[c].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!r)return;var l=document.createElement("script");l.type="text/javascript",l.src=r,l.onload=d,l.onreadystatechange=function(){"complete"==this.readyState&&d()},a.appendChild(l)}else d()}function d(){var t,n=e;if("inPanel"==o.inter.target){var r={class:"threed",cb:function(e){var t=document.createElement("div");t.className="container",e.appendChild(t),a(t)},closed:function(){kInteractive.c.removeClass(e,"running")}};kInteractive.openFrame(r)}else a(n);function a(n){if(setTimeout((function(){if(kInteractive.scorm){var t={};t.id=kInteractive.getScormId("_3D",o.name?o.name:"Model"),t.description="Opened 3D model: "+(o.name?o.name:"No name"),t.learnerResponses="Viewed",t.type="other",t.timestamp=new Date,kInteractive.scorm.setInteractions([t])}kInteractive.events&&kInteractive.events.add({action:"3dModelViewed",param:o.name?o.name:"No name",elem:e,data:o})}),800),t&&cancelAnimationFrame(t),"fbx"!==o.type){if(!kInteractive.threed.webglAvailable)return kInteractive.threed.alert();var r;r=new THREE.WebGLRenderer({precision:"highp"});var a=n.offsetWidth,s=n.offsetHeight,c=new THREE.PerspectiveCamera(o.camera.viewAngle,a/s,o.camera.near,o.camera.far),l=new THREE.Scene;null!=o.scene.bgColor&&r.setClearColor(o.scene.bgColor,1),l.add(c),c.position.x=o.camera.x,c.position.y=o.camera.y,c.position.z=o.camera.z,r.setSize(a,s),o.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:o.scene.floorColor?o.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,l.add(floor));var d=new THREE.LoadingManager;d.onProgress=function(e,t,n){},function e(t){if(!(t>=o.objects.length)){var a=o.objects[t],s=void 0===isKotobee?a.path:ph.join(kInteractive.absoluteURL,a.path);s=kInteractive.cleanURL(s),new OBJLoader(d).load(s,(function(o){i&&i.parentNode&&i.parentNode.removeChild(i),r.domElement.parentNode||n.appendChild(r.domElement),o.position.set(a.x,a.y,a.z),o.traverse((function(n){if(n instanceof THREE.Mesh){var i=n==o.children[o.children.length-1];if(a.textPath){var r=new THREE.ImageLoader(d),s=void 0===isKotobee?a.textPath:ph.join(kInteractive.absoluteURL,a.textPath);r.load(s,(function(r){var a=new THREE.Texture;a.image=r,a.needsUpdate=!0,n.material.map=a,i&&l.add(o),e(++t)}),(function(){}),(function(e){}))}else i&&l.add(o),e(++t)}}))}),(function(e){if(e.lengthComputable)e.loaded,e.total}),(function(e){}))}}(0),new OrbitControls(c,r.domElement).target=new THREE.Vector3(0,0,0),kInteractive.threed.addLight(l,o);var u=new THREE.Clock;!function e(){try{r.render(l,c)}catch(e){return}u.getDelta(),t=requestAnimFrame(e)}()}else"inPanel"===o.inter.target?setTimeout((function(){kInteractive.threed.fbxLoader(n,o)}),500):kInteractive.threed.fbxLoader(n,o)}}},get webglAvailable(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},alert:function(){kotobee.popup(translit.get("webglNotAvailable"),{title:"WebGl",okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})},addLight:function(e,t){t.lights.forEach((function(t){if("pointLight"==t.type){var n=new THREE.PointLight(t.color);n.position.set(t.x,t.y,t.z),e.add(n)}else if("directionalLight"==t.type){var o=new THREE.DirectionalLight(t.color,t.intensity);o.position.set(t.x,t.y,t.z),e.add(o)}else if("hemisphereLight"==t.type){var i=new THREE.HemisphereLight(t.sky,t.ground,t.intensity);i.position.set(t.x,t.y,t.z),e.add(i)}else if("spotLight"==t.type){var r=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);r.position.set(t.x,t.y,t.z),e.add(r)}else if("ambientLight"==t.type){var a=new THREE.AmbientLight(t.color);e.add(a)}else if("areaLight"==t.type){var s=new THREE.RectAreaLight(t.color,t.intensity);e.add(s)}}))},fbxLoader:function(e,t){if(!kInteractive.threed.webglAvailable)return kInteractive.threed.alert();var n,o,i;"inPanel"===t.inter.target?(o=e.getBoundingClientRect().width,i=e.getBoundingClientRect().height):(o=+t.scene.width,i=+t.scene.height);var r=t.scene.bgColor,a=new THREE.Scene,s=new THREE.PerspectiveCamera(+t.camera.viewAngle,o/i,t.camera.near,+t.camera.far);s.position.setX(+t.camera.x),s.position.setY(+t.camera.y),s.position.setZ(+t.camera.z);var c=new THREE.Clock;kInteractive.threed.addLight(a,t);var l=function(){var e;return(e=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(o,i),e.shadowMap.enabled=!0,e.setClearColor(r,1),e}();e.appendChild(l.domElement);var d=new OrbitControls(s,l.domElement);d.target.set(0,0,0),d.update();var u=new FBXLoader,p=function(e){if(Array.isArray(e.objects)&&e.objects.length){var t=e.objects[0],n=void 0===isKotobee?t.path:ph.join(kInteractive.absoluteURL,t.path);return kInteractive.cleanURL(n)}return!1}(t);p&&(u.load(p,(function(e){n=new THREE.AnimationMixer(e),Array.isArray(e.animations)&&e.animations.length&&n.clipAction(e.animations[0]).play(),e.traverse((function(e){if(e.isMesh){e.castShadow=!0,e.receiveShadow=!0;var n=document.getElementsByClassName(t.classname)[0];if(n)[].slice.call(n.getElementsByClassName("loading")).forEach((function(e){kInteractive.c.removeClass(e,"loading")}))}})),a.add(e)})),function e(){requestAnimationFrame(e);var t=c.getDelta();n&&n.update(t),l.render(a,s)}())}},kInteractive.video={preRender:function(e,t){},postRender:function(e,t,n){var o=e.createDocumentFragment(),i=kInteractive.readData(t);if(i){var r="";if(i.splash&&(r=void 0===isKotobee?i.splash:ph.join(kInteractive.absoluteURL,i.splash)),r){t.style.backgroundImage=null;var a=t.style.cssText;r=kInteractive.cleanURL(r),t.setAttribute("style","background-image:url('"+r+"');"+a)}t.setAttribute("id","ki-video-"+n),t.innerHTML="";var s=document.createElement("div");s.setAttribute("id","ki-video-"+n+"-container"),s.className="container";var c=document.createElement("div");i.style&&kInteractive.c.addClass(c,i.style);var l=document.createElement("a");l.className="playBtn ki-btn",l.appendChild(document.createElement("span")),void 0===isKotobee&&l.addEventListener("click",kInteractive.actionEvent),o.appendChild(l),o.appendChild(s),c.appendChild(o),t.appendChild(c);var d=function(){for(var e=[],t=document.getElementsByClassName("kInteractive"),n=0;n<t.length;n++){if(-1!==t[n].className.indexOf("video"))if(kInteractive.readData(t[n]).autoplay){e.push(t[n]);break}}return e.length?e[0]:null}();i.autoplay&&d&&t===d&&kInteractive.action(d)}},action:function(e){var t=kInteractive.readData(e);if(t){if(t.popup&&"kInteractiveFrame"!=e.parentNode.id){var n={pos:"side",aspectRatio:"16:9",cb:function(t){var n=document.createElement("div");n.innerHTML=e.outerHTML;var o=n.children[0];o.style.width="100%",o.style.height="100%",o.style.margin="0",o.style.position="absolute",o.style.left=0,o.style.top=0,kInteractive.c.removeClass(o,"kbHidden"),t.appendChild(o);var i=e.id.split("ki-video-")[1];kInteractive.postRender(document,o,i),setTimeout((function(){kInteractive.action(o)}),100)}};return kInteractive.openFrame(n)}var o=e.getAttribute("id")+"-container",i=e.getElementsByClassName("playBtn")[0];if(!(i.className.indexOf("loading")>=0)){if(kInteractive.stopCurrentMedia(),i.className="playBtn ki-btn loading",t.autoplay&&(i.className="playBtn ki-btn hide"),kInteractive.scorm){var r={};r.id=kInteractive.getScormId(e.getAttribute("id"),t.src),r.description="Played video: "+t.src,r.type="other",r.learnerResponses="Played",r.objective=t.options?t.options.objective:null,r.timestamp=new Date,kInteractive.scorm.setInteractions([r])}if(kInteractive.events&&kInteractive.events.add({action:"videoPlayed",param:t.src,elem:e,data:t}),"file"==t.type){u(void 0===isKotobee?t.video:ph.join(kInteractive.absoluteURL,t.video))}else{var a,s=new URL(t.src);if(s.origin.includes("youtube.com")||s.origin.includes("youtu.be")){if(!(a=s.origin.includes("youtube.com")?s.searchParams.get("v"):s.pathname.split("/")[1]))return;if(window&&window.iBooks)return setTimeout((function(){i.className="playBtn ki-btn"}),1500),void(window.location.href=t.src);var c={videoId:a,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+t.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){i.className="playBtn ki-btn hide",new YT.Player(o,c)}}else"ready"==kInteractive.youTubeStatus&&(i.className="playBtn ki-btn hide",new YT.Player(o,c));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var l=document.createElement("script");l.src="https://www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(l,d),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){i.className="playBtn ki-btn hide",new YT.Player(o,c)}}}else u(t.src)}kInteractive.currentVideo=e,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}}function u(n){var o,r=document.createElement("video");r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("src",kInteractive.cleanURL(n)),r.setAttribute("autoplay","true"),r.setAttribute("disablePictureInPicture","true"),r.setAttribute("data-tap-disabled","false"),0!=n.indexOf("http://")&&0!=n.indexOf("https://")||(o=!0),o&&r.setAttribute("crossorigin","anonymous");var a=!1;try{a=navigator.userAgent.toLowerCase().indexOf("android")>-1}catch(e){}a||r.setAttribute("type","video/mp4"),r.setAttribute("webkit-playsinline","true"),r.setAttribute("controls","true");var s="";t.splash&&(s=void 0===isKotobee?t.splash:ph.join(kInteractive.absoluteURL,t.splash)),s&&r.setAttribute("poster",kInteractive.cleanURL(s)),r.className="ki-noHighlight",t.hideDownloadBtn&&(r.className+=" hideDownloadBtn",r.setAttribute("controlsList","nodownload")),r.innerHTML="Your browser doesn't support HTML5 video.",o&&(r.crossOrigin="anonymous"),r.oncanplay=function(){kInteractive.currentVideo==e&&(i.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+n}))},r.addEventListener("error",(function(e){e.target.error&&kInteractive.stopCurrentMedia()})),r.addEventListener("webkitfullscreenchange",(function(e){var t=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=t}));var c=e.getElementsByClassName("container")[0];c.setAttribute("data-tap-disabled","true"),c.appendChild(r)}},resize:function(e){var t=kInteractive.readData(e);t&&(kInteractive.checkResponsiveFloat(t,e),t.maintainRatio&&"px"==t.widthUnit&&t.height&&t.width&&"absolute"!=e.style.position&&(e.style.height=e.offsetWidth*(t.height/t.width)+"px"))}},kInteractive.widget={preRender:function(e,t){},postRender:function(e,t,n,o){o||(o={});var i=e.createDocumentFragment(),r=kInteractive.readData(t);if(r){var a=r.name,s=(r.src,r.width),c=r.height;if("page"==r.mode){if(t.children.length)return;var l=document.createElement("div");l.className="cover",i.appendChild(l),r.interaction&&(l.style.pointerEvents="none");var d=document.createElement("div");d.className="iframeContainer";var u,p=document.createElement("iframe");if(p.setAttribute("nwdisable","true"),p.setAttribute("nwfaketop","true"),void 0!==desktop&&desktop&&(u=!0),void 0!==isReaderApp&&isReaderApp&&(u=!0),u&&p.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-top-navigation"),p.setAttribute("width",t.style.width?t.style.width:s+r.widthUnit),p.setAttribute("height",t.style.height?t.style.height:c+"px"),p.src=kInteractive.getWidgetUrl(r,o),void 0!==kotobee&&-1!==p.src.indexOf(".amazonaws.com")){var f=document.createElement("a");f.href=p.src,p.addEventListener("load",(function(e){e.target.contentWindow.postMessage({user:{name:kotobee.user.name?kotobee.user.name:"",email:kotobee.user.email?kotobee.user.email:"",loggedIn:kotobee.user.loggedIn},book:kotobee.book.meta.dc.identifier,chapter:kotobee.currentChapter.url.split("EPUB/xhtml/")[1]},f.protocol+"//"+f.hostname)}))}d.appendChild(p),i.appendChild(d);var h=t.style.width,g=t.style.height;h.indexOf("px")>=0&&(r.widthUnit="px"),h.indexOf("%")>=0&&(r.widthUnit="%");try{r.widthUnit?r.width=Number(h.split(r.widthUnit)[0]):r.width=Number(h)}catch(e){r.width=Number(h)}try{r.height=Number(g.split("px")[0])}catch(e){r.height=Number(g)}kInteractive.writeData(t,r)}else{if(!t.children.length&&!t.innerHTML.trim()){var m=document.createElement("img");m.src=kInteractive.cleanURL(kInteractive.getWidgetHome(r,o)+"/"+a+"/Icon.png?c="+Math.round(9999*Math.random())),m.className="wdgtIcon",i.appendChild(m)}void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent)}t.appendChild(i)}},action:function(e){var t=kInteractive.readData(e);if(t){var n,o=kInteractive.getWidgetUrl(t),i=document.createElement("iframe");i.setAttribute("nwdisable","true"),i.setAttribute("nwfaketop","true"),void 0!==desktop&&desktop&&(n=!0),void 0!==isReaderApp&&isReaderApp&&(n=!0),n&&i.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-top-navigation"),t.cb=function(e){i.src=o,e.appendChild(i)},t.cb1="yes",t.closed=function(){},t.responsive&&(t.width=t.height=null),kInteractive.openFrame(t),kInteractive.tinCan({verb:"opened",activity:"Widget: "+t.name}),setTimeout((function(){if(kInteractive.scorm){var n={};n.id=kInteractive.getScormId("widget",t.name),n.description="Opened popup widget: "+t.name,n.learnerResponses="Opened",n.type="other",n.timestamp=new Date,kInteractive.scorm.setInteractions([n])}kInteractive.events&&kInteractive.events.add({action:"popupWidgetOpened",param:t.name,elem:e,data:t})}),800)}},resize:function(e){var t=kInteractive.readData(e);if(t&&"page"==t.mode&&"px"==t.widthUnit){var n=t.width,o=t.height,i=e.parentNode;if(i)if(n>i.offsetWidth){var r=i.offsetWidth/n,a=e.children.length-1;e.children[a].style.transform=e.children[a].style.webkitTransform=e.children[a].style.mozTransform="scale("+r+")",e.children[a].style.transformOrigin=e.children[a].style.webkitTransformOrigin=e.children[a].style.mozTransformOrigin="0 0",e.style.maxWidth=e.style.width,e.style.height=Math.round(o*r)+"px"}else{for(a=0;a<e.children.length;a++)e.children[a].style.transform=e.children[a].style.webkitTransform=e.children[a].style.mozTransform=e.children[a].style.transformOrigin=e.children[a].style.webkitTransformOrigin=e.children[a].style.mozTransformOrigin=null;e.style.maxWidth=null,e.style.height=o+"px"}}}},kInteractive.questions.f={showExp:function(e,t,n,o){var i;(o||(o={}),n.exp)&&(t.getElementsByClassName("explanation").length||(o.expInPopup?((i=document.createElement("a")).href="",i.className="explanation explanationBtn ki-noHighlight",i.innerHTML=(e.explanation?e.explanation:"Explanation")+" ..",i.addEventListener("click",(function(e){e.preventDefault(),kInteractive.alert({content:n.exp})})),kInteractive.appendAfterDelay(t,i)):((i=document.createElement("p")).className="explanation",i.innerHTML=n.exp,kInteractive.appendAfterDelay(t,i))));if((n.ref||n.reftype)&&!t.getElementsByClassName("reference").length){var r=document.createElement("a");if(r.className="reference",r.innerHTML=e.learnMore?e.learnMore:"Learn more",n.reftype&&"website"!=n.reftype){if("booklocation"==n.reftype&&n.refchapter){var a=ph.relative(bookPath,kInteractive.absoluteURL),s=ph.relative(a,n.refchapter.ahref);n.refanchor&&(s+="#"+n.refanchor),r.setAttribute("href",s),r.setAttribute("onclick","return false;"),kInteractive.appendAfterDelay(t,r)}}else r.setAttribute("href",kInteractive.escapeHtml(n.ref)),r.setAttribute("target","_blank"),r.setAttribute("onclick","return false;"),kInteractive.appendAfterDelay(t,r)}if(n.c&&n.c.length){for(var c=t.getElementsByClassName("answer"),l=t.getElementsByClassName("explanation"),d=l.length;d--;)l[d].parentNode.classList.contains("answer")&&l[d].parentNode.removeChild(l[d]);for(d=0;d<n.c.length;d++)o.expForSelection?c[d].getElementsByTagName("input")[0].checked&&kInteractive.questions.f.showExp(e,c[d],n.c[d],o):kInteractive.questions.f.showExp(e,c[d],n.c[d],o)}},getQClass:function(e){var t=e.className;return-1!=t.indexOf("mmcq")?"mmcq":-1!=t.indexOf("mcq")?"mcq":-1!=t.indexOf("tf")?"tf":-1!=t.indexOf("sa")?"sa":-1!=t.indexOf("na")?"na":-1!=t.indexOf("dd")?"dd":-1!=t.indexOf("mt")?"mt":void 0},getItemOrder:function(e){var t=e.getAttribute("data-o");return t&&(e.originArray=t.split(",")),e.originArray},createQElem:function(e,t){t||(t={});var n=t.index,o=t.elem,i=(t.rendered,this.getQId(o)),r=kInteractive.questions.f.getItemOrder(o),a=e.q[n];e.options.randomize&&r&&"slides"==e.options.displayMode&&(a=e.q[o.originArray[n]]);var s=document.createElement("div");s.className="ques",a.id&&(s.id=a.id),null!=a.origin&&s.setAttribute("data-o",a.origin),a.q||(a.q="");"undefined"!=typeof config&&config.v;var c=e.options.numbering;"sp"==a.type&&(c=!1);var l="";c&&(l="<span class='no'>"+(t.questionNo?t.questionNo:n)+"</span>"),a.q=a.q.replace(/<html.*<body>([\s\S]*?)<\/body><\/html>/g,"$1");var d="";if(e.options.questionTts){var u=document.createElement("button");u.className="btn ki-btn ki-questions questions-tts ki-noHighlight",u.type="button",u.innerHTML="&#9654;",u.setAttribute("data-text",a.q),d=u.outerHTML}try{s.innerHTML="<div class='questionTxt'>"+d+"<strong>"+l+"</strong> <span class='inner'> "+a.q+"</span></div>"}catch(e){s.innerHTML="<div class='questionTxt'>"+d+"<strong>"+l+"</strong> <span class='inner'>"+kInteractive.escapeHtml(" "+a.q)+"</span></div>"}kInteractive.c.hasClass(o,"parsed")&&kInteractive.c.addClass(s.children[0].getElementsByClassName("inner")[0],"parsed"),kInteractive.questions.f.addMedia(a,s,t),s.classList.add(a.type);var p={qElem:s,qData:a,qsData:e,k:i,i:n,elem:o,options:t};"sp"==a.type?kInteractive.questions.sp.create(p):"sa"==a.type?kInteractive.questions.sa.create(p):"na"==a.type?kInteractive.questions.na.create(p):"mcq"==a.type||"mmcq"==a.type?kInteractive.questions.mcq.create(p):"tf"==a.type?kInteractive.questions.tf.create(p):"dd"==a.type?kInteractive.questions.dd.create(p):"ih"==a.type?kInteractive.questions.ih.create(p):"mt"==a.type&&kInteractive.questions.mt.create(p);var f=document.createElement("p");return f.className="separator",s.appendChild(f),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[n]&&kInteractive.questions.f.showExp(e.userDict,s,a,e.options),s},addMedia:function(e,t,n){var o=n.rendered;if(e.path){var i,r=document.createElement("img");i=o?void 0===isKotobee?e.path:ph.join(kInteractive.absoluteURL,e.path):e.path,r.src=kInteractive.cleanURL(i),r.className="qMedia",t.appendChild(r)}if(e.audiopath){var a,s=document.createElement("audio");a=o?void 0===isKotobee?e.audiopath:ph.join(kInteractive.absoluteURL,e.audiopath):e.audiopath,s.setAttribute("src",kInteractive.cleanURL(a)),s.controls=!0,s.autoplay=!1,s.className="qMedia",t.appendChild(s)}},getQId:function(e){return Number(e.id.replace("ki-qs-",""))},createSubmitBtn:function(e,t){var n=this.getQId(t),o=document.createElement("input"),i="ki-"+n+"-btn";return o.type="submit",o.value=e.submit?e.submit:"Submit Answers",o.id=i,o.className="btn ki-btn questions-submit",void 0===isKotobee&&o.addEventListener("click",kInteractive.actionEvent),o},createClearBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.clear?e.clear:"Clear Answers",t.className="btn ki-btn ki-questions questions-clear",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createAddToNotebookBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.notebook?e.notebook:"Save to Notebook",t.className="btn ki-btn ki-questions questions-notebook",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPreserveBtn:function(e,t,n){var o=this.getQId(t),i=document.createElement("div");i.style.marginBottom="10px";var r=document.createElement("input");function a(e){return e.slice(0,1).toUpperCase()+e.slice(1)}r.type="checkbox",r.name="preserveAnswers",r.className="ki-btn ki-questions questions-preserve",r.id="ki-"+o+"-preserveAnswersBtn",n&&(Object.keys(n).length>0&&Object.keys(n).forEach((function(e){"placement"==e?r.dataset["design"+a(e)]=n[e]:Object.entries(n[e]).forEach((function(t){r.dataset["design"+a(e)+a(t[0])]=t[1]}))})),void 0!==isKotobee&&t.addEventListener("change",(function(e){e.target.matches("input.questions-preserve")&&kInteractive.actionEvent(e)}))),document[item.id]&&(r.checked=document[item.id].preserve),i.appendChild(r);var s=document.createElement("label");return s.htmlFor=r.id,s.innerHTML=" "+(e.preserve?e.preserve:"Preserve submitted answers"),s.className="ki-noHighlight",i.appendChild(s),void 0===isKotobee&&r.addEventListener("change",kInteractive.actionEvent),i},createNextBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.next?e.next:"Next",t.className="btn ki-btn ki-questions questions-next",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPrevBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.prev?e.prev:"Previous",t.className="btn ki-btn ki-questions questions-prev",void 0===isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createSeparator:function(){document.createElement("p").className="separator"},createEmailForm:function(e){var t=document.createElement("div");return t.setAttribute("class","emailForm"),function(e,n,o){var i=document.createElement("div");i.className="address",i.innerHTML="<p><strong>"+e+"</strong><em>"+n+"</em></p>";var r=document.createElement("input");r.name=o,r.type="text",r.className="txtfield",i.appendChild(r);var a=document.createElement("p");a.className="separator",i.appendChild(a),t.appendChild(i)}(e.recipientEmail?e.recipientEmail:"Recipient email",e.separateEmails?e.separateEmails:"Separate multiple emails with commas","recipientEmail"),t},showNavBtns:function(e,t,n){var o;n||(n={}),(o=n.isFrag?t.lastElementChild:t.getElementsByClassName("btnContainer")[0]).innerHTML="";var i=kInteractive.questions.f.createPrevBtn(n.userDict);o.appendChild(i),e<=0&&i.classList.add("disabled");var r=kInteractive.questions.f.createNextBtn(n.userDict);if(o.appendChild(r),e==n.qsData.q.length-1){r.classList.add("disabled");var a=kInteractive.questions.f.createSubmitBtn(n.userDict,t);if(a.classList.add("shift"),o.appendChild(a),n.qsData.options.emailForm){var s=kInteractive.questions.f.createEmailForm(n.userDict);s&&o.insertBefore(s,o.firstChild)}}},assess:function(e,t,n){for(var o={ddInteractionOb:[],mtInteractionOb:[]},i=e.getElementsByClassName("ans"),r=i.length>0,a=0;a<i.length;a++)if(i[a].getAttribute("id").indexOf("ki-tf-")>=0)0==a&&t.a?o.correctResponses=t.choice1:1!=a||t.a||(o.correctResponses=t.choice2),i[a].checked?(o.learnerResponses=a?t.choice2:t.choice1,0!=a||t.a?1==a&&t.a&&(r=!1):r=!1):0==a&&t.a?r=!1:1!=a||t.a||(r=!1),n.options&&n.options.highlightCorrect&&(0==a&&t.a||1==a&&!t.a)&&kInteractive.c.addClass(i[a].parentNode,"correct");else if(i[a].getAttribute("id").indexOf("ki-na-")>=0){var s=i[a].value,c=null==s?"":String(s).trim(),l=""===c?NaN:Number(c);r=!1;var d="";if(t.k&&t.k.length>0)for(var u=0;u<t.k.length;u++){if(null!=(g=t.k[u]?t.k[u].t:null)&&""!==String(g).trim()){var p=Number(String(g).trim());isNaN(p)||(d&&(d+="+"),d+=String(p),isNaN(l)||l!==p||(r=!0))}}o.correctResponses=d,o.learnerResponses=c}else if(i[a].getAttribute("id").indexOf("ki-sa-")>=0){var f=i[a].value.toLowerCase();f&&(f=f.trim()),r=!0;var h="";for(u=0;u<t.k.length;u++){var g;if(!(g=t.k[u].t)){r=!1;break}h&&(h+="+"),h+=g=g.toLowerCase();for(var m=g.split(","),v=!1,b=0;b<m.length;b++)if(f.indexOf(m[b].trim())>=0){v=!0;break}if(!v){r=!1;break}}o.correctResponses=h,o.learnerResponses=f}else if(i[a].getAttribute("id").indexOf("ki-dd-")>=0){kInteractive.c.removeClass(i[a],"incorrect");for(var k,y=i[a].id.split("-")[4],w=0,C=0;C<t.k.length;C++){if(y<(w+=t.k[C].category.answers.length)){k=C;break}}var x=e.getElementsByClassName("dCategory")[k];if((V={}).correct=i[a].innerText+" -> "+x.children[0].innerText,kInteractive.c.hasClass(i[a].parentNode,"ki-dd-answers"))kInteractive.c.addClass(i[a],"incorrect"),r=!1,V.learner=i[a].innerText+" unassigned";else{var I=i[a].parentNode.parentNode,E=I.children[0].innerText,S=kInteractive.getChildIndex(I);V.learner=i[a].innerText+" -> "+E,S!=k&&n.options&&n.options.highlightCorrect&&(r=!1,kInteractive.c.addClass(i[a],"incorrect"))}o.ddInteractionOb.push(V)}else if(i[a].id&&i[a].id.indexOf("ki-ih-")>=0){var T=i[a].answers||[],O=[],N=[];if(t.hotspots)for(var A=0;A<t.hotspots.length;A++)t.hotspots[A].correct&&O.push(t.hotspots[A].id);for(var L=0;L<T.length;L++)for(A=0;A<t.hotspots.length;A++)if(kInteractive.questions.ih.pointInPolygon(T[L],t.hotspots[A].points)){N.push(t.hotspots[A].id);break}N.sort(),O.sort(),r=N.join(",")===O.join(","),o.correctResponses=O.join(", "),o.learnerResponses=N.join(", ")}else if(i[a].getAttribute("id").indexOf("ki-mt-")>=0){kInteractive.c.removeClass(i[a],"incorrect");var B=i[a].closest(".mt-container"),P=B?B.mtSelection:{pairs:[]},M=B.mtSelection&&P.pairs||[],R={};M.length<t.left.length&&(r=!1);for(var D=0;D<t.left.length;D++)R[t.left[D].txt]=t.right[D].txt;for(var $=0;$<M.length;$++){var V,H=M[$];if((V={}).correct=H.left+" -> "+R[H.left],V.learner=H.left+" -> "+H.right,R[H.left]!==H.right&&(r=!1,n.options&&n.options.highlightCorrect)){document.getElementById(H.leftId);var F=document.getElementById(H.rightId);F&&kInteractive.c.addClass(F,"incorrect")}o.mtInteractionOb.push(V)}}else t.c[a].a&&(o.correctResponses=t.c[a].t),i[a].checked&&(o.learnerResponses=t.c[a].t),(i[a].checked&&!t.c[a].a||!i[a].checked&&t.c[a].a)&&(r=!1),n.options&&n.options.highlightCorrect&&t.c[a].a&&kInteractive.c.addClass(i[a].parentNode,"correct");return o.correct=r,o},checkTimeValidity:function(e,t){var n=kInteractive.phpDateToJS(e),o={};function i(e){var t=e.split(":");return 1==t[0].length&&(t[0]="0"+t[0]),1==t[1].length&&(t[1]="0"+t[1]),t[0]+":"+t[1]}if(!t.fromDate){var r=function(e){return String(e+100).substr(1)},a=r(n.getHours())+":"+r(n.getMinutes());return a>i(t.toTime)?o.expired=!0:a<i(t.fromTime)?o.early=!0:o.valid=!0,o}var s=t.fromDate.split("-"),c=t.fromTime.split(":"),l=new Date(s[2],s[1]-1,s[0],c[0],c[1]),d=t.toDate.split("-"),u=t.toTime.split(":");return n>new Date(d[2],d[1]-1,d[0],u[0],u[1])?o.expired=!0:n<l?o.early=!0:o.valid=!0,o},sendPost:function(e,t,n){t||(t={});var o=new XMLHttpRequest;n&&(o.onreadystatechange=n),o.open("POST",e),o.setRequestHeader("Content-type","application/x-www-form-urlencoded");var i="a=a";for(var r in void 0!==uuid&&(i+="&fingerprint="+uuid),t){var a=t[r];null!=a&&("object"!=_typeof(a)&&("string"==typeof a&&(a=encodeURIComponent(a)),"boolean"==typeof a&&(a=a?1:0),i+="&"+r+"="+a))}o.send(i)},replaceWithError:function(e,t){t||(t={}),this.stopClock(e);var n=e.getElementsByClassName("scoreHistory")[0],o=e.getElementsByTagName("h4")[0],i=kInteractive.readData(e);e.innerHTML="";var r=document.createElement("div");i.style&&kInteractive.c.addClass(r,i.style),e.appendChild(r),o&&!i.options.hideTitleOnError&&r.appendChild(o);var a=document.createElement("div"),s=t.tag;s||(s="p"),a.innerHTML="<"+s+" class='"+t.className+"'>"+t.msg+"</"+s+">",r.appendChild(a.children[0]),n&&r.appendChild(n)},phpDateToJs:function(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])},stopClock:function(e){e&&e.clock&&(e.clock.pause(),e.clock.destroy(),e.clock=null)},getAttempts:function(e,t){if(kInteractive.readData(e).options.serverReports&&kInteractive.isKotobeeUser()){var n=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"admin/library/questions/get",o=angular.element(document.body).scope(),i={env:"library"==config.kotobee.mode?"library":"book",cloudid:config.kotobee.cloudid,email:o.data.user.email,code:o.data.user.code,pwd:o.data.user.pwd,qsxid:e.id,mode:"submissions"};"library"==config.kotobee.mode&&o.data.book&&(i.bid=o.data.book.id),kInteractive.questions.f.sendPost(n,i,(function(e){var n=e.target;if(4===n.readyState&&200===n.status){var o=0;try{var i=JSON.parse(n.responseText);o=Number(i.scores.length)}catch(e){}t(o)}}))}else kotobee.getData({label:e.id+"-attempts"},(function(e){if(!e||!e.length)return t(0);t(Number(e[0].data))}))},clearSavedAnswers:function(){for(obj in document)0==obj.indexOf("ki-qs-")&&delete document[obj]},manualDrag:{isDown:null,startX:null,startY:null,currentX:null,currentY:null,walkX:null,walkY:null,margin:0,currentAnswerObj:{},answersContainers:[],store:null,dragStart:function(e){e.stopPropagation(),this.isDown=!0;var t=(e=e||window.event).target;this.getContainers(t);var n=t.getElementsByTagName("span")[0];n&&(n.style.pointerEvents="none"),t.style.zIndex="999",this.startX=Math.round(e.touches[0].clientX)-this.margin,this.startY=Math.round(e.touches[0].clientY)-this.margin,this.dragEnd(t)},dragEnd:function(e){e.addEventListener("touchend",(function(){function t(){return kInteractive.questions.f.manualDrag}t().isDown=!1,e.style.left="initial",e.style.top="initial",e.style.zIndex="initial",null!==t().store&&t().store.container.append(t().store.answer)}))},dragMove:function(e){var t=(e=e||window.event).target;this.currentAnswerObj=t.getBoundingClientRect(),this.isDown&&(this.currentX=Math.round(e.touches[0].clientX)-this.margin,this.currentY=Math.round(e.touches[0].clientY)-this.margin,this.walkX=this.currentX-this.startX,this.walkY=this.currentY-this.startY,t.style.left=this.walkX+"px",t.style.top=this.walkY+"px",this.detectBoundaries(t))},detectBoundaries:function(e){function t(){return kInteractive.questions.f.manualDrag}this.answersContainers.forEach((function(n){if(n){var o=n.getBoundingClientRect(),i={w:o.width,h:o.height,x:o.x,y:o.y},r={w:t().currentAnswerObj.width,h:t().currentAnswerObj.height,x:t().currentAnswerObj.x,y:t().currentAnswerObj.y};kInteractive.questions.f.manualDrag.hasIntersection(r,i)&&(t().store={container:n,answer:e})}}))},hasIntersection:function(e,t){return!(e.y+0>t.y+t.h)&&(!(e.x+e.w+0<t.x)&&(!(e.y+e.h+0<t.y)&&!(e.x+0>t.x+t.w)))},getContainers:function(e){function t(){return kInteractive.questions.f.manualDrag}var n=e.parentElement,o=n?n.className:"";if(o.includes("ki-dd-answers"))i(n.parentElement.getElementsByClassName("categoryContainer")[0]);else if(o.includes("dCategory")){i(n.parentElement)}function i(e){if(n&&e){var o=e.getElementsByClassName("dCategory");o.length&&(t().answersContainers=Array.from(o))}else t().answersContainers=[]}},isIOS:function(){return void 0!==isKotobee&&void 0!==ios&&ios}}},kInteractive.questions.dd={create:function(e){var t=e.qElem,n=e.qData,o=(e.qsData,e.k),i=e.i,r=(e.elem,e.options),a=document.createElement("div");a.className="categoryContainer";for(var s=[],c=0;c<n.k.length;c++){var l=n.k[c],d=c,u=document.createElement("div");u.className="dCategory ki-noHighlight ki-dd-category-"+d;var p=document.createElement("div");p.innerHTML=l.category.name,p.className="qTitle",u.appendChild(p);var f=document.createElement("div");f.setAttribute("ondragover","kInteractive.questions.dd.allowDrop(event)"),f.setAttribute("ondrop","kInteractive.questions.dd.drop(event)"),f.setAttribute("showplaceholder","true"),f.className="ki-dragPane",u.appendChild(f);for(var h=0;h<l.category.answers.length;h++)s.push(l.category.answers[h]);a.appendChild(u)}t.appendChild(a);var g=document.createElement("div");g.className="ki-dd-clearfix",t.appendChild(g);var m=document.createElement("div");m.setAttribute("ondragover","kInteractive.questions.dd.allowDrop(event)"),m.setAttribute("ondrop","kInteractive.questions.dd.drop(event)"),m.className="ki-dd-answers ki-noHighlight";var v=[];for(c=0;c<s.length;c++){d=c;var b=s[c],k=document.createElement("div"),y="ki-dd-"+o+"-"+i+"-"+d;k.id=y,k.innerHTML="<span></span>",k.children[0].innerText=b.t,kInteractive.questions.f.addMedia(b,k,r),k.className="ki-draggable ans ki-noHighlight",k.draggable=!0,k.setAttribute("ondragover","kInteractive.questions.dd.allowDrop(event)"),k.setAttribute("ondragstart","kInteractive.drag(event);"),k.setAttribute("ondragend","kInteractive.questions.dd.removePlaceholder(event)"),k.setAttribute("onmousedown","event.stopPropagation();"),k.setAttribute("ontouchstart","event.stopPropagation();"),kInteractive.questions.f.manualDrag.isIOS()&&(k.setAttribute("ontouchstart","kInteractive.questions.f.manualDrag.dragStart(event);"),k.setAttribute("ontouchmove","kInteractive.questions.f.manualDrag.dragMove(event);"),document.addEventListener("touchend",(function(){kInteractive.questions.f.manualDrag.isDown=!1}))),void 0===isKotobee&&k.addEventListener("dragend",kInteractive.actionEvent),v.push(k)}kInteractive.shuffleArray(v);for(c=0;c<v.length;c++)m.appendChild(v[c]);return t.appendChild(m),t},removePlaceholder:function(e){var t=e.target,n=kInteractive.getParentInteractiveElem(t).getElementsByClassName("ki-dd-placeholder")[0];n&&n.parentNode.removeChild(n)},drop:function(e){var t=e.target,n=e.view.dragged;if(kInteractive.getParentInteractiveElem(t,"ques")==kInteractive.getParentInteractiveElem(n,"ques")&&("span"==t.nodeName.toLowerCase()&&(t=t.parentNode),e.preventDefault&&e.preventDefault(),t.hasAttribute("ondragover"))){for(;!kInteractive.hasClass(t,"ki-dragPane")&&!kInteractive.hasClass(t,"ki-dd-answers")&&!kInteractive.hasClass(t,"kInteractive");)t=t.parentNode;if(!kInteractive.hasClass(t,"kInteractive")){var o=this.getClosestElem(t,e);o?t.insertBefore(n,o):t.appendChild(n)}}},getClosestElem:function(e,t){for(var n=t.clientY,o=Array.prototype.slice.call(e.children),i=0;i<o.length;i++){var r=o[i].getBoundingClientRect();if(n<r.top+r.height/2)return o[i]}},allowDrop:function(e){var t=e.target,n=kInteractive.getParentInteractiveElem(e.target);if("true"==t.getAttribute("showplaceholder")){var o=n.getElementsByClassName("ki-dd-placeholder")[0];o||((o=document.createElement("div")).className="ki-dd-placeholder",t.appendChild(o));var i={target:t,clientY:e.clientY,view:{dragged:o}};this.drop(i)}e.preventDefault()}},kInteractive.questions.ih={create:function(e){var t=e.qElem,n=e.qData,o=e.qsData,i=e.k,r=e.i,a=document.createElement("a");if(a.className="ih-container ki-a ans",a.id="ki-ih-"+i+"-"+r,a.dataset.qid=n.id,a.style.position="relative",a.style.display="inline-block",n.ihImg&&n.ihImg.path){var s=document.createElement("img");s.src=n.ihImg.path,s.className="ih-image",s.style.display="block",s.style.maxWidth="100%",a.appendChild(s),s.onload=function(){a.imgW=s.naturalWidth,a.imgH=s.naturalHeight,n.hotspots&&!n._normalized&&(n.hotspots=n.hotspots.map((function(e){return _objectSpread(_objectSpread({},e),{},{points:e.points.map((function(e){return{x:e.x/a.imgW*100,y:e.y/a.imgH*100}}))})})),n._normalized=!0)}}var c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.classList.add("ih-overlay"),c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.width="100%",c.style.height="100%",c.style.pointerEvents="auto",a.appendChild(c),t.appendChild(a),void 0===isKotobee&&a.addEventListener("click",(function(e){e.preventDefault(),kInteractive.actionEvent(e)}));var l=document.createElement("a"),d=o.userDict;return d||(d={}),l.innerText=d.resetSelection?d.resetSelection:"Reset selection",l.className="ih-reset-btn btn ki-noHighlight",t.appendChild(l),t},markHotspot:function(e,t){e&&e.setAttribute("fill",t?"rgba(0,255,0,0.4)":"rgba(255,0,0,0.4)")},pointInPolygon:function(e,t){for(var n=e.x,o=e.y,i=!1,r=0,a=t.length-1;r<t.length;a=r++){var s=t[r].x,c=t[r].y,l=t[a].x,d=t[a].y;c>o!=d>o&&n<(l-s)*(o-c)/(d-c)+s&&(i=!i)}return i}},kInteractive.questions.mcq={create:function(e){var t=e.qElem,n=e.qData,o=e.qsData,i=e.k,r=e.i,a=e.elem,s=e.options,c=n.c;if(o.options.randomizeAns){for(var l=c.length-1;l>0;l--){var d=Math.floor(Math.random()*(l+1)),u=[c[d],c[l]];c[l]=u[0],c[d]=u[1]}kInteractive.writeData(a,o)}o.options.inlineChoices&&kInteractive.c.addClass(t,"qInlineChoices"),o.options.toggleChoices&&kInteractive.c.addClass(t,"qToggleChoices");for(var p=0;p<c.length;p++){var f="ki-mcq-"+i+"-"+r+"-"+p,h=document.createElement("input");h.id=f,"mmcq"==n.type?(h.name="name",h.type="checkbox"):(h.name="mcq-"+i+"-"+r,h.type="radio"),h.className="ki-inputbox ans",void 0===isKotobee&&h.addEventListener("click",kInteractive.actionEvent);var g=document.createElement("label");g.htmlFor=f,g.innerHTML=" "+kInteractive.escapeHtml(c[p].t),g.className="ki-noHighlight",kInteractive.questions.f.addMedia(c[p],g,s),kInteractive.c.hasClass(a,"parsed")&&kInteractive.c.addClass(g,"parsed");var m=document.createElement("div");m.className="answer",document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[r]&&(h.checked=document[item.id].q[r][p],o.options&&o.options.highlightCorrect&&n.c[p].a&&kInteractive.c.addClass(m,"correct")),m.appendChild(h),m.appendChild(g),t.appendChild(m)}return t}},kInteractive.questions.mt={create:function(e){var t=e.qElem,n=e.qData,o=e.qsData,i=e.k,r=e.i,a=document.createElement("div");a.className="mt-container qMatching",a.id="mt-"+i+"-"+r,a.mtSelection={first:null,pairs:[]},t.mtSelection=a.mtSelection,t.classList.add("question"),t.classList.add("ki-noHighlight");var s=kInteractive.shuffleArray(n.left.slice()),c=kInteractive.shuffleArray(n.right);window.innerWidth<720&&t.classList.add("isMobile");var l=document.createElement("div");l.className="mt-desktop";var d=document.createElement("div");d.className="mt-left",s.forEach((function(e,t){var n="ki-mt-left-"+i+"-"+r+"-"+t,a=document.createElement("a");a.className="mt-left-item ki-a",a.id=n,a.textContent=e.txt,a.href="",a.setAttribute("data-ki-action","action"),kInteractive.questions.f.addMedia(e,a,o.options),void 0===isKotobee&&a.addEventListener("click",(function(e){e.preventDefault(),kInteractive.actionEvent(e)})),d.appendChild(a)}));var u=document.createElement("div");u.className="mt-right",c.forEach((function(e,t){var n="ki-mt-right-"+i+"-"+r+"-"+t,a=document.createElement("a");a.className="mt-right-item ki-a ans",a.id=n,a.textContent=e.txt,a.href="",a.setAttribute("data-ki-action","action"),kInteractive.questions.f.addMedia(e,a,o.options),void 0===isKotobee&&a.addEventListener("click",(function(e){e.preventDefault(),kInteractive.actionEvent(e)})),u.appendChild(a)}));var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.classList.add("mt-lines"),p.setAttribute("xmlns","http://www.w3.org/2000/svg"),p.style.position="absolute",p.style.top="0",p.style.left="0",p.style.width="100%",p.style.height="100%",p.style.pointerEvents="none",l.style.position="relative",l.appendChild(d),l.appendChild(p),l.appendChild(u);var f=document.createElement("div");return f.className="mt-mobile",s.forEach((function(t,n){var o=document.createElement("div");o.className="mt-mobile-item";var s=document.createElement("div");s.className="mt-left-label",s.textContent=t.txt;var l=document.createElement("select");l.className="mt-mobile-select ki-textfield ",l.setAttribute("data-left",t.txt);var d=document.createElement("option");d.value="default";var u=e.qsData.userDict;d.textContent=u&&u.selectMatch?u.selectMatch:"Select a match",l.appendChild(d),c.forEach((function(e,t){var n=document.createElement("option");n.id="ki-mt-right-"+i+"-"+r+"-"+t,n.value=e.txt,n.textContent=e.txt,n.className="ans",l.appendChild(n)})),void 0===isKotobee&&l.addEventListener("change",(function(e){var t=a,n=t.mtSelection||(t.mtSelection={pairs:[]}),o=l.getAttribute("data-left"),i=l.value;n.pairs=n.pairs.filter((function(e){return e.left!==o})),i&&n.pairs.push({left:o,right:i,leftId:null,rightId:null});var r=kInteractive.helpers.persister.instances[t.id];r&&r.handleChange&&r.handleChange()})),o.appendChild(s),o.appendChild(l),f.appendChild(o)})),a.appendChild(l),a.appendChild(f),t.appendChild(a),t},redrawLines:function(e){var t=e.querySelector(".mt-left"),n=e.querySelector(".mt-right"),o=e.querySelector("svg.mt-lines");if(t&&n&&o){for(;o.firstChild;)o.removeChild(o.firstChild);var i=e.getBoundingClientRect();(e.mtSelection.pairs||[]).forEach((function(e){var t=document.getElementById(e.leftId),n=document.getElementById(e.rightId);if(t&&n){var r=t.getBoundingClientRect(),a=n.getBoundingClientRect(),s=r.right-i.left,c=r.top+r.height/2-i.top,l=a.left-i.left,d=a.top+a.height/2-i.top,u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",s),u.setAttribute("y1",c),u.setAttribute("x2",l),u.setAttribute("y2",d),u.setAttribute("stroke","#3a6"),u.setAttribute("stroke-width","2"),o.appendChild(u)}}))}},resize:function(e){var t=this,n=window.innerWidth<720,o=document.getElementById(e.id);if(kInteractive.hasClass(o,"isMobile")&&!n){o.classList.remove("isMobile");o.querySelector(".mt-container");o.querySelectorAll(".mt-container").forEach((function(e){e.mtSelection=e.mtSelection||{first:null,pairs:[]},t.redrawLines(e)}))}!kInteractive.hasClass(o,"isMobile")&&n&&(o.classList.add("isMobile"),o.querySelectorAll(".mt-container").forEach((function(e){e.mtSelection=e.mtSelection||{first:null,pairs:[]},e.querySelectorAll(".mt-mobile-select").forEach((function(t){var n=t.getAttribute("data-left"),o=e.mtSelection.pairs.find((function(e){return e.left===n}));t.value=o?o.right:"default"}))})))}},kInteractive.questions.na={create:function(e){var t=e.qElem,n=e.qData,o=e.k,i=e.i,r=document.createElement("input");return r.id="ki-na-"+o+"-"+i,r.name="na-"+o+"-"+i,r.type="number",r.className="ki-textfield ans txtfield",r.inputMode="decimal",r.step=null!=n.step?String(n.step):"any",null!=n.min&&(r.min=String(n.min)),null!=n.max&&(r.max=String(n.max)),n.placeholder&&(r.placeholder=n.placeholder),void 0===isKotobee&&(r.addEventListener("keyup",kInteractive.actionEvent),r.addEventListener("change",kInteractive.actionEvent)),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[i]&&(r.value=document[item.id].q[i]),t.appendChild(r),t}},kInteractive.questions.sa={create:function(e){var t=e.qElem,n=e.qData,o=(e.qsData,e.k),i=e.i,r=(e.elem,n.lines?n.lines:1),a=document.createElement(r>1?"textarea":"input"),s="ki-sa-"+o+"-"+i;return a.id=s,a.name="sa-"+o+"-"+i,1==r?a.type="text":a.rows=n.lines?n.lines:1,a.className="ki-textfield ans txtfield",void 0===isKotobee&&(a.addEventListener("keyup",kInteractive.actionEvent),a.addEventListener("change",kInteractive.actionEvent)),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[i]&&(a.value=document[item.id].q[i]),t.appendChild(a),t}},kInteractive.questions.sp={create:function(e){var t=e.qElem,n=e.qData;n.topBorder&&kInteractive.c.addClass(t,"topBorder"),n.bottomBorder&&kInteractive.c.addClass(t,"bottomBorder"),kInteractive.c.addClass(t,"separator")}},kInteractive.questions.tf={create:function(e){var t=e.qElem,n=e.qData,o=e.qsData,i=e.k,r=e.i;o.options.inlineChoices&&kInteractive.c.addClass(t,"qInlineChoices"),o.options.toggleChoices&&kInteractive.c.addClass(t,"qToggleChoices");for(var a=0;a<2;a++){var s="ki-tf-"+i+"-"+r+"-"+a,c=document.createElement("input");c.type="radio",c.className="ki-inputbox ans",c.id=s,c.name="tf-"+i+"-"+r,void 0===isKotobee&&c.addEventListener("click",kInteractive.actionEvent);var l=document.createElement("label");l.htmlFor=s,n.choice1&&n.choice2?l.innerHTML=kInteractive.escapeHtml(" "+(0==a?n.choice1:n.choice2)):l.innerHTML=" "+(0==a?"True":"False"),l.className="ki-noHighlight";var d=document.createElement("div");d.className="answer",document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[r]&&(c.checked=document[item.id].q[r][a],o.options&&o.options.highlightCorrect&&(0==a&&n.a||1==a&&!n.a)&&kInteractive.c.addClass(d,"correct")),d.appendChild(c),d.appendChild(l),t.appendChild(d)}return t}},kInteractive.helpers.persister={instances:{},addInstance:function(e,t){kInteractive.helpers.persister.instances[e]=new kPersister(t)}},"undefined"==typeof rootDir&&(rootDir=""),"undefined"==typeof hostingDomain&&(hostingDomain=""),"undefined"==typeof hostUrlMode&&(hostUrlMode=""),"null"==hostingDomain&&(hostingDomain=""),"null"==hostUrlMode&&(hostUrlMode=""),setConfigDefaults(),debug){var sdkProfilesEnabled=localStorage.sdkProfilesEnabled,sdkProfile=localStorage.sdkProfile;sdkProfilesEnabled&&JSON.parse(sdkProfilesEnabled)&&sdkProfile&&JSON.parse(sdkProfile)&&(config.kotobee=JSON.parse(sdkProfile),delete config.kotobee.name,delete config.kotobee.locked,sdkProfile=null)}if(config.kotobee||(config.kotobee={}),window.location.origin&&config.kotobee.liburl&&0==window.location.origin.indexOf("https://")&&-1!=window.location.origin.indexOf(".kotobee.com")&&isKotobeeHosted()&&!isKotobeeBooks()&&(config.kotobee.liburl=window.location.origin+"/"),isKotobeeHosted())try{publicRoot}catch(e){publicRoot=""}function delayIfSDK(e){return e()}function createVueApp(){Vue.mixin({data:function(){return{data:stg.data,view:stg.view,vueExclude:vueExclude,mobile:mobile,isRelease:isRelease,native:isNative,desktop:desktop,ios:ios,preview:preview,readerApp:isReaderApp,config:config}},methods:{noop:function(){},d:function(e,t){t||(t="");for(var n=t.split("."),o=e,i=0;i<n.length;i++)if(!(o=o[n[i]]))return;return o},htmlSafe:function(e){return e},injectSupportUrl:function(e){if(e=translit.get(e),config&&config.kotobee&&config.kotobee.supporturl){var t=config.kotobee.supporturl.trim();return/^\S+@\S+\.\S+$/.test(t)?t="mailto:"+t:0!=t.indexOf("http")&&(t="https://"+t),e.replace(/<span data-support>(.*?)<\/span>/g,"<a href='"+t+"' target='_blank'>$1</a>")}return e},refreshData:function(){this.$nextTick(stg.forceDataRender)},set:function(e,t,n){Vue.set(e,t,n)},templateUrl:getTemplate,unsafe:function(e){return e},unsafeResource:function(e){return e},nativeLinks:function(e){return this.$options.filters.nativeLinks(e)},cloudParam:function(){return backend.cloudParam.apply(this,arguments)},$broadcast:function(){},$apply:function(){},inherited:function(e){function t(t,n,o){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){return inherited(e,t,n)})),t:function(){return this.$options.filters.t.apply(this,arguments)}},filters:{lc:function(e){return e},filter:function(e,t){return e.filter(t)}},created:function(){if(this.$el)for(var e=this.$el.getElementsByTagName("input"),t=0;t<e.length;t++)e[t].settAttribute("autocomplete","off")},computed:{rootDir:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return rootDir||""}))},mounted:function(){}});var e=[{path:"/",name:"blank",component:compClasses.blank},{path:"/landing",name:"landing",component:compClasses.landing},{path:"/authredirect/:provider/:idToken/:accessToken",name:"authredirect",component:compClasses.authRedirect},{path:"/payment/:provider/:state/:bookID/:userID",name:"payment",component:compClasses.payment},{path:"/payment/:provider/:state/:userID",name:"payment",component:compClasses.payment},{path:"/invoice",name:"invoice",component:compClasses.invoice},{path:"/login",name:"login",component:compClasses.login},{path:"/register",name:"register",component:compClasses.register},{path:"/forgotpwd",name:"forgotpwd",component:compClasses.forgotPwd},{path:"/redeemcode",name:"redeemcode",component:compClasses.redeemCode},{path:"/library",name:"library",component:compClasses.library},{path:"/library/tab/:tab",name:"libraryTab",component:compClasses.library},{path:"/library/search",name:"librarySearch",component:compClasses.library},{path:"/library/cat/:cat",name:"libraryCat",component:compClasses.library},{path:"/library/book/:book",name:"libraryBookDetails",component:compClasses.library},{path:"/reader",name:"reader",component:compClasses.reader},{path:"/reader/chapter/:ch",name:"reader",component:compClasses.reader},{path:"/reader/chapter/:ch/:hash",name:"reader",component:compClasses.reader},{path:"/audiobook",name:"audiobook",component:compClasses.audiobook},{path:"/audiobook/chapter/:ch",name:"audiobook",component:compClasses.audiobook},{path:"/audiobook/chapter/:ch/:hash",name:"audiobook",component:compClasses.audiobook},{path:"/book/:book/reader",name:"reader",component:compClasses.reader},{path:"/book/:book/reader/chapter/:ch",name:"reader",component:compClasses.reader},{path:"/book/:book/reader/chapter/:ch/:hash",name:"reader",component:compClasses.reader},{path:"/book/:book/audiobook",name:"audiobook",component:compClasses.audiobook},{path:"/book/:book/audiobook/chapter/:ch",name:"audiobook",component:compClasses.audiobook},{path:"/book/:book/audiobook/chapter/:ch/:hash",name:"audiobook",component:compClasses.audiobook}];isRelease||e.push({path:"/test",component:compClasses.test});var t,n=new VueRouter({routes:e});n.beforeEach((function(e,n,o){if(e&&e.name&&n&&n.name&&"reader"===n.name&&"library"===e.name&&window.dispatchEvent(new CustomEvent("unmountMiniapp")),t||(t=stg.data.initPath=$location.path()),firstRouteShown)d();else{if(0==t.indexOf("/book/"))(r=(s=t.split("/book/")[1]).split("/")).length>0&&(library.startBook=Number(r[0]));else if(-1!=window.location.href.indexOf("?book=")){var i=window.location.href.replace(/.*\?book=(\d*).*/g,"$1");Number(i)&&(library.startBook=i)}if("undefined"!=typeof defaultBook&&Number(defaultBook)&&(library.startBook=defaultBook),t.indexOf("/reader/chapter/")>=0){var r,a=(s=t.split("/reader/chapter/")[1]).split("?vi=");a.length>1&&(chapters.startVIndex=a[1],s=a[0]),(r=s.split("/")).length>0&&(chapters.startChapter=isNaN(r[0])?0:Number(r[0])),r.length>1&&(chapters.startHash=r[1])}if(t.indexOf("/library/book/")>=0){var s=t.split("/library/book/")[1];library.startBookDetails=Number(s)}if("/"==e.path&&"/"==n.path)d();else{for(var c=["/authredirect","/payment","/invoice","/test"],l=0;l<c.length;l++)if(0==e.path.indexOf(c[l]))return d();o(!1)}}function d(){"blank"!=e.name&&setTimeout(removeSplashScreen,1e3),o()}})),firstRouteShown=!1,new Vue({el:"#kotobeeVue",data:{ob:{},currentScreen:"",modal:null},mounted:function(){this.start()},router:n,methods:{start:function(){if(window.vueApp=this,"undefined"!=typeof kTemplates&&kTemplates(),"undefined"==typeof initializer)return setTimeout(this.start,100);delayIfSDK((function(){if(firstRouteShown=!0,initializer.handleRedirect(t))stg.data.initPath=null;else{for(var e,n,o,i=["/authredirect","/payment","/invoice","/test"],r=0;r<i.length;r++)if(-1!=t.indexOf(i[r]))return;e=document.getElementById("kotobeeLink"),n=document.getElementById("html5Fallback"),o=document.getElementById("localFallback"),e.parentNode.removeChild(e),n.parentNode.removeChild(n),o.parentNode.removeChild(o),initializer.initialize()}}))}}})}function stopAllAudio(){for(var e=document.getElementsByTagName("audio"),t=0;t<e.length;t++)e[t].pause(),e[t].src="";try{document.bgAudio&&(document.bgAudio.pause(),document.bgAudio.src="")}catch(e){}}function applyPreview(e){for(var t in e)Vue.set(config,t,e[t]);design.injectUserCSS(e)}function previewPage(e,t){if("undefined"==typeof stg)return setTimeout((function(){previewPage(e,t)}),100);e||(e="bookInfo"),t||(t={lang:"en",book:{name:"Alice",description:"A great book indeed"}}),"bookInfo"==e&&(config=t.config?t.config:{kotobee:{entry:1,mode:"library"}},stg.data.user=t.user?t.user:{loggedIn:!0},stg.data.currentLibrary=t.library?t.library:{},backend.getS3Paths((function(){translit.setLang(t.lang?t.lang:"en"),bookinfo.show({book:t.book},{animation:"none"})})))}function previewPageOld(e,t){var n=angular.element(document.body).scope();n.previewPage&&n.previewPage(e,t)}function getCookie(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()}function getVar(e){return Modernizr.localstorage?localStorage[e]:getCookie("continueWithoutHTML5")}function setVar(e,t){Modernizr.localstorage?localStorage[e]=t:document.cookie=e+"="+t}function getGlobal(){return angular.element(document.body).scope()}function closePrintIframe(){var e=document.getElementById("printContainer");e&&e.parentNode.removeChild(e)}function putTest(e){}function continueLocally(){setVar("continueLocally","true"),location.reload()}function continueWithoutHTML5(){setVar("continueWithoutHTML5","true"),location.reload()}function isArabic(e){return e.match(/[\u0600-\u06FF\u0750-\u077F]+/g)}function normalize(e){return e.replace(/\u0610/g,"").replace(/\u0611/g,"").replace(/\u0612/g,"").replace(/\u0613/g,"").replace(/\u0614/g,"").replace(/\u0615/g,"").replace(/\u0616/g,"").replace(/\u0617/g,"").replace(/\u0618/g,"").replace(/\u0619/g,"").replace(/\u061A/g,"").replace(/\u06D6/g,"").replace(/\u06D7/g,"").replace(/\u06D8/g,"").replace(/\u06D9/g,"").replace(/\u06DA/g,"").replace(/\u06DB/g,"").replace(/\u06DC/g,"").replace(/\u06DD/g,"").replace(/\u06DE/g,"").replace(/\u06DF/g,"").replace(/\u06E0/g,"").replace(/\u06E1/g,"").replace(/\u06E2/g,"").replace(/\u06E3/g,"").replace(/\u06E4/g,"").replace(/\u06E5/g,"").replace(/\u06E6/g,"").replace(/\u06E7/g,"").replace(/\u06E8/g,"").replace(/\u06E9/g,"").replace(/\u06EA/g,"").replace(/\u06EB/g,"").replace(/\u06EC/g,"").replace(/\u06ED/g,"").replace(/\u0640/g,"").replace(/\u064B/g,"").replace(/\u064C/g,"").replace(/\u064D/g,"").replace(/\u064E/g,"").replace(/\u064F/g,"").replace(/\u0650/g,"").replace(/\u0651/g,"").replace(/\u0652/g,"").replace(/\u0653/g,"").replace(/\u0654/g,"").replace(/\u0655/g,"").replace(/\u0656/g,"").replace(/\u0657/g,"").replace(/\u0658/g,"").replace(/\u0659/g,"").replace(/\u065A/g,"").replace(/\u065B/g,"").replace(/\u065C/g,"").replace(/\u065D/g,"").replace(/\u065E/g,"").replace(/\u065F/g,"").replace(/\u0670/g,"").replace(/ࣰ/g,"").replace(/ࣱ/g,"").replace(/ࣲ/g,"").replace(/ࣳ/g,"").replace(/ﱢ/g,"").replace(/ﱠ/g,"").replace(/ىء/g,"ئ").replace(/؟/g,"")}!function(){function e(){addClass(document.getElementsByTagName("body")[0],mobile?"mobile":"web");for(var e,t=document.getElementsByTagName("head")[0],n=t.innerHTML,o=[],i=document.getElementsByTagName("script"),r=0;r<i.length;r++)if(i[r].getAttribute("src")&&i[r].getAttribute("src").indexOf("lib/ionic/release/js")>=0){var a=i[r].getAttribute("src").split("lib/ionic/release/js");rootDir=a[0];break}e=[rootDir+"lib/ionic/release/css/ionic.min.css"];for(r=0;r<o.length;r++)n+='<script src="'+o[r]+'" type="text/javascript"><\/script>';for(r=0;r<e.length;r++)n='<link rel="stylesheet" href="'+e[r]+'">'+n;t.innerHTML=n,config.noLoadingScreen&&document.body.classList.add("noLoadingScreen")}if(detectIE()||ios){var t=function(){var e=document.getElementsByTagName("body");if(!e.length)return setTimeout(t,100);ios?(addClass(e[0],"ios"),addClass(e[0],"fullscreen")):addClass(e[0],"ie")};t()}var n=document.getElementsByTagName("head");if(!preview){if(config.gAnalyticsID){var o="";isKotobeeHosted()&&(o=getReaderOrigin()+"/bundles/vijualib/templates/reader/public/");var i="";(isNative||desktop)&&(i="ga('set','checkProtocolTask',null);ga('set','anonymizeIp',true);ga('set','forceSSL',true)");var r="'auto'";isNative?r="{'storage':'none','clientId':device.uuid}":desktop&&(r="{'storage':'none'}"),(c=document.createElement("script")).innerHTML="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','"+o+"lib/gAnalytics/analytics.js','ga');ga('create', '"+config.gAnalyticsID+"', "+r+");"+i,n.length&&n[0].appendChild(c)}if(config.gAnalyticsMeasurementId){(c=document.createElement("script")).async=!0,c.src="https://www.googletagmanager.com/gtag/js?id="+config.gAnalyticsMeasurementId;var a=document.createElement("script");a.innerHTML="window.dataLayer = window.dataLayer || [];\nfunction gtag(){dataLayer.push(arguments);}\ngtag('js', new Date());\ngtag('config', '"+config.gAnalyticsMeasurementId+"');",document.head.appendChild(c),document.head.appendChild(a)}if(config.js)for(var s=0;s<config.js.length;s++){var c;(c=document.createElement("script")).src=config.js[s],c.className="kotobeeInjectedScript",document.getElementsByTagName("body")[0].appendChild(c)}if(config.css)for(s=0;s<config.css.length;s++){var l=document.createElement("link");l.rel="stylesheet",l.href=config.css[s],l.className="kotobeeInjectedScript",document.getElementsByTagName("body")[0].appendChild(l)}if(security.applyContextmenu(),"undefined"!=typeof cordova)isNative=!0;else if("file:"==window.location.protocol||"kotobee:"==window.location.protocol||"undefined"!=typeof require){if(mobile)isNative=!0;else if("undefined"!=typeof require){desktop=!0,os="mac",process.env.OS&&process.env.OS.toLowerCase().indexOf("windows")>=0&&(os=process.env.PROCESSOR_ARCHITECTURE.indexOf("64")>=0?"win64":"win32"),String(require("nw.gui").App.argv).indexOf("--mobile")>=0&&(mobile=1)}else if(window.chrome&&chrome.app&&chrome.app.runtime&&chrome.storage){try{if(!chromeEnabled)return}catch(e){return}chromeApp=!0}else if("true"!=getVar("continueLocally"))return setTimeout((function(){document.getElementById("localFallback").style.display="block",document.getElementById("kotobeeLink").style.display="none",document.getElementsByTagName("body")[0].style.cssText="overflow-y: scroll;"}),100),void e()}else"chrome-extension:"==window.location.protocol&&(chromeApp=!0)}if(!chromeApp){if("true"!=getVar("continueWithoutHTML5")&&!(Modernizr.audio&&Modernizr.video&&Modernizr.backgroundsize&&Modernizr.borderradius&&Modernizr.canvas&&Modernizr.opacity&&Modernizr.localstorage&&Modernizr.rgba))return setTimeout((function(){document.getElementById("html5Fallback").style.display="block",document.getElementById("kotobeeLink").style.display="none",document.getElementsByTagName("body")[0].style.cssText="overflow-y: scroll;"}),100),void e();setVar("continueLocally","false"),setVar("continueWithoutHTML5","false")}if(e(),vueExclude){angular.module("ngIOS9UIWebViewPatch",["ng"]).config(["$provide",function(e){e.decorator("$browser",["$delegate","$window",function(e,t){return n=t.navigator.userAgent,/(iPhone|iPad|iPod).* OS 9_\d/.test(n)&&!/Version\/9\./.test(n)?function(e){var t=null,n=e.url;function o(){t=null}return e.url=function(){return arguments.length?(t=arguments[0],n.apply(e,arguments)):t||n.apply(e,arguments)},window.addEventListener("popstate",o,!1),window.addEventListener("hashchange",o,!1),e}(e):e;var n}])}]);var d=["ionic","angular.css.injector","ngIOS9UIWebViewPatch","templates"];"undefined"!=typeof scormEnabled&&scormEnabled&&d.push("scormwrapper");try{angular.module("templates")}catch(e){angular.module("templates",[]).run(["$templateCache",function(e){}])}0,app=angular.module("reader.Kotobee",d),ionic.Platform.isFullScreen=!1,app.config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$compileProvider",function(e,t,n,o){(chromeApp||desktop||isNative)&&(o.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|kotobee|blob|chrome-extension):|data:image\/)/),o.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|kotobee|chrome-extension):/)),n.views.swipeBackEnabled(!1),e.state("loading",{url:"/loading",templateUrl:kTemplate("views/blank.html")}).state("landing",{url:"/landing",templateUrl:kTemplate("views/landing.html")}).state("oauth",{url:"/oauth/:provider/:idToken/:accessToken",templateUrl:kTemplate("views/auth.html")}).state("payment",{url:"/payment/:provider/:state/:bookID/:userID",templateUrl:kTemplate("views/payment.html")}).state("paymentMultiple",{url:"/payment/:provider/:state/:userID",templateUrl:kTemplate("views/payment.html")}).state("invoice",{url:"/invoice",templateUrl:kTemplate("views/invoice.html")}).state("login",{url:"/login",templateUrl:kTemplate("views/login.html")}).state("register",{url:"/register",templateUrl:kTemplate("views/register.html")}).state("forgotPwd",{url:"/forgotpwd",templateUrl:kTemplate("views/forgotPwd.html")}).state("redeemCode",{url:"/redeemcode",templateUrl:kTemplate("views/redeemCode.html")}).state("library",{url:"/library",templateUrl:kTemplate("views/library.html")}).state("library_search",{url:"/library/search",templateUrl:kTemplate("views/library.html")}).state("library_tab",{url:"/library/tab/:tab",templateUrl:kTemplate("views/library.html")}).state("library_bookdetails",{url:"/library/book/:book",templateUrl:kTemplate("views/library.html")}).state("reader",{url:"/reader",templateUrl:kTemplate("views/reader.html")}).state("reader.chapter",{url:"/chapter/:ch",templateUrl:kTemplate("views/reader.html")}).state("reader.chapterhash",{url:"/chapter/:ch/:hash",templateUrl:kTemplate("views/reader.html")}).state("libraryreader",{url:"/book/:book/reader",templateUrl:kTemplate("views/reader.html")}).state("libraryreader.chapter",{url:"/chapter/:ch",templateUrl:kTemplate("views/reader.html")}).state("libraryreader.chapterhash",{url:"/chapter/:ch/:hash",templateUrl:kTemplate("views/reader.html")}).state("app",{url:"/app",templateUrl:kTemplate("views/app.html")})}]),app.run((function(e,t,n,o,i,r){var a=t.path();if(0==a.indexOf("/book/"))(c=a.split("/"))[1]&&(o.startBook=Number(c[0])),c[2]&&(o.startPage=c[2]);else if(-1!=window.location.href.indexOf("?book=")){var s=window.location.href.replace(/.*\?book=(\d*).*/g,"$1");Number(s)&&(o.startBook=s)}if(a.indexOf("/reader/chapter/")>=0){var c,l=a.split("/reader/chapter/")[1],d=l.split("?vi=");d.length>1&&(n.startVIndex=d[1],l=d[0]),(c=l.split("/")).length>0&&(n.startChapter=isNaN(c[0])?0:Number(c[0])),c.length>1&&(n.startHash=c[1])}if("undefined"!=typeof kTemplates&&kTemplates(i),!r.handleRedirect(a)){for(var u=["/oauth","/invoice","/test"],p=0;p<u.length;p++)if(-1!=a.indexOf(u[p]))return;r.initialize()}}))}delayIfSDK(createVueApp)}();